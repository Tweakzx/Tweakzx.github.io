<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='学习Go语言的一些练习代码'><title>Go语言之旅</title>

<link rel='canonical' href='https://tweakzx.github.io/p/go%E8%AF%AD%E8%A8%80%E4%B9%8B%E6%97%85/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='Go语言之旅'>
<meta property='og:description' content='学习Go语言的一些练习代码'>
<meta property='og:url' content='https://tweakzx.github.io/p/go%E8%AF%AD%E8%A8%80%E4%B9%8B%E6%97%85/'>
<meta property='og:site_name' content='Tweakzx'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Go语言' /><meta property='article:tag' content='练习代码' /><meta property='article:published_time' content='2022-02-22T17:20:32&#43;08:00'/><meta property='article:modified_time' content='2022-02-22T17:20:32&#43;08:00'/><meta property='og:image' content='https://go.dev/images/gophers/biplane.svg' />
<meta name="twitter:title" content="Go语言之旅">
<meta name="twitter:description" content="学习Go语言的一些练习代码"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://go.dev/images/gophers/biplane.svg' />
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/go%E8%AF%AD%E8%A8%80%E4%B9%8B%E6%97%85/">
                
                    <img src="https://go.dev/images/gophers/biplane.svg" loading="lazy" alt="Featured image of post Go语言之旅" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/go%E8%AF%AD%E8%A8%80/" >
                Go语言
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/p/go%E8%AF%AD%E8%A8%80%E4%B9%8B%E6%97%85/">Go语言之旅</a>
    </h2>

    
    <h3 class="article-subtitle">
        学习Go语言的一些练习代码
    </h3>
    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Feb 22, 2022</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    6 minute read
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <h1 id="旅行起点">旅行起点</h1>
<p><a class="link" href="https://tour.go-zh.org/welcome/1"  target="_blank" rel="noopener"
    >Go 语言之旅 (go-zh.org)</a></p>
<p>上方链接是一个Go语言学习的Playground，快点击它，开启一场Go语言之旅吧</p>
<h1 id="旅行开始">旅行开始</h1>
<h2 id="练习循环与函数">练习：循环与函数</h2>
<p>为了练习函数与循环，我们来实现一个平方根函数：用牛顿法实现平方根函数。</p>
<p>计算机通常使用循环来计算 x 的平方根。从某个猜测的值 z 开始，我们可以根据 z² 与 x 的近似度来调整 z，产生一个更好的猜测：</p>
<pre><code>z -= (z*z - x) / (2*z)
</code></pre><p>重复调整的过程，猜测的结果会越来越精确，得到的答案也会尽可能接近实际的平方根。</p>
<p>在提供的 <code>func Sqrt</code> 中实现它。无论输入是什么，对 z 的一个恰当的猜测为 1。 要开始，请重复计算 10 次并随之打印每次的 z 值。观察对于不同的值 x（1、2、3 &hellip;）， 你得到的答案是如何逼近结果的，猜测提升的速度有多快。</p>
<p>提示：用类型转换或浮点数语法来声明并初始化一个浮点数值：</p>
<pre><code>z := 1.0
z := float64(1)
</code></pre><p>然后，修改循环条件，使得当值停止改变（或改变非常小）的时候退出循环。观察迭代次数大于还是小于 10。 尝试改变 z 的初始猜测，如 x 或 x/2。你的函数结果与标准库中的 <a class="link" href="https://go-zh.org/pkg/math/#Sqrt"  target="_blank" rel="noopener"
    >math.Sqrt</a> 接近吗？</p>
<p>（<em>注：</em> 如果你对该算法的细节感兴趣，上面的 z² − x 是 z² 到它所要到达的值（即 x）的距离， 除以的 2z 为 z² 的导数，我们通过 z² 的变化速度来改变 z 的调整量。 这种通用方法叫做<a class="link" href="https://zh.wikipedia.org/wiki/%e7%89%9b%e9%a1%bf%e6%b3%95"  target="_blank" rel="noopener"
    >牛顿法</a>。 它对很多函数，特别是平方根而言非常有效。）</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;math&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">Sqrt</span><span class="p">(</span><span class="nx">x</span> <span class="kt">float64</span><span class="p">)</span> <span class="p">(</span><span class="nx">z</span> <span class="kt">float64</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">z</span> <span class="p">=</span> <span class="nb">float64</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="nx">z</span><span class="o">*</span><span class="nx">z</span><span class="o">-</span><span class="nx">x</span><span class="p">)&gt;</span><span class="mf">0.000001</span> <span class="p">{</span>
		<span class="nx">z</span> <span class="o">-=</span> <span class="p">(</span><span class="nx">z</span><span class="o">*</span><span class="nx">z</span><span class="o">-</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nx">z</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">Sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="p">}</span>

</code></pre></div><h2 id="练习切片">练习：切片</h2>
<p>实现 <code>Pic</code>。它应当返回一个长度为 <code>dy</code> 的切片，其中每个元素是一个长度为 <code>dx</code>，元素类型为 <code>uint8</code> 的切片。当你运行此程序时，它会将每个整数解释为灰度值（好吧，其实是蓝度值）并显示它所对应的图像。</p>
<p>图像的选择由你来定。几个有趣的函数包括 <code>(x+y)/2</code>, <code>x*y</code>, <code>x^y</code>, <code>x*log(y)</code> 和 <code>x%(y+1)</code>。</p>
<p>（提示：需要使用循环来分配 <code>[][]uint8</code> 中的每个 <code>[]uint8</code>；请使用 <code>uint8(intValue)</code> 在类型之间转换；你可能会用到 <code>math</code> 包中的函数。）</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;golang.org/x/tour/pic&#34;</span>

<span class="kd">func</span> <span class="nf">Pic</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span> <span class="kt">int</span><span class="p">)</span> <span class="p">[][]</span><span class="kt">uint8</span> <span class="p">{</span>
	<span class="nx">picture</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([][]</span><span class="kt">uint8</span><span class="p">,</span><span class="nx">dy</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">x</span><span class="o">:=</span><span class="k">range</span> <span class="nx">picture</span><span class="p">{</span>
		<span class="nx">line</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">uint8</span><span class="p">,</span><span class="nx">dx</span><span class="p">)</span> 
		<span class="k">for</span> <span class="nx">y</span><span class="o">:=</span><span class="k">range</span> <span class="nx">line</span><span class="p">{</span>
			<span class="nx">line</span><span class="p">[</span><span class="nx">y</span><span class="p">]</span> <span class="p">=</span> <span class="nb">uint8</span><span class="p">((</span><span class="nx">x</span><span class="o">+</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="nx">picture</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span> <span class="p">=</span> <span class="nx">line</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">picture</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">pic</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="nx">Pic</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><h2 id="练习映射">练习：映射</h2>
<p>实现 <code>WordCount</code>。它应当返回一个映射，其中包含字符串 <code>s</code> 中每个“单词”的个数。函数 <code>wc.Test</code> 会对此函数执行一系列测试用例，并输出成功还是失败。</p>
<p>你会发现 <a class="link" href="https://go-zh.org/pkg/strings/#Fields"  target="_blank" rel="noopener"
    >strings.Fields</a> 很有帮助。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;golang.org/x/tour/wc&#34;</span>
	<span class="s">&#34;strings&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">WordCount</span><span class="p">(</span><span class="nx">s</span> <span class="kt">string</span><span class="p">)</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span> <span class="p">{</span>
	<span class="nx">words</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Fields</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
	<span class="nx">ans</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span><span class="nx">w</span> <span class="o">:=</span><span class="k">range</span> <span class="nx">words</span><span class="p">{</span>
		<span class="c1">//v,ok := ans[w]
</span><span class="c1"></span>		<span class="nx">ans</span><span class="p">[</span><span class="nx">w</span><span class="p">]</span> <span class="p">=</span> <span class="nx">ans</span><span class="p">[</span><span class="nx">w</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ans</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">wc</span><span class="p">.</span><span class="nf">Test</span><span class="p">(</span><span class="nx">WordCount</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><h2 id="练习斐波纳契闭包">练习：斐波纳契闭包</h2>
<p>让我们用函数做些好玩的事情。</p>
<p>实现一个 <code>fibonacci</code> 函数，它返回一个函数（闭包），该闭包返回一个<a class="link" href="https://zh.wikipedia.org/wiki/%e6%96%90%e6%b3%a2%e9%82%a3%e5%a5%91%e6%95%b0%e5%88%97"  target="_blank" rel="noopener"
    >斐波纳契数列</a> <code>(0, 1, 1, 2, 3, 5, ...)</code>。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>

<span class="c1">// 返回一个“返回int的函数”
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">fibonacci</span><span class="p">()</span> <span class="kd">func</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="nx">first</span> <span class="o">:=</span> <span class="mi">2</span> 
	<span class="nx">second</span> <span class="o">:=</span> <span class="mi">1</span>   <span class="c1">//根据公式倒推出的first和second
</span><span class="c1"></span>	<span class="k">return</span> <span class="kd">func</span><span class="p">()</span> <span class="kt">int</span><span class="p">{</span>
		<span class="nx">first</span> <span class="p">=</span> <span class="nx">second</span> <span class="o">-</span> <span class="nx">first</span>
		<span class="nx">second</span> <span class="p">=</span> <span class="nx">second</span> <span class="o">+</span> <span class="nx">first</span> <span class="c1">//斐波那契公式
</span><span class="c1"></span>		<span class="k">return</span> <span class="nx">second</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">f</span> <span class="o">:=</span> <span class="nf">fibonacci</span><span class="p">()</span>
	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">f</span><span class="p">())</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="练习stringer">练习：Stringer</h2>
<p>通过让 <code>IPAddr</code> 类型实现 <code>fmt.Stringer</code> 来打印点号分隔的地址。</p>
<p>例如，<code>IPAddr{1, 2, 3, 4}</code> 应当打印为 <code>&quot;1.2.3.4&quot;</code>。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>

<span class="kd">type</span> <span class="nx">IPAddr</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="kt">byte</span>

<span class="c1">// TODO: 给 IPAddr 添加一个 &#34;String() string&#34; 方法
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">ip</span> <span class="nx">IPAddr</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span><span class="p">{</span>
	<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%v.%v.%v.%v\n&#34;</span><span class="p">,</span><span class="nx">ip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nx">ip</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nx">ip</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="nx">ip</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">hosts</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">IPAddr</span><span class="p">{</span>
		<span class="s">&#34;loopback&#34;</span><span class="p">:</span>  <span class="p">{</span><span class="mi">127</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
		<span class="s">&#34;googleDNS&#34;</span><span class="p">:</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">ip</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">hosts</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%v: %v\n&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">ip</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="练习错误">练习：错误</h2>
<p>从<a class="link" href="https://tour.go-zh.org/flowcontrol/8"  target="_blank" rel="noopener"
    >之前的练习</a>中复制 <code>Sqrt</code> 函数，修改它使其返回 <code>error</code> 值。</p>
<p><code>Sqrt</code> 接受到一个负数时，应当返回一个非 nil 的错误值。复数同样也不被支持。</p>
<p>创建一个新的类型</p>
<pre><code>type ErrNegativeSqrt float64
</code></pre><p>并为其实现</p>
<pre><code>func (e ErrNegativeSqrt) Error() string
</code></pre><p>方法使其拥有 <code>error</code> 值，通过 <code>ErrNegativeSqrt(-2).Error()</code> 调用该方法应返回 <code>&quot;cannot Sqrt negative number: -2&quot;</code>。</p>
<p><strong>注意:</strong> 在 <code>Error</code> 方法内调用 <code>fmt.Sprint(e)</code> 会让程序陷入死循环。可以通过先转换 <code>e</code> 来避免这个问题：<code>fmt.Sprint(float64(e))</code>。这是为什么呢？</p>
<p>修改 <code>Sqrt</code> 函数，使其接受一个负数时，返回 <code>ErrNegativeSqrt</code> 值。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
<span class="p">)</span>
<span class="kd">type</span> <span class="nx">ErrNegativeSqrt</span> <span class="kt">float64</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="nx">ErrNegativeSqrt</span><span class="p">)</span> <span class="nf">Error</span><span class="p">()</span> <span class="kt">string</span><span class="p">{</span>
	<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;cannot Sqrt negative number: %v&#34;</span><span class="p">,</span><span class="nb">float64</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">Sqrt</span><span class="p">(</span><span class="nx">x</span> <span class="kt">float64</span><span class="p">)</span> <span class="p">(</span><span class="kt">float64</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">x</span><span class="p">&gt;</span><span class="mi">0</span><span class="p">{</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">nil</span>
	<span class="p">}</span><span class="k">else</span><span class="p">{</span>
		<span class="kd">var</span> <span class="nx">e</span> <span class="nx">ErrNegativeSqrt</span>
		<span class="nx">e</span> <span class="p">=</span> <span class="nf">ErrNegativeSqrt</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
		<span class="k">return</span> <span class="nx">x</span><span class="p">,</span><span class="nx">e</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">Sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">Sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div><h2 id="练习reader">练习：Reader</h2>
<p>实现一个 <code>Reader</code> 类型，它产生一个 ASCII 字符 <code>'A'</code> 的无限流。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;golang.org/x/tour/reader&#34;</span>

<span class="kd">type</span> <span class="nx">MyReader</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// TODO: 给 MyReader 添加一个 Read([]byte) (int, error) 方法
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">mr</span> <span class="nx">MyReader</span><span class="p">)</span> <span class="nf">Read</span><span class="p">(</span><span class="nx">buf</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span><span class="k">range</span> <span class="nx">buf</span><span class="p">{</span>
		<span class="nx">buf</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="sc">&#39;A&#39;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">reader</span><span class="p">.</span><span class="nf">Validate</span><span class="p">(</span><span class="nx">MyReader</span><span class="p">{})</span>
<span class="p">}</span>
</code></pre></div><h2 id="练习rot13reader">练习：rot13Reader</h2>
<p>有种常见的模式是一个 <a class="link" href="https://go-zh.org/pkg/io/#Reader"  target="_blank" rel="noopener"
    ><code>io.Reader</code></a> 包装另一个 <code>io.Reader</code>，然后通过某种方式修改其数据流。</p>
<p>例如，<a class="link" href="https://go-zh.org/pkg/compress/gzip/#NewReader"  target="_blank" rel="noopener"
    ><code>gzip.NewReader</code></a> 函数接受一个 <code>io.Reader</code>（已压缩的数据流）并返回一个同样实现了 <code>io.Reader</code> 的 <code>*gzip.Reader</code>（解压后的数据流）。</p>
<p>编写一个实现了 <code>io.Reader</code> 并从另一个 <code>io.Reader</code> 中读取数据的 <code>rot13Reader</code>，通过应用 <a class="link" href="http://en.wikipedia.org/wiki/ROT13"  target="_blank" rel="noopener"
    >rot13</a> 代换密码对数据流进行修改。</p>
<p><code>rot13Reader</code> 类型已经提供。实现 <code>Read</code> 方法以满足 <code>io.Reader</code>。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;io&#34;</span>
	<span class="s">&#34;os&#34;</span>
	<span class="s">&#34;strings&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">rot13Reader</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">r</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Reader</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span> <span class="nx">rot</span> <span class="nx">rot13Reader</span><span class="p">)</span> <span class="nf">Read</span><span class="p">(</span><span class="nx">buf</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">){</span>
	<span class="nx">len</span><span class="p">,</span><span class="nx">ok</span> <span class="o">:=</span> <span class="nx">rot</span><span class="p">.</span><span class="nx">r</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span><span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">buf</span><span class="p">{</span>
		<span class="k">switch</span><span class="p">{</span>
			<span class="k">case</span> <span class="p">(</span><span class="sc">&#39;a&#39;</span><span class="o">&lt;=</span><span class="nx">v</span> <span class="o">&amp;&amp;</span> <span class="nx">v</span><span class="o">&lt;=</span><span class="sc">&#39;m&#39;</span><span class="p">)</span><span class="o">||</span><span class="p">(</span><span class="sc">&#39;A&#39;</span><span class="o">&lt;=</span><span class="nx">v</span> <span class="o">&amp;&amp;</span> <span class="nx">v</span><span class="o">&lt;=</span><span class="sc">&#39;M&#39;</span><span class="p">):</span>
				<span class="nx">buf</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v</span><span class="o">+</span><span class="mi">13</span>
			<span class="k">case</span> <span class="p">(</span><span class="sc">&#39;n&#39;</span><span class="o">&lt;=</span><span class="nx">v</span> <span class="o">&amp;&amp;</span> <span class="nx">v</span><span class="o">&lt;=</span><span class="sc">&#39;z&#39;</span><span class="p">)</span><span class="o">||</span><span class="p">(</span><span class="sc">&#39;N&#39;</span><span class="o">&lt;=</span><span class="nx">v</span> <span class="o">&amp;&amp;</span> <span class="nx">v</span><span class="o">&lt;=</span><span class="sc">&#39;Z&#39;</span><span class="p">):</span>
				<span class="nx">buf</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v</span><span class="o">-</span><span class="mi">13</span>
			<span class="k">default</span><span class="p">:</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">len</span><span class="p">,</span><span class="nx">ok</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">s</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="s">&#34;Lbh penpxrq gur pbqr!&#34;</span><span class="p">)</span>
	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">rot13Reader</span><span class="p">{</span><span class="nx">s</span><span class="p">}</span>
	<span class="nx">io</span><span class="p">.</span><span class="nf">Copy</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">r</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><h2 id="练习图像">练习：图像</h2>
<p>还记得之前编写的<a class="link" href="https://tour.go-zh.org/moretypes/18"  target="_blank" rel="noopener"
    >图片生成器</a> 吗？我们再来编写另外一个，不过这次它将会返回一个 <code>image.Image</code> 的实现而非一个数据切片。</p>
<p>定义你自己的 <code>Image</code> 类型，实现<a class="link" href="https://go-zh.org/pkg/image/#Image"  target="_blank" rel="noopener"
    >必要的方法</a>并调用 <code>pic.ShowImage</code>。</p>
<p><code>Bounds</code> 应当返回一个 <code>image.Rectangle</code> ，例如 <code>image.Rect(0, 0, w, h)</code>。</p>
<p><code>ColorModel</code> 应当返回 <code>color.RGBAModel</code>。</p>
<p><code>At</code> 应当返回一个颜色。上一个图片生成器的值 <code>v</code> 对应于此次的 <code>color.RGBA{v, v, 255, 255}</code>。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;golang.org/x/tour/pic&#34;</span>
	<span class="s">&#34;image&#34;</span>
	<span class="s">&#34;image/color&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Image</span> <span class="kd">struct</span><span class="p">{</span>
	<span class="nx">w</span><span class="p">,</span><span class="nx">h</span> <span class="kt">int</span>
	<span class="nx">pixels</span> <span class="p">[][]</span><span class="kt">uint8</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="nx">Image</span><span class="p">)</span> <span class="nf">Bounds</span><span class="p">()(</span><span class="nx">image</span><span class="p">.</span><span class="nx">Rectangle</span><span class="p">){</span>
	<span class="k">return</span> <span class="nx">image</span><span class="p">.</span><span class="nf">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">h</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="nx">Image</span><span class="p">)</span> <span class="nf">ColorModel</span><span class="p">()(</span><span class="nx">color</span><span class="p">.</span><span class="nx">Model</span><span class="p">){</span>
	<span class="k">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBAModel</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="nx">Image</span><span class="p">)</span> <span class="nf">At</span><span class="p">(</span><span class="nx">x</span> <span class="kt">int</span> <span class="p">,</span><span class="nx">y</span> <span class="kt">int</span><span class="p">)(</span><span class="nx">color</span><span class="p">.</span><span class="nx">Color</span><span class="p">){</span>
	<span class="nx">v</span> <span class="o">:=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">pixels</span><span class="p">[</span><span class="nx">y</span><span class="p">][</span><span class="nx">x</span><span class="p">]</span>
	<span class="k">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span class="nx">v</span><span class="p">,</span><span class="nx">v</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">}</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">Pic</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span> <span class="kt">int</span><span class="p">)</span> <span class="p">[][]</span><span class="kt">uint8</span> <span class="p">{</span>
    <span class="nx">img</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([][]</span><span class="kt">uint8</span><span class="p">,</span> <span class="nx">dy</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">dy</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">img</span><span class="p">[</span><span class="nx">y</span><span class="p">]</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">uint8</span><span class="p">,</span> <span class="nx">dx</span><span class="p">)</span>
        <span class="k">for</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">dx</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
			<span class="nx">img</span><span class="p">[</span><span class="nx">y</span><span class="p">][</span><span class="nx">x</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="kt">uint8</span><span class="p">)(</span><span class="nx">x</span><span class="p">^</span><span class="nx">y</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">img</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">m</span> <span class="o">:=</span> <span class="nx">Image</span><span class="p">{</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="nf">Pic</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">)}</span>
	<span class="nx">pic</span><span class="p">.</span><span class="nf">ShowImage</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><h2 id="练习等价二叉查找树">练习：等价二叉查找树</h2>
<p><strong>1.</strong> 实现 <code>Walk</code> 函数。</p>
<p><strong>2.</strong> 测试 <code>Walk</code> 函数。</p>
<p>函数 <code>tree.New(k)</code> 用于构造一个随机结构的已排序二叉查找树，它保存了值 <code>k</code>, <code>2k</code>, <code>3k</code>, &hellip;, <code>10k</code>。</p>
<p>创建一个新的信道 <code>ch</code> 并且对其进行步进：</p>
<pre><code>go Walk(tree.New(1), ch)
</code></pre><p>然后从信道中读取并打印 10 个值。应当是数字 <code>1, 2, 3, ..., 10</code>。</p>
<p><strong>3.</strong> 用 <code>Walk</code> 实现 <code>Same</code> 函数来检测 <code>t1</code> 和 <code>t2</code> 是否存储了相同的值。</p>
<p><strong>4.</strong> 测试 <code>Same</code> 函数。</p>
<p><code>Same(tree.New(1), tree.New(1))</code> 应当返回 <code>true</code>，而 <code>Same(tree.New(1), tree.New(2))</code> 应当返回 <code>false</code>。</p>
<p><code>Tree</code> 的文档可在<a class="link" href="https://godoc.org/golang.org/x/tour/tree#Tree"  target="_blank" rel="noopener"
    >这里</a>找到。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;golang.org/x/tour/tree&#34;</span>
<span class="p">)</span>

<span class="c1">// Walk 步进 tree t 将所有的值从 tree 发送到 channel ch。
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Walk</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">tree</span><span class="p">.</span><span class="nx">Tree</span><span class="p">,</span> <span class="nx">ch</span> <span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="nf">dfs</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">ch</span><span class="p">)</span>
	<span class="nb">close</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">dfs</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">tree</span><span class="p">.</span><span class="nx">Tree</span><span class="p">,</span> <span class="nx">ch</span> <span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">t</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="nf">dfs</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">Left</span><span class="p">,</span> <span class="nx">ch</span><span class="p">)</span>
	<span class="nx">ch</span> <span class="o">&lt;-</span> <span class="nx">t</span><span class="p">.</span><span class="nx">Value</span>
	<span class="nf">dfs</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">Right</span><span class="p">,</span> <span class="nx">ch</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Same 检测树 t1 和 t2 是否含有相同的值。
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Same</span><span class="p">(</span><span class="nx">t1</span><span class="p">,</span> <span class="nx">t2</span> <span class="o">*</span><span class="nx">tree</span><span class="p">.</span><span class="nx">Tree</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
	<span class="nx">ch1</span><span class="p">,</span> <span class="nx">ch2</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">),</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>

	<span class="k">go</span> <span class="nf">Walk</span><span class="p">(</span><span class="nx">t1</span><span class="p">,</span> <span class="nx">ch1</span><span class="p">)</span>
	<span class="k">go</span> <span class="nf">Walk</span><span class="p">(</span><span class="nx">t2</span><span class="p">,</span> <span class="nx">ch2</span><span class="p">)</span>

	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">ch1</span> <span class="p">{</span> <span class="c1">// ch1 关闭后   for循环自动跳出
</span><span class="c1"></span>		<span class="k">if</span> <span class="nx">i</span> <span class="o">!=</span> <span class="o">&lt;-</span><span class="nx">ch2</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kc">false</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">Same</span><span class="p">(</span><span class="nx">tree</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nx">tree</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
<span class="p">}</span>

</code></pre></div><h2 id="练习web-爬虫">练习：Web 爬虫</h2>
<p>在这个练习中，我们将会使用 Go 的并发特性来并行化一个 Web 爬虫。</p>
<p>修改 <code>Crawl</code> 函数来并行地抓取 URL，并且保证不重复。</p>
<p><em>提示</em>：你可以用一个 map 来缓存已经获取的 URL，但是要注意 map 本身并不是并发安全的！</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;sync&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Fetcher</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="c1">// Fetch 返回 URL 的 body 内容，并且将在这个页面上找到的 URL 放到一个 slice 中。
</span><span class="c1"></span>	<span class="nf">Fetch</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">body</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">urls</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Crawl 使用 fetcher 从某个 URL 开始递归的爬取页面，直到达到最大深度。
</span><span class="c1"></span>
<span class="kd">type</span> <span class="nx">CrawlRecord</span> <span class="kd">struct</span><span class="p">{</span>
	<span class="nx">m</span>   <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
	<span class="nx">mux</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
	<span class="nx">wg</span>  <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<span class="p">}</span>
<span class="kd">var</span>	<span class="nx">cr</span> <span class="p">=</span> <span class="nx">CrawlRecord</span><span class="p">{</span><span class="nx">m</span><span class="p">:</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)}</span>

<span class="kd">func</span> <span class="nf">Crawl</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">depth</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">fetcher</span> <span class="nx">Fetcher</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">defer</span> <span class="nx">cr</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
	<span class="c1">// TODO: 并行的抓取 URL。
</span><span class="c1"></span>	<span class="c1">// TODO: 不重复抓取页面。
</span><span class="c1"></span>        <span class="c1">// 下面并没有实现上面两种情况：
</span><span class="c1"></span>	<span class="k">if</span> <span class="nx">depth</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="k">return</span>
	<span class="p">}</span>
	
	<span class="nx">cr</span><span class="p">.</span><span class="nx">mux</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
	<span class="nx">cr</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">url</span><span class="p">]</span><span class="o">++</span>
	<span class="nx">cr</span><span class="p">.</span><span class="nx">mux</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
	
	<span class="nx">body</span><span class="p">,</span> <span class="nx">urls</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">fetcher</span><span class="p">.</span><span class="nf">Fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>
	
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;found: %s %q\n&#34;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>

	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">u</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">urls</span> <span class="p">{</span>
		<span class="nx">cr</span><span class="p">.</span><span class="nx">mux</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
		<span class="k">if</span> <span class="nx">_</span><span class="p">,</span><span class="nx">ok</span> <span class="o">:=</span> <span class="nx">cr</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">u</span><span class="p">];</span> <span class="p">!</span><span class="nx">ok</span><span class="p">{</span>
			<span class="nx">cr</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
			<span class="k">go</span> <span class="nf">Crawl</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span> <span class="nx">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">fetcher</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="nx">cr</span><span class="p">.</span><span class="nx">mux</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
	<span class="p">}</span>

	<span class="k">return</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">cr</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
	<span class="nf">Crawl</span><span class="p">(</span><span class="s">&#34;https://golang.org/&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">fetcher</span><span class="p">)</span>
	<span class="nx">cr</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// fakeFetcher 是返回若干结果的 Fetcher。
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">fakeFetcher</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">fakeResult</span>

<span class="kd">type</span> <span class="nx">fakeResult</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">body</span> <span class="kt">string</span>
	<span class="nx">urls</span> <span class="p">[]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="nx">fakeFetcher</span><span class="p">)</span> <span class="nf">Fetch</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">[</span><span class="nx">url</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">urls</span><span class="p">,</span> <span class="kc">nil</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;not found: %s&#34;</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// fetcher 是填充后的 fakeFetcher。
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">fetcher</span> <span class="p">=</span> <span class="nx">fakeFetcher</span><span class="p">{</span>
	<span class="s">&#34;https://golang.org/&#34;</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">fakeResult</span><span class="p">{</span>
		<span class="s">&#34;The Go Programming Language&#34;</span><span class="p">,</span>
		<span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
			<span class="s">&#34;https://golang.org/pkg/&#34;</span><span class="p">,</span>
			<span class="s">&#34;https://golang.org/cmd/&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="s">&#34;https://golang.org/pkg/&#34;</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">fakeResult</span><span class="p">{</span>
		<span class="s">&#34;Packages&#34;</span><span class="p">,</span>
		<span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
			<span class="s">&#34;https://golang.org/&#34;</span><span class="p">,</span>
			<span class="s">&#34;https://golang.org/cmd/&#34;</span><span class="p">,</span>
			<span class="s">&#34;https://golang.org/pkg/fmt/&#34;</span><span class="p">,</span>
			<span class="s">&#34;https://golang.org/pkg/os/&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="s">&#34;https://golang.org/pkg/fmt/&#34;</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">fakeResult</span><span class="p">{</span>
		<span class="s">&#34;Package fmt&#34;</span><span class="p">,</span>
		<span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
			<span class="s">&#34;https://golang.org/&#34;</span><span class="p">,</span>
			<span class="s">&#34;https://golang.org/pkg/&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="s">&#34;https://golang.org/pkg/os/&#34;</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">fakeResult</span><span class="p">{</span>
		<span class="s">&#34;Package os&#34;</span><span class="p">,</span>
		<span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
			<span class="s">&#34;https://golang.org/&#34;</span><span class="p">,</span>
			<span class="s">&#34;https://golang.org/pkg/&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">}</span>

</code></pre></div><h1 id="旅行终点">旅行终点</h1>
<p>你可以从<a class="link" href="https://go-zh.org/doc/install/"  target="_blank" rel="noopener"
    >安装 Go</a> 开始。</p>
<p>一旦安装了 Go，Go <a class="link" href="https://go-zh.org/doc/"  target="_blank" rel="noopener"
    >文档</a>是一个极好的 应当继续阅读的内容。 它包含了参考、指南、视频等等更多资料。</p>
<p>了解如何组织 Go 代码并在其上工作，参阅<a class="link" href="https://www.youtube.com/watch?v=XCsL89YtqCs"  target="_blank" rel="noopener"
    >此视频</a>，或者阅读<a class="link" href="https://go-zh.org/doc/code.html"  target="_blank" rel="noopener"
    >如何编写 Go 代码</a>。</p>
<p>如果你需要标准库方面的帮助，请参考<a class="link" href="https://go-zh.org/pkg/"  target="_blank" rel="noopener"
    >包手册</a>。如果是语言本身的帮助，阅读<a class="link" href="https://go-zh.org/ref/spec"  target="_blank" rel="noopener"
    >语言规范</a>是件令人愉快的事情。</p>
<p>进一步探索 Go 的并发模型，参阅 <a class="link" href="https://www.youtube.com/watch?v=f6kdp27TYZs"  target="_blank" rel="noopener"
    >Go 并发模型</a>(<a class="link" href="https://talks.go-zh.org/2012/concurrency.slide"  target="_blank" rel="noopener"
    >幻灯片</a>)以及<a class="link" href="https://www.youtube.com/watch?v=QDDwwePbDtw"  target="_blank" rel="noopener"
    >深入 Go 并发模型</a>(<a class="link" href="https://talks.go-zh.org/2013/advconc.slide"  target="_blank" rel="noopener"
    >幻灯片</a>)并阅读<a class="link" href="https://go-zh.org/doc/codewalk/sharemem/"  target="_blank" rel="noopener"
    >通过通信共享内存</a>的代码之旅。</p>
<p>想要开始编写 Web 应用，请参阅<a class="link" href="https://vimeo.com/53221558"  target="_blank" rel="noopener"
    >一个简单的编程环境</a>(<a class="link" href="https://talks.go-zh.org/2012/simple.slide"  target="_blank" rel="noopener"
    >幻灯片</a>)并阅读<a class="link" href="https://go-zh.org/doc/articles/wiki/"  target="_blank" rel="noopener"
    >编写 Web 应用</a>的指南。</p>
<p><a class="link" href="https://go-zh.org/doc/codewalk/functions/"  target="_blank" rel="noopener"
    >函数：Go 中的一等公民</a>展示了有趣的函数类型。</p>
<p><a class="link" href="https://blog.go-zh.org/"  target="_blank" rel="noopener"
    >Go 博客</a>有着众多关于 Go 的文章和信息。</p>
<p><a class="link" href="https://www.mikespook.com/tag/golang/"  target="_blank" rel="noopener"
    >mikespook 的博客</a>中有大量中文的关于 Go 的文章和翻译。</p>
<p>开源电子书 <a class="link" href="https://github.com/astaxie/build-web-application-with-golang"  target="_blank" rel="noopener"
    >Go Web 编程</a>和 <a class="link" href="https://github.com/Unknwon/the-way-to-go_ZH_CN"  target="_blank" rel="noopener"
    >Go 入门指南</a>能够帮助你更加深入的了解和学习 Go 语言。</p>
<p>访问 <a class="link" href="https://go-zh.org/"  target="_blank" rel="noopener"
    >go-zh.org</a> 了解更多内容。</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/go%E8%AF%AD%E8%A8%80/">Go语言</a>
        
            <a href="/tags/%E7%BB%83%E4%B9%A0%E4%BB%A3%E7%A0%81/">练习代码</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer="true"
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    <aside class="related-contents--wrapper">
    
    
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (DISQUS) {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2022 Tweakzx
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.5.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Table of contents</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ol>
    <li><a href="#练习循环与函数">练习：循环与函数</a></li>
    <li><a href="#练习切片">练习：切片</a></li>
    <li><a href="#练习映射">练习：映射</a></li>
    <li><a href="#练习斐波纳契闭包">练习：斐波纳契闭包</a></li>
    <li><a href="#练习stringer">练习：Stringer</a></li>
    <li><a href="#练习错误">练习：错误</a></li>
    <li><a href="#练习reader">练习：Reader</a></li>
    <li><a href="#练习rot13reader">练习：rot13Reader</a></li>
    <li><a href="#练习图像">练习：图像</a></li>
    <li><a href="#练习等价二叉查找树">练习：等价二叉查找树</a></li>
    <li><a href="#练习web-爬虫">练习：Web 爬虫</a></li>
  </ol>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
