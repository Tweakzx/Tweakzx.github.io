[{"content":"Tiresias è®ºæ–‡é˜…è¯»ç¬”è®° Abstract  æ·±åº¦å­¦ä¹  (DL) è®­ç»ƒä½œä¸šç»™ç°æœ‰çš„é›†ç¾¤ç®¡ç†å™¨å¸¦æ¥äº†ä¸€äº›ç‹¬ç‰¹çš„æŒ‘æˆ˜ï¼Œä¾‹å¦‚  ä¸å¯é¢„æµ‹çš„è®­ç»ƒæ—¶é—´ å…¨æœ‰æˆ–å…¨æ— çš„æ‰§è¡Œæ¨¡å‹ GPU å…±äº«çš„ä¸çµæ´»æ€§   æˆ‘ä»¬å¯¹ç”Ÿäº§ä¸­çš„å¤§å‹ GPU é›†ç¾¤çš„åˆ†æè¡¨æ˜ï¼Œç°æœ‰çš„å¤§æ•°æ®è°ƒåº¦ç¨‹åºä¼šå¯¼è‡´  è¾ƒé•¿çš„æ’é˜Ÿå»¶è¿Ÿ è¾ƒä½çš„æ•´ä½“æ€§èƒ½   æˆ‘ä»¬ä»‹ç»äº† Tiresias  è¿™æ˜¯ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼ DL è®­ç»ƒä½œä¸šé‡èº«å®šåˆ¶çš„ GPU é›†ç¾¤ç®¡ç†å™¨ï¼Œå®ƒå¯ä»¥æœ‰æ•ˆåœ°å®‰æ’å’Œæ”¾ç½® DL ä½œä¸šä»¥å‡å°‘å®ƒä»¬çš„ä½œä¸šå®Œæˆæ—¶é—´ (JCT)ã€‚ é‰´äº DL ä½œä¸šçš„æ‰§è¡Œæ—¶é—´é€šå¸¸æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸¤ç§è°ƒåº¦ç®—æ³•â€”â€”  ç¦»æ•£åŒ–äºŒç»´Gittinsç´¢å¼•ï¼šåŸºäºéƒ¨åˆ†ä¿¡æ¯ ç¦»æ•£åŒ–äºŒç»´ LASï¼š ä¸ä¿¡æ¯æ— å…³ï¼Œæ—¨åœ¨æœ€å°åŒ–å¹³å‡ JCT   æ­¤å¤–ï¼Œæˆ‘ä»¬æè¿°äº†ä½•æ—¶å¯ä»¥æ”¾å®½åˆå¹¶æ”¾ç½®çº¦æŸï¼Œå¹¶æå‡ºäº†ä¸€ç§æ”¾ç½®ç®—æ³•æ¥åˆ©ç”¨è¿™äº›è§‚å¯Ÿç»“æœè€Œæ— éœ€ä»»ä½•ç”¨æˆ·è¾“å…¥ã€‚   åœ¨å…·æœ‰ 60 ä¸ª P100 GPU çš„å¯†æ­‡æ ¹ ConFlux é›†ç¾¤ä¸Šè¿›è¡Œçš„å®éªŒå’Œå¤§è§„æ¨¡è·Ÿè¸ªé©±åŠ¨æ¨¡æ‹Ÿè¡¨æ˜ï¼Œ  ä¸ç”Ÿäº§ä¸­ä½¿ç”¨çš„åŸºäº Apache YARN çš„èµ„æºç®¡ç†å™¨ç›¸æ¯”ï¼ŒTiresias å°†å¹³å‡ JCT æé«˜äº† 5.5 å€ã€‚ æ›´é‡è¦çš„æ˜¯ï¼ŒTiresias çš„æ€§èƒ½ä¸å‡è®¾å®Œç¾çŸ¥è¯†çš„è§£å†³æ–¹æ¡ˆçš„æ€§èƒ½ç›¸å½“ã€‚    Introduction ç”±äº DDL è®­ç»ƒçš„ç‹¬ç‰¹é™åˆ¶ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°å½“å‰é›†ç¾¤ç®¡ç†å™¨è®¾è®¡ä¸­çš„ä¸¤ä¸ªä¸»è¦é™åˆ¶ã€‚\n è®­ç»ƒæ—¶é—´ä¸å¯é¢„çŸ¥çš„æœ´ç´ è°ƒåº¦  å°½ç®¡å·²çŸ¥æœ€çŸ­ä½œä¸šä¼˜å…ˆ (SJF) å’Œæœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ (SRTF) ç®—æ³•å¯ä»¥æœ€å°åŒ–å¹³å‡ JCT ï¼Œä½†å®ƒä»¬éœ€è¦ä½œä¸šçš„å‰©ä½™æ‰§è¡Œæ—¶é—´ï¼Œè€Œè¿™å¯¹äº DL è®­ç»ƒä½œä¸šæ¥è¯´é€šå¸¸æ˜¯æœªçŸ¥çš„. Optimuså¯ä»¥ä¾é å…¶é‡å¤æ‰§è¡Œæ¨¡å¼å¹¶å‡è®¾å…¶æŸå¤±æ›²çº¿ä¼šæ”¶æ•›æ¥é¢„æµ‹ DL è®­ç»ƒä½œä¸šçš„å‰©ä½™æ‰§è¡Œæ—¶é—´ã€‚ç„¶è€Œï¼Œè¿™äº›æè®®å¯¹å…·æœ‰å¹³æ»‘æŸå¤±æ›²çº¿å’Œè¿è¡Œå®Œæˆçš„å·¥ä½œåšå‡ºäº†è¿‡äºç®€åŒ–çš„å‡è®¾ï¼›åœ¨ç”Ÿäº§ç³»ç»Ÿä¸­ï¼Œä¸¤è€…éƒ½ä¸æ€»æ˜¯æ­£ç¡®çš„ã€‚ æ­£å› ä¸ºå¦‚æ­¤ï¼Œç”Ÿäº§ä¸­æœ€å…ˆè¿›çš„èµ„æºç®¡ç†å™¨ç›¸å½“å¤©çœŸã€‚ä¾‹å¦‚ï¼Œå¾®è½¯å†…éƒ¨çš„è§£å†³æ–¹æ¡ˆæ˜¯ä» Apache YARN æœ€åˆä¸ºå¤§æ•°æ®ä½œä¸šæ„å»ºçš„ Capacity Scheduler æ‰©å±•è€Œæ¥çš„ã€‚å®ƒåªæ‰§è¡ŒåŸºæœ¬çš„ç¼–æ’ï¼Œå³ä½œä¸šåˆ°è¾¾æ—¶çš„éæŠ¢å å¼è°ƒåº¦ã€‚å› æ­¤ï¼Œå½“é›†ç¾¤è¶…é¢è®¢é˜…æ—¶ï¼Œç”¨æˆ·ç»å¸¸ä¼šé‡åˆ°é•¿æ—¶é—´çš„æ’é˜Ÿå»¶è¿Ÿâ€”â€”å³ä½¿æ˜¯å°ä½œä¸šä¹Ÿå¯èƒ½é•¿è¾¾æ•°å°æ—¶ã€‚   æ”¾ç½®ä»»åŠ¡è¿‡ç¨‹ä¸­è¿‡åº¦æ¿€è¿›çš„åˆå¹¶  ç°æœ‰çš„é›†ç¾¤ç®¡ç†å™¨è¿˜è¯•å›¾å°† DDL ä½œä¸šæ•´åˆåˆ°å…·æœ‰è¶³å¤Ÿ GPU çš„æœ€å°‘æ•°é‡çš„æœåŠ¡å™¨ä¸Šã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæœ‰ 16 ä¸ª GPU çš„ä½œä¸šåœ¨æ¯å°æœåŠ¡å™¨ 4 ä¸ª GPU çš„é›†ç¾¤ä¸­è‡³å°‘éœ€è¦å››å°æœåŠ¡å™¨ï¼Œå¦‚æœæ‰¾ä¸åˆ°å››å°å®Œå…¨ç©ºé—²çš„æœåŠ¡å™¨ï¼Œä½œä¸šå¯èƒ½ä¼šè¢«é˜»å¡ã€‚ åŸºæœ¬å‡è®¾æ˜¯åº”å°½å¯èƒ½é¿å…ä½¿ç”¨ç½‘ç»œé€šä¿¡ï¼Œå› ä¸ºå®ƒå¯èƒ½æˆä¸ºç“¶é¢ˆå¹¶æµªè´¹ GPU å‘¨æœŸ ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å‘ç°è¿™ä¸ªå‡è®¾åªæ˜¯éƒ¨åˆ†æœ‰æ•ˆã€‚    åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº† Tiresiasï¼Œä¸€ç§å…±äº« GPU é›†ç¾¤ç®¡ç†å™¨ï¼Œæ—¨åœ¨è§£å†³ä¸Šè¿°æœ‰å…³ DDL ä½œä¸šè°ƒåº¦å’Œæ”¾ç½®çš„æŒ‘æˆ˜ã€‚ä¸ºç¡®ä¿Tiresiaså®ç”¨ä¸”æ˜“äºéƒ¨ç½²ï¼Œæˆ‘ä»¬ä¾é å¯¹ç”Ÿäº§ä½œä¸šè½¨è¿¹çš„åˆ†æã€å¯¹è®­ç»ƒå„ç§ DL æ¨¡å‹çš„è¯¦ç»†æµ‹é‡ä»¥åŠä¸¤ä¸ªç®€å•è€Œæœ‰æ•ˆçš„æƒ³æ³•ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æœ‰æ„è®© Tiresias å¯¹ç”¨æˆ·ä¿æŒé€æ˜ï¼Œå³æ‰€æœ‰ç°æœ‰ä½œä¸šéƒ½å¯ä»¥åœ¨æ²¡æœ‰ä»»ä½•é¢å¤–çš„ç”¨æˆ·æŒ‡å®šé…ç½®çš„æƒ…å†µä¸‹è¿è¡Œã€‚\n ç¬¬ä¸€ä¸ªæƒ³æ³•ï¼šä¸€ä¸ªæ–°çš„è°ƒåº¦æ¡†æ¶ï¼ˆ2DASï¼‰ï¼Œæ—¨åœ¨åœ¨ DL ä½œä¸šçš„æ‰§è¡Œæ—¶é—´ä¸å¯é¢„æµ‹æ—¶æœ€å°åŒ– JCT  è°ƒåº¦ç®—æ³•  Discretized 2D Gittins index Discretized 2D-LAS   ä¸Šè¿°ä¸¤ä¸ªæ–¹æ¡ˆéƒ½æ˜¯ç»™ä»»åŠ¡ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œå‰è€…ä½¿ç”¨Gittinsç´¢å¼•ï¼Œåè€…ç›´æ¥åº”ç”¨æ”¶åˆ°çš„ä»»åŠ¡(éšç€æ—¶é—´ä¼šæ”¹å˜ï¼Œä»»åŠ¡ä¼šæŒ‰ç…§ä¼˜å…ˆçº§æ¥è¿›è¡Œè°ƒåº¦) ä½¿ç”¨ä¸Šè¿°ç­–ç•¥æœ‰ä¸¤ä¸ªæŒ‘æˆ˜  è®¡ç®—ä»»åŠ¡ä¼˜å…ˆçº§çš„æ—¶å€™ã€‚éœ€è¦åŒæ—¶è€ƒè™‘ç©ºé—´å’Œæ—¶é—´ä¸¤ä¸ªç»´åº¦ã€‚ç©ºé—´ï¼šGPUä¸ªæ•°ï¼Œ æ—¶é—´ï¼šä»»åŠ¡è¿è¡Œæ—¶é—´ã€‚ ç›¸å¯¹ä¼˜å…ˆçº§å¯èƒ½ä¼šéšç€å·¥ä½œæ¥å—æœåŠ¡äºŒå‘ç”Ÿå˜åŒ–ï¼Œ å¯èƒ½ä¼šå¯¼è‡´å·¥ä½œè¢«æŠ¢å ï¼Œ GPUæŠ¢å DDLå·¥ä½œçš„ä»£ä»·æ˜‚è´µï¼Œ æ‰€ä»¥ä¸ºäº†é¿å…æŠ¢å ï¼Œ ä½œä¸šçš„ä¼˜å…ˆçº§éœ€è¦åœ¨å›ºå®šçš„æ—¶é—´é—´éš”å‘ç”Ÿå˜åŒ–ã€‚   æœ‰å…ˆéªŒçš„æƒ…å†µä¸‹ä½¿ç”¨Gittinsç´¢å¼•ï¼Œ æ²¡æœ‰å…ˆéªŒçš„æƒ…å†µä¸‹ä½¿ç”¨LAS   ç¬¬äºŒä¸ªæƒ³æ³•ï¼šå°½å¯èƒ½ä½¿ç”¨æ¨¡å‹ç»“æ„æ¥æ”¾æ¾åˆå¹¶æ”¾ç½®çº¦æŸ  æˆ‘ä»¬è§‚å¯Ÿåˆ°åªæœ‰æŸäº›ç±»å‹çš„ DL æ¨¡å‹å¯¹å…¶æ˜¯å¦åˆå¹¶æ•æ„Ÿï¼Œå¹¶ä¸”å®ƒä»¬çš„æ•æ„Ÿæ€§æ˜¯ç”±äºå…¶æ¨¡å‹ä¸­å¼ é‡å¤§å°åˆ†å¸ƒçš„åå·®ã€‚æˆ‘ä»¬ä½¿ç”¨è¿™ç§æ´å¯Ÿå°†å·¥ä½œåˆ†ä¸ºä¸¤ç±»ï¼š  å¯¹æ•´åˆæ•æ„Ÿï¼ˆé«˜åå·®ï¼‰çš„å·¥ä½œ å…¶ä»–å·¥ä½œ   æˆ‘ä»¬åœ¨ Tiresias ä¸­å®ç°äº†ä¸€ä¸ª RDMA ç½‘ç»œåˆ†æåº“ï¼Œå®ƒå¯ä»¥é€šè¿‡ç½‘ç»œçº§æ´»åŠ¨ç¡®å®š DDL ä½œä¸šçš„æ¨¡å‹ç»“æ„ã€‚  é€šè¿‡åˆ©ç”¨åˆ†æåº“å’Œ DDL è®­ç»ƒçš„è¿­ä»£ç‰¹æ€§ï¼ŒTiresias å¯ä»¥é€æ˜ä¸”æ™ºèƒ½åœ°æ”¾ç½®ä½œä¸šã€‚ Tiresias é¦–å…ˆåœ¨è¯•ç”¨ç¯å¢ƒä¸­è¿è¡Œä½œä¸šå‡ æ¬¡è¿­ä»£ï¼Œç„¶åæ ¹æ®ä»å…ˆå‰æµ‹é‡ä¸­æ€»ç»“çš„æ ‡å‡†ç¡®å®šæœ€ä½³æ”¾ç½®ç­–ç•¥ã€‚      æœ¬æ–‡çš„è´¡çŒ®å¦‚ä¸‹ï¼š\n Tiresiasæ˜¯ç¬¬ä¸€ä¸ªä¿¡æ¯ä¸å¯çŸ¥çš„GPUé›†ç¾¤èµ„æºç®¡ç†å™¨ã€‚åŒæ—¶ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªä½¿ç”¨äº†ä¸¤ä¸ªç»´åº¦çš„æ‰©å±•å’Œä¼˜å…ˆçº§æ¥è°ƒåº¦DDLå·¥ä½œã€‚ ä½¿ç”¨äº†ä¸€ä¸ªç®€å•çš„ï¼Œ å¤–éƒ¨å¯è§‚å¯Ÿçš„ï¼Œ model-specificçš„è¯„ä»·æ ‡å‡†æ¥åˆ¤æ–­ä»€ä¹ˆæ—¶å€™æ”¾æ¾GPUåˆå¹¶çš„çº¦æŸ è®¾è®¡ç®€å•ï¼Œæ˜“éƒ¨ç½²ï¼Œ æ€§èƒ½æ˜¾è‘—æé«˜  èƒŒæ™¯å’ŒåŠ¨æœº DDLåˆ†å¸ƒå¼æ·±åº¦å­¦ä¹  è¿™é‡Œåªå…³æ³¨æ•°æ®å¹¶è¡Œ\n\rimage-20221227122558146\r\n å‘¨æœŸæ€§è¿­ä»£ å‚æ•°æœåŠ¡å™¨æ¶æ„ Trial and error çš„æ¢ç´¢ï¼š è¶…å‚æ•°è°ƒä¼˜  æŒ‘æˆ˜  ä¸å¯é¢„çŸ¥çš„ä½œä¸šæ—¶é—´  å½“å‰é¢„æµ‹ DL ä½œä¸šè®­ç»ƒæ—¶é—´çš„è§£å†³æ–¹æ¡ˆ éƒ½å‡è®¾ DL ä½œä¸š  (1) å…·æœ‰å¹³æ»‘çš„æŸå¤±æ›²çº¿ (2) è¾¾åˆ°å…¶è®­ç»ƒç›®æ ‡å¹¶å®Œæˆ   ç„¶è€Œ  å¯¹äºè®¸å¤šåœ¨è¯•é”™æ¢ç´¢è¿‡ç¨‹ä¸­è¾ƒå·®çš„æ¨¡å‹ï¼Œå®ƒä»¬çš„æŸå¤±æ›²çº¿å¹¶ä¸åƒæ¢ç´¢ç»“æŸæ—¶æœ€ç»ˆé€‰æ‹©çš„æœ€ä½³æ¨¡å‹çš„æ›²çº¿é‚£æ ·å¹³æ»‘ã€‚å¦‚å›¾2  \rimage-20221227123048934\r   DLçš„ç»ˆæ­¢æ¡ä»¶æ˜¯ä¸ç¡®å®šçš„   å› æ­¤ï¼Œå®é™…çš„èµ„æºç®¡ç†å™¨è®¾è®¡ä¸åº”ä¾èµ–äºå‡†ç¡®æ€§/æŸå¤±æ›²çº¿æ¥é¢„æµ‹æœ€ç»ˆçš„ä½œä¸šå®Œæˆæ—¶é—´ã€‚   è¿‡åº¦æ¿€è¿›çš„ä»»åŠ¡åˆå¹¶  åœ¨æ¨¡å‹èšé›†é˜¶æ®µå°è¯•å‡å°‘ç½‘ç»œçš„é€šä¿¡åœ¨åˆ†å¸ƒå¼è®­ç»ƒä¸­æ˜¯ä¸€ç§é€šç”¨çš„ä¼˜åŒ–ï¼Œå› ä¸ºç½‘ç»œå¯èƒ½æ˜¯æ€§èƒ½ç“¶é¢ˆå¹¶ä¸”æµªè´¹GPUå‘¨æœŸã€‚ ç„¶è€Œï¼Œè®¸å¤šç°å­˜çš„GPUç®¡ç†åœ¨æ”¾ç½®åˆ†å¸ƒå¼æ·±åº¦å­¦ä¹ ä»»åŠ¡æ—¶ç›²ç›®åœ°éµä»ä¸€ä¸ªåˆå¹¶çº¦æŸï¼Œç‰¹åˆ«åœ°ï¼Œä»–ä»¬å°†ä½œä¸šçš„æ‰€æœ‰ç»„ä»¶ï¼ˆå‚æ•°æœåŠ¡å™¨å’ŒWorkerï¼‰åˆ†é…ç»™ç›¸åŒæˆ–æœ€å°æ•°é‡çš„æœåŠ¡å™¨ ä¸€ä¸ªåˆ†å¸ƒå¼æ·±åº¦å­¦ä¹ ä½œä¸šå¦‚æœä¸èƒ½åˆå¹¶é€šå¸¸ä¼šç­‰å¾…ï¼Œå³ä½¿é›†ç¾¤ä¸­æœ‰è¶³å¤Ÿçš„ç©ºé—²èµ„æºï¼Œè™½ç„¶è¿™ä¸ªçº¦æŸæ˜¯ä¸ºäº†é«˜æ€§èƒ½ï¼Œä½†æ˜¯ä¼šå¯¼è‡´æ›´é•¿çš„é˜Ÿåˆ—å»¶è¿Ÿå’Œä½çš„èµ„æºåˆ©ç”¨ã€‚   æŠ¢å å¼çš„æ—¶é—´å¼€é”€  ç”±äºæ—¶é—´å¼€é”€å¤§ï¼Œç›®å‰çš„ç”Ÿäº§é›†ç¾¤å¹¶æ²¡æœ‰æŠ¢å ä½œä¸šã€‚ \rimage-20221227124028866\r \rimage-20221227124044585\r    æ½œåœ¨çš„æ”¶ç›Š ç ´é™¤ä¸¤ä¸ªè°¬è¯¯ï¼Œ å¯ä»¥è·å¾—å·¨å¤§çš„æå‡\n è°¬è¯¯ä¸€ï¼šå¦‚æœæ²¡æœ‰ç¡®åˆ‡çš„å·¥ä½œæŒç»­æ—¶é—´ï¼Œå°±æ— æ³•å¾ˆå¥½åœ°å®‰æ’å·¥ä½œã€‚  å°½ç®¡ DDL ä½œä¸šæŒç»­æ—¶é—´é€šå¸¸æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œä½†å¯ä»¥ä»å†å²æ—¥å¿—ä¸­äº†è§£å®ƒä»¬çš„æ€»ä½“åˆ†å¸ƒã€‚ å¹¿æ³›ç”¨äºè§£å†³ç»å…¸å¤šè‡‚è€è™æœºé—®é¢˜çš„ Gittins æŒ‡æ•°ç­–ç•¥ï¼Œåªè¦ç»™å®šå·¥ä½œæŒç»­æ—¶é—´åˆ†å¸ƒï¼Œå°±å¯ä»¥é™ä½å¹³å‡ JCTã€‚ å³ä½¿æ²¡æœ‰è¿™äº›ä¿¡æ¯ï¼ŒLAS ç®—æ³•ä¹Ÿå¯ä»¥æ ¹æ®è·å¾—çš„æœåŠ¡æœ‰æ•ˆåœ°å®‰æ’ä½œä¸šã€‚   è°¬è¯¯äºŒï¼šDDL ä½œä¸šåº”è¯¥å§‹ç»ˆåˆå¹¶ã€‚  è™½ç„¶åˆå¹¶æ”¾ç½®ä½œä¸šç¡®å®å¯ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘å…¶é€šä¿¡æ—¶é—´ï¼Œä½†æˆ‘ä»¬å‘ç°æŸäº› DDL ä½œä¸šå¯¹æ”¾ç½®ä¸æ•æ„Ÿã€‚ æˆ‘ä»¬ç¡®å®šæ ¸å¿ƒå› ç´ æ˜¯æ¨¡å‹ç»“æ„    Tiresias çš„è®¾è®¡ æ€»ä½“æ¶æ„  è°ƒåº¦ç›®æ ‡  ç”¨æˆ·ä¸ºä¸­å¿ƒï¼šæœ€å°åŒ–å¹³å‡JCT æ“ä½œè€…ä¸ºä¸­å¿ƒï¼šæé«˜GPUçš„åˆ©ç”¨ç‡ å¹³è¡¡ä»¥ä¸ŠäºŒè€…ï¼šä»»åŠ¡ä¸èƒ½æ— é™é¥¥é¥¿   ä¸€äº›å‡è®¾  ä»»åŠ¡åœ¨çº¿è¾¾åˆ° ä»»åŠ¡æŒç»­æ—¶é—´æœªçŸ¥ ä»»åŠ¡çš„ä»»åŠ¡ç‰¹æ€§æœªçŸ¥ All or Nothingçš„èµ„æºåˆ†é…   ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ  Tiresias æ—¨åœ¨ä¼˜åŒ–ä¸Šè¿°ç›®æ ‡ï¼Œè€Œæ— éœ€åœ¨ç‰¹å®š DL æ¡†æ¶ä¸‹å¯¹ä½œä¸šçš„èµ„æºéœ€æ±‚ã€æŒç»­æ—¶é—´æˆ–å…¶å†…éƒ¨ç‰¹å¾åšå‡ºä»»ä½•å‡è®¾ã€‚ \rimage-20221227125201039\r å›¾ 6 å±•ç¤ºäº† Tiresias çš„æ¶æ„ä»¥åŠä½œä¸šç”Ÿå‘½å‘¨æœŸä¸­å‘ç”Ÿçš„ä¸€ç³»åˆ—æ“ä½œã€‚  1ï¼‰ä½œä¸šä¸€æäº¤ï¼Œå…¶ GPU è¦æ±‚å°±å·²çŸ¥ï¼Œå¹¶ä¸”å®ƒè¢«é™„åŠ åˆ° WAITQUEUE ã€‚ 2ï¼‰è°ƒåº¦ç¨‹åºå®šæœŸè°ƒåº¦æ¥è‡ª WAITQUEUE çš„ä½œä¸šï¼Œå¹¶åœ¨ä½œä¸šåˆ°è¾¾ã€ä½œä¸šå®Œæˆå’Œèµ„æºå¯ç”¨æ€§å˜åŒ–ç­‰äº‹ä»¶æ—¶æŠ¢å é›†ç¾¤ä¸­æ­£åœ¨è¿è¡Œçš„ä½œä¸šåˆ° WAITQUEUEã€‚ 3ï¼‰é¦–æ¬¡å¯åŠ¨ä½œä¸šæˆ–æ¢å¤å…ˆå‰æŠ¢å çš„ä½œä¸šæ—¶ï¼Œè°ƒåº¦ç¨‹åºä¾èµ–äºæ”¾ç½®æ¨¡å—æ¥åˆ†é…å…¶ GPUã€‚ 4ï¼‰å¦‚æœä¸€ä¸ªä½œä¸šæ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œæ”¾ç½®æ¨¡å—é¦–å…ˆå¯¹å…¶è¿›è¡Œå‰–æâ€”â€”å‰–æå™¨è¯†åˆ«ä½œä¸šç‰¹å®šçš„ç‰¹å¾ï¼Œä¾‹å¦‚å¼ é‡åˆ†å¸ƒä¸­çš„åæ–œï¼Œä»¥ç¡®å®šæ˜¯å¦åˆå¹¶è¯¥ä½œä¸š ã€‚      è°ƒåº¦ æˆ‘ä»¬è§‚å¯Ÿåˆ°æŠ¢å å¼è°ƒåº¦å¯¹äºå®ç°è°ƒåº¦ç›®æ ‡æ¥è¯´æ˜¯å¿…è¦çš„ã€‚\nä¸ºä»€ä¹ˆæ˜¯äºŒç»´è°ƒåº¦ é€šè¿‡å›é¡¾åŸºäºæ—¶é—´æˆ–å¤§å°çš„å¯å‘å¼æ–¹æ³•ï¼Œæˆ‘ä»¬è®¤ä¸ºåœ¨ GPU èµ„æºæœ‰é™çš„é›†ç¾¤ä¸Šè°ƒåº¦ DDL ä½œä¸šæ—¶ä»…è€ƒè™‘ä¸€ä¸ªæ–¹é¢ï¼ˆç©ºé—´æˆ–æ—¶é—´ï¼‰æ˜¯ä¸å¤Ÿçš„ã€‚\n åœ¨ SRTF è°ƒåº¦ç¨‹åºä¸­ï¼Œå‰©ä½™æ—¶é—´çŸ­çš„å¤§å‹ä½œä¸šä¼šå ç”¨è®¸å¤š GPUï¼Œä»è€Œå¯¼è‡´è®¸å¤šæ–°æäº¤çš„å°å‹ä½œä¸šå‡ºç°ä¸å¯å¿½ç•¥çš„æ’é˜Ÿå»¶è¿Ÿã€‚ å¦‚æœè°ƒåº¦ç¨‹åºæ˜¯GPU çš„æ•°é‡æœ€å°ä¼˜å…ˆSFçš„ï¼Œé‚£ä¹ˆå¤§å‹ä½œä¸šå¯èƒ½ä¼šè¢«ä¸€è¿ä¸²çš„å°å‹ä½œä¸šé˜»å¡ï¼Œå³ä½¿å®ƒä»¬æ¥è¿‘å®Œæˆ  \rimage-20221227130428691\r\n2DAS äºŒç»´çš„è·å¾—æ€§åŸºäºæœåŠ¡çš„è°ƒåº¦å™¨ 2DASæ˜¯å¯¹ä¼ ç»ŸLASçš„æ‰©å±•ï¼ŒåŒæ—¶è€ƒè™‘äº†æ—¶é—´å’Œç©ºé—´ï¼Œå®ƒä¼šèµ‹äºˆä»»åŠ¡ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œè¿™ä¸ªä¼˜å…ˆçº§å’Œæ—¶é—´ä»¥åŠç©ºé—´æœ‰å…³ã€‚\nè€Œè¿™ä¸ªä¼˜å…ˆçº§å‡½æ•°æœ‰ä¸åŒçš„æƒ…å†µï¼Œå½“æœ‰æ²¡æœ‰å…ˆéªŒçŸ¥è¯†çš„æ—¶å€™ï¼Œå³æ²¡æœ‰ä»»åŠ¡æŒç»­æ—¶é—´çš„åˆ†å¸ƒçš„æ—¶å€™ï¼Œä½¿ç”¨LASç®—æ³•ï¼Œå¦‚æœæœ‰å…ˆéªŒåˆ†å¸ƒï¼Œåˆ™ä½¿ç”¨Gittinsç´¢å¼•\n\rimage-20221227132002748\r\nä¼˜å…ˆçº§çš„ç¦»æ•£åŒ– ä½¿ç”¨è¿ç»­çš„ä¼˜å…ˆçº§ä¼šå¯¼è‡´ä¸€ç³»åˆ—çš„æŠ¢å å’Œä¸€ç³»åˆ—çš„é‡å¯ï¼Œå¯¹äºåˆ†å¸ƒå¼æ·±åº¦å­¦ä¹ ä»»åŠ¡æ¥è¯´ï¼ŒæŠ¢å å’Œé‡å¯çš„ä»£ä»·å¾ˆé«˜ï¼Œè¿‡å¤šçš„æŠ¢å ä¼šå¯¼è‡´2DASä¸å¯ç”¨\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒåŸºäºä¼ ç»Ÿçš„**å¤šçº§åˆ«åé¦ˆé˜Ÿåˆ—(MLFQ)**ç®—æ³•å®ç°ä¼˜å…ˆçº§ç¦»æ•£åŒ–çš„æ¡†æ¶ã€‚å³ï¼Œå°†åŸæœ‰çš„ä¸€ä¸ªé˜Ÿåˆ—å˜æˆKä¸ªé˜Ÿåˆ—ã€‚\n æ•´ä½“ç»“æ„ç¡®ä¿å…·æœ‰ç›¸ä¼¼ (WJtJ) å€¼çš„ä½œä¸šä¿ç•™åœ¨åŒä¸€é˜Ÿåˆ—ä¸­ã€‚å…·æœ‰é«˜åº¦ä¸åŒ (WJtJ) å€¼çš„ä½œä¸šä¿æŒåœ¨ä¸åŒçš„ä¼˜å…ˆçº§ã€‚ ä½¿ç”¨ LAS æ—¶ï¼ŒåŒä¸€é˜Ÿåˆ—ä¸­çš„ä½œä¸šæŒ‰å…¶å¼€å§‹æ—¶é—´çš„ FIFO é¡ºåºè¿›è¡Œè°ƒåº¦ï¼ˆå³ï¼Œé¦–æ¬¡è°ƒåº¦å®ƒä»¬çš„æ—¶é—´ï¼‰ï¼Œæ²¡æœ‰ä»»ä½• HOL é˜»å¡çš„é£é™©ã€‚ Gittins æŒ‡æ•°ä¸­çš„æœåŠ¡é‡ Î” ä¹Ÿæ˜¯ç¦»æ•£åŒ–çš„ã€‚å¯¹äº Qi ä¸­çš„ä½œä¸šï¼ŒÎ”i ç­‰äº Qhi iï¼Œè¿™æ˜¯ Qi çš„ä¸Šé™ã€‚å½“ä¸€ä¸ªä½œä¸šç”¨å®Œå®ƒçš„æ‰€æœ‰æœåŠ¡é‡æ—¶ï¼Œå®ƒå°†è¢«é™çº§åˆ°è¾ƒä½ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ã€‚å¯¹äº Gittins ç´¢å¼•ï¼ŒåŒä¸€é˜Ÿåˆ—ä¸­çš„ä½œä¸šæ ¹æ®å…¶ Gittins ç´¢å¼•å€¼è¿›è¡Œè°ƒåº¦ã€‚åœ¨æœ€åä¸€ä¸ªé˜Ÿåˆ— QK ä¸­ï¼ŒÎ”K è¢«è®¾ç½®ä¸º âˆã€‚åœ¨è¿™ç§æç«¯æƒ…å†µä¸‹ï¼ŒGittins ç´¢å¼•çš„è¡¨ç°ä¸ LAS ç±»ä¼¼ï¼Œæœ€åä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„ä½œä¸šæŒ‰ç…§ FIFO é¡ºåºè¿›è¡Œè°ƒåº¦ã€‚  \rimage-20221227131451335\r\næ”¾ç½® ç»™å®šä¸€ä¸ªä»»åŠ¡ï¼Œéœ€è¦å‚æ•°æœåŠ¡å™¨ä»¥åŠWorkerï¼Œå¦‚æœæœ‰è¶³å¤Ÿçš„èµ„æºï¼ŒTiresiaséœ€è¦çŸ¥é“æ˜¯å¦åœ¨å°½å¯èƒ½å°‘çš„æœºå™¨ä¸­åˆå¹¶ä¸€äº›ä»»åŠ¡çš„GPUæˆ–è€…å»åˆ†å‘å®ƒä»¬ï¼Œå‰è€…åœ¨å¾®è½¯çš„çš„ç”Ÿäº§é›†ç¾¤ä¸­å®ç°ï¼Œæ•…ä¸€ä¸ªä»»åŠ¡å³ä½¿èµ„æºè¶³å¤Ÿä¹Ÿå¯èƒ½è¢«æ”¾ç½®åœ¨ç­‰å¾…é˜Ÿåˆ—ã€‚æœ¬æ–‡ä½¿ç”¨ILPï¼Œå³æ•´æ•°çº¿æ€§è§„åˆ’æ¥ä¼˜åŒ–è¿™ä¸ªåˆ†é…é—®é¢˜ã€‚\nåˆå¹¶å¯¹äºä»»åŠ¡æ¥è¯´é‡è¦å—? æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­å¯¹äºåˆå¹¶æ•æ„Ÿçš„ä¸€èˆ¬éƒ½æœ‰è¾ƒå¤§çš„å¼ é‡ï¼Œ åŸå› æ˜¯æ¨¡å‹èšåˆä¸­çš„æ¶ˆæ¯å¤§å°ä¸æ¨¡å‹çš„ç»“æ„å¯†åˆ‡ç›¸å…³ã€‚ ä¾‹å¦‚ï¼ŒTensorFlowä¸­çš„æ¨¡å‹ç”±è®¸å¤šå¼ é‡ç»„æˆã€‚ æ¯ä¸ªå¼ é‡éƒ½è¢«åŒ…è£…ä¸ºå•ä¸ªé€šä¿¡æ¶ˆæ¯ã€‚å› æ­¤ï¼ŒDDLä¸­çš„æ¶ˆæ¯å¤§å°åˆ†å¸ƒå–å†³äºæ¨¡å‹çš„å¼ é‡å¤§å°åˆ†å¸ƒã€‚ å¼ é‡å¤§å°é€šå¸¸åˆ†å¸ƒä¸å‡åŒ€; æœ‰æ—¶å­˜åœ¨å·¨å¤§çš„å¼ é‡ï¼Œå…¶ä¸­åŒ…å«è¿™äº›æ¨¡å‹ä¸­çš„å¤§éƒ¨åˆ†å‚æ•°ã€‚ å› æ­¤ï¼Œèšåˆè¾ƒå¤§çš„å¼ é‡ä¼šæ›´ä¸¥é‡åœ°å—åˆ°ç½‘ç»œäº‰ç”¨çš„å½±å“ï¼Œè€Œè¾ƒå°å¼ é‡çš„ä¼ è¾“å¾€å¾€ä¼šç›¸äº’äº¤é”™ã€‚\nåˆ©ç”¨è¿™ä¸ªç›´è§‰ï¼Œè®¾è®¡äº†Tiresiasçš„åˆ†æå™¨ï¼Œç”¨äºåˆ†ææ¯ä¸ªæ¨¡å‹çš„åå·®ç¨‹åº¦ï¼Œå†ä½¿ç”¨æ”¾ç½®çš„ç®—æ³• \rimage-20221227132216616\r\næ€»ç»“  ä¸ Apache YARN çš„å®¹é‡è°ƒåº¦ç¨‹åº (YARNCS) å’Œ Gandiva ç›¸æ¯”ï¼ŒTiresias æ—¨åœ¨æœ€å°åŒ–å¹³å‡ JCTã€‚ ä¸ Optimus ä¸åŒï¼ŒTiresias å¯ä»¥åœ¨æ²¡æœ‰æˆ–æœ‰éƒ¨åˆ†å…ˆéªŒçŸ¥è¯†çš„æƒ…å†µä¸‹æœ‰æ•ˆåœ°å®‰æ’å·¥ä½œï¼ˆè¡¨ 2ï¼‰ã€‚ æ­¤å¤–ï¼ŒTiresias å¯ä»¥æ ¹æ® Tiresias åˆ†æå™¨è‡ªåŠ¨æ•è·çš„æ¨¡å‹ç»“æ„å·§å¦™åœ°æ”¾ç½® DDL ä½œä¸šã€‚  å®ç° ä¸­å¿ƒMaster é™¤äº†å¯åŠ¨æ–°ä½œä¸šå’Œå®Œæˆç°æœ‰ä½œä¸šå¤–ï¼Œmaster çš„ä¸€ä¸ªä¸»è¦åŠŸèƒ½æ˜¯å½“å®ƒä»¬çš„ï¼ˆGPUï¼‰èµ„æºè¢«è°ƒåº¦ç¨‹åºåˆ†é…ç»™å…¶ä»–ä½œä¸šæ—¶æŠ¢å æ­£åœ¨è¿è¡Œçš„ä½œä¸šã€‚\nç”±äº DL ä½œä¸šçš„è¿­ä»£æ€§è´¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦å°†æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨ GPU å’Œä¸»å†…å­˜ä¸­ä»¥è¿›è¡Œä½œä¸šæŠ¢å ã€‚\nç›®å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨å‡ ä¹æ‰€æœ‰ DL æ¡†æ¶æä¾›çš„æ£€æŸ¥ç‚¹åŠŸèƒ½æ¥ä¸ºæŠ¢å ä½œä¸šä¿å­˜æœ€æ–°æ¨¡å‹ã€‚\nå½“è§¦å‘æŠ¢å æ—¶ï¼Œä½œä¸šé¦–å…ˆè¢«æš‚åœï¼›ç„¶åå®ƒçš„é¦–å¸­å·¥ä½œè€…å°†å®ƒçš„æ¨¡å‹æ£€æŸ¥ç‚¹åˆ°ä¸€ä¸ªé›†ç¾¤èŒƒå›´çš„å…±äº«æ–‡ä»¶ç³»ç»Ÿã€‚\nå½“è°ƒåº¦ç¨‹åºå†æ¬¡æ¢å¤æš‚åœçš„ä½œä¸šæ—¶ï¼Œå°†åœ¨é‡æ–°å¯åŠ¨ä¹‹å‰åŠ è½½å…¶æœ€è¿‘çš„æ£€æŸ¥ç‚¹ã€‚ä¸­å¤®ä¸»æœºè¿˜ä½¿ç”¨æ”¾ç½®ç®—æ³•å’Œåˆ†æå™¨ç¡®å®šä½œä¸šçš„æ”¾ç½®ã€‚\nåˆ†å¸ƒå¼RDMAç›‘æ§ ç”±äº RDMA åœ¨ GPU é›†ç¾¤ä¸­å¹¿æ³›ç”¨äº DDL ä½œä¸šï¼Œæˆ‘ä»¬å°†åˆ†æå™¨å®ç°ä¸ºå¯åŠ è½½åº“ï¼Œç”¨äºæ‹¦æˆª RDMA ibverbs APIã€‚\nå› æ­¤ï¼Œå®ƒå¯ä»¥è®°å½•æ¯ä¸ªæœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰ RDMA æ´»åŠ¨ï¼Œä¾‹å¦‚å»ºç«‹è¿æ¥ã€å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚æ‰€æœ‰ç›¸å…³å·¥ä½œäººå‘˜å’Œå‚æ•°æœåŠ¡å™¨çš„ RDMA çº§ä¿¡æ¯éšååœ¨ä¸­å¤®åˆ†æå™¨ä¸­èšåˆã€‚\nåŸºäºèšåˆä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œæ¶ˆæ¯å¤§å°å’Œæ€»æµé‡ï¼‰ï¼ŒTiresias å¯ä»¥è§£æç»™å®š DDL ä½œä¸šçš„è¯¦ç»†æ¨¡å‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶åå·®ã€‚\nè™½ç„¶æ˜¯ä¸º RDMA ç½‘ç»œå®ç°çš„ï¼Œä½†åˆ†æå™¨å¯ä»¥é€šè¿‡æ‹¦æˆªå¥—æ¥å­— API è½»æ¾æ‰©å±•ä»¥æ”¯æŒ TCP/IP ç½‘ç»œã€‚\n","date":"2022-12-27T09:46:16+08:00","image":"https://cdn.jsdelivr.net/gh/Tweakzx/ImageHost@main/img/202212270951184.png","permalink":"https://tweakzx.github.io/p/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0tiresias%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/","title":"ã€è®ºæ–‡ç¬”è®°ã€‘Tiresiasè®ºæ–‡é˜…è¯»ç¬”è®°"},{"content":"Tensorflow kernal launch çš„è¿‡ç¨‹ åˆ†æsessionæ‰§è¡Œçš„è¿‡ç¨‹ï¼Œ å¹¶åˆ†æAntmanå¯¹æ‰§è¡Œè¿‡ç¨‹çš„ä¿®æ”¹\nå‡½æ•°è°ƒç”¨é“¾ Run()\u0026ndash;\u0026gt;RunInternel()\u0026ndash;\u0026gt;RunAsync()\u0026ndash;\u0026gt;ScheduleReady()\u0026ndash;\u0026gt;Process()\nä¿®æ”¹äº†direct_session.cc , åœ¨sessionæ‰§è¡Œå‰åè¿è¡Œä¸­é—´ä»¶æ¡†æ¶\nä¿®æ”¹äº†executor.cc ï¼Œ æ–°å¢ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨é˜Ÿåˆ—ï¼Œ å¹¶å°†éœ€è¦æ’å…¥æ—¶é—´æ§½çš„å¼‚æ­¥OpåŠ å…¥é˜Ÿåˆ—ï¼Œåœ¨OpManagerçº¿ç¨‹ä¸­ç­‰å¾…æ‰§è¡Œã€‚\n\rimg\r\nSessionçš„æ‰§è¡Œ Sessionçš„ä»£ç é€»è¾‘åœ¨TensorFlow-with-dynamic-scaling/tensorflow/core/common_runtime/direct_session.ccçš„Run()å‡½æ•°ä¸­ï¼Œ\nDirectSession::Run Status DirectSession::Run(const RunOptions\u0026amp; run_options, const NamedTensorList\u0026amp; inputs, const std::vector\u0026lt;string\u0026gt;\u0026amp; output_names, const std::vector\u0026lt;string\u0026gt;\u0026amp; target_nodes, std::vector\u0026lt;Tensor\u0026gt;* outputs, RunMetadata* run_metadata) { //åˆ¤æ–­è®¡ç®—å›¾æ˜¯å¦æ„å»º  TF_RETURN_IF_ERROR(CheckNotClosed()); TF_RETURN_IF_ERROR(CheckGraphCreated(\u0026#34;Run()\u0026#34;)); //è®¡æ•°å™¨  direct_session_runs-\u0026gt;GetCell()-\u0026gt;IncrementBy(1); // Extract the inputs names for this run of the session.  //æå–è¾“å…¥çš„å¼ é‡åå­—å’Œå¼ é‡å¤§å°  std::vector\u0026lt;string\u0026gt; input_tensor_names; input_tensor_names.reserve(inputs.size()); size_t input_size = 0; for (const auto\u0026amp; it : inputs) { input_tensor_names.push_back(it.first); input_size += it.second.AllocatedBytes(); } metrics::RecordGraphInputTensors(input_size); // Check if we already have an executor for these arguments.  // æ£€æŸ¥æ˜¯å¦å·²ç»åˆ›å»ºæ‰§è¡Œå™¨ï¼Œ æ²¡æœ‰çš„è¯ï¼Œ åˆ›å»º  // ä¸€èˆ¬æƒ…å†µä¸‹ æ¯ä¸ªè®¾å¤‡éƒ½æœ‰ä¸€ä¸ªæ‰§è¡Œå™¨ï¼Œ è´Ÿè´£è¿™ä¸ªè®¾å¤‡ä¸Šè®¡ç®—å­å›¾çš„æ‰§è¡Œ  ExecutorsAndKeys* executors_and_keys; RunStateArgs run_state_args(run_options.debug_options()); run_state_args.collective_graph_key = run_options.experimental().collective_graph_key(); TF_RETURN_IF_ERROR(GetOrCreateExecutors(input_tensor_names, output_names, target_nodes, \u0026amp;executors_and_keys, \u0026amp;run_state_args)); { mutex_lock l(collective_graph_key_lock_); collective_graph_key_ = executors_and_keys-\u0026gt;collective_graph_key; } // Configure a call frame for the step, which we use to feed and  // fetch values to and from the executors.  //è®¾ç½®å‡½æ•°è°ƒç”¨å¸§çš„å‚æ•°ï¼Œ Tensorflowä½¿ç”¨feedå’Œfetchå­—å…¸æ¥å’Œæ‰§è¡Œå™¨è¿›è¡Œæ•°æ®äº¤äº’  //feedæ˜¯è¾“å…¥ï¼Œ fetchæ˜¯è¾“å‡º  //æ„å»ºFunctionCallFrame call_frame, Sessionä¸æ‰§è¡Œå™¨ä¹‹é—´ç›¸äº’äº¤äº’  //å¤„ç†æ‰§è¡Œå™¨çš„è¾“å…¥ä¸è¾“å‡º  FunctionCallFrame call_frame(executors_and_keys-\u0026gt;input_types, executors_and_keys-\u0026gt;output_types); gtl::InlinedVector\u0026lt;Tensor, 4\u0026gt; feed_args(inputs.size()); for (const auto\u0026amp; it : inputs) { if (it.second.dtype() == DT_RESOURCE) { Tensor tensor_from_handle; TF_RETURN_IF_ERROR( ResourceHandleToInputTensor(it.second, \u0026amp;tensor_from_handle)); feed_args[executors_and_keys-\u0026gt;input_name_to_index[it.first]] = tensor_from_handle; } else { feed_args[executors_and_keys-\u0026gt;input_name_to_index[it.first]] = it.second; } } const Status s = call_frame.SetArgs(feed_args); if (errors::IsInternal(s)) { return errors::InvalidArgument(s.error_message()); } else if (!s.ok()) { return s; } const int64 step_id = step_id_counter_.fetch_add(1); if (LogMemory::IsEnabled()) { LogMemory::RecordStep(step_id, run_state_args.handle); } //å‡†å¤‡å¥½æ‰§è¡Œç¯å¢ƒä¹‹åï¼Œ å¼€å§‹è°ƒç”¨RunInternalæ‰§è¡Œè®¡ç®—  TF_RETURN_IF_ERROR(RunInternal(step_id, run_options, \u0026amp;call_frame, executors_and_keys, run_metadata, thread::ThreadPoolOptions())); ... ... // è·å–å¹¶å¤„ç†è®¡ç®—å›¾çš„æ‰§è¡Œç»“æœ } DirectSession::RunInternal() // RunInternalä¼šå¯åŠ¨å¤šä¸ªå¹¶è¡Œçš„æ‰§è¡Œå™¨ï¼Œ // åˆ›å»ºæ‰§è¡Œå™¨çš„barrierï¼Œ ç¡®ä¿æ‰§è¡Œå™¨éƒ½æ‰§è¡Œå®Œï¼Œ æ‰§è¡Œå®Œåè¿”å›Run()å‡½æ•° Status DirectSession::RunInternal( int64 step_id, const RunOptions\u0026amp; run_options, CallFrameInterface* call_frame, ExecutorsAndKeys* executors_and_keys, RunMetadata* run_metadata, const thread::ThreadPoolOptions\u0026amp; threadpool_options) { const uint64 start_time_usecs = options_.env-\u0026gt;NowMicros(); const int64 executor_step_count = executors_and_keys-\u0026gt;step_count.fetch_add(1); ////////////////////////////////////////////////////////  // Running all pre session run action in grouping //  // åœ¨sessionè®¡ç®—æ‰§è¡Œä¹‹å‰æ·»åŠ SessionRunActionRegistry //  // ä»¥è¿è¡Œåœ¨sessionå¼€å§‹ä¹‹å‰çš„ä¸­é—´ä»¶ //  ////////////////////////////////////////////////////////  SessionRunActionOptions action_options; action_options.device_mgr = \u0026amp;device_mgr_; action_options.sess_ptr = this; TF_RETURN_IF_ERROR(SessionRunActionRegistry::Global()-\u0026gt;RunGrouping( SessionRunActionRegistry::PRE_SESSION_RUN, action_options)); //  //  //æ ‡è®°è¿è¡ŒçŠ¶æ€  RunState run_state(step_id, \u0026amp;devices_); ... ... // profiler TraceMe  //æ„å»º IntraProcessRendezvous ç”¨äºæœ¬åœ°Tensorç®¡ç†  run_state.rendez = new IntraProcessRendezvous(device_mgr_.get()); ... ... // ifndef _ANDROID  // Start parallel Executors.  //å¼€å§‹å¹¶è¡Œæ‰§è¡Œå™¨  //æ„å»º ExecutorBarrier ç”¨äºåè°ƒå¤šä¸ª Executor å¹¶è¡Œè®¡ç®—ï¼Œä¿æŒ graph ä¸€è‡´æ€§  const size_t num_executors = executors_and_keys-\u0026gt;items.size(); ExecutorBarrier* barrier = new ExecutorBarrier( num_executors, run_state.rendez, [\u0026amp;run_state](const Status\u0026amp; ret) { { mutex_lock l(run_state.mu_); run_state.status.Update(ret); } run_state.executors_done.Notify(); }); ... ... //æ„å»ºargs  // Register this step with session\u0026#39;s cancellation manager, so that  // `Session::Close()` will cancel the step.  ... ...//å¤„ç†`Session::Close()`  // Use std::unique_ptr to ensure garbage collection  //åˆ›å»ºçº¿ç¨‹æ± å®é™…è¿è¡Œæ‰§è¡Œå™¨  std::unique_ptr\u0026lt;thread::ThreadPool\u0026gt; threadpool_wrapper; thread::ThreadPool* pool = nullptr; ...//è®¾ç½®çº¿ç¨‹æ±   //å¼‚æ­¥å¯åŠ¨æ‰§è¡Œå™¨  for (const auto\u0026amp; item : executors_and_keys-\u0026gt;items) { thread::ThreadPool* device_thread_pool = item.device-\u0026gt;tensorflow_device_thread_pool(); if (!device_thread_pool) { args.runner = default_runner; } else { args.runner = [this, device_thread_pool](Executor::Args::Closure c) { device_thread_pool-\u0026gt;Schedule(std::move(c)); }; } if (handler != nullptr) { args.user_intra_op_threadpool = handler-\u0026gt;AsIntraThreadPoolInterface(); } /////////////// æ‰§è¡Œå™¨çš„å¯åŠ¨///////////////////  item.executor-\u0026gt;RunAsync(args, barrier-\u0026gt;Get()); /////////////////////////////////////////////  } //ç­‰å¾…æ‰§è¡Œç»“æœ  WaitForNotification(\u0026amp;run_state, \u0026amp;step_cancellation_manager, run_options.timeout_in_ms() \u0026gt; 0 ? run_options.timeout_in_ms() : operation_timeout_in_ms_); ... ... //ä¿å­˜è¿è¡Œç»“æœ  if (!run_state.tensor_store.empty()) { TF_RETURN_IF_ERROR(run_state.tensor_store.SaveTensors( {executors_and_keys-\u0026gt;callable_options.fetch().begin(), executors_and_keys-\u0026gt;callable_options.fetch().end()}, \u0026amp;session_state_)); } ... ... ///////////////////////////////////////////////////////////  // Running all post session run action in grouping //  // åœ¨sessionè®¡ç®—æ‰§è¡Œç»“æŸä¹‹åæ·»åŠ SessionRunActionRegistryï¼Œ //  // ä»¥è¿è¡Œåœ¨sessionç»“æŸä¹‹åçš„ä¸­é—´ä»¶ //  ///////////////////////////////////////////////////////////  uint64 session_end_time = tensorflow::Env::Default()-\u0026gt;NowMicros(); action_options.sess_duration_us = time_duration_usecs; action_options.graph_id = reinterpret_cast\u0026lt;uint64\u0026gt;(executors_and_keys); TF_RETURN_IF_ERROR(SessionRunActionRegistry::Global()-\u0026gt;RunGrouping( SessionRunActionRegistry::POST_SESSION_RUN, action_options)); return Status::OK(); } æ‰§è¡Œå™¨é€»è¾‘ ExecutorState::RunAsyn() # ExecutorState::RunAsync çš„å®ç° # æ¦‚è¿°ï¼šåˆå§‹åŒ–readyé˜Ÿåˆ—ï¼Œ å¼€å¯çº¿ç¨‹æ±  void ExecutorState::RunAsync(Executor::DoneCallback done) { const Graph* graph = impl_-\u0026gt;graph_.get(); TaggedNodeSeq ready; // è·å– context mapï¼Œå³è¿è¡Œæ—¶ä¸Šä¸‹æ–‡  Device* device = impl_-\u0026gt;params_.device; const Status fill_status = device-\u0026gt;FillContextMap(graph, \u0026amp;device_context_map_); if (!fill_status.ok()) { done(fill_status); return; } // åˆå§‹åŒ– ready é˜Ÿåˆ—ï¼Œå³å­˜æ”¾å…¥åº¦ä¸º0çš„node  for (const Node* n : impl_-\u0026gt;root_nodes_) { DCHECK_EQ(n-\u0026gt;in_edges().size(), 0); ready.push_back(TaggedNode{n, root_frame_, 0, false}); } if (ready.empty()) { done(Status::OK()); } else { num_outstanding_ops_ = ready.size(); root_frame_-\u0026gt;iterations[0]-\u0026gt;outstanding_ops = ready.size(); done_cb_ = std::move(done); // çº¿ç¨‹æ± å…¥å£  ScheduleReady(ready, nullptr); } } ExecutorState::ScheduleReady() # ExecutorState::ScheduleReady çš„å®ç° # æ¦‚è¿°ï¼šå°†èŠ‚ç‚¹åˆ†ä¸º expensive \u0026amp; inexpensive èŠ‚ç‚¹ï¼Œå°†inexpensiveèŠ‚ç‚¹æ”¾å…¥ inline_ready ä¸­ void ExecutorState::ScheduleReady(const TaggedNodeSeq\u0026amp; ready, TaggedNodeReadyQueue* inline_ready) { if (ready.empty()) return; int64 scheduled_usec = 0; if (stats_collector_) { scheduled_usec = nodestats::NowInUsec(); } if (inline_ready == nullptr) { // è¿è¡Œæ‰€æœ‰ ready ops \t// è¿è¡Œreadyé˜Ÿåˆ—é‡Œçš„èŠ‚ç‚¹ readyæ˜¯å½“å‰çº¿ç¨‹è¦å¤„ç†çš„é˜Ÿåˆ—  for (auto\u0026amp; tagged_node : ready) { runner_([=]() { Process(tagged_node, scheduled_usec); }); } return; } // å°†èŠ‚ç‚¹åˆ†ç±»ï¼Œè¿è¡Œ expensive node  const GraphView\u0026amp; gview = impl_-\u0026gt;gview_; const TaggedNode* curr_expensive_node = nullptr; for (auto\u0026amp; tagged_node : ready) { const NodeItem\u0026amp; item = *gview.node(tagged_node.node-\u0026gt;id()); if (tagged_node.is_dead || !item.kernel_is_expensive) { //  inline_ready-\u0026gt;push_back(tagged_node); } else { //å¯¹äºé«˜å¼€é”€èŠ‚ç‚¹å¯åŠ¨æ–°çš„çº¿ç¨‹å»æ‰§è¡Œ  if (curr_expensive_node) { runner_(std::bind(\u0026amp;ExecutorState::Process, this, *curr_expensive_node, scheduled_usec)); } curr_expensive_node = \u0026amp;tagged_node; } } if (curr_expensive_node) { //é«˜å¼€é”€èŠ‚ç‚¹  if (inline_ready-\u0026gt;empty()) { // inline_readyä¸ºç©ºï¼Œ å°†é¦–ä¸ªé«˜å¼€é”€èŠ‚ç‚¹æ”¾å…¥inline_ready  inline_ready-\u0026gt;push_back(*curr_expensive_node); } else { // inline_readyä¸ä¸ºç©ºï¼Œ å°†é«˜å¼€é”€èŠ‚ç‚¹æ”¾å…¥å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œ  runner_(std::bind(\u0026amp;ExecutorState::Process, this, *curr_expensive_node, scheduled_usec)); } } ... ... } ExecutorState::Process() # ExecutorState::Process è¯¦è§£ # æ¦‚è¿°ï¼šçº¿ç¨‹æ± ä¸­è·‘çš„å†…å®¹ï¼Œä»£ç å¤ªé•¿ä¸è´´äº†ã€‚ # ä¸»è¦æµç¨‹ï¼š # + å°†å½“å‰èŠ‚ç‚¹æ·»åŠ åˆ° inline_ready é˜Ÿåˆ—ä¸­ã€‚ # + å¾ªç¯ä» inline_ready é˜Ÿåˆ—è·å–èŠ‚ç‚¹å¹¶è¿è¡Œï¼Œè¿è¡Œå®Œæ¯•åæ‰§è¡Œ NodeDoneï¼ˆæœ‰å¯èƒ½ä¼šæ·»åŠ æ–°èŠ‚ç‚¹åˆ°inline_readyé˜Ÿåˆ—ï¼‰ # + å½“inline readyé˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè·³å‡ºå¾ªç¯ã€‚ # å…¶ä»–é‡è¦å†…å®¹ï¼š # + è¿è¡ŒèŠ‚ç‚¹é€šè¿‡ device çš„ ComputeAsync æˆ– Compute æ–¹æ³• # + å¤„ç†è¾“å‡ºç»“æœä½¿ç”¨ ProcessOutputs å‡½æ•°å’Œ PropagateOutputs å‡½æ•° # + è®¡ç®—ç»“æŸåé€šè¿‡ NodeDone æ¥æ”¶å°¾ void ExecutorState::Process(TaggedNode tagged_node, int64 scheduled_nsec) { WithContext wc(context_); ... ... // Parameters passed to OpKernel::Compute.  TensorValueVec inputs; DeviceContextVec input_device_contexts; AllocatorAttributeVec input_alloc_attrs; OpKernelContext::Params params; params.step_id = step_id_; // Override device\u0026#39;s threadpool if user provides an intra_op_threadpool  Device* device = impl_-\u0026gt;params_.device; ... ... bool completed = false; inline_ready.push_back(tagged_node); uint64 sess_op_num = 0; //å¾ªç¯å¤„ç†inline_readyä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ ç›´åˆ°ä¸ºç©º  while (!IsAsyncGPUOpQueueEmpty() || !inline_ready.empty()) { tagged_node = inline_ready.front(); inline_ready.pop_front(); ... ... //å‡†å¤‡è¾“å…¥æ•°æ®ï¼Œ ç¡®ä¿è¾“å…¥æ˜¯æœ‰æ•ˆçš„  s = PrepareInputs(item, first_input, \u0026amp;inputs, \u0026amp;input_device_contexts, \u0026amp;input_alloc_attrs, \u0026amp;is_input_dead); ... ... // ç»å¤§å¤šæ•°çš„Opæ˜¯åŒæ­¥è®¡ç®—æ¨¡å¼ï¼Œ send/recvæ˜¯å¼‚æ­¥è®¡ç®—æ¨¡å¼  if (item.kernel_is_async) { //å¼‚æ­¥è®¡ç®—, send/recvæ˜¯é«˜å¼€é”€çš„  launched_asynchronously = true; Device* kernel_device = impl_-\u0026gt;params_.device; // Only enqueue this op if it is an async GPU op.  if (need_to_insert_idle_time_ \u0026amp;\u0026amp; (kernel_device-\u0026gt;name()).find(\u0026#34;GPU\u0026#34;) != string::npos) { //////////////////////////////////////////////////////////////////////  // æŠŠè¿™ä¸ªGPU Opæ”¾å…¥async_gpu_op_queueé˜Ÿåˆ—ä¸­ å¦‚æœéœ€è¦åœ¨å®ƒå¯åŠ¨ä¹‹å‰æ’å…¥æ—¶é—´æ§½çš„è¯  // Enqueue this GPU op therefore we can insert a time slot before launching this op.  // å°†åŸæœ¬æ‰§è¡Œå¼‚æ­¥è®¡ç®—ä»£ç çš„Opæ”¾å…¥è‡ªå®šä¹‰çš„async_gpu_op_queueé˜Ÿåˆ—ä¸­ï¼Œ  // äº¤ç”±OpManageræ‰§è¡Œ  //////////////////////////////////////////////////////////////////////  sess_op_num++; ... ... // Enqueue this asyn GPU op.  async_gpu_op_queue_lock_.lock(); async_gpu_op_queue.emplace_back(async_gpu_kernel); num_queued_op.fetch_add(1); async_gpu_op_queue_lock_.unlock(); } else { /////////////////////////////////////////////////////////////////////  // ä¸éœ€è¦æ’å…¥æ—¶é—´æ§½ï¼Œ æ‰€ä»¥ä¸æ”¾å…¥async_gpu_op_queueé˜Ÿåˆ—  // Do not enqueue this op.  // è°ƒç”¨åŸæœ¬çš„è®¡ç®—å¼‚æ­¥çš„å‡½æ•°  /////////////////////////////////////////////////////////////////////  device-\u0026gt;ComputeAsync(async, \u0026amp;state-\u0026gt;ctx, done); } else { // åŒæ­¥è®¡ç®—  // Synchronous computes.  OpKernelContext ctx(\u0026amp;params, item.num_outputs); nodestats::SetOpStart(stats); ... ... //è¿›è¡Œè®¡ç®— deivce-\u0026gt;Compute(op_kernel, \u0026amp;ctx)  nodestats::SetOpEnd(stats); //å¤„ç†è¾“å‡º  s = ProcessOutputs(item, \u0026amp;ctx, \u0026amp;outputs, stats); ... ... //ä¼ æ’­è¾“å‡º  if (s.ok()) { PropagateOutputs(tagged_node, \u0026amp;item, \u0026amp;outputs, \u0026amp;ready); } ... ... //ä¼ æ’­åå¤„ç†  //ç»“æŸ  completed = NodeDone(s, item.node, ready, stats, \u0026amp;inline_ready); } } // while !inline_ready.empty()  if (sess_op_num \u0026gt; 0) { // Record the total number of the queued op running in this session.  GPUResourceManagement* rm = GetGPUResourceManagement(); if (rm != nullptr) { rm-\u0026gt;SetExecutorQueuedOpNum(impl_, sess_op_num); } } // This thread of computation is done if completed = true.  if (completed) ScheduleFinish(); } ExecutorState::AsyncGPUOpManager() void ExecutorState::AsyncGPUOpManager() { uint64 sleep_time_us = 0; need_to_insert_idle_time_ = false; GPUResourceManagement* rm = GetGPUResourceManagement(); if (rm == nullptr) { return; } while (!terminate_op_magager_thread_) { //è®¾ç½®é˜Ÿåˆ—ä¸­çš„Opæ˜¯å¦éœ€è¦æ’å…¥æ—¶é—´æ§½  need_to_insert_idle_time_ = rm-\u0026gt;GetEstimatedIdleTime() \u0026gt; 0 ? true : false; std::function\u0026lt;void(void)\u0026gt; queued_call_func = nullptr; async_gpu_op_queue_lock_.lock(); if (!async_gpu_op_queue.empty()) { queued_call_func = async_gpu_op_queue.front(); } async_gpu_op_queue_lock_.unlock(); if (queued_call_func != nullptr) { queued_call_func(); async_gpu_op_queue_lock_.lock(); if (!async_gpu_op_queue.empty()) { async_gpu_op_queue.erase(async_gpu_op_queue.begin()); num_queued_op.fetch_sub(1); } async_gpu_op_queue_lock_.unlock(); // Estimate idle time  uint64 idle_time = rm-\u0026gt;GetEstimatedIdleTime(); uint64 queued_op_num = rm-\u0026gt;GetExecutorQueuedOpNum(impl_); idle_time = queued_op_num \u0026gt; 0 ? (idle_time / queued_op_num) : 0; usleep(idle_time); uint64 remain_time = rm-\u0026gt;GetEstimatedIdleTime(); remain_time = remain_time \u0026gt; idle_time ? (remain_time - idle_time) : 0; rm-\u0026gt;SetEstimatedIdleTime(remain_time); } usleep(default_check_interval); } return; } ","date":"2022-12-23T18:57:14+08:00","permalink":"https://tweakzx.github.io/p/%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90tensorflow%E7%9A%84session%E6%89%A7%E8%A1%8C%E5%88%86%E6%9E%90/","title":"ã€ä»£ç åˆ†æã€‘Tensorflowçš„sessionæ‰§è¡Œåˆ†æ"},{"content":"Antmanå¯¹Tensorflowçš„ä»£ç ä¿®æ”¹ æ€»ä½“çš„å…³ç³»å›¾ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªå®ç°ï¼Œ å†…å­˜æ–¹é¢çš„GPUResourceManagementä»¥åŠç®—åŠ›æ–¹é¢çš„GpuOpManagerã€‚\ngraph TD Agpu_resource_manage_file] B[SessionRunRegistry] C[SessionRunAction] D[Executor] E[GPUResouceManagement] F[GPU Statistic] G[GpuOpManager] H[GpuUsageAdjustment] I(dump gpu statistic) J[GPU Process State] K[GPUVMemAllocator] L[GPUAdjustableAllocator] A --|FileListener| E B --|Register| E E --|need_to_adjust_memory_| H H --|new| L H --|get| K C --|Derive| E C --|Derive| F B --|Register| F F --|need_to_dump_statistics_| I B --|Run| C J --|maybe_create_gpu_vmem_allocator|K D --|run thread| G E --|GetEstimatedIdleTime| G  GPUVMemAllocator GPUVMemAllocator å¯ä»¥åˆ†é…hostçš„memä½œä¸ºæ˜¾å­˜çš„å¤‡ç”¨ï¼Œä»¥å…å‡ºç°OOMé”™è¯¯ã€‚\nåˆ›å»ºallocator maybe_create_gpu_vmem_allocator(\u0026hellip;)å¯ä»¥æ ¹æ®æƒ…å†µè¿”å›åˆé€‚çš„allocator\ngraph TD A([start]) --|gpu_allocator|B[maybe_create_gpu_vmem_allocator]--C{if !gpu_vmem} C --|true| D([è¿”å›gpu_allocator]) C --|false|Z(å‡†å¤‡ç”ŸæˆVMemAllocator) Z -- E[new GpuHostAllocator] E --|sub_allocator| F[new BFCAllocator] Z --|gpu_allocator| G[new GPUVMemAllocator] F --|host_allocator|G G --|gpu_vmem_allocator|H([è¿”å›gpu_vmem_allocator])  Allocator* maybe_create_gpu_vmem_allocator(Allocator* gpu_allocator, int bus_id, PlatformGpuId platform_gpu_id, int tf_gpu_id, se::StreamExecutor* stream_exec) { bool gpu_vmem = false; Status status = ReadBoolFromEnvVar(\u0026#34;TF_GPU_VMEM\u0026#34;, true/*enabled by default*/, \u0026amp;gpu_vmem); if (!status.ok()) { LOG(ERROR) \u0026lt;\u0026lt; \u0026#34;GetGPUAllocator: \u0026#34; \u0026lt;\u0026lt; status.error_message(); } if (!gpu_vmem) { return gpu_allocator; } SubAllocator* sub_allocator = new GpuHostAllocator( GpuIdUtil::ExecutorForPlatformGpuId(platform_gpu_id).ValueOrDie(), bus_id, {}, {}); int64 cuda_host_mem_limit_in_mb = -1; status = ReadInt64FromEnvVar(\u0026#34;TF_CUDA_HOST_MEM_LIMIT_IN_MB\u0026#34;, 1LL \u0026lt;\u0026lt; 16 /*64GB max by default*/, \u0026amp;cuda_host_mem_limit_in_mb); if (!status.ok()) { LOG(ERROR) \u0026lt;\u0026lt; \u0026#34;GetGpuHostAllocator: \u0026#34; \u0026lt;\u0026lt; status.error_message(); } int64 cuda_host_mem_limit = cuda_host_mem_limit_in_mb * (1LL \u0026lt;\u0026lt; 20); Allocator* host_allocator = new BFCAllocator(sub_allocator, cuda_host_mem_limit, true /*allow_growth*/, strings::StrCat(\u0026#34;GPUHost_\u0026#34;, tf_gpu_id, \u0026#34;_bfc\u0026#34;)); Allocator* gpu_vmem_allocator = new GPUVMemAllocator(gpu_allocator, host_allocator, tf_gpu_id, stream_exec); return gpu_vmem_allocator; } åˆ†é…è™šæ‹Ÿå†…å­˜ å…ˆå°è¯•åˆ†é…GPUå†…å­˜ï¼Œ åˆ†é…æˆåŠŸåˆ™è¿”å›ï¼Œ åˆ†é…å¤±è´¥åˆ™åˆ†é…CPUå†…å­˜ã€‚\nvoid* GPUVMemAllocator::AllocateRaw(size_t alignment, size_t num_bytes) { mutex_lock l(lock_); AllocationAttributes new_attr; // Tell the device_allocator_ not to retry  // since we can alloc host memory as backup  new_attr.no_retry_on_failure = true; void* ret = device_allocator_-\u0026gt;AllocateRaw(alignment, num_bytes, new_attr); if (ret != nullptr) { device_ptrs_.insert(ret); return ret; } ret = host_allocator_-\u0026gt;AllocateRaw(alignment, num_bytes); VLOG(3) \u0026lt;\u0026lt; \u0026#34;host_allocator_ allocates \u0026#34; \u0026lt;\u0026lt; (num_bytes/1024.0/1024) \u0026lt;\u0026lt; \u0026#34; MiB\u0026#34;; return ret; } SessionRunActionRegistryï¼ˆä¸­é—´ä»¶æ¡†æ¶ï¼‰ æ·»åŠ äº†ä¸€ä¸ªSessionRunActionRegistryæ¡†æ¶ï¼Œ æ–¹ä¾¿åœ¨sessionå¼€å§‹ä¹‹å‰æˆ–è€…ç»“æŸä¹‹åæ·»åŠ æ‰§è¡ŒåŠ¨ä½œ\nä¿®æ”¹direct_session.cc å’Œ master_session.cc /ä¿®æ”¹äº†åŸå…ˆçš„sessionæ‰§è¡Œæµç¨‹ åœ¨sessionæ‰§è¡Œå‰ååˆ†åˆ«æ‰§è¡Œactions\n// Running all pre session run action in grouping  SessionRunActionOptions action_options; action_options.device_mgr = \u0026amp;device_mgr_; action_options.sess_ptr = this; TF_RETURN_IF_ERROR(SessionRunActionRegistry::Global()-\u0026gt;RunGrouping( SessionRunActionRegistry::PRE_SESSION_RUN, action_options)); ... const uint64 time_duration_usecs = options_.env-\u0026gt;NowMicros() - start_time_usecs; metrics::UpdateGraphExecTime(time_duration_usecs); // Running all post session run action in grouping  uint64 session_end_time = tensorflow::Env::Default()-\u0026gt;NowMicros(); action_options.sess_duration_us = time_duration_usecs; action_options.graph_id = reinterpret_cast\u0026lt;uint64\u0026gt;(executors_and_keys); TF_RETURN_IF_ERROR(SessionRunActionRegistry::Global()-\u0026gt;RunGrouping( SessionRunActionRegistry::POST_SESSION_RUN, action_options)); æ³¨å†Œaction void SessionRunActionRegistry::Register( Grouping grouping, int phase, SessionRunAction* action) { VLOG(2) \u0026lt;\u0026lt; \u0026#34;Register session run action \u0026#34; \u0026lt;\u0026lt; action-\u0026gt;name(); groups_[grouping][phase].emplace_back(action); } // ä¸€äº›å®å‡½æ•°: æä¾›æ³¨å†Œä¸­é—´ä»¶çš„æ¥å£ #define REGISTER_SESSION_RUN_ACTION(grouping, phase, action) \\ REGISTER_ACTION_UNIQ_HELPER(__COUNTER__, grouping, phase, action)  #define REGISTER_ACTION_UNIQ_HELPER(ctr, grouping, phase, action) \\ REGISTER_ACTION_UNIQ(ctr, grouping, phase, action)  #define REGISTER_ACTION_UNIQ(ctr, grouping, phase, action) \\ static ::tensorflow::session_run_action_registration:: \\ SessionRunActionRegistration register_session_run_action_##ctr( \\ grouping, phase, new action(), \\ #action)  } // namespace tensorflow  #endif // TENSORFLOW_CORE_COMMON_RUNTIME_SESSION_RUN_ACTION_REGISTRY_H_  //å®šä¹‰äº†ä¸€ä¸ªRunAction()çš„æ¥å£ï¼Œ Action å¿…é¡»å®ç°è¿™ä¸ªæ¥å£ class SessionRunAction { public: virtual ~SessionRunAction() {} virtual Status RunAction(const SessionRunActionOptions\u0026amp; options) = 0; void set_name(const string\u0026amp; name) { name_ = name; } std::string name() const { return name_; } private: // The name of the action, which is the same as the inherited  // class name.  string name_; }; GPU memory limit adjustment å®ç°åŠ¨æ€èµ„æºåˆ†é…ï¼Œ è‡ªåŠ¨è°ƒæ•´ç°å­˜é™åˆ¶ï¼Œ å½“å‘ç° Host å†…å­˜è¢«ä½¿ç”¨çš„æ—¶å€™ï¼Œä¼šæé«˜æ˜¾å­˜çš„é™åˆ¶é˜ˆå€¼ï¼Œè¿™æ ·æ‰€æœ‰çš„ Tensor éƒ½å¯ä»¥ç”³è¯·åœ¨æ˜¾å¡ä¸Šã€‚è¿™æ ·åªä¼šå½±å“ä¸€ä¸ª mini batch çš„æ€§èƒ½ï¼Œåé¢çš„ mini batch è·‘å‰å‘åå‘è®¡ç®—çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ Tensor éƒ½ä¼šè¢«ç”³è¯·åœ¨æ˜¾å­˜ä¸Šã€‚\nä¿®æ”¹äº†tensorflow åŸæœ¬çš„ BFC_Allocator.h å¢åŠ äº†friend class GPUAdjustableAllocator;\n// Declare the GPUAdjustableAllocator to be friend of the BFCAllocator,  // therefore it can adjust the memory limit by modifying the private  // member variables of BFCAllocator.  friend class GPUAdjustableAllocator; å¢åŠ äº†æ‰©ç¼©æ˜¾å­˜åˆ†é…çš„å‡½æ•° class GPUAdjustableAllocator final { public: // Adjust the memory_limit_ to allow memory grow/shrink at runtime  // Returns adjusted memory_limit_. If the return value is less than  // the new_memory_limit, the adjustment failed.  size_t AdjustMemoryLimit(size_t new_memory_limit, BFCAllocator* bfc_allocator); // Get the memory pool size and in used memory size of the bfc_allocator.  void GetMemPoolStats(BFCAllocator* bfc_allocator, int64_t* deviceMemPoolSize, int64_t* deviceMemStable); private: // Free the memory regions that are not in use  size_t FreeEmptyMemory(size_t target_memory_bytes, BFCAllocator* bfc_allocator) EXCLUSIVE_LOCKS_REQUIRED(lock_); }; size_t GPUAdjustableAllocator::AdjustMemoryLimit(size_t new_memory_limit, BFCAllocator* bfc_allocator) { mutex_lock l(bfc_allocator-\u0026gt;lock_); if (new_memory_limit \u0026gt;= bfc_allocator-\u0026gt;total_region_allocated_bytes_) { // 1) new_memory_limit \u0026gt;= memory_limit_ : grow memory size  // 2) memory_limit_ \u0026gt; new_memory_limit \u0026gt;= total_region_allocated_bytes_:  // shrink, but don\u0026#39;t need to free memory  // In both cases, no action needed by changing the memory limit  bfc_allocator-\u0026gt;memory_limit_ = new_memory_limit; bfc_allocator-\u0026gt;stats_.bytes_limit = new_memory_limit; } else { // total_region_allocated_bytes_ \u0026gt; new_memory_limit:  // shrink, need to free memory  size_t free_res = FreeEmptyMemory( new_memory_limit, bfc_allocator); if (free_res \u0026lt;= new_memory_limit) { bfc_allocator-\u0026gt;memory_limit_ = new_memory_limit; bfc_allocator-\u0026gt;stats_.bytes_limit = new_memory_limit; } else { bfc_allocator-\u0026gt;memory_limit_ = free_res; bfc_allocator-\u0026gt;stats_.bytes_limit = free_res; } } return bfc_allocator-\u0026gt;memory_limit_; } File Listener ç›‘æ§é…ç½®æ–‡ä»¶æ˜¯å¦å‘ç”Ÿæ”¹å˜ï¼Œ å¦‚æœå‘ç”Ÿæ”¹å˜åˆ™è§¦å‘å“åº”çš„handler,ä»¥åŠä¸€ä¸ªå›è°ƒå‡½æ•°\nvoid FileListener::RegisterFileListener(const std::string\u0026amp; file_path, const std::string\u0026amp; handler_name, callback callback_func) { LOG(INFO) \u0026lt;\u0026lt; \u0026#34;Register a file listener named \u0026#34; \u0026lt;\u0026lt; handler_name \u0026lt;\u0026lt; \u0026#34; on file \u0026#34; \u0026lt;\u0026lt; file_path; FileInfo new_file(file_path); std::vector\u0026lt;CallbackFunc\u0026gt; new_handlers; InfoAndHandlers value = {new_file, new_handlers}; CallbackFunc new_callback(handler_name, callback_func); mutex_lock l(lock_); auto res = listeners_.emplace(file_path, value); res.first-\u0026gt;second.file_handlers_.emplace_back(new_callback); if (file_monitor_thread_ == nullptr) { // Note we should start only one monitor thread  StartMonitorThread(); } } GPU resource managementï¼ˆä¸­é—´ä»¶ï¼‰ ç»§æ‰¿äº†SessionRunAction, æ˜¯ä¸€ä¸ªèµ„æºç®¡ç†ä¸­é—´ä»¶ï¼Œå®šä¹‰å¦‚ä¸‹\nclass GPUResourceManagement : public SessionRunAction { public: // Note that we will enable TF_FORCE_GPU_ALLOW_GROWTH and TF_GPU_VMEM  // automatically if the GPUResourceManagement feature is enabled.  GPUResourceManagement(); ~GPUResourceManagement() override; ...\t... //ğŸš¨é…ç½®æ–‡ä»¶æ›´æ–°åï¼Œ è§£ææ–°çš„é…ç½®å¹¶å­˜æ”¾äºæ­¤  // For recording the parsed new gpu resource limit.  //ğŸš¨ GPU èµ„æºé™åˆ¶  std::unordered_map\u0026lt;std::string, GPUResourceLimitInfo\u0026gt; gpu_resource_management_info_; // For recording the parsed new gpu performance limitation  // (if the value is 0, then it means to suspend this job).  // ğŸš¨ GPU æ€§èƒ½é™åˆ¶ï¼Œ å¦‚æœå€¼ä¸º0ï¼Œ æ„å‘³ç€æŒ‚èµ·è¿™ä¸ªjob  std::atomic\u0026lt;int\u0026gt; gpu_perf_control_; // For recording the total time of all inserted time slot.  uint64 total_time_slot_; // For recording the estimated total idle time.  uint64 estimated_total_idle_time_; // For recording the total number of queued GPU op running in  // the specified executor.  // ğŸš¨è®°å½•æ¯ä¸€ä¸ªExecutorè¦æ‰§è¡Œçš„OPæ•°ç›®  std::unordered_map\u0026lt;const void*, uint64\u0026gt; executor_queued_op_num_; // Determine if we need to adjust the GPU usage limit.  // ğŸš¨è¡¨ç¤ºæ˜¯å¦éœ€è¦æ›´æ”¹é…ç½®  std::atomic\u0026lt;bool\u0026gt; need_to_adjust_memory_; // For performing the adjustment.  // ä¿®æ”¹é…ç½®çš„ç±»çš„å®ä¾‹  GPUUsageAdjustment* gpu_usage_adjustment_; const std::string FILE_LISTENER_NAME = \u0026#34;GPUResourceManage\u0026#34;; }; GPUResourceManagement() GPUResourceManagement::GPUResourceManagement() : need_to_adjust_memory_(false), gpu_perf_control_(100), gpu_usage_adjustment_(new GPUUsageAdjustment()) { //ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–gpué…ç½®æ–‡ä»¶çš„è·¯å¾„  ReadStringFromEnvVar(\u0026#34;GPU_CONFIG_FILE\u0026#34;, \u0026#34;\u0026#34;, \u0026amp;gpu_resource_manage_file_path_); if (gpu_resource_manage_file_path_.empty()) { enable_gpu_resource_manage_ = false; } else { enable_gpu_resource_manage_ = true; // Note that we will enable TF_FORCE_GPU_ALLOW_GROWTH and TF_GPU_VMEM  // automatically if the GPUResourceManagement feature is enabled.  setenv(\u0026#34;TF_FORCE_GPU_ALLOW_GROWTH\u0026#34;, \u0026#34;true\u0026#34;, 1); setenv(\u0026#34;TF_GPU_VMEM\u0026#34;, \u0026#34;true\u0026#34;, 1); // Register a handler that will be triggered when the file named  FileListener::GlobalFileListener()-\u0026gt;RegisterFileListener( gpu_resource_manage_file_path_, FILE_LISTENER_NAME, //FILE_LISTENER_NAME: \u0026#34;GPUResourceManage\u0026#34;  [](const std::string\u0026amp; str) { // The callback func which is invoked when file changed.  // ä¼ å…¥ä¸€ä¸ªjsonæ–‡ä»¶ï¼ŒåŒ…å«ManageInfo  // å½“æ–‡ä»¶æ›´æ”¹æ—¶ï¼Œ è·å–ç›¸åº”çš„åœ¨sessionç»“æŸåè°ƒç”¨é¡ºåºä¸º2çš„actionä¸­åä¸ºGPUResourceManagementçš„action  // actionè§£ææ–°çš„é…ç½®ä¿¡æ¯  // ç­‰åˆ°session è§¦å‘RunAction()ï¼Œ æ›´æ–°é™åˆ¶  SessionRunAction* act = SessionRunActionRegistry::Global()-\u0026gt;GetAction( SessionRunActionRegistry::POST_SESSION_RUN, 2, \u0026#34;GPUResourceManagement\u0026#34;); if (act == nullptr) { std::cout \u0026lt;\u0026lt; \u0026#34;Cannot get the instance of GPUResourceManagement \\n\u0026#34;; } if (act != nullptr) { GPUResourceManagement* rm = dynamic_cast\u0026lt;GPUResourceManagement *\u0026gt;(act); if (rm != nullptr) { rm-\u0026gt;ParseManageInfoFromJson(str); } } }); } } æ³¨å†Œä¸­é—´ä»¶ æ„å‘³ç€session ç»“æŸå‰åè¦æ‰§è¡ŒRunActionï¼ˆ\u0026hellip;ï¼‰\n#if GOOGLE_CUDA // We register the GPUResourceManagement as a POST_SESSION_RUN action // during the initialization phase of the program. REGISTER_SESSION_RUN_ACTION(SessionRunActionRegistry::POST_SESSION_RUN, 2, GPUResourceManagement); #endif // GOOGLE_CUDA å®ç°å‡½æ•°RunActionï¼ˆ\u0026hellip;ï¼‰ å¦‚æœéœ€è¦è¿›è¡Œæ˜¾å­˜è°ƒæ•´ï¼Œ åˆ™è°ƒç”¨GPUUsageAdjustmentè°ƒæ•´èµ„æº\nStatus GPUResourceManagement::RunAction( const SessionRunActionOptions\u0026amp; options) { if (!need_to_adjust_memory_ \u0026amp;\u0026amp; gpu_perf_control_ \u0026gt;= 100) { // TODO(shiru): do we need to unregister the  // GPUResourceManagement if the environment variable  // GPU_CONFIG_FILE is set to null?  return Status::OK(); } if (need_to_adjust_memory_) { mutex_lock l(manage_mu_); // Start to adjust the resource limit as required.  for (const auto\u0026amp; it : gpu_resource_management_info_) { gpu_usage_adjustment_-\u0026gt;AdjustMemLimit(it.first, //GPUæ€»çº¿id  it.second.mem_limit_, options.device_mgr,\t//æ–°çš„æ˜¾å­˜é™åˆ¶ï¼Œ è®¾å¤‡ç®¡ç†å™¨  options.device_set);\t//è®¾å¤‡é›†åˆ  } need_to_adjust_memory_ = false; } // æš‚åœä¸€æ®µæ—¶é—´ æˆ–è€… æŒ‚èµ·è¿™ä¸ªjob  DoSleepOrSuspend(options.sess_duration_us); return Status::OK(); } GPUUsageAdjustment.cc bool GPUUsageAdjustment::AdjustMemLimit(const std::string\u0026amp; gpu_pci_bus_id, size_t new_mem_limit, const std::unique_ptr\u0026lt;const tensorflow::DeviceMgr\u0026gt;* device_mgr, const std::unique_ptr\u0026lt;DeviceSet\u0026gt;* device_set) { mutex_lock l(adj_mu_); //ä¸€ä¸ªè®°å½•å¯¹åº”gpuä½¿ç”¨æƒ…å†µçš„map  auto cur_info = cur_usage_info_.find(gpu_pci_bus_id); if (cur_info == cur_usage_info_.end()) { //å¦‚æœæ²¡æœ‰ç›¸åº”çš„ä½¿ç”¨ä¿¡æ¯ï¼Œ åˆ™ç«‹åˆ»è·å–ä½¿ç”¨ä¿¡æ¯  GPUBFCAllocator* allo = GetGPUAllocator(device_mgr, device_set, gpu_pci_bus_id); if (allo == nullptr) { LOG(ERROR) \u0026lt;\u0026lt; \u0026#34;Failed to get the allocator of gpu_pci_bus_id: \u0026#34; \u0026lt;\u0026lt; gpu_pci_bus_id; return false; } GPUUsageInfo usage_info; usage_info.gpu_allocator_ = allo; usage_info.cur_limit_.mem_limit_ = ULONG_MAX; // Get the VGPU_MEMORY_LIMIT  absl::optional\u0026lt;AllocatorStats\u0026gt; device_stats = allo-\u0026gt;GetStats(); usage_info.cur_limit_.initial_mem_limit_ = device_stats ? *device_stats-\u0026gt;bytes_limit : ULONG_MAX; auto ret = cur_usage_info_.emplace(gpu_pci_bus_id, usage_info); if (ret.second == false) { return false; } cur_info = ret.first; } //å¦‚æœè¶…å‡ºè™šæ‹ŸGPUçš„ä½¿ç”¨é™åˆ¶ï¼Œ åˆ™ä½¿ç”¨ä¸Šé™  if (new_mem_limit \u0026gt; cur_info-\u0026gt;second.cur_limit_.initial_mem_limit_) { // The new mem size limit exceeds VGPU_MEMORY_LIMIT  new_mem_limit = cur_info-\u0026gt;second.cur_limit_.initial_mem_limit_; LOG(WARNING) \u0026lt;\u0026lt; \u0026#34;The new mem size limit exceeds VGPU_MEMORY_LIMIT, \u0026#34; \u0026lt;\u0026lt; \u0026#34;therefore, adjust the new mem size limit to : \u0026#34; \u0026lt;\u0026lt; new_mem_limit; } //å¦‚æœåœ¨é™åˆ¶èŒƒå›´å†…ï¼Œå¹¶ä¸”éœ€è¦è°ƒæ•´ï¼Œ ä¸”è°ƒæ•´åçš„å€¼ä¸ä¸º0ï¼Œ  //è°ƒç”¨GPUAdjustableAllocatorï¼Œ æ›´æ”¹å†…å­˜é™åˆ¶ï¼Œ å¹¶ä¸”æ›´æ–°ä½¿ç”¨ä¿¡æ¯  if (cur_info-\u0026gt;second.cur_limit_.mem_limit_ != new_mem_limit \u0026amp;\u0026amp; new_mem_limit \u0026gt;= 0) { // Adjust the memory limit of this GPU  LOG(INFO) \u0026lt;\u0026lt; \u0026#34;Start to manage the mem size limit to \u0026#34; \u0026lt;\u0026lt; new_mem_limit \u0026lt;\u0026lt; \u0026#34; of device gpu_pci_bus_id: \u0026#34; \u0026lt;\u0026lt; gpu_pci_bus_id; GPUAdjustableAllocator* adj = new GPUAdjustableAllocator(); size_t cur_mem_limit = adj-\u0026gt;AdjustMemoryLimit(new_mem_limit, cur_info-\u0026gt;second.gpu_allocator_); cur_info-\u0026gt;second.cur_limit_.mem_limit_ = cur_mem_limit; if (cur_mem_limit \u0026gt; new_mem_limit) { LOG(ERROR) \u0026lt;\u0026lt; \u0026#34;Failed to manage the mem size limit to \u0026#34; \u0026lt;\u0026lt; new_mem_limit \u0026lt;\u0026lt; \u0026#34; of device gpu_pci_bus_id: \u0026#34; \u0026lt;\u0026lt; gpu_pci_bus_id; // TODO(shiru): need to check is gpu_allocator_ has been changed!  return false; } return true; } return false; } Gpu Statistics ï¼ˆä¸­é—´ä»¶ï¼‰ åœ¨sessionè¿è¡Œç»“æŸåæ‰§è¡Œï¼Œæ‰§è¡Œé¡ºåºä¸º1ï¼Œ åˆ¤æ–­æ˜¯å¦éœ€è¦å¯¼å‡ºGPUç»Ÿè®¡æ•°æ®\nStatus GPUStatistics::RunAction(const SessionRunActionOptions\u0026amp; options) { if (!need_to_dump_statistics_) { return Status::OK(); } bool huge_change = RecordSessionRunDuration( options.graph_id, options.sess_duration_us); if (!ShouldCheckGPUStatistics() \u0026amp;\u0026amp; !huge_change) { return Status::OK(); } { // Global lock.  mutex_lock l(check_mu_); bool dur_flag = CheckSessionRunDuration(options.graph_id, options.sess_duration_us); bool stat_flag = CheckGPUVMemAllocatorStatistics(options.device_mgr, options.device_set); if (dur_flag || stat_flag) { dumpGPUStatistics(); } gpu_statistics_last_write_ = time(0); } return Status::OK(); } void GPUStatistics::dumpGPUStatistics() { Json::Value dump_json; Json::Value gpu_info_json; for (const auto\u0026amp; a : allocator_status_lists_) { Json::Value device_json; device_json[\u0026#34;deviceMemUsedMax\u0026#34;] = Json::Int64(a.deviceMemUsedMax); device_json[\u0026#34;deviceMemUsedMin\u0026#34;] = Json::Int64(a.deviceMemUsedMin); device_json[\u0026#34;deviceMemPoolSize\u0026#34;] = Json::Int64(a.deviceMemPoolSize); device_json[\u0026#34;deviceMemStable\u0026#34;] = Json::Int64(a.deviceMemStable); device_json[\u0026#34;hostMemUsedMax\u0026#34;] = Json::Int64(a.hostMemUsedMax); device_json[\u0026#34;hostMemUsedMin\u0026#34;] = Json::Int64(a.hostMemUsedMin); device_json[\u0026#34;hostMemPoolSize\u0026#34;] = Json::Int64(a.hostMemPoolSize); device_json[\u0026#34;swapReason\u0026#34;] = a.swapReason; device_json[\u0026#34;deviceMemUsedNvidia\u0026#34;] = Json::Int64(-1); gpu_info_json[a.gpu_pci_bus_id] = device_json; } dump_json[\u0026#34;gpuUsageInfo\u0026#34;] = gpu_info_json; Json::Value sess_json; uint64 max_duration = 0; for (const auto\u0026amp; s : sess_run_durations_) { uint64 du = s.second.duration_; time_t rec = s.second.recording_time_; sess_json[\u0026#34;graph_\u0026#34; + std::to_string(s.first)] = Json::UInt64(du); if (du \u0026gt; max_duration \u0026amp;\u0026amp; time(0) - rec \u0026lt; max_record_interval) { max_duration = du; } } dump_json[\u0026#34;miniBatchDuration\u0026#34;] = Json::UInt64(max_duration); dump_json[\u0026#34;Durations\u0026#34;] = sess_json; Json::StreamWriterBuilder stream_writer; std::unique_ptr\u0026lt;Json::StreamWriter\u0026gt; writer(stream_writer.newStreamWriter()); std::ofstream statistics_file; statistics_file.open(gpu_statistics_file_); writer-\u0026gt;write(dump_json, \u0026amp;statistics_file); statistics_file.close(); // LOG(INFO) \u0026lt;\u0026lt; \u0026#34;gpu_statistics_file updated.\u0026#34;; } æ³¨å†Œä¸­é—´ä»¶\n#if GOOGLE_CUDA // We register the GPUStatistics as a POST_SESSION_RUN action // during the initialization phase of the program. REGISTER_SESSION_RUN_ACTION(SessionRunActionRegistry::POST_SESSION_RUN, 1, GPUStatistics); #endif // GOOGLE_CUDA GpuOpManager  GpuOpManager continuously profiles the GPU operators execution time and simply distributes idle time slots before launching the GPU operators.\n åœ¨GPUResourceManagement.cc ä¸­å®ç°äº†set()å’Œget() å¯¹åº”executorè¦æ‰§è¡ŒOPæ•°çš„æ¥å£ï¼Œ\nåœ¨Executorä¸­ä»¥ä¸€ä¸ªçº¿ç¨‹çš„å½¢å¼è¿è¡Œï¼Œ åœ¨ExecutorState::ExecutorStateä¸­æ–°å¢äº†ä¸€ä¸ªthreadæˆå‘˜å˜é‡\nä¿®æ”¹Executor.cc\næ„é€ å‡½æ•°é‡Œï¼Œåˆå§‹åŒ–gpu_op_manger_thread // è·å–GPUResourceManagement  GPUResourceManagement* rm = GetGPUResourceManagement(); if (rm != nullptr) { enable_op_management = (rm-\u0026gt;GetEstimatedIdleTime() \u0026gt; 0); } if (enable_op_management \u0026amp;\u0026amp; gpu_op_manager_thread_ == nullptr) { gpu_op_manager_thread_ = new std::thread(\u0026amp;ExecutorState::AsyncGPUOpManager, this); } managerè´Ÿè´£æ’å…¥æ—¶é—´æ§½ï¼Œ ä¹Ÿå°±æ˜¯è®¡ç®—å¥½sleepçš„æ—¶é—´ï¼Œ é‡Šæ”¾èµ„æº\n// The manager thread which is in charge of inserting the time slot // before launching each queued async GPU op. void ExecutorState::AsyncGPUOpManager() { uint64 sleep_time_us = 0; need_to_insert_idle_time_ = false; GPUResourceManagement* rm = GetGPUResourceManagement(); if (rm == nullptr) { return; } while (!terminate_op_magager_thread_) { need_to_insert_idle_time_ = rm-\u0026gt;GetEstimatedIdleTime() \u0026gt; 0 ? true : false; std::function\u0026lt;void(void)\u0026gt; queued_call_func = nullptr; // 1ï¼‰ä»é˜Ÿåˆ—ä¸­è·å–ç¬¬ä¸€ä¸ªè¦æ‰§è¡Œçš„Op  async_gpu_op_queue_lock_.lock(); if (!async_gpu_op_queue.empty()) { queued_call_func = async_gpu_op_queue.front(); } async_gpu_op_queue_lock_.unlock(); if (queued_call_func != nullptr) { //2ï¼‰è°ƒç”¨è¿™ä¸ªOp  queued_call_func(); async_gpu_op_queue_lock_.lock(); //3ï¼‰ä»é˜Ÿåˆ—ä¸­åˆ é™¤è¿™ä¸ªop  if (!async_gpu_op_queue.empty()) { async_gpu_op_queue.erase(async_gpu_op_queue.begin()); // æ•°ç›®å‡ä¸€  num_queued_op.fetch_sub(1); } async_gpu_op_queue_lock_.unlock(); // Estimate idle time é¢„æµ‹ç©ºé—²æ—¶é—´  uint64 idle_time = rm-\u0026gt;GetEstimatedIdleTime(); uint64 queued_op_num = rm-\u0026gt;GetExecutorQueuedOpNum(impl_); idle_time = queued_op_num \u0026gt; 0 ? (idle_time / queued_op_num) : 0; // ç­‰å¾…ä¸€ä¸ªopçš„ idle_time  usleep(idle_time); // è®¾ç½®å‰©ä½™æ—¶é—´  uint64 remain_time = rm-\u0026gt;GetEstimatedIdleTime(); remain_time = remain_time \u0026gt; idle_time ? (remain_time - idle_time) : 0; rm-\u0026gt;SetEstimatedIdleTime(remain_time); } usleep(default_check_interval); } return; } Process å¤„ç†è¿‡ç¨‹ // Process():  ... Device* kernel_device = impl_-\u0026gt;params_.device; // Only enqueue this op if it is an async GPU op. \t// 1 å¦‚æœæ˜¯ä¸€ä¸ªå¼‚æ­¥Opï¼Œ åˆ™åŠ å…¥åˆ°å¼‚æ­¥OPé˜Ÿåˆ—  if (need_to_insert_idle_time_ \u0026amp;\u0026amp; (kernel_device-\u0026gt;name()).find(\u0026#34;GPU\u0026#34;) != string::npos) { // Enqueue this GPU op therefore we can insert a time slot before launching this op.  // åœ¨å¯åŠ¨è¿™ä¸ªopä¹‹å‰æˆ‘ä»¬å¯ä»¥æ’å…¥ä¸€ä¸ªæ—¶é—´æ§½  sess_op_num++; const GraphView\u0026amp; gview_t = impl_-\u0026gt;gview_; const NodeItem\u0026amp; item_t = *gview_t.node(id); AsyncState* state = new AsyncState(params, tagged_node, \u0026amp;item_t, first_input, stats); auto async_gpu_kernel = [this, state, id, stats, op_kernel, device] { AsyncOpKernel* async = state-\u0026gt;item-\u0026gt;kernel-\u0026gt;AsAsync(); DCHECK(async != nullptr); auto done = [this, state]() { Device* device = impl_-\u0026gt;params_.device; NodeExecStatsInterface* stats = state-\u0026gt;stats; // Shorthand  Entry* first_input = state-\u0026gt;first_input; // Shorthand  nodestats::SetOpEnd(stats); EntryVector outputs; Status s = ProcessOutputs(*state-\u0026gt;item, \u0026amp;state-\u0026gt;ctx, \u0026amp;outputs, stats); nodestats::SetMemory(stats, \u0026amp;state-\u0026gt;ctx); if (vlog_) { VLOG(2) \u0026lt;\u0026lt; \u0026#34;Async kernel done: \u0026#34; \u0026lt;\u0026lt; state-\u0026gt;item-\u0026gt;node-\u0026gt;id() \u0026lt;\u0026lt; \u0026#34; step \u0026#34; \u0026lt;\u0026lt; step_id_ \u0026lt;\u0026lt; \u0026#34; \u0026#34; \u0026lt;\u0026lt; SummarizeNode(*state-\u0026gt;item-\u0026gt;node) \u0026lt;\u0026lt; (state-\u0026gt;tagged_node.is_dead ? \u0026#34; is dead\u0026#34; : \u0026#34;\u0026#34;) \u0026lt;\u0026lt; \u0026#34; device: \u0026#34; \u0026lt;\u0026lt; device-\u0026gt;name(); } // Clears inputs.  const int num_inputs = state-\u0026gt;item-\u0026gt;num_inputs; for (int i = 0; i \u0026lt; num_inputs; ++i) { (first_input + i)-\u0026gt;ClearVal(); } FrameState* input_frame = state-\u0026gt;tagged_node.input_frame; const int64 input_iter = state-\u0026gt;tagged_node.input_iter; const int id = state-\u0026gt;tagged_node.node-\u0026gt;id(); MaybeMarkCompleted(input_frame, input_iter, id); TaggedNodeSeq ready; if (s.ok()) { PropagateOutputs(state-\u0026gt;tagged_node, state-\u0026gt;item, \u0026amp;outputs, \u0026amp;ready); } outputs.clear(); if (s.ok() \u0026amp;\u0026amp; impl_-\u0026gt;device_record_tensor_accesses_) { // Get the list of all tensors accessed during the execution  TensorReferenceVector accessed; state-\u0026gt;ctx.retrieve_accessed_tensors(\u0026amp;accessed); nodestats::SetReferencedTensors(stats, accessed); // callee takes ownership of the vector  device-\u0026gt;ConsumeListOfAccessedTensors(state-\u0026gt;ctx.op_device_context(), accessed); } const bool completed = NodeDone(s, state-\u0026gt;item-\u0026gt;node, ready, stats, nullptr); delete state; if (completed) ScheduleFinish(); }; nodestats::SetOpStart(stats); { profiler::TraceMe activity( [\u0026amp;] { return strings::StrCat( op_kernel-\u0026gt;name(), \u0026#34;:\u0026#34;, op_kernel-\u0026gt;type_string(), \u0026#34;#id=\u0026#34;, step_container_ ? step_container_-\u0026gt;step_id() : 0, \u0026#34;,device=\u0026#34;, device-\u0026gt;name(), \u0026#34;,async=true#\u0026#34;); }, profiler::GetTFTraceMeLevel(op_kernel-\u0026gt;IsExpensive())); device-\u0026gt;ComputeAsync(async, \u0026amp;state-\u0026gt;ctx, done); } }; // Enqueue this asyn GPU op.  async_gpu_op_queue_lock_.lock(); async_gpu_op_queue.emplace_back(async_gpu_kernel); //æ·»åŠ kernelåˆ°opé˜Ÿåˆ—  num_queued_op.fetch_add(1); //åŠ ä¸€  async_gpu_op_queue_lock_.unlock(); } else { //2 å¦‚æœä¸æ˜¯å¼‚æ­¥çš„OP åˆ™ä¸åŠ å…¥  // Do not enqueue this op.  AsyncOpKernel* async = item.kernel-\u0026gt;AsAsync(); DCHECK(async != nullptr); AsyncState* state = new AsyncState(params, tagged_node, \u0026amp;item, first_input, stats); auto done = [this, state]() { Device* device = impl_-\u0026gt;params_.device; NodeExecStatsInterface* stats = state-\u0026gt;stats; // Shorthand  Entry* first_input = state-\u0026gt;first_input; // Shorthand  nodestats::SetOpEnd(stats); EntryVector outputs; Status s = ProcessOutputs(*state-\u0026gt;item, \u0026amp;state-\u0026gt;ctx, \u0026amp;outputs, stats); nodestats::SetMemory(stats, \u0026amp;state-\u0026gt;ctx); if (vlog_) { VLOG(2) \u0026lt;\u0026lt; \u0026#34;Async kernel done: \u0026#34; \u0026lt;\u0026lt; state-\u0026gt;item-\u0026gt;node-\u0026gt;id() \u0026lt;\u0026lt; \u0026#34; step \u0026#34; \u0026lt;\u0026lt; step_id_ \u0026lt;\u0026lt; \u0026#34; \u0026#34; \u0026lt;\u0026lt; SummarizeNode(*state-\u0026gt;item-\u0026gt;node) \u0026lt;\u0026lt; (state-\u0026gt;tagged_node.is_dead ? \u0026#34; is dead\u0026#34; : \u0026#34;\u0026#34;) \u0026lt;\u0026lt; \u0026#34; device: \u0026#34; \u0026lt;\u0026lt; device-\u0026gt;name(); } // Clears inputs.  const int num_inputs = state-\u0026gt;item-\u0026gt;num_inputs; for (int i = 0; i \u0026lt; num_inputs; ++i) { (first_input + i)-\u0026gt;ClearVal(); } FrameState* input_frame = state-\u0026gt;tagged_node.input_frame; const int64 input_iter = state-\u0026gt;tagged_node.input_iter; const int id = state-\u0026gt;tagged_node.node-\u0026gt;id(); MaybeMarkCompleted(input_frame, input_iter, id); TaggedNodeSeq ready; if (s.ok()) { PropagateOutputs(state-\u0026gt;tagged_node, state-\u0026gt;item, \u0026amp;outputs, \u0026amp;ready); } outputs.clear(); if (s.ok() \u0026amp;\u0026amp; impl_-\u0026gt;device_record_tensor_accesses_) { // Get the list of all tensors accessed during the execution  TensorReferenceVector accessed; state-\u0026gt;ctx.retrieve_accessed_tensors(\u0026amp;accessed); nodestats::SetReferencedTensors(stats, accessed); // callee takes ownership of the vector  device-\u0026gt;ConsumeListOfAccessedTensors(state-\u0026gt;ctx.op_device_context(), accessed); } const bool completed = NodeDone(s, state-\u0026gt;item-\u0026gt;node, ready, stats, nullptr); delete state; if (completed) ScheduleFinish(); }; nodestats::SetOpStart(stats); { profiler::TraceMe activity( [\u0026amp;] { return strings::StrCat( op_kernel-\u0026gt;name(), \u0026#34;:\u0026#34;, op_kernel-\u0026gt;type_string(), \u0026#34;#id=\u0026#34;, step_container_ ? step_container_-\u0026gt;step_id() : 0, \u0026#34;,device=\u0026#34;, device-\u0026gt;name(), \u0026#34;,async=true#\u0026#34;); }, profiler::GetTFTraceMeLevel(op_kernel-\u0026gt;IsExpensive())); device-\u0026gt;ComputeAsync(async, \u0026amp;state-\u0026gt;ctx, done); } } ç»“æŸå‡½æ•° // Finish():  if (gpu_op_manager_thread_ != nullptr) { terminate_op_magager_thread_ = true; if (gpu_op_manager_thread_-\u0026gt;joinable()) { gpu_op_manager_thread_-\u0026gt;join(); } delete gpu_op_manager_thread_; terminate_op_magager_thread_ = false; } æ€»ç»“ graph TD Agpu_resource_manage_file] B[SessionRunRegistry] C[SessionRunAction] D[Executor] E[GPUResouceManagement] F[GPU Statistic] G[GpuOpManager] H[GpuUsageAdjustment] I(dump gpu statistic) J[GPU Process State] K[GPUVMemAllocator] L[GPUAdjustableAllocator] A --|FileListener| E B --|Register| E E --|need_to_adjust_memory_| H H --|new| L H --|get| K C --|Derive| E C --|Derive| F B --|Register| F F --|need_to_dump_statistics_| I B --|Run| C J --|maybe_create_gpu_vmem_allocator|K D --|run thread| G E --|GetEstimatedIdleTime| G  ","date":"2022-12-04T23:08:20+08:00","permalink":"https://tweakzx.github.io/p/%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90antman%E5%AF%B9tensorflow%E7%9A%84%E4%BF%AE%E6%94%B9/","title":"ã€ä»£ç åˆ†æã€‘Antmanå¯¹Tensorflowçš„ä¿®æ”¹"},{"content":"EasyScale è®ºæ–‡é˜…è¯»ç¬”è®° Abstract  åˆ†å¸ƒå¼åŒæ­¥GPUè®­ç»ƒé€šå¸¸è¢«ç”¨äºæ·±åº¦å­¦ä¹ ã€‚  ä½¿ç”¨å›ºå®šGPUçš„èµ„æºçº¦æŸ  ä½¿å¾—å¤§è§„æ¨¡çš„æ·±åº¦å­¦ä¹ è®­ç»ƒå·¥ä½œå—åˆ°å½±å“ é™ä½äº†é›†ç¾¤çš„åˆ©ç”¨ç‡   çº³å…¥èµ„æºå¼¹æ€§  å¾€å¾€ä¼šå¼•å…¥æ¨¡å‹ç²¾åº¦çš„éç¡®å®šæ€§\u0026lt;\u0026mdash;\u0026ndash;ç¼ºä¹éš”ç¦»èƒ½åŠ›     æœ¬æ–‡ä»‹ç»EasyScaleï¼Œ  è¿™æ˜¯ä¸€ä¸ªå¼¹æ€§æ¡†æ¶  å¯ä»¥åœ¨å¼‚æ„GPUä¸Šæ‰©å±•åˆ†å¸ƒå¼è®­ç»ƒ åŒæ—¶äº§ç”Ÿç¡®å®šæ€§çš„æ·±åº¦å­¦ä¹ æ¨¡å‹   å®ç°äº†å¼¹æ€§çš„ç²¾åº¦ä¸€è‡´çš„æ¨¡å‹è®­ç»ƒã€‚  EasyScaleä¸¥æ ¼éµå¾ªæ•°æ®å¹¶è¡Œè®­ç»ƒæµç¨‹ ä»”ç»†è¿½è¸ªä¸ç²¾åº¦ç›¸å…³çš„å› ç´  æœ‰æ•ˆåˆ©ç”¨æ·±åº¦å­¦ä¹ ç‰¹æ€§è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢   ä¸ºäº†ä½¿å¼‚æ„GPUçš„è®¡ç®—èƒ½åŠ›è¾¾åˆ°é¥±å’Œ  EasyScaleæ ¹æ®æˆ‘ä»¬çš„ä½œä¸šå†…å’Œä½œä¸šé—´è°ƒåº¦ç­–ç•¥åŠ¨æ€åœ°åˆ†é…å·¥äºº æœ€å¤§é™åº¦åœ°å‡å°‘GPUçš„ç©ºé—²æ—¶é—´ å¹¶ç›¸åº”åœ°æé«˜ç»¼åˆä½œä¸šçš„ååé‡ã€‚   å®éªŒ  éƒ¨ç½²åœ¨CompanyAçš„ä¸€ä¸ªåœ¨çº¿æœåŠ¡é›†ç¾¤ä¸­ EasyScaleä¸ºå¼¹æ€§æ·±åº¦å­¦ä¹ è®­ç»ƒä½œä¸šæä¾›åŠ¨åŠ›ï¼Œä½¿å…¶é€‚æ—¶åœ°åˆ©ç”¨ç©ºé—²çš„GPU åœ¨ä¸è¿åSLAçš„æƒ…å†µä¸‹å°†é›†ç¾¤çš„æ•´ä½“åˆ©ç”¨ç‡æé«˜äº†62.1%      Introduction   å¼¹æ€§æ·±åº¦å­¦ä¹ æ¡†æ¶å¾ˆå°‘åœ¨è¡Œä¸šä¸­ä½¿ç”¨\n æ ¹æœ¬éšœç¢ï¼šåœ¨ä½¿ç”¨ä¸åŒèµ„æºè¿›è¡Œè®­ç»ƒæ—¶æ¨¡å‹å‡†ç¡®æ€§ä¸ä¸€è‡´ èµ„æºå¼¹æ€§å¯¹è®­ç»ƒç¨‹åºå’Œæ¨¡å‹æ”¶æ•›éƒ½å¼•å…¥äº†éç¡®å®šæ€§ã€‚  é€šè¿‡è°ƒæ•´ç‰¹å®šåŸºå‡†ä¸­çš„è¶…å‚æ•°ï¼ˆå¦‚å­¦ä¹ ç‡æˆ–æ‰¹é‡å¤§å°ï¼‰æ”¶æ•›åˆ°ç±»ä¼¼çš„ç²¾åº¦ä¸èƒ½è¯´æœç”¨æˆ·ï¼Œå› ä¸ºé¢„æœŸçš„è®¡ç®—æµç¨‹å·²ç»éšæ€§æ”¹å˜ã€‚ åœ¨æ”¹å˜æ•°æ®é›†æˆ–æ¨¡å‹ç»“æ„æ—¶ï¼Œå¯¹æ¨¡å‹å‡†ç¡®æ€§çš„éç¡®å®šæ€§çš„æ‹…å¿§ä»ç„¶æ²¡æœ‰å¾—åˆ°è§£å†³ï¼Œè¿™ä½¿å¾—æ·±åº¦å­¦ä¹ ä»ä¸šè€…åœ¨æ‹¥æŠ±èµ„æºå¼¹æ€§æ—¶çŠ¹è±«ä¸å†³      EasyScaleï¼š\n ç¬¬ä¸€ä¸ªåœ¨åŒæ„å’Œå¼‚æ„ GPU çš„èµ„æºå¼¹æ€§ä¸Šå®ç°ä¸€è‡´æ¨¡å‹ç²¾åº¦çš„è®­ç»ƒæ¡†æ¶  æé«˜äº†æ•´ä½“é›†ç¾¤æ•ˆç‡\u0026lt;\u0026mdash;-é€šè¿‡å°½æœ€å¤§åŠªåŠ›åˆ©ç”¨ç©ºé—² GPU æ¥è¿›è¡Œå¼¹æ€§æ¨¡å‹è®­ç»ƒ   å°†æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒè§†ä¸ºç§‘å­¦å®éªŒï¼Œå°†ç¡®å®šæ€§å’Œå¯é‡å¤æ€§ä½œä¸ºç¬¬ä¸€æµçš„ç›®æ ‡ EasyScaleæ¢è®¨äº†å°†åˆ†å¸ƒå¼æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸ç¡¬ä»¶èµ„æºè§£è€¦çš„å¯èƒ½æ€§  æ— è®ºåˆ†é…çš„GPUæ•°é‡å’Œç±»å‹å¦‚ä½•ï¼Œéƒ½èƒ½äº§ç”Ÿä½æ•°ä¸€è‡´çš„æ¨¡å‹ è¿™æ˜¯é€šè¿‡ä¸€ä¸ªåä¸ºEasyScaleThreadçš„æŠ½è±¡æ¥å®ç°çš„  å®ƒå°è£…äº†ä»æ•°æ®åŠ è½½ã€é‡‡æ ·ã€è®¡ç®—åˆ°é€šä¿¡çš„æ‰€æœ‰é˜¶æ®µ å¹¶ä½¿å®ƒä»¬ä¸åœ¨å›ºå®šçš„GPUä¸­æ‰§è¡Œçš„å®Œå…¨ä¸€æ ·   EasyScaleåˆ©ç”¨æ·±åº¦å­¦ä¹ çš„ç‰¹ç‚¹  å®ç°äº†å¿«é€Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ è§£å†³äº†è®­ç»ƒå·¥ä½œè€…çŠ¶æ€çš„æ½œåœ¨éç¡®å®šæ€§ å¹¶åœ¨èµ„æºé‡æ–°é…ç½®æ—¶æœ‰æ•ˆåœ°æ‰§è¡Œè¿½è¸ªå’Œæ£€æŸ¥ç‚¹   EasyScaleå¼•å…¥äº†ä¸€ä¸ªå·¥ä½œå†…ç­–ç•¥\u0026mdash;-\u0026gt;ä»¥è´Ÿè½½å¹³è¡¡çš„æ–¹å¼åœ¨å¼‚æ„GPUä¸Šå®‰æ’è®­ç»ƒå·¥äºº è¿›ä¸€æ­¥ä¼˜åŒ–äº†å·¥ä½œé—´çš„èµ„æºåˆ†é…\u0026mdash;-\u0026gt;ä»¥æœ€å¤§é™åº¦åœ°æé«˜æ€»çš„ååé‡ã€‚      è´¡çŒ®å¦‚ä¸‹\n æˆ‘ä»¬è°ƒæŸ¥äº†ç°æœ‰çš„å¼¹æ€§æ·±åº¦å­¦ä¹ æ¡†æ¶å’Œå¼‚æ„ç¯å¢ƒä¸­çš„éç¡®å®šæ€§è¡Œä¸ºï¼Œå¹¶å¯¹æ•£å¸ƒåœ¨æ•´ä¸ªDLTè½¯ä»¶å †æ ˆä¸­çš„ä½æ•°å·®å¼‚è¿›è¡Œäº†æº¯æºã€‚ æˆ‘ä»¬ä»‹ç»ç”¨äºå¼¹æ€§åˆ†å¸ƒå¼æ¨¡å‹è®­ç»ƒçš„EasyScaleï¼Œå®ƒä»¥ç¡®å®šæ€§çš„æ–¹å¼å®ç°äº†ä¸€è‡´çš„å‡†ç¡®æ€§ã€‚EasyScaleåˆ©ç”¨EasyScaleThreadæ¥ä¿æŒä¸PyTorch DDPç›¸åŒçš„å¼¹æ€§è®­ç»ƒè¡Œä¸ºï¼Œå¹¶ä»¥å¯å¿½ç•¥ä¸è®¡çš„å¼€é”€æœ‰æ•ˆåœ°è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ æˆ‘ä»¬å¼•å…¥äº†æ–°çš„ä½œä¸šå†…å’Œä½œä¸šé—´è°ƒåº¦ç­–ç•¥ï¼Œä»¥æé«˜å•ä¸ªEasyScaleä½œä¸šçš„ååé‡å’Œèšåˆé›†ç¾¤çš„ååé‡ï¼Œä»è€Œçµæ´»æœ‰æ•ˆåœ°åˆ©ç”¨å¼‚æ„çš„GPUã€‚ æˆ‘ä»¬åœ¨ç”Ÿäº§é›†ç¾¤ä¸­å…¨é¢éƒ¨ç½²äº†EasyScaleï¼Œå°†å¼¹æ€§è®­ç»ƒä½œä¸šä¸åœ¨çº¿æ¨¡å‹æœåŠ¡æ”¾åœ¨ä¸€èµ·ï¼Œåœ¨æ»¡è¶³æ¨¡å‹æœåŠ¡SLAçš„çº¦æŸä¸‹ï¼Œæ˜¾è‘—æé«˜äº†é›†ç¾¤åˆ©ç”¨ç‡ã€‚    Motivation å¼¹æ€§è®­ç»ƒå¸¦æ¥çš„ä¸ç¡®å®šæ€§   ä¸ä¸€è‡´çš„æ¨¡å‹ç²¾åº¦\n  \rimage-20221110093121968\r\n  ç”¨å¼¹æ€§æ¡†æ¶è¿›è¡Œæ¨¡å‹è®­ç»ƒçš„å¤šæ¬¡è¿è¡Œï¼Œæœªèƒ½åœ¨ä½¿ç”¨ä¸åŒæ•°é‡çš„èµ„æºæ—¶äº§ç”Ÿä¸€è‡´çš„æ¨¡å‹ç²¾åº¦ã€‚\n  å›¾2è¯´æ˜äº†ResNet18åœ¨CIFAR10ä¸Šçš„éªŒè¯ç²¾åº¦  å®éªŒæ¡ä»¶  è¿™æ˜¯ä¸€ä¸ªç”¨ä¸åŒæ•°é‡çš„V100 GPUè®­ç»ƒçš„å¼¹æ€§æ¨¡å‹ è¶…å‚æ•°å’Œéšæœºç§å­ä¸é»˜è®¤å€¼ç›¸åŒï¼Œåªä½¿ç”¨ä¸åŒåˆ†é…çš„GPU TorchElasticï¼ˆTEï¼‰è¢«é…ç½®ä¸ºè°ƒæ•´å­¦ä¹ ç‡çš„çº¿æ€§ç¼©æ”¾è§„åˆ™ Polluxå¯ä»¥è‡ªåŠ¨å†³å®šç›¸åº”çš„å­¦ä¹ ç‡å’Œæ‰¹æ¬¡å¤§å°   å®éªŒç»“è®º  ä¸å›ºå®šGPUä¸Šçš„åˆ†å¸ƒå¼æ¨¡å‹è®­ç»ƒç›¸æ¯”ï¼Œèµ„æºå¼¹æ€§å¸¦æ¥äº†ä¸åŒçš„è®­ç»ƒè¡Œä¸ºã€‚ Polluxåœ¨äº§ç”Ÿæ¨¡å‹è´¨é‡æ–¹é¢å¼•å…¥äº†ç›¸å¯¹è¾ƒå°çš„å·®å¼‚ï¼Œç„¶è€Œï¼Œè¿™ç§å·®å¼‚ä»ç„¶æ˜¯ä¸å¯å¿½è§†çš„     å›¾3ä¸­æŠ¥å‘Šäº†æ€»ä½“å’Œæ¯ç±»çš„ç»§ç»­è®­ç»ƒåˆ°100ä¸ªepochå‡†ç¡®ç‡  ç»“æœ  æ€»ä½“å‡†ç¡®ç‡çš„å·®å¼‚ä»ç„¶å¾ˆæ˜æ˜¾ï¼šTorchElasticå’ŒPolluxåˆ†åˆ«ä¸º0.6%å’Œ2.8%ã€‚ æ¯ç±»å‡†ç¡®ç‡çš„å·®å¼‚ç”šè‡³æ›´å¤§ï¼šè¾¾åˆ°7.4%å’Œ17.3%   ç»“è®º  è¿™è¡¨æ˜å¼¹æ€§è®­ç»ƒçš„æ¨¡å‹ä¸ä½¿ç”¨å›ºå®šGPUçš„æ¨¡å‹ç›¸æ¯”ï¼Œåå·®ä¸åŒã€‚ å…¶ä»–æŒ‡æ ‡ä»æœªæŠ«éœ²ï¼Œæ¨¡å‹è´¨é‡å·®è·çš„ä¸Šé™ä»ç„¶æœªçŸ¥           å¾ˆéš¾ç†è§£è¶…å‚å¸¦æ¥çš„å½±å“\n  \rimage-20221110093137841\r\n  ç ”ç©¶äººå‘˜å¾ˆéš¾æ¨ç†å‡ºgammaå¦‚ä½•å½±å“è®­ç»ƒæŸå¤±æ›²çº¿\n  å›¾4æ˜¾ç¤ºäº†ResNet50åœ¨CIFAR10ä¸Šçš„å®éªŒ  å®éªŒè®¾ç½®  æ¯”è¾ƒå¯¹è±¡  å›ºå®š4ä¸ªGPUä¸Šçš„DDPè®­ç»ƒ 1/2/4ä¸ªGPUä¸Šçš„ä½¿ç”¨Polluxçš„å¼¹æ€§æ¨¡å‹è®­ç»ƒ   é™¤äº†å­¦ä¹ ç‡è°ƒåº¦å™¨çš„ä¸€ä¸ªè¶…å‚æ•°gammaå¤–ï¼Œå…¶ä»–é…ç½®éƒ½æ˜¯ä¸€è‡´çš„  gammaå†³å®šäº†æœ¬å®éªŒä¸­20ä¸ªepochsåçš„å­¦ä¹ ç‡é™ä½æ¯”ä¾‹ DDPå®éªŒä»¥ç›¸åŒçš„è®¾ç½®è¿è¡Œäº†ä¸‰æ¬¡4-GPUè®­ç»ƒï¼Œä½†gammaå€¼åˆ†åˆ«ä¸º0.1ã€0.3å’Œ0.5 Polluxä¹Ÿè¿è¡ŒåŒæ ·çš„å®éªŒï¼Œ1ä¸ªGPUçš„gammaä¸º0.1ï¼Œ2ä¸ªGPUçš„gammaä¸º0.3ï¼Œè€Œ4ä¸ªGPUçš„gammaä¸º0.5     å®éªŒç»“è®º  ä½¿ç”¨DDPï¼Œå¯ä»¥æ¸…æ¥šåœ°æ¨æ–­å‡ºè¶…å‚æ•°gammaæ˜¯å¦‚ä½•å½±å“æ¨¡å‹è®­ç»ƒè¿‡ç¨‹çš„ã€‚  è®­ç»ƒæŸå¤±åœ¨å‰20ä¸ª epochsçš„ä¸‰æ¬¡è¿è¡Œä¸­ä¿æŒä¸€è‡´ ä¹‹åï¼Œè¾ƒå°çš„gammaå¯¼è‡´è¾ƒå°çš„è®­ç»ƒæŸå¤±   ä½¿ç”¨Polluxï¼Œç ”ç©¶äººå‘˜å¾ˆéš¾æ¨ç†å‡ºgammaå¦‚ä½•å½±å“è®­ç»ƒæŸå¤±æ›²çº¿ã€‚           æ€»ç»“\n DL æ¨¡å‹ç°åœ¨æ˜¯ç®—æ³•ï¼Œæ¡†æ¶å’Œè®¡ç®—èµ„æºç»„åˆçš„ç»“æœï¼Œè¿™æ˜¯é™åˆ¶ DLT ä½œä¸šä½¿ç”¨å¼¹æ€§èµ„æºçš„æ ¹æœ¬åŸå›  ç°æœ‰çš„å¼¹æ€§ DL æ¡†æ¶ç¼ºä¹å°†èµ„æºä¸æ¨¡å‹è¶…å‚æ•°è§£è€¦çš„èƒ½åŠ›\u0026mdash;-\u0026gt;æ— æ³•æä¾›ä¸å¼¹æ€§è®­ç»ƒä¸€è‡´çš„æ¨¡å‹ç²¾åº¦ æˆ‘ä»¬éœ€è¦æ”¯æŒå¼¹æ€§è®­ç»ƒï¼ŒåŒæ—¶ä¿æŒä¸€è‡´çš„æ¨¡å‹ç²¾åº¦    Design Overview   å¼¹æ€§è®­ç»ƒåº”è¯¥ç”Ÿæˆä¸ä½¿ç”¨å›ºå®šæ•°é‡çš„GPUè¿›è¡Œçš„DDPè®­ç»ƒç›¸åŒçš„æ¨¡å‹å‚æ•°\n  å®ç°å¼¹æ€§å‡†ç¡®åº¦ä¸€è‡´çš„æ¨¡å‹è®­ç»ƒçš„å…³é”®æŒ‘æˆ˜æ˜¯æ‰¾åˆ°ä¸€ç§å®ç”¨çš„æ–¹æ³•ï¼Œå°†ä¸€ä¸ªGPUæœ‰æ•ˆåœ°åˆ†äº«ç»™å¤šä¸ªworker\n  EasyScaleThread   EasyScaleThreadï¼š æ•æ‰æ·±åº¦å­¦ä¹ çš„è®­ç»ƒè¿‡ç¨‹å¹¶å°†å…¶ä¸ç¡¬ä»¶èµ„æºè§£è€¦\n æ¯ä¸ªGPUéƒ½ç”±ä¸€ä¸ªEasyScale PyTorch workerå¯åŠ¨ã€‚ åŸå§‹è®­ç»ƒworkerçš„æ‰§è¡Œè¢«è§†ä¸ºESTçš„æ‰§è¡Œï¼Œå®ƒå¯ä»¥åŠ¨æ€åœ°åˆ†é…ç»™PyTorch workerè¿›ç¨‹ã€‚ åœ¨ä¸€ä¸ªworkerä¸­ï¼Œå¤šä¸ªEasyScaleThreadsè½®æµå ç”¨GPUè¿›è¡Œè®¡ç®—ã€‚ ä½¿ç”¨  é€šè¿‡ä½¿ç”¨ç™½ç›’æ–¹æ³•ï¼ŒEasyScaleé€šè¿‡ç”¨æˆ·æ³¨é‡Šå°†æ¨¡å‹è®­ç»ƒçš„å…³é”®æ­¥éª¤æŒ‚é’©ï¼Œæ•°æ®åŠ è½½ã€åå‘ä¼ æ’­å’Œæ¨¡å‹æ›´æ–°ï¼Œå› æ­¤åœ¨mini-batchè¾¹ç•Œè¿›è¡Œç²¾åº¦ä¸€è‡´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ ç”¨æˆ·å®šä¹‰çš„æ¨¡å‹è®­ç»ƒè¯­ä¹‰ï¼ŒåŒ…æ‹¬æ¨¡å‹ç»“æ„ã€æ•°æ®å¢é‡ã€æ‰¹æ¬¡å¤§å°ã€ä¼˜åŒ–ç­‰ï¼Œéƒ½ç…§å¸¸ä¿ç•™ã€‚ è‡³äºç¼–ç¨‹ï¼Œç”¨æˆ·è€ƒè™‘æ€»çš„é€»è¾‘è®­ç»ƒå·¥ä½œè€…çš„æ•°é‡æ¥å†³å®šè¶…å‚æ•°ï¼ˆå¦‚å…¨å±€æ‰¹å¤„ç†é‡å’Œå­¦ä¹ ç‡ï¼‰ï¼Œè¿™ä¸ä»–ä»¬ä½¿ç”¨å›ºå®šGPUçš„ç»éªŒç›¸åŒï¼Œä½†è‡ªåŠ¨å—ç›ŠäºEasyScaleæä¾›çš„å¼¹æ€§ã€‚      æ‰§è¡Œ\n mini-batchçš„æ‰§è¡Œï¼š  è¾“å…¥æ•°æ®è¢«åˆ†å‰²åˆ°æ‰€æœ‰çš„EasyScaleThreadsä¸­ ä¸€ä¸ªGPUä¸Šæ¯æ¬¡æ‰§è¡Œä¸€ä¸ªESTæ—¶ï¼Œ å…¶ä»–ESTè¢«å†»ç»“ åœ¨æ‰€æœ‰EasyScaleThreadså®Œæˆåï¼Œmini-batchå°±å®Œæˆäº†   å½“ä¸¤ä¸ªEasyScaleThreadsåˆ‡æ¢æ—¶  EasyScaleThreadçš„è®­ç»ƒçŠ¶æ€éœ€è¦è¢«ä¿å­˜åˆ°GPUä¹‹å¤–ï¼Œå› æ­¤è¦ç¡®ä¿æœ‰è¶³å¤Ÿçš„GPUå†…å­˜ç»™ä¸‹ä¸€ä¸ªEasyScaleThreadï¼Œè¿™å¯èƒ½æ˜¯æ˜‚è´µçš„ã€‚ åœ¨GPUä¸Šä¸ºæ¯ä¸ªminibatchæœ‰æ•ˆåˆ‡æ¢EasyScaleThreadsçš„å…³é”®æ˜¯å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢æ‰€éœ€çš„çŠ¶æ€ã€‚ è€ŒEasyScaleé€‰æ‹©åœ¨å®Œæˆå‰å‘åå‘è®¡ç®—ååˆ‡æ¢EasyScaleThreadsï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘GPUCPUå†…å­˜æ‹·è´ã€‚   æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹æ–¹å¼æœ€å°åŒ–çŠ¶æ€çš„å¤§å°ï¼š  iï¼‰å®šä½å½±å“æœ€ç»ˆç²¾åº¦çš„éç¡®å®šæ€§æ¥æºï¼Œæœ€å°åŒ–éœ€è¦è®°å½•çš„å¿…è¦çŠ¶æ€ iiï¼‰åˆ©ç”¨DLçš„æ•°æ®å¹¶è¡Œè¡Œä¸ºï¼Œæœ€å°åŒ–æ•°æ®äº¤æ¢çš„å·¥ä½œé›†ã€‚   EasyScaleThreadçš„GPUå†…å­˜ä¸­çš„å·¥ä½œé›†  å¯ä»¥åˆ†ä¸ºæ—¶é—´å¼ é‡å’Œæ¿€æ´»ã€æ¨¡å‹å‚æ•°å’Œä¼˜åŒ–çŠ¶æ€ä»¥åŠæ¢¯åº¦ï¼Œ å¤„ç†  é¦–å…ˆï¼Œå¯¹äºæ—¶é—´å¼ é‡å’Œæ¿€æ´»ï¼Œå®ƒä»¬åœ¨å‰å‘æ­¥éª¤ä¸­åˆ›å»ºï¼Œåœ¨å®Œæˆæ¢¯åº¦ç”Ÿæˆååœ¨åå‘æ­¥éª¤ä¸­é”€æ¯ã€‚  å› æ­¤ï¼Œå®ƒä»¬ä¼šåœ¨å°æ‰¹å¤„ç†ç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾å‡ºæ¥ã€‚   å…¶æ¬¡ï¼Œå…³äºæ¨¡å‹å‚æ•°å’Œä¼˜åŒ–å™¨çŠ¶æ€ï¼Œæ¯ä¸ªæ•°æ®å¹¶è¡Œå·¥ä½œè€…åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­éƒ½ä¼šä¿ç•™ä¸€ä¸ªå‰¯æœ¬ï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªå°æ‰¹å¤„ç†ç»“æŸæ—¶è¿›è¡Œæ›´æ–°ã€‚  å› æ­¤ï¼Œåœ¨EasyScaleä¸­ï¼Œå½“åˆ‡æ¢EasyScaleThreadsæ—¶ï¼Œå®ƒä»¬å¯ä»¥è¢«é‡å¤ä½¿ç”¨ã€‚   æœ€åï¼Œæ¢¯åº¦æ˜¯æ ¹æ®EasyScaleThreadsçš„ä¸åŒæ•°æ®è¾“å…¥è®¡ç®—çš„ï¼Œå› æ­¤ä¸èƒ½é‡å¤ä½¿ç”¨ã€‚ç„¶è€Œï¼Œæ¢¯åº¦é€šå¸¸å¾ˆå°ï¼Œå¹¶ä¸”åªåœ¨minibatchç»“æŸæ—¶çš„åˆ†å¸ƒå¼æ¢¯åº¦åŒæ­¥ä¸­ä½¿ç”¨ã€‚  å› æ­¤ï¼Œåœ¨EasyScaleä¸­ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶å°†æ¢¯åº¦è¿ç§»åˆ°ä¸»æœºDRAMä¸­ï¼Œå¹¶ä¸ä¸‹ä¸€ä¸ªEasyScaleThreadçš„è®¡ç®—é‡å ã€‚       é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬äº¤æ›¿æ‰§è¡ŒEasyScaleThreadsï¼Œç›´åˆ°æ‰€æœ‰è®¡ç®—å®Œæˆã€‚ä¹‹åï¼Œåˆ†å¸ƒå¼åŒæ­¥è¢«è§¦å‘ï¼Œæ¨¡å‹æ›´æ–°è¢«è¿›è¡Œä¸€æ¬¡ä»¥å®Œæˆå°æ‰¹é‡çš„è®¡ç®—ã€‚    é‡é…ç½®\n å½“èµ„æºé‡æ–°é…ç½®è¢«è§¦å‘æ—¶ï¼ŒEasyScaleé‡‡ç”¨æŒ‰éœ€æ£€æŸ¥ç‚¹çš„æ–¹å¼æ¥æŒç»­ä¿æŒæœ€å°å’Œå¿…è¦çš„çŠ¶æ€ã€‚ æ£€æŸ¥ç‚¹åŒ…å«äº†  æ‰€æœ‰EasyScaleThreadsçš„ä¸Šä¸‹æ–‡ é¢å¤–çš„çŠ¶æ€ï¼ˆåŒ…æ‹¬è®­ç»ƒè¿›åº¦å’Œå…¶ä»–å®ç°ç²¾åº¦ä¸€è‡´æ€§çš„çŠ¶æ€ï¼‰ æ·±åº¦å­¦ä¹ å‚æ•°ï¼ˆä¾‹å¦‚ï¼Œæ¨¡å‹ã€ä¼˜åŒ–å™¨å’Œå­¦ä¹ ç‡è°ƒåº¦å™¨ï¼‰   ä¸EasyScaleThreadä¸Šä¸‹æ–‡ä¸åŒçš„æ˜¯  é¢å¤–çš„çŠ¶æ€å’Œå‚æ•°åªéœ€è¦ä¸€ä¸ªå‰¯æœ¬ï¼Œå› ä¸ºå®ƒä»¬åœ¨mini-batchç»“æŸæ—¶å¯¹æ‰€æœ‰EasyScaleThreadéƒ½æ˜¯ä¸€æ ·çš„ã€‚   è¯·æ³¨æ„ï¼Œåœ¨é‡æ–°å¯åŠ¨æ¨¡å‹è®­ç»ƒåï¼Œæ¯ä¸ªGPUçš„EasyScaleè¿è¡Œæ—¶  ä¼šåŠ è½½é¢å¤–çš„çŠ¶æ€å’Œæ¨¡å‹å‚æ•°çš„å‰¯æœ¬ ä»¥åŠé‡æ–°åˆ†å¸ƒçš„EasyScaleThreadsçš„ç›¸åº”ä¸Šä¸‹æ–‡      ä¼˜åŒ–\n  ä¸ºäº†overlapæ•°æ®åŠ è½½å’ŒGPUè®­ç»ƒ\n data loaderåœ¨ç‹¬ç«‹çš„å¤„ç†å™¨ä¸­æ‰§è¡Œï¼ˆå³PyTorchä¸­çš„åŠ è½½å™¨å·¥ä½œè€…è¿›ç¨‹ï¼‰ï¼Œå¼‚æ­¥åŠ è½½è®­ç»ƒæ ·æœ¬å¹¶æ‰§è¡Œæ•°æ®å¢å¼ºï¼ˆä¾‹å¦‚ï¼Œè£å‰ªæˆ–æ—‹è½¬å›¾åƒï¼‰ä»¥å»ºç«‹è®­ç»ƒæ‰¹æ¬¡ã€‚ åœ¨EasyScaleä¸­ï¼Œæˆ‘ä»¬ä¼˜åŒ–äº†æ‰€æœ‰EasyScaleThreadsä¹‹é—´å…±äº«data loaderï¼Œå› ä¸ºæ¯æ¬¡åªæœ‰ä¸€ä¸ªEasyScaleThreadåœ¨GPUä¸Šè¿›è¡Œè®­ç»ƒã€‚ å°½ç®¡å…±äº«äº†å¤šä¸ªEasyScaleThreadsï¼Œä½†æ•°æ®æ¶ˆè€—ç‡ä¸ä¸“ç”¨GPUä¸­çš„æ•°æ®æ¶ˆè€—ç‡ç›¸ä¼¼ã€‚    ä¸ºäº†å®ç°data loaderçš„å…±äº«\n  EasyScaleé‡‡ç”¨äº†ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®é‡‡æ ·å™¨ï¼Œè¯¥é‡‡æ ·å™¨å…±åŒè€ƒè™‘äº†EasyScaleThreadsçš„å…¨å±€indexå’Œæ—¶åˆ†æ¨¡å¼ï¼Œåœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ç”Ÿæˆæ•°æ®index\n  ç„¶åï¼Œè¿™äº›æ•°æ®ç´¢å¼•è¢«æ•°æ®å·¥ä½œè€…æœ‰åºåœ°å¤„ç†\n \rimage-20221110211808582\r\n å›¾7æ˜¾ç¤ºäº†å°†ä¸‰ä¸ªæ•°æ®å·¥ä½œè€…å…±äº«ç»™ä¸¤ä¸ªEasyScaleThreadsçš„æƒ…å†µï¼Œå…¶ä¸­EasyScaleThreadçš„æ€»æ•°é‡ä¸ºå››ä¸ªï¼ˆå³å›¾6ä¸­çš„2-GPUè®­ç»ƒï¼‰ã€‚ EST0å’ŒEST1çš„è®­ç»ƒæ‰¹æ¬¡ä¸ºï¼šå°æ‰¹0çš„b0å’Œb1ï¼Œå°æ‰¹1çš„b4å’Œb5ã€‚ åœ¨ä¸“ç”¨GPUä¸­ä¸ºEasyScaleThread iå¤„ç†æ•°æ®æŒ‡æ•°çš„æ•°æ®å·¥ä½œè€…jçš„çŠ¶æ€è¢«è¡¨ç¤ºä¸ºRi-j ä¸ºäº†å¹³è¡¡è´Ÿè½½ï¼ŒEasyScaleä¸­çš„æ•°æ®å·¥ä½œè€…è½®æµä»é˜Ÿåˆ—ç¼“å†²åŒºä¸­è·å–ç»™å®šæ•°æ®æŒ‡æ•°çš„ç›¸åº”çŠ¶æ€ï¼ˆå³Ri-jï¼‰è¿›è¡Œé¢„å¤„ç†ï¼Œå®Œæˆåå°†çŠ¶æ€æäº¤å›é˜Ÿåˆ—ç¼“å†²åŒºä¸­ã€‚     æ³¨æ„ï¼Œç”±äºdata loaderçš„å¼‚æ­¥æ‰§è¡Œ\u0026ndash;\u0026gt;\n data loaderçš„è¿›ç¨‹é€šå¸¸åœ¨è®­ç»ƒè¿›åº¦ä¹‹å‰\u0026mdash;\u0026gt; ä¸ºäº†è·Ÿè¸ªå’Œä¿æŒå¼¹æ€§çš„ä¸€è‡´çŠ¶æ€ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ’é˜Ÿç¼“å†²åŒºæ¥è®°å½•æœªè¢«æ¶ˆè€—çš„å°æ‰¹çš„å¿…è¦çŠ¶æ€\u0026mdash;\u0026gt; workerçš„çŠ¶æ€æ ¹æ®è®­ç»ƒè¿›åº¦ä»é˜Ÿåˆ—ç¼“å†²åŒºä¸­å»æ’é˜Ÿï¼Œç„¶ååœ¨æ£€æŸ¥ç‚¹ä¸­è¢«è§†ä¸ºé¢å¤–çŠ¶æ€çš„ä¸€éƒ¨åˆ†        ä¸ç¡®å®šæ€§çš„æº¯æºä¸è§£å†³  è‡ªä¸Šè€Œä¸‹çš„æ–¹æ³•æ¥æ¯”è¾ƒEasyScaleå’ŒDDPï¼Œ æˆ‘ä»¬å‘ç°éç¡®å®šæ€§çš„æ ¹æœ¬åŸå› åˆ†æ•£åœ¨è®­ç»ƒç®¡é“çš„å‡ ä¹æ•´ä¸ªè½¯ä»¶æ ˆä¸­ï¼Œä»è®­ç»ƒæ¡†æ¶åˆ°é€šä¿¡ï¼Œå†åˆ°GPUå†…æ ¸ã€‚  é¦–å…ˆï¼Œåœ¨è®­ç»ƒæ¡†æ¶å±‚é¢  æ¡†æ¶æœ‰ä¸€äº›çŠ¶æ€éœ€è¦åœ¨æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­ä¿æŒä¸€è‡´ï¼Œä»¥ä¿è¯ç¡®å®šæ€§ å°½ç®¡æ·±åº¦å­¦ä¹ è®­ç»ƒåœ¨DAGå›¾ä¸­ç»„ç»‡è¿ç®—ç¬¦ï¼ˆä¾‹å¦‚å·ç§¯ã€æ‰¹é‡å½’ä¸€åŒ–ï¼‰ï¼Œä½†ä¸€äº›è¿ç®—ç¬¦éšå«åœ°ä¾èµ–ä¸€äº›çŠ¶æ€ï¼Œè€Œä¸æ˜¯å…¶å‰è¾ˆçš„è¾“å‡ºã€‚ä¾‹å¦‚  Dropoutä¾èµ–äºGPUä¸­çš„éšæœºæ•°å‘ç”Ÿå™¨ï¼ˆRNGï¼‰çŠ¶æ€ï¼› BatchNormé€šè¿‡è€ƒè™‘å·¥ä½œè€…çš„ç­‰çº§æ¥è·Ÿè¸ªå…¶è¿è¡ŒçŠ¶æ€ï¼› æ•°æ®åŠ è½½å™¨å’Œæ•°æ®å¢å¼ºçš„è½¬åŒ–å™¨ä¾èµ–äºPythonã€NumPyå’ŒPyTorchçš„éšæœºçŠ¶æ€ï¼Œç­‰ç­‰ã€‚     ç¬¬äºŒï¼Œåœ¨é€šä¿¡å±‚é¢  é€šè¿‡å…¨è¿˜åŸçš„æ¢¯åº¦åŒæ­¥åœ¨èµ„æºå¼¹æ€§ä¸‹æ˜¯ä¸ç¡®å®šçš„ åœ¨åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œæ¢¯åº¦è¢«èšé›†åˆ°é€šä¿¡æ¡¶ä¸­ï¼Œä»¥ä¼˜åŒ–é€šä¿¡æ€§èƒ½ã€‚ æ¢¯åº¦åˆ°æ¡¶çš„æ˜ å°„æœ€åˆç”±DAGå›¾çš„é™æ€åè½¬æ‹“æ‰‘é¡ºåºå†³å®šã€‚ å®ƒåœ¨ç¬¬ä¸€ä¸ªå°æ‰¹å¤„ç†ç»“æŸæ—¶æ ¹æ®æ”¶åˆ°çš„æ¢¯åº¦å¼ é‡çš„é¡ºåºè¿›è¡Œé‡æ„ã€‚ ç„¶è€Œï¼Œåœ¨å¼¹æ€§è®­ç»ƒæœŸé—´ï¼Œå·¥ä½œè€…é‡æ–°å¯åŠ¨å°†é‡å»ºé€šä¿¡æ¸ é“ï¼Œè¿™å¯èƒ½ä¼šå½±å“ç¬¬ä¸€ä¸ªæ¢å¤çš„å°æ‰¹çš„æ¢¯åº¦èšåˆé¡ºåºã€‚ ç”±äºç¯å½¢Allreduceçš„å®ç°ï¼Œè¿™æœ€ç»ˆä¼šå¼•å…¥éç¡®å®šæ€§ã€‚   æœ€åï¼Œåœ¨GPUå†…æ ¸å±‚é¢  ä¸ºåŒä¸€è¿ç®—å™¨é€‰æ‹©ä¸åŒçš„å†…æ ¸ä¹Ÿä¼šå¯¼è‡´ç»“æœçš„ç»†å¾®å·®åˆ« å¯¼è‡´ä¸åŒå†…æ ¸é€‰æ‹©çš„åŸå› æœ‰ä¸¤ä¸ªã€‚  é¦–å…ˆæ˜¯æ¡†æ¶ã€ç¼–è¯‘å™¨æˆ–ä¾›åº”å•†åº“ä¸­çš„ä¸€äº›åŸºäºå‰–æçš„ä¼˜åŒ–ï¼Œåœ¨å°æ‰¹é‡ä¸­åº”ç”¨ä¸åŒçš„å†…æ ¸å®ç°ï¼Œä»¥æ”¶é›†æ€§èƒ½ç»Ÿè®¡æ•°æ®ï¼Œæ‰¾åˆ°æœ€ä½³åŒ¹é…ã€‚ å¦ä¸€ä¸ªæ˜¯å†…æ ¸çš„å®ç°å¯ä»¥ä¸ç¡¬ä»¶ç›¸å…³ã€‚ä¾‹å¦‚ï¼Œä¸€äº›å†…æ ¸å®ç°æ˜¯åŸºäºæµå¤„ç†å™¨å•å…ƒçš„æ•°é‡ã€ç¡¬ä»¶ç‰¹å®šçš„ä½ä½ç»„ä»¶ç­‰ï¼Œå› æ­¤ä¸èƒ½åº”ç”¨äºæ‰€æœ‰ç±»å‹çš„GPUã€‚       ç¡®å®šæ€§çš„ç­‰çº§ä¸åº”å¯¹æ–¹æ¡ˆ  EasyScaleå®šä¹‰äº†ä¸åŒçº§åˆ«çš„å¼¹æ€§è®­ç»ƒçš„ç¡®å®šæ€§ï¼Œä¸ºç”¨æˆ·æä¾›æ˜ç¡®çš„ä¸€è‡´æ€§ä¿è¯ï¼Œå¹¶è®¾è®¡äº†ç›¸åº”çš„å¤„ç†æ–¹æ³•æ¥å®ç°å®ƒä»¬ã€‚ D0ï¼šå›ºå®šDoPçš„ç¡®å®šæ€§  \u0026ndash;ç”¨å›ºå®šçš„GPUèµ„æºè¿›è¡Œå¤šæ¬¡è®­ç»ƒåº”è¯¥äº§ç”Ÿç›¸åŒçš„æ¨¡å‹ å®ç°D0éœ€è¦è®­ç»ƒæ¡†æ¶åŠå…¶æ‰€é€‰å†…æ ¸çš„ä¸€è‡´è¡Œä¸ºã€‚  å¯¹äºæ¡†æ¶ï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒå¼€å§‹æ—¶å›ºå®šRNGçš„éšæœºç§å­ï¼Œå¹¶åœ¨æ•°æ®åŠ è½½å·¥ä½œè€…çŠ¶æ€ä¸­è®°å½•RNGçš„çŠ¶æ€ï¼Œåœ¨ä¸Šä¸‹æ–‡ä¸­è®°å½•EasyScaleThreadsçš„çŠ¶æ€ï¼Œä»¥ä¾¿EasyScaleThreadsè‡ªåŠ¨ä¿æŒçŠ¶æ€ä¸€è‡´ã€‚ æˆ‘ä»¬è¿˜ç¦ç”¨äº†æœ€é€‚åˆçš„ç®—æ³•é€‰æ‹©ï¼Œå¹¶é€‰æ‹©äº†ç¡®å®šæ€§çš„ç®—æ³•ï¼ˆä¾‹å¦‚ï¼Œæ²¡æœ‰åŸå­æŒ‡ä»¤ï¼‰ã€‚     D1ï¼šå¼¹æ€§ç¡®å®šæ€§  \u0026ndash;åœ¨æ£€æŸ¥ç‚¹é‡å¯çš„æƒ…å†µä¸‹ï¼Œç”¨æ•°é‡ä¸æ–­å˜åŒ–çš„åŒè´¨GPUè¿›è¡Œå¤šæ¬¡è®­ç»ƒï¼Œåº”è¯¥äº§ç”Ÿç›¸åŒçš„æ¨¡å‹ åœ¨D0ä¹‹å¤–ï¼ŒD1éœ€è¦è§£å†³é€šä¿¡å±‚é¢çš„éç¡®å®šæ€§ã€‚  ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªEasyScaleThreadåˆ†é…äº†ä¸€ä¸ªå›ºå®šçš„è™šæ‹Ÿé€šä¿¡ç­‰çº§ã€‚ æˆ‘ä»¬è¿˜å°†å½¢æˆæ¢¯åº¦æ¡¶çš„ç´¢å¼•è®°å½•åˆ°æ£€æŸ¥ç‚¹ä¸­ã€‚ é‡æ–°å¯åŠ¨åï¼Œåœ¨è®­ç»ƒä¹‹å‰ï¼Œé¦–å…ˆç”¨è®°å½•çš„æŒ‡æ•°é‡å»ºæ¡¶ã€‚ åé¢çš„é€šä¿¡é€šé“é‡å»ºè¢«ç¦æ­¢ã€‚     D2ï¼šå¼‚è´¨æ€§ç¡®å®šæ€§  \u0026ndash;ç”¨ä¸åŒç±»å‹çš„GPUè¿›è¡Œçš„å¤šæ¬¡è®­ç»ƒåº”è¯¥äº§ç”Ÿç›¸åŒçš„æ¨¡å‹ã€‚ ä¸ºäº†å®ç°D2ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸ç¡¬ä»¶æ— å…³çš„GPUå†…æ ¸ã€‚å…·ä½“æ¥è¯´ï¼Œ  1ï¼‰æˆ‘ä»¬ä¿®æ”¹å†…æ ¸å®ç°ï¼ˆä¾‹å¦‚PyTorchä¸­çš„reduceã€dropoutï¼‰ï¼Œé™åˆ¶SMå’Œçº¿ç¨‹çš„æ•°é‡ï¼› 2ï¼‰æˆ‘ä»¬é€šè¿‡å‘é«˜å±‚è°ƒç”¨ä¼ é€’algo_idï¼Œå¼ºåˆ¶é€‰æ‹©ç›¸åŒçš„ä½å±‚å®ç°ï¼ˆä¾‹å¦‚cuDNNä¸­çš„convolutionï¼Œä»¥åŠcuBLASä¸­çš„gemmã€gemvï¼‰ã€‚       å¦‚ä½•ç¡®å®šç¡®å®šæ€§ç­‰çº§  åœ¨EasyScaleä¸­ï¼ŒD0å’ŒD1æ˜¯é»˜è®¤å¯ç”¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„å®ç°å¯¹å®ç°å®ƒä»¬çš„å¼€é”€å¯ä»¥å¿½ç•¥ä¸è®¡ å®ç°D2å¯¹äºæŸäº›ç±»å‹çš„æ¨¡å‹ï¼ˆå¦‚CVæ¨¡å‹ï¼‰å¯èƒ½ä¼šæœ‰è¾ƒé«˜çš„å¼€é”€ï¼Œå› ä¸ºå®ƒä»¬ä¸èƒ½å¯¹æŸäº›GPUç±»å‹ä½¿ç”¨ä¸€äº›ä¾›åº”å•†ä¼˜åŒ–çš„å†…æ ¸ï¼ˆå¦‚å·ç§¯ï¼‰ã€‚  EasyScaleå¯ä»¥é€æ˜åœ°åˆ†æä¸€ä¸ªæ¨¡å‹ï¼ˆé€šè¿‡æ‰«æPyTorch nn.Modulesï¼‰ï¼Œå¹¶è¯†åˆ«å®ƒæ˜¯å¦ä¾èµ–äºéœ€è¦ç¡¬ä»¶ç‰¹å®šå†…æ ¸ä¼˜åŒ–çš„è¿ç®—ç¬¦ã€‚ å¦‚æœä¸æ˜¯ï¼Œæˆ‘ä»¬å°±å¯ç”¨D2ï¼Œå…è®¸å®ƒä½¿ç”¨å¼‚æ„çš„GPUï¼Œå¦åˆ™å°±é™åˆ¶å®ƒä½¿ç”¨åŒæ„çš„GPUã€‚      è°ƒåº¦åŸåˆ™  ç”¨æˆ·åœ¨æäº¤EasyScaleä½œä¸šæ—¶  å¯ä»¥æŒ‡å®šä¸€ä¸ªmaxPï¼šå³è¦å¯åŠ¨çš„æœ€å¤§å·¥ä½œè€…æ•°é‡ï¼Œè¿™ä¹Ÿæ˜¯ä½œä¸šæ‰§è¡Œè¿‡ç¨‹ä¸­EasyScaleThreadsçš„æ•°é‡ ç”¨æˆ·è¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ªminPï¼ˆ\u0026gt;=0ï¼‰ï¼Œè¡¨ç¤ºæ‰€éœ€çš„ä¿è¯GPU è®¾ç½®minP == maxPæ„å‘³ç€ä½œä¸šå°†å›åˆ°ä½¿ç”¨ä¸DDPç›¸åŒçš„å›ºå®šDoP   å°ç»“ï¼šESTiæŠ½è±¡ -\u0026gt; ç¡®å®šæ€§å¤„ç† -\u0026gt; è°ƒåº¦EST  EasyScaleThreadsï¼ˆESTï¼‰çš„æŠ½è±¡å°†DLè®­ç»ƒå’Œåº•å±‚GPUèµ„æºè§£è€¦ï¼Œå› æ­¤ä¸DDPå…¼å®¹çš„è®­ç»ƒä½œä¸šå¯ä»¥æŒç»­åœ°åœ¨åŒè´¨GPUçš„å¼¹æ€§æ•°é‡ä¸Šè¿è¡Œã€‚ ç¡®å®šæ€§å¤„ç†å®ç°äº†å¼¹æ€§è®­ç»ƒä¸‹çš„ç²¾åº¦ä¸€è‡´æ€§ï¼Œå³ä½¿æ˜¯åœ¨å¼‚æ„GPUä¸Š   åœ¨å¼‚æ„GPUä¸Šè°ƒåº¦ESTçš„å…³é”®æŒ‘æˆ˜åœ¨äºè®¡ç®—èƒ½åŠ›çš„å¼‚è´¨æ€§å’ŒGPUå†…å­˜çš„å¼‚è´¨æ€§ã€‚  Polluxå’ŒVirtualFlow  é‡‡ç”¨ä¸ºæ¯ä¸€ç§GPUå•ç‹¬æ‰©å±•æ‰¹æ¬¡å¤§å°çš„æ–¹æ³• å¯¹äºEasyScaleæ¥è¯´æ˜¯å®Œå…¨ä¸å¯æ¥å—çš„ï¼Œå› ä¸ºå®ƒæ”¹å˜äº†å›ºæœ‰çš„è®­ç»ƒè¶…å‚æ•°ï¼Œä»è€Œç ´åäº†ç²¾åº¦çš„ä¸€è‡´æ€§   ESTæ¶ˆè€—å›ºå®šè®¡ç®—èƒ½åŠ›ä¸å›ºå®šå†…å­˜æ¶ˆè€—  åœ¨ESTæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªESTæ¶ˆè€—å›ºå®šçš„è®¡ç®—èƒ½åŠ›ï¼Œå…¶ä¸­GPUçš„å¾®æ¶æ„ç‰¹å¾ï¼ˆå³SMæ•°é‡å’Œç¼“å­˜å¤§å°ï¼‰å†³å®šäº†ç†è®ºèƒ½åŠ›ã€‚å…·æœ‰è¾ƒé«˜è®¡ç®—èƒ½åŠ›çš„GPUå¯ä»¥åœ¨ä¸€å®šæ—¶é—´å†…æ‰§è¡Œæ›´å¤šçš„EST è€Œæ¯ä¸ªESTéƒ½æœ‰å›ºå®šå¤§å°çš„GPUå†…å­˜ä½¿ç”¨å³°å€¼ã€‚æ­¤å¤–ï¼Œç”±äºåŒä¸€GPUæ‰§è¡Œå™¨ä¸­çš„ESTçš„å†…å­˜æ˜¯å®Œå…¨é‡å¤ä½¿ç”¨/å…±äº«çš„ï¼Œæ‰§è¡Œå™¨çš„å†…å­˜ç”¨é‡å¯ä»¥ä»£è¡¨ESTçš„å†…å­˜ç”¨é‡ ä¸ºç®€æ´èµ·è§ï¼Œæˆ‘ä»¬å°†å›ºå®šçš„è®¡ç®—èƒ½åŠ›å’Œå†…å­˜ç”¨é‡åˆ†åˆ«å®šä¹‰ä¸ºè®¡ç®—å•å…ƒï¼ˆCUï¼‰å’Œå†…å­˜å•å…ƒï¼ˆMUï¼‰   å¤æ‚çš„åˆ†æè§„åˆ’ï¼šé¿å…å› ä¸ºä¸¥é‡çš„è´Ÿè½½ä¸å¹³è¡¡è€Œé€ æˆé‡å¤§çš„æ€§èƒ½æµªè´¹    å¼‚æ„æ„ŸçŸ¥çš„ESTè§„åˆ’   Planning CUs\n åˆ†é…ç­–ç•¥  å½“åˆ†é…çš„GPUæ˜¯åŒè´¨çš„ï¼Œå¹¶ä¸”æ•°é‡æ˜¯maxPçš„ä¸€ä¸ªå› ç´ æ—¶ï¼Œåœ¨è¿™äº›GPUä¸Šå‡åŒ€åœ°åˆ†é…CUï¼Œå› ä¸ºæ‰€æœ‰CUéƒ½æœ‰ç›¸åŒçš„è®¡ç®—æ—¶é—´ åœ¨å¼‚æ„GPUçš„æƒ…å†µä¸‹ï¼Œéœ€è¦æ ¹æ®GPUçš„è®¡ç®—èƒ½åŠ›æ¥åˆ†é…CUä»¥è¾¾åˆ°å¹³è¡¡ï¼Œå¹¶æœ€å¤šæ¶ˆé™¤ç©ºé—²å‘¨æœŸ   æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ–°çš„æŒ‡æ ‡ï¼Œå«åšæµªè´¹ï¼Œ  å³ç”±äºCUçš„æ•´æ•°å€å’ŒGPUçš„å®é™…è¿ç»­èƒ½åŠ›ä¸åŒ¹é…è€Œæµªè´¹çš„è®¡ç®—èƒ½åŠ›ï¼Œæˆ–è€…è¯´æ˜¯è´Ÿè½½ä¸å¹³è¡¡ã€‚ æµªè´¹ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢ï¼š  âˆ‚å¼‚æ„GPUä¹‹é—´çš„è´Ÿè½½ä¸å¹³è¡¡ï¼Œæ˜¯ç”±äºç”¨CUçš„æ•´æ•°å€ä¸å‡†ç¡®åœ°é€¼è¿‘è¿ç»­çš„å®é™…è®¡ç®—èƒ½åŠ›é€ æˆçš„ï¼› âˆ‘åŒæ„GPUä¹‹é—´çš„è´Ÿè½½ä¸å¹³è¡¡ï¼Œæ˜¯ç”±äºæ²¡æœ‰è¶³å¤Ÿçš„CUåˆ†é…æ¥å……åˆ†åˆ©ç”¨æ‰€æœ‰çš„GPUï¼Œå› ä¸ºCUçš„æ€»é‡è¢«maxPæ‰€é™åˆ¶ã€‚   å› æ­¤ï¼Œæˆ‘ä»¬å»ºç«‹ä¸€ä¸ªåˆ†ææ¨¡å‹æ¥é‡åŒ–æµªè´¹ã€‚  ç¬¦å·è¡¨ç¤º  å¯ç”¨çš„GPUæ•°é‡è¡¨ç¤ºä¸ºNiï¼Œå…¶ä¸­ä¸‹æ ‡iä»£è¡¨GPUç±»å‹ã€‚ ä¸å·¥ä½œè´Ÿè½½ç›¸å…³çš„è®¡ç®—èƒ½åŠ›Ciè¢«ä¼°è®¡ä¸ºæ¯ç§’çš„å°æ‰¹å¤„ç†æ•°é‡ã€‚ åˆ†é…ç»™GPUç±»å‹içš„CUçš„æœ€å¤§æ•°ç›®è¢«è¡¨ç¤ºä¸ºAiã€‚   \rimage-20221112203217230\r ä¸ºäº†ç¡®ä¿æ‰€æœ‰EasyScaleThreadsè¢«æ‰§è¡Œï¼Œå¼‚æ„GPUä¸Šçš„æœ€å¤§CUæ€»æ•°ï¼ˆCU_capacityï¼‰åº”è¯¥å¤§äºæˆ–ç­‰äºmaxPï¼ˆå…¬å¼1aï¼‰ã€‚ è¿‡è½½ç³»æ•°foverloadä»£è¡¨æ‰€è¯·æ±‚çš„å¼‚æ„GPUçš„æœ€å¤§è¿‡è½½ï¼Œå…¶ä¸­è¿‡è½½è¢«å®šä¹‰ä¸ºæ¯ä¸ªè®¡ç®—èƒ½åŠ›çš„CUï¼ˆç­‰å¼1bï¼‰ã€‚ å¦‚æœä¸€ä¸ªGPUç±»å‹æ‰¿æ‹…äº†å¤ªå¤šçš„CUï¼Œå®ƒå°±ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œå¹¶ç”±äºSync-SGDè€Œæ‹–æ…¢å…¶ä»–GPUçš„é€Ÿåº¦ã€‚å› æ­¤ï¼Œæµªè´¹è¢«è¡¨è¿°ä¸ºï¼šâˆ‚Ciå’ŒAiä¹‹é—´çš„å·®è·æŒ‰foverloadç¼©æ”¾ï¼Œâˆ‘è¶…é¢é…ç½®çš„CU_capacityæŒ‰foverloadç¼©æ”¾ï¼ˆå…¬å¼1cï¼‰ã€‚ ä¸ºäº†è¿›ä¸€æ­¥åŒºåˆ†å½“å‰Niã€Ciå’ŒAiä¸‹çš„CUåˆ†é…æ•ˆç‡ï¼Œå¾—å‡ºäº†å½’ä¸€åŒ–çš„æµªè´¹ç™¾åˆ†æ¯”ï¼ˆå…¬å¼1dï¼‰ã€‚ è¿˜å¾—å‡ºäº†ä¼°è®¡æ€§èƒ½ï¼ˆç­‰å¼1eï¼‰ã€‚        Planning MUs\n  å¼‚æ„GPUä¹‹é—´çš„å†…å­˜å®¹é‡ä¹Ÿå­˜åœ¨å¼‚è´¨æ€§\n å°†MUåˆ†é…ç»™æ¯ä¸ªGPUçš„å•ä¸ªæ‰§è¡Œå™¨å¯ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘æ•´ä½“å†…å­˜å ç”¨ï¼Œå› ä¸ºEasyScaleThreadså¼•å…¥çš„å†…å­˜å¼€é”€å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ è€Œä¸”å®ƒä»¬çš„MUå¯ä»¥å®Œå…¨é‡å¤ä½¿ç”¨ã€‚ å› æ­¤ï¼Œæ‰€æœ‰çš„GPUéƒ½æ˜¾ç¤ºå‡ºä¸MUç›¸åŒçš„å³°å€¼å†…å­˜ä½¿ç”¨é‡ï¼Œå¯¼è‡´å…·æœ‰è¾ƒå¤§å†…å­˜å®¹é‡çš„GPUå‡ºç°é—²ç½®å†…å­˜ã€‚    æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªå¤šæ‰§è¡Œå™¨çš„è®¾è®¡\n  å®ƒå…è®¸åœ¨GPUä¸Šåˆ†é…ä¸€ä¸ªä»¥ä¸Šçš„æ‰§è¡Œå™¨ï¼Œè¿™æ ·å°±å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªESTã€‚\n  å…·æœ‰è¾ƒå¤§å†…å­˜çš„GPUå¯ä»¥æƒè¡¡æ‰§è¡Œå™¨æ•°é‡å’Œæ¯ä¸ªæ‰§è¡Œå™¨çš„ESTæ•°é‡\n åŒæ—¶ä¿æŒ ï¼ˆ#æ‰§è¡Œå™¨ Ã— #ESTï¼‰ ä¸å˜ ä¾‹å¦‚ï¼Œåœ¨åˆ†é…äº†ä¸¤ä¸ªESTçš„æƒ…å†µä¸‹ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼š  aï¼‰\u0026lt;1æ‰§è¡Œå™¨Ã—2EST\u0026gt; bï¼‰\u0026lt;2æ‰§è¡Œå™¨Ã—1EST\u0026gt;      å®ƒæ‹“å®½äº†é«˜æ•ˆåœºæ™¯ï¼Œå³è¿è¡Œæ›´å¤šçš„æ‰§è¡Œå™¨ä¸ä¼šè¶…è¿‡GPUèµ„æºï¼ˆSMæ ¸ã€å†…å­˜ï¼‰ï¼Œå³ä½¿è€ƒè™‘åˆ°å¹²æ‰°ï¼Œä»ç„¶æœ‰åŠ©äºæé«˜æ€§èƒ½ã€‚\n æ¨èæ¨¡å‹ï¼ˆå¦‚Wide\u0026amp;Deepï¼‰çš„è®­ç»ƒé€šå¸¸æ˜¾ç¤ºå‡ºå¯¹GPUè®¡ç®—èƒ½åŠ›çš„åˆ©ç”¨ä¸è¶³ï¼Œé€šå¸¸ä½äº50%ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ†é…å¤šä¸ªæ‰§è¡Œå™¨å¯ä»¥åˆ©ç”¨å‰©ä½™çš„è®¡ç®—èƒ½åŠ›ï¼Œè€Œä¸”æ‰§è¡Œå™¨ä¹‹é—´ä¸ä¼šäº§ç”Ÿä¸åˆ©å½±å“ï¼Œä»è€Œæé«˜ç»¼åˆååé‡ã€‚\n     æˆ‘ä»¬è¿˜å¯¹ï¼ˆç­‰å¼1ï¼‰è¿›è¡Œäº†è°ƒæ•´ï¼Œä»¥å¯¹å¤šä¸ªæ‰§è¡Œå™¨çš„æµªè´¹è¿›è¡Œå»ºæ¨¡ã€‚\n ä¸å·¥ä½œè´Ÿè½½ç›¸å…³çš„è®¡ç®—èƒ½åŠ›Ciè¢«MCi = m Ã— Ci Ã— Iiæ‰€å–ä»£ï¼Œè¡¨ç¤ºmä¸ªæ‰§è¡Œå™¨çš„æ•´ä½“èƒ½åŠ›ï¼Œå…¶ä¸­åŒ…æ‹¬å¹²æ‰°Iiã€‚ åˆ†é…ç»™GPU Aiçš„CUæ•°é‡ç”±MAi = m Ã— Aiå–ä»£ï¼Œä»£è¡¨mä¸ªæ‰§è¡Œå™¨çš„æ€»CUæ•°é‡ã€‚      EeayScale è°ƒåº¦å™¨  å¦‚å›¾9æ‰€ç¤ºï¼ŒEasyScaleé‡‡ç”¨äº†ä¸€ä¸ªåˆ†å±‚è°ƒåº¦æ¶æ„ã€‚  æ¯ä¸ªä½œä¸šéƒ½åŒ…å«ä¸€ä¸ªä½œä¸šå†…çš„è°ƒåº¦å™¨ï¼Œåä¸ºAIMasterï¼Œå®ƒè´Ÿè´£ï¼š  aï¼‰åœ¨åŒè´¨å’Œå¼‚è´¨GPUä¹‹é—´åˆ†é…EasyScaleThreadsï¼Œå°½é‡å‡å°‘æµªè´¹ï¼Œä½¿èµ„æºåˆ©ç”¨ç‡æœ€å¤§åŒ–ï¼› bï¼‰é€šè¿‡ä¼°è®¡æ½œåœ¨çš„é€Ÿåº¦æå‡ï¼Œæå‡ºæ‰€éœ€çš„èµ„æºè¿›è¡Œæ‰©å±•ã€‚   æ­¤å¤–ï¼Œä¸€ä¸ªé›†ç¾¤è°ƒåº¦å™¨ä»¥å…¨å±€æ¨¡å¼è¡Œäº‹ï¼Œåè°ƒä½œä¸šä¹‹é—´çš„èµ„æºã€‚    \rimage-20221110214614664\r\n Intra-Job scheduler  åŸºæœ¬èŒè´£ï¼šåœ¨ç»™å®šçš„GPUä¸‹ç”ŸæˆESTåˆ†é…é…ç½®  é¦–å…ˆï¼Œåœ¨å½“å‰å¯ç”¨çš„GPUä¸‹ï¼Œå®ƒé€‰æ‹©ä¼°è®¡ååé‡æœ€é«˜çš„é…ç½®ï¼Œå¹¶ç›¸åº”åˆ†é…ESTã€‚ å…¶æ¬¡ï¼Œå®ƒè¯•å›¾ç”¨ä¸€ä¸ªå¢é‡çš„GPUæ¥æ‰©å±•ï¼Œä»è€Œäº§ç”Ÿæ–°çš„é…ç½®ï¼Œå¹¶é€‰æ‹©top-Kçš„é…ç½®ä½œä¸ºæäº¤ç»™é›†ç¾¤è°ƒåº¦å™¨çš„å»ºè®®ã€‚   é…ç½®ç»„æˆä¸çº¦æŸ  ç”±\u0026lt;nums, executors, threads, waste, perf\u0026gt;ç»„æˆ  nums, executors, threadsæ˜¯å…·æœ‰ç›¸åŒé•¿åº¦çš„GPUç±»å‹çš„æ•°ç»„ï¼Œåˆ†åˆ«ä»£è¡¨GPUæ•°é‡ã€æ‰§è¡Œå™¨æ•°é‡å’Œæ¯ä¸ªæ‰§è¡Œå™¨çš„ESTæ•°é‡ wasteå’Œperfä»£è¡¨è¯¥é…ç½®é€šè¿‡åˆ†ææ¨¡å‹ä¼°è®¡çš„æµªè´¹å’Œæ€§èƒ½   è¿™äº›é…ç½®åº”è¯¥æ»¡è¶³é›†ç¾¤æ€»èµ„æºã€minPã€maxPå’Œå½’ä¸€åŒ–æµªè´¹çš„é˜ˆå€¼ï¼ˆå®é™…ä¸º30%ï¼‰çš„çº¦æŸã€‚   å¯»æ‰¾å¯ç”¨é…ç½®  ä¸åŒçš„å·¥ä½œè´Ÿè½½ä½¿ç”¨ä¸åŒGPUçš„ååé‡æœ‰å·®å¼‚ï¼Œä½†åœ¨æ²¡æœ‰å®é™…æ‰§è¡Œçš„æƒ…å†µä¸‹å¾ˆéš¾é¢„æµ‹ å› æ­¤ï¼ŒAIMasteræ¨¡å—ä½¿ç”¨ä½œä¸šçš„è¿è¡Œæ—¶æ‰§è¡Œç»Ÿè®¡æ•°æ®æ¥äº†è§£å·¥ä½œè´Ÿè½½å·®å¼‚ï¼Œå¹¶ç¡®å®šæ¯ä¸ªGPUç±»å‹içš„å·¥ä½œè´Ÿè½½ç›¸å…³è®¡ç®—èƒ½åŠ›Ciã€‚ é‰´äºæ¯ä¸ªGPUç±»å‹içš„å‰–æè®¡ç®—èƒ½åŠ›Ciï¼Œæˆ‘ä»¬è®¡ç®—å®ƒä»¬çš„æ•´æ•°è¿‘ä¼¼å€¼ï¼ˆä¾‹å¦‚ï¼Œceil(tÃ—Ci), floor(tÃ—Ci)ï¼‰ï¼Œå‡è®¾æ¯ä¸ªèƒ½åŠ›æ‰¿æ‹…kä¸ªESTï¼Œå¹¶å½¢æˆå®ƒä»¬çš„ç»„åˆ ç„¶åæˆ‘ä»¬éå†è¿™äº›ç»„åˆï¼Œæ‰¾åˆ°å¯ç”¨çš„é…ç½®ã€‚å¯¹äºå…·æœ‰ç›¸åŒ\u0026lt;æ•°ã€æ‰§è¡Œå™¨ã€çº¿ç¨‹\u0026gt;çš„é…ç½®ï¼Œé€‰æ‹©å…·æœ‰æœ€å°æµªè´¹çš„é…ç½®ï¼Œå…¶ä»–é…ç½®åˆ™è¢«è¿‡æ»¤æ‰   é…ç½®å›é€€  å¯¹æµªè´¹çš„ä¼°è®¡æœ‰æ—¶å¯èƒ½æ˜¯ä¸æ­£ç¡®çš„ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ›´å·®çš„è®­ç»ƒæ€§èƒ½ ä¸€æ—¦åœ¨é‡æ–°é…ç½®åè§‚å¯Ÿåˆ°æ€§èƒ½ä¸‹é™ï¼Œæˆ‘ä»¬å°±ä¼šé€€å›åˆ°ä½¿ç”¨ä»¥å‰çš„èµ„æºå¹¶é‡Šæ”¾æ–°åˆ†é…çš„èµ„æº     Inter-job cluster scheduler   å®ƒé€šè¿‡è€ƒè™‘èµ„æºå¯ç”¨æ€§å’Œææ¡ˆçš„ä¼˜å…ˆçº§æ¥å“åº”AIMasterææ¡ˆã€‚\n ä¸ºäº†æé«˜é›†ç¾¤çš„æ•´ä½“åˆ©ç”¨ç‡å’Œèšåˆä½œä¸šçš„ååé‡ å®ƒé‡‡ç”¨äº†ä¸€ç§å¯å‘å¼ç®—æ³•ï¼Œå€¾å‘äºæ¥å—æ¯ä¸ªGPUå…·æœ‰è¾ƒé«˜é€Ÿåº¦çš„å»ºè®®ï¼Œå¦‚ç®—æ³•1æ‰€ç¤ºã€‚  ä½œä¸šé—´è°ƒåº¦å™¨æŒ‰ç…§æŠ¥å‘Šçš„å¹³å‡åŠ é€Ÿæ¯”å¯¹å»ºè®®è¿›è¡Œé™åºæ’åºã€‚ ç„¶åï¼Œå®ƒå¯¹è¿™äº›å»ºè®®è¿›è¡Œå¾ªç¯ï¼Œå¼€å§‹æ¥å—æœ€é«˜çš„å»ºè®®ã€‚ å¦‚æœå¤šä¸ªå»ºè®®å¼•å…¥äº†ç›¸åŒçš„å¹³å‡GPUåŠ é€Ÿï¼Œæˆ‘ä»¬çš„è°ƒåº¦å™¨ä¼šä¼˜å…ˆè€ƒè™‘æ‹¥æœ‰æ›´å¤šGPUçš„å»ºè®®ã€‚    \rimage-20221112210504940\r\n  é›†ç¾¤è°ƒåº¦å™¨å…è®¸å¼¹æ€§ä½œä¸šæœ€å¥½åœ°åˆ©ç”¨ç©ºé—²èµ„æº\n è¿™äº›èµ„æºé€šå¸¸å±äºå…¶ä»–äººï¼Œä½†æš‚æ—¶æ˜¯é—²ç½®çš„ã€‚ ç„¶è€Œï¼Œå¦‚æœè¿™äº›GPUéœ€è¦è¿”å›ï¼Œå¯èƒ½ä¼šè§¦å‘æŠ¢å ã€‚  åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé›†ç¾¤è°ƒåº¦å™¨å°†å°è¯•æŠŠä¸æŠ¢å çš„GPUç›¸åŒçš„GPUåˆ†é…ç»™å¼¹æ€§ä½œä¸šã€‚ å½“åˆ†é…è¶…æ—¶æ—¶ï¼ŒEasyScaleä½œä¸šä¼šå›è½åˆ°åˆ©ç”¨å®ƒç›®å‰æ‹¥æœ‰çš„å¯ç”¨GPUã€‚        Implementation   DLT ä½œä¸šåœ¨å…·æœ‰ EasyScale å®ç°çš„ Docker å®¹å™¨ä¸­è¿è¡Œã€‚\n åœ¨ Kubernetes ä¸Šå®ç°äº†ä¸€ä¸ªåŸå‹è‡ªå®šä¹‰é›†ç¾¤è°ƒåº¦å™¨ä»¥è¿›è¡Œè¯„ä¼°ã€‚ EasyScale åœ¨æˆ‘ä»¬å†…éƒ¨çš„ GPU é›†ç¾¤è°ƒåº¦å™¨ä¸­å¾—åˆ°äº†å……åˆ†çš„å®ç°ï¼Œå®ƒæ˜¯ Kubernetes è°ƒåº¦å™¨çš„ä¸€ä¸ªä¼˜åŒ–ç‰ˆæœ¬ï¼Œå¯ä»¥ä¸ºæ—¥å¸¸çš„ GPU ç”Ÿäº§ä»»åŠ¡æä¾›æœåŠ¡ã€‚    DL æ¡†æ¶ä¸­ EasyScale çš„å®ç°ä¸ PyTorch 1.8 LTS å…¼å®¹ã€‚\n å®ƒéœ€è¦å¤§çº¦1,200è¡Œ Python ä»£ç å’Œ2,000è¡Œ PyTorch ä¸­çš„ C + + ä¿®æ”¹ä»£ç ï¼Œä»¥åŠä¸€ä¸ªåŸºäº PyTorch å®ç°çš„æ’ä»¶åº“ã€‚ PyTorch æ¡†æ¶çš„ C + + å®ç°åŒ…æ‹¬ä¸€ä¸ªæ”¯æŒå¼¹æ€§çš„åˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œé€šä¿¡åº“ ElasticDDPï¼Œå®ƒå¯ä»¥æ”¯æŒå¤šä¸ª EasyScaleThread ä¹‹é—´çš„é€šä¿¡ï¼Œä»¥å…¨é¢å‡å°‘æ¢¯åº¦ï¼Œå¹¶åœ¨è§¦å‘èµ„æºå¼¹æ€§æ—¶åœ¨é‡æ–°å¯åŠ¨ä»»åŠ¡æ—¶å§‹ç»ˆå¦‚ä¸€åœ°æ„å»ºé€šä¿¡æ¡¶ã€‚ æ‰§è¡Œæµæ§åˆ¶å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ä½œä¸º PyTorch çš„é™„åŠ ç»„ä»¶åœ¨ Python æ¨¡å—ä¸­å®ç°ã€‚    å®ç°äº† AIMaster\n ä¸ºäº†å†³å®šè´Ÿè½½å¹³è¡¡åˆ†é…å¹¶æ§åˆ¶ä½œä¸šä»¥ä½¿ç”¨æ›´å¤šçš„ GPU è¿›è¡Œæ‰©å±• ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ã€‚  é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ª rpc åº“æ”¶é›† EasyScale è¿è¡Œæ—¶æŠ¥å‘Šçš„æ€§èƒ½åˆ†æã€‚ å…¶æ¬¡ï¼Œæˆ‘ä»¬æå‡ºèµ„æºå»ºè®®å¹¶ç›‘è§†çŠ¶æ€ï¼Œä»è€Œé€šè¿‡ Kubernetes Python å‘Šå¯†è€…äº†è§£èµ„æºåˆ†é…è¶…æ—¶ã€‚ ç¬¬ä¸‰ï¼Œå®ç°ç­–ç•¥æ§åˆ¶å™¨æ¥è®¡ç®—å¢é‡èµ„æºè¯·æ±‚å¹¶å°†å…¶æäº¤ç»™é›†ç¾¤è°ƒåº¦å™¨ã€‚ä¸ºäº†æ”¯æŒèµ„æºå¼¹æ€§æ—¶çš„æŒç»­å·¥ä½œåŸ¹è®­ï¼Œæˆ‘ä»¬é‡‡ç”¨æŒ‰éœ€æ£€æŸ¥ç‚¹è®°å½•ç”¨æˆ·å®šä¹‰çš„æ¨¡å‹ï¼Œæ—¶ä»£å’Œå°æ‰¹é‡çŠ¶æ€ä»¥åŠåŸºæœ¬ä¸Šä¸‹æ–‡åˆ‡æ¢çŠ¶æ€      ä¸€ä¸ªåŠè‡ªåŠ¨å‰–æå·¥å…·æ¥æ‰§è¡Œå¼ é‡ä¹‹é—´çš„æŒ‰ä½æ¯”è¾ƒ\n ä»è€Œæ‰¾åˆ°è¿ç®—ç¬¦ä¸ä¸€è‡´çš„ç»“æœï¼Œè¯†åˆ«èµ„æºå¼¹æ€§ä¸­ä¸ç¡®å®šæ€§çš„æ¥æºã€‚    ","date":"2022-11-09T15:09:23+08:00","image":"https://cdn.jsdelivr.net/gh/Tweakzx/ImageHost@main/img/202211091510408.png","permalink":"https://tweakzx.github.io/p/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0easyscale%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/","title":"ã€è®ºæ–‡ç¬”è®°ã€‘EasyScaleè®ºæ–‡é˜…è¯»ç¬”è®°"},{"content":"Gandiva è®ºæ–‡é˜…è¯»ç¬”è®° Abstract   Gandiva: ä¸€ä¸ªé›†ç¾¤è°ƒåº¦æ¡†æ¶ï¼Œä½¿ç”¨ç‰¹å®šé¢†åŸŸçŸ¥è¯†ï¼Œä¼˜åŒ–äº†GPUé›†ç¾¤è®­ç»ƒæ·±åº¦å­¦ä¹ æ¨¡å‹çš„å»¶è¿Ÿä¸æ•ˆç‡\n  æ·±åº¦å­¦ä¹ jobçš„ç‰¹å¾\n 1ï¼‰åé¦ˆé©±åŠ¨çš„æ¢ç´¢ï¼š  ä¸€ä¸ªç”¨æˆ·ç»å¸¸è¿è¡Œä¸€ç»„ä½œä¸š(æˆ– a multi-job)æ¥è·å¾—ç‰¹å®šä»»åŠ¡çš„æœ€ä½³ç»“æœ å¹¶ä½¿ç”¨å…³äºå‡†ç¡®æ€§çš„æ—©æœŸåé¦ˆæ¥åŠ¨æ€ä¼˜å…ˆè€ƒè™‘æˆ–æ€æ­»ä¸€ä¸ªä½œä¸šå­é›† åŒæ­¥å‘ç”Ÿçš„å¤šä¸ªä½œä¸šçš„æ—©æœŸåé¦ˆæ˜¯è‡³å…³é‡è¦çš„   2ï¼‰æ·±åº¦å­¦ä¹ å·¥ä½œåœ¨èµ„æºä½¿ç”¨æ–¹é¢çš„å¼‚æ„ï¼Œè¿™ä½¿å¾—å®ƒå¾ˆéš¾å®ç°æœ€é€‚åˆçš„å…ˆéªŒã€‚ 3ï¼‰ä½œä¸šå†…å¯é¢„æµ‹æ€§ï¼šå› ä¸ºä½œä¸šä¼šé‡å¤æ‰§è¡Œå«åšmini-batchçš„è¿­ä»£  Gandivaåˆ©ç”¨è¿™ä¸ªç‰¹å¾è§£å†³äº†1ï¼‰2ï¼‰ä¸¤ä¸ªé—®é¢˜ åˆ©ç”¨å¯é¢„æµ‹æ€§å¯¹GPUè¿›è¡Œå¤šä¸ªjobé—´è¿›è¡Œæ—¶åˆ†å¤ç”¨ï¼Œ è¿™æä¾›äº†ä½å»¶è¿Ÿ è¿™ç§é¢„æµ‹æ€§è¿˜å¯ä»¥ç”¨äºå†…çœjobæ€§èƒ½å¹¶åŠ¨æ€è¿ç§»åˆ°æœ€åˆé€‚çš„GPUä¸Šï¼Œæé«˜äº†é›†ç¾¤æ•ˆç‡      æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªåŸå‹å®ç°å’Œå¾®åŸºå‡†æµ‹è¯•è¡¨æ˜\n Gandiva å¯ä»¥åœ¨æ·±åº¦å­¦ä¹ è¿‡ç¨‹åŠ å¿«è¶…å‚æ•°æœç´¢ä¸€ä¸ªæ•°é‡çº§ å¹¶é€šè¿‡é€æ˜è¿ç§»å’Œjobæ—¶åˆ†å®ç°æ›´å¥½çš„åˆ©ç”¨ï¼Œä½¿jobä¸èµ„æºçš„æ›´å¥½åœ°åŒ¹é…ã€‚ åœ¨ä¸€ä¸ªè¿è¡Œåœ¨180-GPU é›†ç¾¤ä¸­çš„å®é™…å·¥ä½œè´Ÿè½½ä¸­ï¼ŒGandiva å°†é›†ç¾¤çš„æ€»åˆ©ç”¨ç‡æé«˜äº†26% è¿™ä¸ºæ·±åº¦å­¦ä¹ æä¾›äº†ä¸€ç§ç®¡ç†å¤§å‹ GPU é›†ç¾¤çš„æ–°æ–¹æ³•ã€‚    Introduction   DLT jobçš„ç‰¹å¾\n  åé¦ˆé©±åŠ¨\n  è¶…å‚æ•°æœç´¢ï¼š\n ç”¨æˆ·é€šå¸¸ä¼šå°è¯•ä¸€ä¸ªä½œä¸šçš„å‡ ä¸ªé…ç½®ï¼ˆa multi-jobï¼‰ï¼Œå¹¶åˆ©ç”¨è¿™äº›ä½œä¸šçš„æ—©æœŸåé¦ˆæ¥å†³å®šæ˜¯å¦ä¼˜å…ˆå¤„ç†æˆ–æ€æ­»å…¶ä¸­çš„ä¸€äº›å­é›†ã€‚     ä¼ ç»Ÿçš„è°ƒåº¦å™¨è¿è¡Œä¸€ä¸ªå·¥ä½œå­é›†ï¼Œ å®Œæˆå‰å…¶ä»–å·¥ä½œæ’é˜Ÿ\n è¿™ç§æ¨¡å¼ä¸é€‚åˆmulti-jobsï¼Œå› ä¸ºa multi-jobä¸­çš„æ‰€æœ‰å·¥ä½œéœ€è¦åŒæ—¶å¾—åˆ°æ—©æœŸåé¦ˆã€‚ å¦å¤–ï¼Œä¼´éšç€multi-jobsï¼Œå…¶ä»–å·²ç»ç¡®å®šäº†æ­£ç¡®çš„è¶…å‚æ•°çš„DLTä½œä¸šï¼Œè¿è¡Œäº†å‡ ä¸ªå°æ—¶åˆ°å‡ å¤©ï¼Œå¯¼è‡´äº†è¡Œå¤´é˜»å¡ï¼Œå› ä¸ºé•¿æœŸè¿è¡Œçš„ä½œä¸šå¯¹GPUæ‹¥æœ‰ç‹¬å®¶è®¿é—®æƒï¼Œç›´åˆ°å®Œæˆï¼Œè€Œå–å†³äºæ—©æœŸåé¦ˆçš„å¤šä½œä¸šåˆ™åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚ é•¿çš„æ’é˜Ÿæ—¶é—´è¿«ä½¿ç”¨æˆ·è¦ä¹ˆä½¿ç”¨é¢„ç•™çš„GPUï¼Œè¦ä¹ˆè¦æ±‚é›†ç¾¤è¶…é¢é…ç½®ï¼Œä»è€Œé™ä½é›†ç¾¤æ•ˆç‡ã€‚     å¼‚æ„\n Jobsä¹‹é—´çš„å›ºæœ‰å·®å¼‚  æ˜¾å­˜ä½¿ç”¨ æ ¸ä½¿ç”¨ å¸¦å®½æ•æ„Ÿæ€§ jobä¹‹é—´çš„å¹²æ‰°     ä¼ ç»Ÿè°ƒåº¦å™¨å°†jobè§†ä½œé»‘ç®±ï¼Œæ— æ³•å–å¾—æœ€ä¼˜çš„é›†ç¾¤æ•ˆç‡\n   ä½œä¸šå†…å¯é¢„æµ‹\n    Gandiva\n Gandivaåˆ©ç”¨å¯é¢„æµ‹æ€§æ¥æ‰§è¡Œå‰–æé©±åŠ¨çš„è‡ªçœã€‚  å®ƒä½¿ç”¨å°æ‰¹é‡çš„è¿›åº¦ç‡æ¥ä¸æ–­åçœå…¶å†³ç­–ï¼Œä»¥æé«˜é›†ç¾¤æ•ˆç‡ã€‚ ä¾‹å¦‚ï¼Œåªæœ‰åœ¨å†…å­˜å’ŒGPUåˆ©ç”¨ç‡è¾ƒä½æ—¶ï¼Œå®ƒæ‰ä¼šå°†å¤šä¸ªä½œä¸šè£…ç®±åœ¨åŒä¸€ä¸ªGPUä¸Š å®ƒåŠ¨æ€åœ°å°†é€šä¿¡å¯†é›†å‹ä½œä¸šè¿ç§»åˆ°æ›´å¤šçš„äº²å’ŒåŠ›å¼ºçš„GPUä¸Š å®ƒè¿˜ä¼šé€‚æ—¶åœ° \u0026ldquo;å¢é•¿ \u0026ldquo;ä½œä¸šçš„å¹¶è¡Œç¨‹åº¦ï¼Œä»¥åˆ©ç”¨ç©ºé—²èµ„æºï¼Œå¹¶åœ¨ç©ºé—²èµ„æºæ¶ˆå¤±åç¼©å°ä½œä¸šã€‚ æˆ‘ä»¬ç›®å‰å®æ–½çš„è‡ªçœç­–ç•¥æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„è¯•é”™ç­–ç•¥ï¼Œå®ƒæ˜¯å¯è¡Œçš„ï¼Œå› ä¸ºå®ƒçš„é¢„æµ‹èƒ½åŠ›å¾ˆå¼ºã€‚   Gandivaé™¤äº†ç‰¹å®šçš„å†…çœæ ¸è°ƒåº¦ç­–ç•¥ï¼Œè¿˜æä¾›äº†ä¸€äº›API APIï¼šï¼ˆaï¼‰é«˜æ•ˆçš„æŒ‚èµ·æ¢å¤æˆ–æ—¶é—´åˆ‡ç‰‡ï¼Œï¼ˆbï¼‰ä½å»¶è¿Ÿè¿ç§»ï¼Œï¼ˆcï¼‰ç»†ç²’åº¦ç›‘æ§ï¼Œï¼ˆdï¼‰å¼¹æ€§ï¼Œä»¥åŠï¼ˆeï¼‰åŠ¨æ€ä¼˜å…ˆçº§ã€‚  è¿™äº›åŸè¯­é«˜æ•ˆçš„å…³é”®æ˜¯Gandivaçš„ååŒè®¾è®¡ï¼šè·¨è¶Šè°ƒåº¦å™¨å±‚ä¸DLTå·¥å…·åŒ…å±‚ï¼ˆå¦‚pytorchï¼Œ tensorflow)   é€šè¿‡åˆ©ç”¨GPUé›†ç¾¤çš„ä¸“ç”¨æ€§ï¼ŒGandivaä¸ºæ·±åº¦å­¦ä¹ çš„ç‰¹å®šå·¥ä½œè´Ÿè½½å®šåˆ¶äº†è°ƒåº¦å™¨ï¼Œä»è€Œä¸ºè°ƒåº¦å™¨æä¾›äº†å¯¹å·¥ä½œçš„æ›´å¤šå¯è§æ€§å’Œæ§åˆ¶ï¼ŒåŒæ—¶ä»ç„¶å®ç°äº†å¯¹ä»»æ„DLTå·¥ä½œçš„é€šç”¨æ€§ã€‚ Gandivaçš„å®ç°  ä¿®æ”¹ä¸¤ä¸ªæµè¡Œçš„æ¡†æ¶ PyTorch å’Œ Tensorflow ï¼Œä¸ºè°ƒåº¦ç¨‹åºæä¾›å¿…è¦çš„æ–°åŸè¯­ å¹¶åœ¨ Kubernetes å’Œ Docker å®¹å™¨ä¹‹ä¸Šå®ç°äº†ä¸€ä¸ªåˆå§‹è°ƒåº¦ç­–ç•¥ç®¡ç†å™¨      æœ¬æ–‡è´¡çŒ®\n æˆ‘ä»¬è¯´æ˜äº†æ·±åº¦å­¦ä¹ å·¥ä½œæµç¨‹çš„å„ç§ç‹¬ç‰¹ç‰¹å¾ï¼Œå¹¶å°†å…¶æ˜ å°„åˆ°é›†ç¾¤è°ƒåº¦æ‰€éœ€çš„å…·ä½“è¦æ±‚ã€‚ æˆ‘ä»¬ç¡®å®šäº†DLTä½œä¸šè°ƒåº¦ç­–ç•¥å¯ä»¥ä½¿ç”¨çš„é€šç”¨åŸè¯­ï¼Œå¹¶æä¾›äº†åº”ç”¨æ„ŸçŸ¥æŠ€æœ¯ï¼Œé€šè¿‡åˆ©ç”¨DLç‰¹æœ‰çš„ä½œä¸šå†…å‘¨æœŸæ€§çŸ¥è¯†ï¼Œä½¿æ—¶é—´åˆ‡å‰²å’Œè¿ç§»ç­‰åŸè¯­çš„æ•ˆç‡æé«˜äº†ä¸€ä¸ªæ•°é‡çº§ï¼Œä»è€Œå˜å¾—å®ç”¨ã€‚ æˆ‘ä»¬æå‡ºå¹¶è¯„ä¼°äº†ä¸€ä¸ªæ–°çš„è‡ªçœå¼è°ƒåº¦æ¡†æ¶ï¼Œè¯¥æ¡†æ¶åˆ©ç”¨DLTå·¥ä½œçš„ç‰¹å®šé¢†åŸŸçŸ¥è¯†æ¥ä¸æ–­å®Œå–„å…¶è°ƒåº¦å†³ç­–ï¼Œä»è€Œæ˜¾è‘—æ”¹å–„æ—©æœŸåé¦ˆæ—¶é—´å¹¶æä¾›é«˜é›†ç¾¤æ•ˆç‡ã€‚    Backgroud   åé¦ˆé©±åŠ¨çš„æ¢ç´¢ã€‚\n å®ç°é«˜ç²¾ç¡®åº¦çš„ä¸€ä¸ªå‰ææ¡ä»¶æ˜¯æ¨¡å‹çš„é€‰æ‹©ã€‚æ–°æ¨¡å‹çš„å‘ç°ï¼Œå¦‚ResNetæˆ–Inceptionï¼Œå¦‚ä»Šå¤§å¤šæ˜¯ä¸€ä¸ªè¯•é”™çš„è¿‡ç¨‹ï¼Œå°½ç®¡ä½¿ä¹‹è‡ªåŠ¨åŒ–çš„æ–¹æ³•æ˜¯ä¸€ä¸ªæ´»è·ƒçš„ç ”ç©¶é¢†åŸŸã€‚ é™¤äº†æ¨¡å‹ç»“æ„å¤–ï¼Œè¿˜æœ‰ä¸€äº›å‚æ•°ï¼Œç§°ä¸ºè¶…å‚æ•°ï¼Œä¹Ÿéœ€è¦ä½œä¸ºDLTå·¥ä½œçš„ä¸€éƒ¨åˆ†è¢«æŒ‡å®šã€‚è¶…å‚æ•°åŒ…æ‹¬æ¨¡å‹ä¸­çš„å±‚æ•°/æƒé‡ã€æœ€å°æ‰¹é‡å¤§å°ã€å­¦ä¹ ç‡ç­‰ã€‚è¿™äº›å‚æ•°é€šå¸¸ç”±ç”¨æˆ·æ ¹æ®é¢†åŸŸçŸ¥è¯†å’Œè¯•é”™æ¥é€‰æ‹©ï¼Œæœ‰æ—¶ç”šè‡³ä¼šå¯¼è‡´æ—©æœŸè®­ç»ƒå¤±è´¥ã€‚ å› æ­¤ï¼ŒDLTå·¥ä½œçš„æ—©æœŸåé¦ˆæ˜¯è‡³å…³é‡è¦çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨è®­ç»ƒçš„åˆå§‹é˜¶æ®µã€‚    multi-job\n  ä¸€æ—¦ç”¨æˆ·ç¡®å®šäº†è¦è¿›ä¸€æ­¥æ¢ç´¢çš„ç‰¹å®šæ¨¡å‹ï¼Œç”¨æˆ·é€šå¸¸ä¼šè¿›è¡Œè¶…å‚æ•°æœç´¢ä»¥æé«˜ä»»åŠ¡çš„å‡†ç¡®æ€§ã€‚\n  è¿™å¯ä»¥åœ¨è¶…å‚æ•°ç©ºé—´ä¸Šä½¿ç”¨å„ç§æœç´¢æŠ€æœ¯æ¥å®Œæˆï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·ç”Ÿæˆå¤šä¸ªDLTä»»åŠ¡æˆ–å¤šä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡ä½¿ç”¨ä¸€ç»„è¶…å‚æ•°æˆ–é…ç½®è¿›è¡Œå…¨é¢è®­ç»ƒã€‚ç”±äºç”¨æˆ·é€šå¸¸ä¼šæ¢ç´¢æ•°ç™¾ä¸ªè¿™æ ·çš„é…ç½®ï¼Œè¿™ä¸ªè¿‡ç¨‹åœ¨è®¡ç®—ä¸Šæ˜¯å¾ˆæ˜‚è´µçš„ã€‚\n  å› æ­¤ï¼Œæ–‡çŒ®ä¸­å‡ºç°äº†å¤æ‚ç‰ˆæœ¬çš„è¶…å‚æ•°æœç´¢ï¼Œå¦‚HyperOptå’ŒHyperbandã€‚\n ä¾‹å¦‚ï¼ŒHyperbandæœ€åˆå¯èƒ½ä¼šäº§ç”Ÿ128ä¸ªDLTä½œä¸šï¼Œå¹¶åœ¨æ¯ä¸€è½®ï¼ˆä¾‹å¦‚100ä¸ªå°æ‰¹é‡è¿­ä»£ï¼‰ä¸­ï¼Œæ€æ­»ä¸€åŠç²¾åº¦æœ€ä½çš„ä½œä¸šã€‚\n   åŒæ ·ï¼Œå¯¹äºè¿™äº›ç®—æ³•æ¥è¯´ï¼Œå¯¹æ•´ä¸ªä½œä¸šé›†çš„æ—©æœŸåé¦ˆæ˜¯è‡³å…³é‡è¦çš„ï¼Œå› ä¸ºå¦åˆ™ä»–ä»¬å°†æ— æ³•åšå‡ºæœ‰æ•ˆçš„è®­ç»ƒå†³å®šã€‚\n    DLT jobçš„ç‰¹å¾ å¯¹ä½ç½®ï¼ˆlocality)æ•æ„Ÿ  å¤šGPU DLTå·¥ä½œçš„æ€§èƒ½å–å†³äºåˆ†é…çš„GPUçš„äº²å’ŒåŠ›ã€‚  ä¸åŒçš„DLTå·¥ä½œå¯¹GPUé—´çš„äº²å’ŒåŠ›è¡¨ç°å‡ºä¸åŒç¨‹åº¦çš„æ•æ„Ÿæ€§ã€‚ å³ä½¿æ˜¯åŒä¸€å°æœºå™¨ä¸Šçš„GPUï¼Œç”±äºä¸å¯¹ç§°çš„æ¶æ„ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ä¸åŒç¨‹åº¦çš„GPUä¹‹é—´çš„äº²å’ŒåŠ›  ä¸¤ä¸ªGPUå¯èƒ½ä½äºä¸åŒçš„CPUæ’æ§½ï¼ˆè¡¨ç¤ºä¸ºDiffSocketï¼‰ åœ¨åŒä¸€ä¸ªCPUæ’æ§½ï¼Œä½†åœ¨ä¸åŒçš„PCIe Switchï¼ˆè¡¨ç¤ºä¸ºSameSocketï¼‰ åœ¨åŒä¸€ä¸ªPCIe Switchï¼ˆè¡¨ç¤ºä¸ºSamePCIeSwï¼‰      \rimage-20221108193230029\r\n å›¾1æ˜¾ç¤ºäº†ä¸¤ä¸ªæ¨¡å‹VGG16[44]å’ŒResNet-50[24]å¯¹æœåŠ¡å™¨å†…å®šä½çš„ä¸åŒæ•æ„Ÿæ€§ã€‚  å½“ä½¿ç”¨Tensorflowçš„ä¸¤ä¸ªP100 GPUè¿›è¡Œè®­ç»ƒæ—¶ï¼ŒVGG16åœ¨ä¸è‰¯å®šä½ä¸‹å—åˆ°å¾ˆå¤§å½±å“ã€‚ åœ¨æœ€å·®çš„å®šä½ä¸‹ï¼Œå½“ä¸¤ä¸ªGPUä½äºä¸åŒçš„CPUæ’åº§ä¸Šæ—¶ï¼ŒVGG16åªå®ç°äº†æœ€ä½³å®šä½é…ç½®çš„60%ï¼Œå³ä¸¤ä¸ªGPUè¢«æ”¾ç½®åœ¨åŒä¸€ä¸ªPCIeå¼€å…³ä¸‹ã€‚ å¦ä¸€æ–¹é¢ï¼Œåœ¨è¿™ç§è®¾ç½®ä¸‹ï¼ŒResNet-50ä¸å—GPUå®šä½çš„å½±å“ã€‚è¿™æ˜¯å› ä¸ºVGG16æ˜¯ä¸€ä¸ªæ¯”ResNet-50æ›´å¤§çš„ç¥ç»æ¨¡å‹ï¼Œå› æ­¤åœ¨æ¯ä¸ªå°æ‰¹æ¬¡ä¸­çš„æ¨¡å‹åŒæ­¥ä¼šåœ¨åº•å±‚PCIeæ€»çº¿ä¸Šäº§ç”Ÿæ›´é«˜çš„é€šä¿¡è´Ÿè·ã€‚   æˆ‘ä»¬åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­è§‚å¯Ÿåˆ°ç±»ä¼¼çš„è¶‹åŠ¿ã€‚å›¾2æ˜¾ç¤ºäº†ä¸€ä¸ª4GPU Tensorflowä½œä¸šçš„æ€§èƒ½ï¼Œå®ƒä»¥ä¸åŒçš„æœåŠ¡å™¨é—´å®šä½è¿è¡Œï¼Œè®­ç»ƒResNet-50å’ŒInceptionV3[46]æ¨¡å‹ã€‚  å³ä½¿æ˜¯ç”¨40G InfiniBandç½‘ç»œäº’è¿ï¼Œå½“ä½œä¸šè¢«åˆ†é…åˆ°4ä¸ªGPUæ—¶ï¼Œæ€§èƒ½å·®å¼‚æ˜æ˜¾ï¼Œ  å…¶ä¸­å®ƒä»¬å‡åŒ€åœ°åˆ†æ•£åœ¨4å°æœåŠ¡å™¨ï¼ˆè¡¨ç¤ºä¸º4*1-GPUï¼‰ 2å°æœåŠ¡å™¨ï¼ˆè¡¨ç¤ºä¸º2*2-GPUï¼‰ ä»¥åŠå…¨éƒ¨åœ¨ä¸€å°æœåŠ¡å™¨ï¼ˆè¡¨ç¤ºä¸ºæœ¬åœ°4GPUï¼‰ å°½ç®¡ä¸¤ä¸ªæ¨¡å‹å¯¹ä½ç½®æ€§çš„æ•æ„Ÿæ€§ä¸åŒã€‚     å› æ­¤ï¼ŒDLTè°ƒåº¦å™¨åœ¨åˆ†é…GPUæ—¶å¿…é¡»è€ƒè™‘åˆ°ä½œä¸šå¯¹ä½ç½®çš„æ•æ„Ÿæ€§ã€‚  å¯¹å¹²æ‰°æ•æ„Ÿ  å½“åœ¨ä¸€ä¸ªå…±äº«çš„æ‰§è¡Œç¯å¢ƒä¸­è¿è¡Œæ—¶ï¼ŒDLTå·¥ä½œå¯èƒ½ä¼šå› ä¸ºèµ„æºäº‰å¤ºè€Œç›¸äº’å¹²æ‰°ã€‚æˆ‘ä»¬å†æ¬¡è§‚å¯Ÿåˆ°ï¼Œä¸åŒçš„DLTå·¥ä½œè¡¨ç°å‡ºä¸åŒç¨‹åº¦çš„å¹²æ‰°ã€‚  \rimage-20221108193107517\r\n  å³ä½¿å¯¹äºå•GPUä½œä¸šï¼Œä¹Ÿå­˜åœ¨å¹²æ‰°ã€‚\n å›¾3æ˜¾ç¤ºäº†: å½“æŠŠä¸€ä¸ªè¯­è¨€æ¨¡å‹ä½œä¸šï¼ˆæ ‡è®°ä¸ºLMï¼‰ä¸å¦ä¸€ä¸ªä½œä¸šæ”¾åœ¨åŒä¸€ä¸ªPCI-eäº¤æ¢æœºä¸‹æ—¶ï¼Œç”±äºæœåŠ¡å™¨å†…çš„å¹²æ‰°è€Œå¯¼è‡´çš„æ€§èƒ½ä¸‹é™æƒ…å†µã€‚  å½“ä¸¤ä¸ªLMä¸€èµ·è¿è¡Œæ—¶ï¼Œä¸¤ä¸ªä½œä¸šéƒ½ä¼šé­å—19%çš„å‡é€Ÿã€‚ ç„¶è€Œï¼ŒResNet-50å¹¶æ²¡æœ‰å—åˆ°GPUä¸LMå…±å¤„çš„å½±å“ã€‚ ç¥ç»æœºå™¨ç¿»è¯‘ï¼ˆGNMTï¼‰[51]å¯¹LMçš„å¹²æ‰°ç¨‹åº¦ä¸å¤§ã€‚ åŒæ ·åœ°ï¼Œæˆ‘ä»¬ä¹Ÿè§‚å¯Ÿåˆ°ä¸åŒç±»å‹çš„è®­ç»ƒæ¨¡å‹å¯¹å¤šGPUè®­ç»ƒçš„ä¸åŒç¨‹åº¦çš„å¹²æ‰°ã€‚      å›¾4æ˜¾ç¤ºäº†ç”¨40G InfiniBandç½‘ç»œè¿æ¥çš„ä¸¤ä¸ª4GPUæœåŠ¡å™¨ä¸Šçš„æœåŠ¡å™¨é—´å¹²æ‰°ã€‚\n å½“è¿è¡Œå¤šä¸ª2-GPUä½œä¸šæ—¶ï¼Œæ¯ä¸ªGPUè¢«æ”¾åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œ  ResNet-50æ˜¾ç¤ºå‡ºé«˜è¾¾47%çš„å‡é€Ÿï¼Œ InceptionV3æ˜¾ç¤ºå‡º30%çš„å‡é€Ÿï¼Œ è€ŒDeepSpeech[23]ä»…æ˜¾ç¤ºå‡º5%çš„å‡é€Ÿã€‚      æ€»ä¹‹ï¼Œä¸åŒåº”ç”¨é¢†åŸŸçš„æµè¡Œæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå¦‚è§†è§‰ã€è¯­è¨€å’Œè¯­éŸ³ï¼Œè¡¨ç°å‡ºå¯¹ä½ç½®æ€§å’Œå¹²æ‰°çš„ä¸åŒç¨‹åº¦çš„æ•æ„Ÿæ€§ã€‚ä¸ºäº†è¿åˆè¿™äº›æŒ‘æˆ˜ï¼ŒGandivaåˆ©ç”¨äº†DLTå·¥ä½œçš„ä¸€ä¸ªå…³é”®ç‰¹å¾ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥ä¼šè¯¦ç»†è¯´æ˜ã€‚\n  jobå†…å¯é¢„æµ‹æ€§ \rimage-20221108193308480\r\n ä¸€ä¸ªDLTä½œä¸šåŒ…æ‹¬è®¸å¤šå°æ‰¹é‡çš„è¿­ä»£ï¼Œ å‘ˆç°å¯¹åº”çš„å‘¨æœŸæ€§ã€‚  å›¾5(a)æ˜¾ç¤ºäº†åœ¨å››ä¸ªK80 GPUä¸Šä½¿ç”¨ResNet-50æ¨¡å‹å¯¹ImageNetæ•°æ®è¿›è¡Œè®­ç»ƒçš„20så¿«ç…§æœŸé—´ä½¿ç”¨çš„GPUæ€»å†…å­˜ã€‚  æ‰€ä½¿ç”¨çš„GPUå†…å­˜æ˜æ˜¾éµå¾ªä¸€ä¸ªå‘¨æœŸæ€§æ¨¡å¼ã€‚ æ¯ä¸ªå‘¨æœŸéƒ½å¯¹åº”ç€ä¸€ä¸ªå°æ‰¹æ¬¡çš„å¤„ç†ï¼ˆå¤§çº¦1.5sï¼‰ï¼Œå†…å­˜åœ¨å‰å‘ä¼ é€’ä¸­å¢åŠ ï¼Œåœ¨åå‘ä¼ é€’ä¸­å‡å°‘ã€‚ ä½¿ç”¨çš„æœ€å¤§å’Œæœ€å°çš„GPUå†…å­˜åˆ†åˆ«ä¸º23GBå’Œ0.3GBï¼Œæˆ–77å€çš„ç³»æ•°ã€‚ è¿™ä¸ªæ¯”ä¾‹éšç€è¿·ä½ æ‰¹å¤„ç†é‡çš„å¢åŠ è€Œæ‰©å¤§ï¼ˆé€šå¸¸åœ¨16åˆ°256ä¹‹é—´ï¼›æœ¬ä¾‹ä¸­ä¸º128ï¼‰ã€‚   å›¾5(b)æ˜¾ç¤ºäº†åœ¨ä¸€ä¸ªK80 GPUä¸Šä½¿ç”¨GNMTæ¨¡å‹æ—¶ï¼Œå¯¹WMT'14è‹±è¯­å¾·è¯­æ•°æ®é›†è¿›è¡Œè®­ç»ƒçš„20så¿«ç…§æ‰€ä½¿ç”¨çš„GPUæ€»å†…å­˜ã€‚  è™½ç„¶å°æ‰¹é‡è¿­ä»£ä¸ImageNetçš„ä¾‹å­ä¸å®Œå…¨ç›¸åŒï¼ˆç”±äºä¸åŒçš„å¥å­é•¿åº¦å’ŒPyTorchä¸­ä½¿ç”¨çš„åŠ¨æ€å›¾ï¼‰ï¼Œä½†è¯¥å›¾å…·æœ‰ç±»ä¼¼çš„å¾ªç¯æ€§è´¨ã€‚ æœ€å¤§å€¼å’Œæœ€å°å€¼ä¹‹é—´çš„å·®å¼‚è¾ƒå°ï¼ˆ3å€ï¼‰ï¼Œä¸»è¦æ˜¯ç”±äºè¾ƒå¤§çš„æ¨¡å‹ï¼ˆ0.4GBï¼‰å’Œè¾ƒå°çš„è¿·ä½ æ‰¹æ¬¡å¤§å°ï¼ˆæœ¬ä¾‹ä¸­ä¸º16ï¼‰ã€‚   é™¤äº†è¿™é‡Œæ˜¾ç¤ºçš„å›¾åƒå’Œè¯­è¨€æ¨¡å‹å¤–ï¼Œå…¶ä»–è®­ç»ƒé¢†åŸŸï¼Œå¦‚è¯­éŸ³ã€ç”Ÿæˆå¼é€†å‘ç½‘ç»œï¼ˆGANï¼‰å’Œå˜å¼‚è‡ªåŠ¨ç¼–ç å™¨éƒ½éµå¾ªç±»ä¼¼çš„å¾ªç¯æ¨¡å¼ï¼ˆç”±äºç©ºé—´é™åˆ¶æ²¡æœ‰æ˜¾ç¤ºï¼‰ï¼Œå› ä¸ºè®­ç»ƒçš„æ ¸å¿ƒæ˜¯æ¢¯åº¦ä¸‹é™ç®—æ³•ï¼Œæ‰§è¡Œè®¸å¤šå°æ‰¹é‡è¿­ä»£ã€‚   å……åˆ†åˆ©ç”¨å¯é¢„æµ‹æ€§ã€‚  é¦–å…ˆï¼Œä¸€ä¸ªDLTä½œä¸šå¯ä»¥è¢«è‡ªåŠ¨åˆ†å‰²æˆå°æ‰¹é‡çš„è¿­ä»£ï¼Œè¿™äº›è¿­ä»£åœ¨60ç§’å†…çš„é›†åˆï¼Œä¾‹å¦‚ä¸€ä¸ªå¾®ä»»åŠ¡ï¼Œå½¢æˆä¸€ä¸ªè°ƒåº¦é—´éš”ã€‚ ç¬¬äºŒï¼Œé€šè¿‡åœ¨å†…å­˜å‘¨æœŸçš„æœ€å°å€¼ä¸Šæ‰§è¡Œæš‚åœæ“ä½œï¼Œå¯ä»¥å¤§å¤§å‡å°‘ä»GPUå¤åˆ¶åˆ°CPUä¸­çš„å†…å­˜é‡ï¼Œä»è€Œä½¿æš‚åœ/æ¢å¤å’Œè¿ç§»çš„æ•ˆç‡æ¯”naiveçš„å®ç°è¦é«˜ä¸€ä¸ªæ•°é‡çº§ã€‚ ç¬¬ä¸‰ï¼Œå¯ä»¥å¯¹å°æ‰¹é‡çš„è¿›åº¦è¿›è¡Œåˆ†æï¼Œå¹¶å°†å…¶ä½œä¸ºè¯„ä¼°è£…ç®±æˆ–è¿ç§»ç­‰æœºåˆ¶çš„æœ‰æ•ˆæ€§çš„ä»£ç†ã€‚    è®¾è®¡ \rimage-20221108193438681\r\n å¦‚ä»Šçš„é›†ç¾¤ä¸­å‡ºç°é«˜å»¶è¿Ÿå’Œä½åˆ©ç”¨ç‡çš„é—®é¢˜  æ˜¯å› ä¸ºDLTä½œä¸šè¢«ä¸“é—¨åˆ†é…äº†ä¸€ç»„å›ºå®šçš„GPUã€‚ ç‹¬å è®¿é—® GPU çš„åŸå› è¡Œå¤´é˜»å¡ï¼Œé˜»å¡äº†æ—©æœŸåé¦ˆï¼Œå¯¼è‡´ä½œä¸šçš„æ’é˜Ÿæ—¶é—´è¿‡é•¿ã€‚ å½“ä½œä¸šæ— æ³•å®Œå…¨åˆ©ç”¨å…¶åˆ†é…çš„GPUæ—¶ï¼Œå¯¹ä¸€ç»„å›ºå®šçš„GPUçš„ç‹¬å®¶è®¿é—®ä¹Ÿä¼šå¯¼è‡´GPUçš„ä½åˆ©ç”¨ç‡ã€‚    æœºåˆ¶  ä¸‰ç§æ–¹å¼æ¶ˆé™¤GPUå¯¹DLTä½œä¸šçš„æ’ä»–æ€§å’Œå›ºå®šåˆ†é…æ¥è§£å†³ä½æ•ˆç‡é—®é¢˜  é¦–å…ˆï¼Œåœ¨è¿‡è½½æœŸé—´ï¼ŒGandivaå…è®¸åæ¥çš„å·¥ä½œä¸ç°æœ‰çš„å·¥ä½œå…±äº«GPU  è€Œä¸æ˜¯ç­‰å¾…å½“å‰å·¥ä½œçš„ç¦»å¼€ã€‚ è¿™æ˜¯ä¸ºDLTä½œä¸šå®šåˆ¶çš„æŒ‚èµ·-é‡å¯æœºåˆ¶å’Œé€‰æ‹©æ€§è£…ç®±è€Œå®ç°çš„ã€‚   ç¬¬äºŒï¼ŒGandivaæ”¯æŒDLTä½œä¸šä»ä¸€ç»„GPUåˆ°å¦ä¸€ç»„çš„é«˜æ•ˆè¿ç§»  è¿ç§»å…è®¸æ—¶é—´ç¢ç‰‡åŒ–çš„ä½œä¸šè¿ç§»åˆ°å…¶ä»–ï¼ˆæœ€è¿‘ç©ºå‡ºçš„ï¼‰GPUä¸Š æˆ–è€…å¯¹é›†ç¾¤è¿›è¡Œå»ç¢ç‰‡åŒ–å¤„ç†ï¼Œä»è€Œä½¿åæ¥çš„ä½œä¸šè¢«åˆ†é…åˆ°å…·æœ‰è‰¯å¥½ä½ç½®æ€§çš„GPUä¸Šã€‚   ç¬¬ä¸‰ï¼ŒGandivaæ”¯æŒGPUå¢é•¿-ç¼©å‡æœºåˆ¶  è¿™æ ·ç©ºé—²çš„GPUå°±å¯ä»¥é€‚æ—¶åœ°è¢«ä½¿ç”¨ã€‚ ä¸ºäº†æœ‰æ•ˆåœ°æ”¯æŒè¿™äº›æœºåˆ¶å¹¶å®ç°æœ‰æ•ˆçš„èµ„æºç®¡ç†ï¼ŒGandivaé€šè¿‡ä¸æ–­åœ°å‰–æDLTä½œä¸šçš„èµ„æºä½¿ç”¨æƒ…å†µå¹¶ä¼°è®¡å…¶æ€§èƒ½ï¼Œå¯¹DLTä½œä¸šè¿›è¡Œå†…çœã€‚      æŒ‚èµ·-é‡å¯ä¸è£…ç®±   Suspend-resume\n æŒ‚èµ·-é‡å¯æ˜¯Gandivaç”¨æ¥æ¶ˆé™¤ä¸€ç»„GPUå¯¹DLTä½œä¸šçš„ç‹¬å æ€§çš„ä¸€ç§æœºåˆ¶ã€‚  Gandivaåˆ©ç”¨è¿™ç§æœºåˆ¶ï¼Œå¢åŠ äº†å¯¹GPUæ—¶é—´åˆ†å‰²çš„è‡ªå®šä¹‰æ”¯æŒã€‚   Gandivaçš„å…³é”®æ€æƒ³æ˜¯åˆ©ç”¨è¿™ç§å‘¨æœŸæ€§è¡Œä¸ºï¼Œåœ¨DLTä½œä¸šçš„GPUæ˜¾å­˜ä½¿ç”¨é‡æœ€ä½æ—¶æš‚åœ-æ¢å¤ã€‚  1ï¼‰å‘å‡ºæš‚åœè°ƒç”¨ 2ï¼‰DLTå·¥å…·åŒ…ä¼šç­‰åˆ°å†…å­˜ä½¿ç”¨å‘¨æœŸçš„æœ€å°å€¼ï¼Œå°†å­˜å‚¨åœ¨GPUä¸­çš„å¯¹è±¡å¤åˆ¶åˆ°CPUï¼Œé‡Šæ”¾å…¶æ‰€æœ‰GPUå†…å­˜åˆ†é…ï¼ˆåŒ…æ‹¬ç¼“å­˜ï¼‰ 3ï¼‰ç„¶åè°ƒç”¨ç»å…¸çš„CPUæš‚åœæœºåˆ¶ 4ï¼‰ä¹‹åï¼Œå½“CPUæ¢å¤å·¥ä½œæ—¶ï¼ŒDLTæ¡†æ¶é¦–å…ˆåˆ†é…é€‚å½“çš„GPUå†…å­˜ï¼Œå°†å­˜å‚¨çš„å¯¹è±¡å¤åˆ¶å›GPUï¼Œç„¶åæ¢å¤å·¥ä½œã€‚   Suspend-resumeä¹Ÿå¯ä»¥åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸­å¯åŠ¨GPUçš„æ›´æ¢  è™½ç„¶æ›´æ¢GPUçš„æˆæœ¬å¾ˆé«˜ï¼Œä½†æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªå»¶è¿Ÿä»å…³é”®è·¯å¾„ä¸­éšè—  å…¸å‹çš„å›¾åƒåˆ†ç±»å·¥ä½œï¼Œæš‚åœ-æ¢å¤ä¸€èµ·å¯ä»¥åœ¨100mså†…å®Œæˆ è€Œå¯¹äºå¤§å‹è¯­è¨€ç¿»è¯‘å·¥ä½œï¼Œæš‚åœ-æ¢å¤å¯èƒ½éœ€è¦1s   è€ƒè™‘åˆ°1åˆ†é’Ÿçš„æ—¶é—´åˆ‡åˆ†é—´éš”ï¼Œè¿™ç›¸å½“äº2%æˆ–æ›´å°‘çš„å¼€é”€   å»¶è¿Ÿ  Gandivaä¸­çš„suspendå¯èƒ½æœ€å¤šå»¶è¿ŸDLTä½œä¸šçš„ä¸€ä¸ªå°æ‰¹æ¬¡é—´éš” å€¼å¾—  ç”±äºå‡å°‘äº†GPU-CPUçš„å¤åˆ¶æˆæœ¬å’Œæ›´å°‘çš„CPUä½¿ç”¨çš„å†…å­˜ï¼Œå®ƒçš„å¼€é”€æ˜æ˜¾å‡å°‘ åœ¨è¿™ä¸ªå»¶è¿ŸæœŸé—´è¿˜å®Œæˆäº†æœ‰ç”¨çš„å·¥ä½œã€‚   è°ƒåº¦å™¨è·Ÿè¸ªè¿™ä¸€å»¶è¿Ÿï¼Œå¹¶ç›¸åº”åœ°è°ƒæ•´æ—¶é—´åˆ†å‰²çš„é—´éš”ï¼Œä»¥å®ç°å…¬å¹³æ€§      è£…ç®±\n æš‚åœ-æ¢å¤çš„å¦ä¸€ç§æ–¹æ³•æ˜¯è£…ç®±  åœ¨ä¸€ä¸ªGPUä¸ŠåŒæ—¶è¿è¡Œå¤šä¸ªDLTä½œä¸šï¼Œè®©GPUåˆ†æ‹…ä½œä¸šçš„æ—¶é—´ã€‚   æœ‰æ•ˆæ€§  åªæœ‰å½“è£…ç®±çš„ä½œä¸šä¸è¶…è¿‡GPUçš„èµ„æºï¼Œå¹¶ä¸”ä¸ä¼šå¯¹å½¼æ­¤äº§ç”Ÿä¸åˆ©å½±å“æ—¶ï¼ŒGPUä¸­çš„è£…ç®±æ‰æ˜¯æœ‰æ•ˆçš„ã€‚ å¦‚æœä½œä¸šç›¸äº’å¹²æ‰°ï¼Œè£…ç®±å°±ä¼šæ¯”æš‚åœ-æ¢å¤å·®å¾ˆå¤šã€‚   è£…ç®±çš„ä½¿ç”¨  å½“DLTä½œä¸šæœ‰æ’ä»–æ€§çš„è®¿é—®æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨Profilingæ¥ç›‘æµ‹å®ƒä»¬çš„èµ„æºå’Œè¿›åº¦ å¦‚æœä¸¤ä¸ªä½œä¸šè¢«ç¡®å®šä¸ºè£…ç®±çš„å€™é€‰è€…ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒä»¬è£…ç®±åœ¨ä¸€èµ·ï¼Œå¹¶ç»§ç»­ç›‘æ§å®ƒä»¬ å¦‚æœç»™å®šçš„è£…ç®±ç»“æœå¯¹ä½œä¸šçš„æ€§èƒ½äº§ç”Ÿäº†ä¸åˆ©å½±å“ï¼Œæˆ‘ä»¬å°±è§£é™¤è¿™äº›ä½œä¸šçš„è£…ç®±å¹¶æ¢å¤åˆ°æš‚åœ-æ¢å¤çŠ¶æ€      è¿ç§»  è¿ç§»æ˜¯Gandivaç”¨æ¥æ”¹å˜åˆ†é…ç»™DLTä½œä¸šçš„GPUé›†çš„æœºåˆ¶ã€‚  è¿ç§»åœ¨å‡ ç§æƒ…å†µä¸‹æ˜¯æœ‰ç”¨çš„  iï¼‰å°†æ—¶é—´åˆ†å‰²çš„ä½œä¸šç§»åˆ°é›†ç¾¤ä¸­ä»»ä½•åœ°æ–¹çš„ç©ºé—²GPUä¸Š iiï¼‰å°†ç›¸äº’å¹²æ‰°çš„ä½œä¸šç§»å¼€ iiiï¼‰å¯¹é›†ç¾¤è¿›è¡Œå»ç¢ç‰‡åŒ–å¤„ç†ï¼Œä½¿è¿›å…¥çš„ä½œä¸šè·å¾—å…·æœ‰è‰¯å¥½ä½ç½®æ€§çš„GPU   æˆ‘ä»¬è¯„ä¼°äº†ä¸¤ç§è§£å†³DLTè¿›ç¨‹çŠ¶æ€è¿ç§»çš„æ–¹æ³•ã€‚  åœ¨ç¬¬ä¸€ç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨ä¸€ä¸ªé€šç”¨çš„è¿›ç¨‹è¿ç§»æœºåˆ¶ï¼Œå¦‚CRIUã€‚  CRIUæœ¬èº«ä¸æ”¯æŒä½¿ç”¨GPUè®¾å¤‡çš„è¿›ç¨‹è¿ç§»  æˆ‘ä»¬é¦–å…ˆå¯¹GPUå¯¹è±¡è¿›è¡Œæ£€æŸ¥ è°ƒç”¨CRIUä¹‹å‰ä»è¿›ç¨‹ä¸­åˆ é™¤æ‰€æœ‰GPUçŠ¶æ€   å› ä¸ºCRIUæ£€æŸ¥ç‚¹å’Œæ¢å¤æ•´ä¸ªè¿›ç¨‹çš„å†…å­˜  å¯¹äºè¿™äº›ä½¿ç”¨PyTorchçš„DLTä½œä¸šæ¥è¯´ï¼Œæ£€æŸ¥ç‚¹çš„å¤§å°æ˜¯GBçº§åˆ«çš„ã€‚ å¯¹äºå•GPUä½œä¸šæ¥è¯´ï¼Œæ‰€äº§ç”Ÿçš„è¿ç§»å¼€é”€çº¦ä¸º810sï¼Œå¯¹äºå¤šGPUä½œä¸šæ¥è¯´åˆ™æ›´é«˜ã€‚     æˆ‘ä»¬è€ƒè™‘çš„ç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨å…·æœ‰æ£€æŸ¥ç‚¹æ„è¯†çš„DLTä½œä¸šã€‚  Tensorflowç­‰DLTæ¡†æ¶å·²ç»æ”¯æŒå…è®¸è‡ªåŠ¨æ£€æŸ¥ç‚¹å’Œæ¢å¤æ¨¡å‹çš„API é€šè¿‡åœ¨è¿ç§»å‰å¯¹ç›®çš„åœ°è¿›è¡Œé¢„çƒ­ï¼Œå¹¶ä¸”åªè¿ç§»å¿…è¦çš„è®­ç»ƒçŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥é™ä½è¿ç§»å¼€é”€å°åˆ°ä¸€ä¸¤ç§’     æ— è®ºé‡‡ç”¨å“ªç§æ–¹æ³•ï¼Œæˆ‘ä»¬å‘ç°ï¼Œä¸å®ƒåœ¨æé«˜GPUæ€»ä½“åˆ©ç”¨ç‡æ–¹é¢æä¾›çš„å¥½å¤„ç›¸æ¯”ï¼ŒæœåŠ¡å™¨é—´è¿ç§»çš„å¼€é”€æ˜¯å€¼å¾—çš„    å¢é•¿ä¸æ”¶ç¼©  Gandivaç”¨æ¥æ¶ˆé™¤GPUå¯¹DLTä½œä¸šçš„æ’ä»–æ€§çš„ç¬¬ä¸‰ä¸ªæœºåˆ¶æ˜¯å¢é•¿-æ”¶ç¼©ã€‚  è¿™ç§æœºåˆ¶ä¸»è¦é’ˆå¯¹é›†ç¾¤å¯èƒ½æ²¡æœ‰è¢«å®Œå…¨åˆ©ç”¨çš„æƒ…å†µ åŸºæœ¬æ€æƒ³  åœ¨ç©ºé—²æ—¶é—´å†…ï¼Œé€‚æ—¶åœ°å¢åŠ å¯ç”¨äºä½œä¸šçš„GPUæ•°é‡ åœ¨è´Ÿè½½å¢åŠ æ—¶ç›¸åº”åœ°å‡å°‘å¯ç”¨çš„GPUæ•°é‡   è®¸å¤šDLTå·¥ä½œï¼Œç‰¹åˆ«æ˜¯åœ¨å›¾åƒé¢†åŸŸï¼Œéšç€GPUæ•°é‡çš„å¢åŠ ï¼Œä¼šçœ‹åˆ°çº¿æ€§çš„æ€§èƒ½æ‰©å±•ã€‚  Gandivaåªå¯¹é‚£äº›ç‰¹åˆ«å£°æ˜ä»–ä»¬æœ‰è¶³å¤Ÿçš„é€‚åº”æ€§æ¥åˆ©ç”¨è¿™äº›å¢é•¿æœºä¼šçš„DLTå·¥ä½œåº”ç”¨è¿™ä¸€æœºåˆ¶ã€‚ å½“å¤šä¸ªDLTå·¥ä½œç¬¦åˆè¿™ä¸€æ ‡å‡†æ—¶ï¼ŒGandivaä½¿ç”¨Profilingæ¥ä¼°è®¡æ¯ä¸ªå·¥ä½œçš„è¿›åº¦ï¼Œç„¶åç›¸åº”åœ°åˆ†é…GPUã€‚      Profiling  Gandivaç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ  å¦‚CPUå’ŒGPUåˆ©ç”¨ç‡ï¼ŒCPU/GPUå†…å­˜ç­‰ã€‚ Gandivaçš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºï¼Œå®ƒè¿˜ä»¥ä¸€ç§åº”ç”¨æ„ŸçŸ¥çš„æ–¹å¼å†…çœ  åˆ©ç”¨äº†DLTä½œä¸šè¡¨ç°å‡ºçš„è§„å¾‹å†…çœ åˆ©ç”¨å‘¨æœŸæ€§ä»¥ä¼°è®¡DLTè¿›åº¦   Gandivaä¼°è®¡DLTä½œä¸šçš„mini_batchæ—¶é—´  å³å¯¹ä¸€æ‰¹è¾“å…¥æ•°æ®åšä¸€æ¬¡å‰å‘/åå‘ä¼ é€’çš„æ—¶é—´ï¼Œä½œä¸ºGPUå†…å­˜ä½¿ç”¨å‘¨æœŸçš„ä¸¤ä¸ªæœ€å°å€¼ä¹‹é—´çš„æ—¶é—´ ç”±äºDLTä½œä¸šåœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­é€šå¸¸ä¼šæ‰§è¡Œæ•°ç™¾ä¸‡æ¬¡è¿™æ ·çš„å°æ‰¹é‡æ“ä½œï¼Œè°ƒåº¦å™¨ä¼šåœ¨è°ƒåº¦å†³ç­–ä¹‹å‰å’Œä¹‹åæ¯”è¾ƒDLTçš„mini_batchæ—¶é—´ä»¥ç¡®å®šå…¶æœ‰æ•ˆæ€§ã€‚   Gandivaå¯ä»¥å†³å®šè£…ç®±æ˜¯å¦æœ‰æ•ˆ  é€šè¿‡æ¯”è¾ƒè£…ç®±å‰åä¸¤ä¸ªDLTä½œä¸šçš„å°æ‰¹é‡æ—¶é—´ å¦‚æœæ²¡æœ‰è¿™æ ·çš„å‰–æï¼Œä¸ºäº†åšå‡ºè£…ç®±çš„å†³å®š  äººä»¬ä¸ä»…è¦å¯¹ä¸¤ä¸ªDLTä½œä¸šåœ¨ä¸åŒGPUä¸Šçš„æ€§èƒ½è¿›è¡Œå»ºæ¨¡ï¼Œ è¿˜è¦å¯¹å®ƒä»¬å¯èƒ½ç›¸äº’å¹²æ‰°çš„å„ç§æ–¹å¼è¿›è¡Œå»ºæ¨¡ï¼ˆä¾‹å¦‚ï¼Œç¼“å­˜ã€å†…å­˜å¸¦å®½ç­‰ï¼‰ è¿™ä¸æ˜¯ä¸€é¡¹ç®€å•çš„ä»»åŠ¡        è°ƒåº¦åŸåˆ™   å®šä¹‰ï¼šåœ¨æˆ‘ä»¬æè¿°è°ƒåº¦å™¨çš„ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€äº›æœ¯è¯­ã€‚\n DLTä½œä¸š  è¢«å°è£…åœ¨å®¹å™¨ä¸­, åŒ…æ‹¬  æ‰€éœ€çš„GPUæ•°é‡ ä¼˜å…ˆçº§ï¼ˆå¯ä»¥æ˜¯åŠ¨æ€çš„ ï¼‰ ä¸€ä¸ªæŒ‡ç¤ºä½œä¸šæ˜¯å¦èƒ½å¤Ÿå¢é•¿-æ”¶ç¼©çš„æ ‡å¿—   æˆ‘ä»¬å‡è®¾ä¸€ä¸ªä½œä¸šæ‰€è¦æ±‚çš„GPUæ•°é‡æ˜¯2çš„å¹‚ã€‚   é›†ç¾¤  ä¸€ä¸ªé›†ç¾¤ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ç»„æˆ æ¯ä¸ªæœåŠ¡å™¨æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªGPU æˆ‘ä»¬å‡è®¾ä¸€ä¸ªä¸“é—¨çš„GPUé›†ç¾¤ç”¨äºDLTå·¥ä½œ   æœåŠ¡å™¨çš„é«˜åº¦  å®šä¹‰ä¸ºâŒˆM/N]ï¼Œ å…¶ä¸­Mæ˜¯åˆ†é…çš„GPUæ•°é‡ï¼ŒNæ˜¯æ€»GPUçš„æ•°é‡ã€‚ åªæœ‰å½“æœåŠ¡å™¨çš„é«˜åº¦è¶…è¿‡1æ—¶ï¼Œæ‰ä¼šä½¿ç”¨æš‚åœ/æ¢å¤æœºåˆ¶ã€‚   é›†ç¾¤çš„é«˜åº¦  è¢«å®šä¹‰ä¸ºå…¶æ‰€æœ‰æœåŠ¡å™¨çš„æœ€å¤§é«˜åº¦ã€‚ å½“é›†ç¾¤çš„é«˜åº¦å¤§äº1æ—¶ï¼Œå°±ä¼šå‡ºç°è¿‡è½½ï¼›å³æ‰€æœ‰ä½œä¸šçš„è¯·æ±‚/åˆ†é…çš„GPUä¹‹å’Œå¤§äºGPUçš„æ€»æ•°ã€‚   æœåŠ¡å™¨çš„äº²å’ŒåŠ›  è¢«å®šä¹‰ä¸ºåˆ†é…ç»™è¯¥æœåŠ¡å™¨çš„ä½œä¸šç±»å‹ã€‚ ä¾‹å¦‚ï¼Œæœ€åˆæœåŠ¡å™¨çš„äº²å’ŒåŠ›ä¸ºé›¶ï¼Œå¦‚æœä¸€ä¸ªéœ€è¦ä¸¤ä¸ªGPUçš„ä½œä¸šè¢«åˆ†é…åˆ°ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆè¯¥æœåŠ¡å™¨çš„äº²å’ŒåŠ›å°±ä¼šå˜æˆä¸¤ä¸ªã€‚ è¿™ä¸ªå‚æ•°è¢«è°ƒåº¦å™¨ç”¨æ¥å°†å…·æœ‰ç±»ä¼¼GPUéœ€æ±‚çš„ä½œä¸šåˆ†é…åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šã€‚      ç›®æ ‡\n Gandivaè°ƒåº¦å™¨çš„ä¸»è¦è®¾è®¡ç›®æ ‡æ˜¯ä¸ºä½œä¸šæä¾›æ—©æœŸåé¦ˆã€‚  åœ¨æµè¡Œçš„è°ƒåº¦å™¨ä¸­ï¼Œä½œä¸šåœ¨è¿‡è½½æœŸé—´ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚ Gandivaé€šè¿‡ç«‹å³ä¸ºæ–°ä½œä¸šåˆ†é…GPUå¹¶ä½¿ç”¨suspend-resumeæœºåˆ¶æä¾›æ—©æœŸç»“æœæ¥æ”¯æŒè¶…é¢è®¢é˜…ã€‚   ç¬¬äºŒä¸ªè®¾è®¡ç›®æ ‡æ˜¯é›†ç¾¤æ•ˆç‡ã€‚  é€šè¿‡ä¸€ä¸ªæŒç»­çš„ä¼˜åŒ–è¿‡ç¨‹æ¥å®ç°ï¼Œè¯¥è¿‡ç¨‹ä½¿ç”¨äº†å‰–æå’Œè´ªå©ªçš„å¯å‘å¼ï¼Œåˆ©ç”¨äº†è¯¸å¦‚è£…ç®±ã€è¿ç§»å’Œå¢é•¿-æ”¶ç¼©ç­‰æœºåˆ¶ã€‚   é›†ç¾¤çº§çš„å…¬å¹³æ€§ä¸æ˜¯Gandivaçš„è®¾è®¡ç›®æ ‡ã€‚  åªå…³æ³¨ä½¿ç”¨æš‚åœ-æ¢å¤æœºåˆ¶åœ¨æ¯ä¸ªæœåŠ¡å™¨ä¸Šæä¾›ä½œä¸šä¹‹é—´çš„å…¬å¹³æ€§ é›†ç¾¤çº§çš„å…¬å¹³æ€§ç•™ç»™æœªæ¥å·¥ä½œ   ä¸ºäº†å®ç°è¿™äº›ç›®æ ‡ï¼ŒGandivaè°ƒåº¦å™¨ä»¥ä¸¤ç§æ¨¡å¼è¿è¡Œï¼š  å“åº”æ¨¡å¼ï¼šè°ƒåº¦å™¨å¯¹è¯¸å¦‚å·¥ä½œåˆ°è¾¾ã€ç¦»å¼€ã€æœºå™¨æ•…éšœç­‰äº‹ä»¶åšå‡ºååº” å†…çœæ¨¡å¼ï¼š ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œè¿‡ç¨‹ä¸­ï¼Œè°ƒåº¦å™¨çš„ç›®æ ‡æ˜¯æé«˜é›†ç¾¤çš„åˆ©ç”¨ç‡å’Œä½œä¸šå®Œæˆæ—¶é—´ è¯·æ³¨æ„ï¼Œè°ƒåº¦å™¨å¯ä»¥åŒæ—¶åœ¨ä¸¤ç§æ¨¡å¼ä¸‹è¿è¡Œã€‚      å“åº”æ¨¡å¼ å“åº”æ¨¡å¼è¢«è®¾è®¡ç”¨æ¥å¤„ç†è¯¸å¦‚å·¥ä½œåˆ°è¾¾ã€ç¦»å¼€å’Œæœºå™¨æ•…éšœçš„äº‹ä»¶\n\rimage-20221108220646915\r\nå½“ä¸€ä¸ªæ–°çš„ä½œä¸šåˆ°è¾¾æ—¶ï¼Œè°ƒåº¦å™¨ä¸ºè¯¥ä½œä¸šåˆ†é…æœåŠ¡å™¨/GPUã€‚\n  Gandivaä½¿ç”¨çš„èŠ‚ç‚¹åˆ†é…ç­–ç•¥å¦‚ç®—æ³•1æ‰€ç¤ºã€‚\n findNodesæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè¿”å›æ»¡è¶³ä½œä¸šè¯·æ±‚çš„èŠ‚ç‚¹å€™é€‰è€…ï¼Œå¹¶æœ‰ä¸€ä¸ªäº²å’ŒåŠ›çº¦æŸçš„å¯é€‰å‚æ•°ã€‚ æœ€åˆï¼ŒGandivaè¯•å›¾æ‰¾åˆ°ä¸æ–°å·¥ä½œå…·æœ‰ç›¸åŒäº²å’ŒåŠ›çš„èŠ‚ç‚¹ï¼Œå¹¶åœ¨è¿™äº›èŠ‚ç‚¹ä¸­æ‰¾åˆ°å…·æœ‰æœ€å°è´Ÿè½½çš„èŠ‚ç‚¹ã€‚å¦‚æœå­˜åœ¨è¿™æ ·çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”å®ƒä»¬çš„é«˜åº¦å°äº1ï¼ˆç¬¬5-6è¡Œï¼‰ï¼Œè¯¥èŠ‚ç‚¹å°†è¢«åˆ†é…ã€‚ å¦åˆ™ï¼ŒGandivaè¯•å›¾æ‰¾åˆ°å¹¶åˆ†é…æœªäº²å’Œçš„èŠ‚ç‚¹ï¼ˆç¬¬7-8è¡Œï¼‰ã€‚ å¦‚æœæ²¡æœ‰è¿™æ ·çš„ç©ºé—²æœåŠ¡å™¨ï¼Œç¬¬ä¸‰ä¸ªé€‰æ‹©æ˜¯å¯»æ‰¾æœ‰ç©ºé—²GPUçš„èŠ‚ç‚¹ï¼ŒåŒæ—¶å¿½ç•¥äº²å’ŒåŠ›ï¼ˆç¬¬9-10è¡Œï¼‰ã€‚ è¿™å¯èƒ½ä¼šå¯¼è‡´å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´çš„ç¢ç‰‡åŒ–åˆ†é…ï¼Œä½†æ­£å¦‚æˆ‘ä»¬å°†åœ¨åé¢çœ‹åˆ°çš„ï¼Œè¿ç§»å¯ä»¥ç”¨äºç¢ç‰‡åŒ–ã€‚å¦‚æœä¸Šè¿°æ–¹æ³•éƒ½ä¸å¥æ•ˆï¼Œè¿™æ„å‘³ç€é›†ç¾¤ä¸­æ²¡æœ‰å¯ç”¨çš„GPUã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå­˜åœ¨å…·æœ‰ç›¸åŒäº²å’ŒåŠ›çš„èŠ‚ç‚¹ï¼Œå®ƒä»¬å°†è¢«ç”¨äºæš‚åœ-æ¢å¤ï¼ˆç¬¬11-12è¡Œï¼‰ï¼› å¦‚æœæ²¡æœ‰ï¼Œä½œä¸šå°†è¢«æ’é˜Ÿï¼ˆç¬¬13-14è¡Œï¼‰ã€‚    æ”¾ç½®job\n   ä¼ ç»Ÿçš„è°ƒåº¦å™¨å°†ä½¿ç”¨ä½œä¸šç¦»å¼€æ¥è§¦å‘ä»ç­‰å¾…é˜Ÿåˆ—ä¸­æŒ‘é€‰ä¸‹ä¸€ä¸ªä½œä¸šã€‚\n   Gandivaæ£€æŸ¥é›†ç¾¤çš„é«˜åº¦æ˜¯å¦å¯ä»¥å‡å°‘\n å°†è¢«æš‚åœçš„ä½œä¸šè¿ç§»åˆ°æ–°çš„ç©ºé—²GPUä¸Š è¿™ä¸ªä½œä¸šå¯èƒ½æ¥è‡ªåŒä¸€å°æœåŠ¡å™¨æˆ–é›†ç¾¤ä¸­çš„ä»»ä½•å…¶ä»–æœåŠ¡å™¨ã€‚ ä½œä¸šçš„ç¦»å¼€ä¹Ÿå¯ä»¥è§¦å‘è¿ç§»ï¼Œä»¥æ”¹å–„ä½ç½®æ€§      Gandivaçš„å·¥ä½œå®‰æ’Policyæ—¶è€ƒè™‘åˆ°äº†ä¸¤ä¸ªå› ç´ ã€‚\n Gandivaå…è®¸è¶…é¢è®¤è´­ã€‚  å½“ä¸€ä¸ªæœåŠ¡å™¨è¢«è¶…é¢è®¤è´­æ—¶ï¼Œæˆ‘ä»¬ä¼šè¿›è¡ŒåŠ æƒè½®æµè°ƒåº¦ï¼Œç»™æ¯ä¸ªä½œä¸šå…¬å¹³çš„æ—¶é—´ä»½é¢ã€‚   GPUåˆ†é…ä¸æ˜¯ä½œä¸šåˆ°è¾¾æ—¶çš„ä¸€æ¬¡æ€§äº‹ä»¶ï¼ŒGandivaä½¿ç”¨è‡ªçœæ¨¡å¼æ¥æŒç»­æ”¹å–„é›†ç¾¤çš„åˆ©ç”¨ç‡ã€‚  å› æ­¤ï¼ŒGandivaä¾é ä¸€ä¸ªç®€å•çš„ä½œä¸šå®‰ç½®ç­–ç•¥æ¥å¿«é€Ÿåˆ†é…GPUèµ„æºç»™æ–°ä½œä¸šï¼Œä»è€Œå®ç°æ—©æœŸåé¦ˆã€‚      å†…çœæ¨¡å¼ åœ¨è‡ªçœæ¨¡å¼ä¸‹ï¼ŒGandivaæŒç»­ç›‘æ§å¹¶ä¼˜åŒ–ä½œä¸šåœ¨é›†ç¾¤ä¸­çš„GPUä¸Šçš„ä½ç½®ï¼Œä»¥æé«˜DLTä½œä¸šçš„æ•´ä½“åˆ©ç”¨ç‡å’Œå®Œæˆæ—¶é—´ã€‚\n  è£…ç®±\n åªæœ‰åœ¨è¿‡è½½æ—¶æ‰ä¼šè€ƒè™‘è£…ç®±ã€‚  åŸºæœ¬æ€æƒ³ï¼šåœ¨GPUä¸ŠåŒæ—¶è¿è¡Œä¸¤ä¸ªæˆ–å¤šä¸ªä½œä¸šä»¥æé«˜æ•ˆç‡ã€‚ å¯èƒ½æ— æ•ˆ  å¦‚æœè£…ç®±å·¥ä½œçš„å†…å­˜éœ€æ±‚åŠ èµ·æ¥é«˜äºGPUçš„å†…å­˜ï¼Œé‚£ä¹ˆä»CPUå†…å­˜ä¸­ \u0026ldquo;åˆ†é¡µ \u0026ldquo;çš„å¼€é”€å°±ä¼šå¾ˆé«˜ï¼Œè£…ç®±å°±æ²¡æœ‰æ•ˆæœã€‚ å½“ä¸¤ä¸ªæˆ–æ›´å¤šä½œä¸šçš„å†…å­˜éœ€æ±‚å°äºGPUå†…å­˜æ—¶ï¼Œè£…ç®±ä»ç„¶å¯èƒ½ä¸æ¯”æš‚åœ-æ¢å¤æ›´æœ‰æ•ˆã€‚     é‰´äºDLTä½œä¸šçš„å¼‚è´¨æ€§ï¼Œå¯¹è£…ç®±çš„æ€§èƒ½è¿›è¡Œåˆ†æå»ºæ¨¡æ˜¯ä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„é—®é¢˜ã€‚  ç›¸åï¼ŒGandivaä¾é ä¸€ç§è´ªå©ªçš„å¯å‘å¼æ–¹æ³•æ¥è£…ç®±jobã€‚  å½“jobåˆ°è¾¾æ—¶ï¼Œæˆ‘ä»¬æ€»æ˜¯ä½¿ç”¨æš‚åœ-æ¢å¤çš„ç‹¬å æ¨¡å¼è¿è¡Œå®ƒä»¬ï¼Œå¹¶æ”¶é›†å‰–æä¿¡æ¯ï¼ˆGPUåˆ©ç”¨ç‡ã€å†…å­˜å’Œä½œä¸šè¿›å±•ç‡ï¼‰ã€‚ åŸºäºå‰–ææ•°æ®ï¼Œè°ƒåº¦å™¨ç»´æŠ¤ä¸€ä¸ªæŒ‰GPUåˆ©ç”¨ç‡æ’åºçš„ä½œä¸šåˆ—è¡¨ã€‚ è°ƒåº¦å™¨è´ªå©ªåœ°æŒ‘é€‰å‡ºGPUåˆ©ç”¨ç‡æœ€ä½çš„ä½œä¸šï¼Œå¹¶è¯•å›¾å°†å…¶è£…ç®±åˆ°å…·æœ‰æœ€ä½GPUåˆ©ç”¨ç‡çš„GPUä¸Šã€‚æˆ‘ä»¬åªåœ¨è£…ç®±ä½œä¸šçš„æ€»å†…å­˜åˆ©ç”¨ç‡ä¸è¶…è¿‡GPUçš„æ€»å†…å­˜æ—¶æ‰è¿™æ ·åšã€‚ å½“è£…ç®±ä½œä¸šçš„æ€»ååé‡å¤§äºæ—¶é—´åˆ‡å‰²æ—¶ï¼Œè£…ç®±è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚ å¦‚æœè£…ç®±ä¸æˆåŠŸï¼Œæˆ‘ä»¬å°±æ’¤æ¶ˆè£…ç®±ï¼Œå¹¶å°è¯•ä¸‹ä¸€ä¸ªåˆ©ç”¨ç‡æœ€ä½çš„GPUã€‚ å¦‚æœè£…ç®±æˆåŠŸï¼Œæˆ‘ä»¬æ‰¾åˆ°ä¸‹ä¸€ä¸ªåˆ©ç”¨ç‡è¾ƒä½çš„ä½œä¸šå¹¶é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚   æ ¹æ®æˆ‘ä»¬çš„è¯„ä¼°ï¼Œæˆ‘ä»¬å‘ç°è¿™ä¸ªç®€å•çš„è´ªå©ªçš„å¯å‘å¼æ–¹æ³•å®ç°äº†26%çš„æ•ˆç‡æå‡ã€‚      è¿ç§»\n GPUçš„ä½ç½®æ€§åœ¨ä¸€äº›ä½œä¸šçš„æ€§èƒ½ä¸­èµ·ç€é‡è¦ä½œç”¨ã€‚ åœ¨Gandivaä¸­  æ¯å½“ä½œä¸šç¦»å¼€æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šä½¿ç”¨è¿ç§»æ¥æ”¹å–„ä½ç½®æ€§ï¼Œ åŒæ—¶ä¹Ÿä½œä¸ºä¸€ä¸ªåå°è¿›ç¨‹æ¥ \u0026ldquo;æ•´ç† \u0026ldquo;é›†ç¾¤çš„å†…å®¹ã€‚ ä¸ºäº†æ”¹å–„ä½ç½®æ€§ï¼Œæˆ‘ä»¬æŒ‘é€‰é‚£äº›ä¸åœ¨åŒä¸€åœ°ç‚¹çš„ä½œä¸šï¼Œå¹¶è¯•å›¾æ‰¾åˆ°ä¸€ä¸ªæ–°çš„åŒä¸€åœ°ç‚¹çš„ä½ç½®ã€‚     \rimage-20221109111201868\r\n å›¾8å±•ç¤ºäº†ä¸€ä¸ªé›†ç¾¤å®éªŒçš„ä¾‹å­ï¼ˆç¬¬6.4èŠ‚ï¼‰ã€‚  å½“ä¸€ä¸ªæœ‰4ä¸ªä½œä¸šã€æ¯ä¸ªä½œä¸šéœ€è¦2ä¸ªGPUçš„å¤šä½œä¸šè¢«å®‰æ’æ—¶ï¼Œå®ƒçš„GPUäº²å’Œæ€§å¾ˆå·®ï¼›  åªæœ‰J0çš„ä¸¤ä¸ªGPUè¢«å®‰æ’åœ¨ä¸€èµ·ï¼Œè€Œå¤šä½œä¸šä¸­çš„å…¶ä»–3ä¸ªä½œä¸šï¼ˆJ1ã€J2å’ŒJ3ï¼‰è¢«åˆ†é…åˆ°ä¸åŒçš„GPUã€‚ ä¸‰åˆ†é’Ÿåï¼Œä¸€ä¸ªèƒŒæ™¯è®­ç»ƒä½œä¸šDeepSpeechå®Œæˆäº†ï¼Œå¹¶é‡Šæ”¾äº†å®ƒçš„8ä¸ªGPUã€‚ 8ä¸ªGPUä¸­çš„3ä¸ªï¼Œåœ¨å›¾8ä¸­æ ‡è®°ä¸ºDï¼Œä½äºä¸‰ä¸ªä¸åŒçš„æœåŠ¡å™¨ï¼ˆæœåŠ¡å™¨1ã€3å’Œ4ï¼‰ï¼Œå¯ä»¥æé«˜å¤šä»»åŠ¡çš„è®­ç»ƒæ•ˆç‡ã€‚ å› æ­¤ï¼ŒGandivaå¯åŠ¨äº†è¿ç§»è¿‡ç¨‹ï¼Œå°†J1ã€J2å’ŒJ3é‡æ–°å®‰ç½®åˆ°åŒåœ°çš„GPUã€‚        å»ç¢ç‰‡åŒ–  æˆ‘ä»¬åœ¨æ‰€æœ‰éç©ºé—²çš„æœåŠ¡å™¨ä¸­æŒ‘é€‰å‡ºæ‹¥æœ‰æœ€å¤šç©ºé—²GPUçš„æœåŠ¡å™¨ã€‚ ç„¶åæˆ‘ä»¬å°è¯•å°†è¿è¡Œåœ¨è¯¥æœåŠ¡å™¨ä¸Šçš„ä½œä¸šè¿ç§»åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šã€‚ åªè¦æ€§èƒ½æŸå¤±å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œä½œä¸šå°±ä¼šè¢«è¿ç§»åˆ°å¦ä¸€ä¸ªç©ºé—²GPUè¾ƒå°‘çš„æœåŠ¡å™¨ä¸Šã€‚ æˆ‘ä»¬é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æ¯å°éç©ºé—²æœåŠ¡å™¨ä¸Šçš„ç©ºé—²GPUæ•°é‡å°‘äºé˜ˆå€¼ï¼ˆåœ¨æˆ‘ä»¬çš„å®éªŒä¸­æ˜¯4ä¸ªä¸­çš„3ä¸ªï¼‰ï¼Œæˆ–è€…æ²¡æœ‰ä½œä¸šä¼šä»è¿ç§»ä¸­å—ç›Šã€‚      æ‰©ç¼©\n å¢é•¿-æ”¶ç¼©çš„æ¡ä»¶  é›†ç¾¤æœªè¢«å……åˆ†åˆ©ç”¨ DLTä½œä¸šæ˜ç¡®æŒ‡å‡ºè‡ªå·±å¯ä»¥è¿›è¡Œå¢é•¿-æ”¶ç¼©   é™åˆ¶  åœ¨æˆ‘ä»¬ç›®å‰çš„ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬åªè®©ä½œä¸šå¢é•¿åˆ°å•å°æœåŠ¡å™¨ä¸­å¯ç”¨çš„æœ€å¤§GPUæ•°é‡ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬åªåœ¨ç©ºé—²ä¸€æ®µæ—¶é—´åè§¦å‘å¢é•¿ï¼Œä»¥é¿å…æƒŠæ‰°ï¼Œ åœ¨æ–°ä½œä¸šå¯èƒ½éœ€è¦GPUæ—¶ç«‹å³æ”¶ç¼©ã€‚      æ—¶åˆ†\n æˆ‘ä»¬åœ¨æ¯ä¸ªæœåŠ¡å™¨ä¸­æ”¯æŒè½®å›è°ƒåº¦ï¼Œä»¥å…¬å¹³åœ°åˆ†äº«GPUã€‚ å½“ä½œä¸šæœ‰å¤šä¸ªä¼˜å…ˆçº§æ—¶ï¼Œè¾ƒé«˜ä¼˜å…ˆçº§çš„ä½œä¸šå°†ä¸ä¼šè¢«æš‚åœä»¥é€‚åº”è¾ƒä½ä¼˜å…ˆçº§çš„ä½œä¸šã€‚ å¦‚æœä¸€å°æœåŠ¡å™¨è¢«è¾ƒé«˜ä¼˜å…ˆçº§çš„ä½œä¸šå®Œå…¨åˆ©ç”¨ï¼Œå¦‚æœå¯è¡Œçš„è¯ï¼Œè¾ƒä½ä¼˜å…ˆçº§çš„ä½œä¸šå°†è¢«è¿ç§»åˆ°å¦ä¸€å°æœåŠ¡å™¨ã€‚    å®ç° DLTä½œä¸šè¢«å°è£…ä¸ºDockerå®¹å™¨ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬å®šåˆ¶çš„DLå·¥å…·ç®±å’ŒGandivaå®¢æˆ·ç«¯çš„ç‰ˆæœ¬ã€‚è¿™äº›å·¥ä½œè¢«æäº¤ç»™Kubernetesç³»ç»Ÿã€‚Gandivaè¿˜å®ç°äº†ä¸€ä¸ªå®šåˆ¶çš„è°ƒåº¦å™¨ï¼Œç„¶åå¯¹è¿™äº›ä½œä¸šè¿›è¡Œè°ƒåº¦ã€‚\nè°ƒåº¦å™¨   Gandivaç”±ä¸€ä¸ªå®šåˆ¶çš„ä¸­å¤®è°ƒåº¦å™¨å’Œä¸€ä¸ªå®¢æˆ·ç«¯ç»„ä»¶ç»„æˆï¼Œå®¢æˆ·ç«¯æ˜¯æ¯ä¸ªDLTå·¥ä½œå®¹å™¨çš„ä¸€éƒ¨åˆ†ã€‚\n  è°ƒåº¦å™¨åªæ˜¯å¦ä¸€ä¸ªç”±Kubernetesç®¡ç†çš„å®¹å™¨ã€‚\n Kubernetesè´Ÿè´£æ•´ä½“é›†ç¾¤ç®¡ç†ï¼Œ Gandivaè°ƒåº¦å™¨ç®¡ç†DLTä½œä¸šçš„è°ƒåº¦ã€‚ Gandivaè°ƒåº¦å™¨ä½¿ç”¨Kubernetes APIæ¥è·å–é›†ç¾¤èŠ‚ç‚¹å’Œå®¹å™¨ä¿¡æ¯ï¼Œæ¯å½“æäº¤ä¸€ä¸ªæ–°çš„å®¹å™¨æ—¶ï¼Œè°ƒåº¦å™¨ä¼šæ ¹æ®è°ƒåº¦ç­–ç•¥å°†å…¶åˆ†é…ç»™é›†ç¾¤ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªGPUã€‚    å½“ä¸€ä¸ªå®¹å™¨è¢«å®‰æ’åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ—¶\n æœ€åˆåªæœ‰Gandivaå®¢æˆ·ç«¯å¼€å§‹æ‰§è¡Œã€‚ ç„¶åï¼Œå®ƒè½®è¯¢Gandivaè°ƒåº¦å™¨ï¼Œä»¥ç¡®å®šå“ªäº›GPUå¯ç”¨äºDLTå·¥ä½œï¼Œ å¹¶ä½¿ç”¨æš‚åœ/æ¢å¤å’Œè¿ç§»å‘½ä»¤æ§åˆ¶DLTå·¥ä½œçš„æ‰§è¡Œã€‚    è™½ç„¶æˆ‘ä»¬é›†ç¾¤ä¸­æ‰€æœ‰GPUçš„è°ƒåº¦å®Œå…¨ç”±ä¸­å¤®è°ƒåº¦å™¨æ§åˆ¶ï¼Œä½†å¦‚æœå¼¹æ€§æˆä¸ºæˆ‘ä»¬å…³å¿ƒçš„é—®é¢˜ï¼Œå¯èƒ½éœ€è¦ä¸€ä¸ªåˆ†å±‚çš„æ–¹æ³•ã€‚\n  DLå·¥å…·çš„ä¿®æ”¹   PyTorchçš„æ—¶åˆ†ã€‚\n  å‘å‡ºSIGTSTPä¿¡ä¿¡å·\n Gandiva clientä¼šå‘å‡ºä¸€ä¸ªSIGTSTPä¿¡å·ï¼Œè¡¨ç¤ºå·¥å…·åŒ…å¿…é¡»æš‚åœè¿›ç¨‹ã€‚ å®ƒè¿˜æŒ‡ç¤ºæ¢å¤æ˜¯å¦åº”è¯¥é€šè¿‡å†…å­˜æ–‡ä»¶åœ¨æ–°çš„GPUä¸­å‘ç”Ÿã€‚ æ”¶åˆ°ä¿¡å·åï¼Œå·¥å…·åŒ…ä¼šè®¾ç½®ä¸€ä¸ªæš‚åœæ ‡å¿—ï¼Œå¹¶ä¸”åªåœ¨ä¸€ä¸ªå°æ‰¹å¤„ç†è¾¹ç•Œçš„æœ«ç«¯æ‰§è¡Œæš‚åœã€‚    è¯†åˆ«mini-batchè¾¹ç•Œ\n åœ¨Tensorflowè¿™ä¸ªå®šä¹‰å¹¶è¿è¡Œçš„å·¥å…·åŒ…ä¸­ï¼Œmini-batchçš„è¾¹ç•Œå¾ˆå®¹æ˜“è¯†åˆ«ï¼ˆsession.run()çš„ç»“æŸï¼‰ã€‚ åœ¨PyTorchè¿™ä¸ªé€ä¸€å®šä¹‰çš„å·¥å…·åŒ…ä¸­ï¼Œ  æˆ‘ä»¬é€šè¿‡è·Ÿè¸ªGPUå†…å­˜ä½¿ç”¨å‘¨æœŸæ¥ç¡®å®šmini-batchçš„è¾¹ç•Œï¼Œ è¿™æ˜¯PyTorchçš„GPUå†…å­˜ç®¡ç†å™¨ï¼ˆTHCCachingAllocatorï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œ æ¯å½“GPUå†…å­˜è¢«é‡Šæ”¾æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šå¯»æ‰¾ä¸€ä¸ªå‘¨æœŸæœ€å°å€¼ã€‚      æ‰§è¡Œæš‚åœ\n ä¸€æ—¦æ£€æµ‹åˆ°å‘¨æœŸæœ€å°å€¼ï¼Œå·¥å…·åŒ… iï¼‰å°†æ‰€æœ‰å­˜å‚¨çš„å¯¹è±¡ä»GPUå¤åˆ¶åˆ°CPUï¼Œiiï¼‰é‡Šæ”¾GPUåˆ†é…ï¼Œä»¥åŠiiiï¼‰æš‚åœè¿›ç¨‹ã€‚    æ¢å¤è¿›ç¨‹\n å½“Gandivaå®¢æˆ·ç«¯å‘å‡ºSIGCONTä¿¡å·æ—¶ï¼Œå·¥å…·åŒ…ä¼šåˆ†é…GPUå†…å­˜ï¼Œå°†å­˜å‚¨çš„å¯¹è±¡ä»CPUå¤åˆ¶åˆ°GPUï¼Œå¹¶æ¢å¤è¿›ç¨‹ã€‚ ä¸ºäº†å¤„ç†é‡æ–°å¯åŠ¨æ—¶çš„åœ°å€æ”¹å˜ï¼Œæˆ‘ä»¬è·Ÿè¸ªå·¥å…·åŒ…ä¸­çš„GPUå¯¹è±¡ï¼Œå¹¶ç”¨æ–°çš„åœ°å€å¯¹å…¶è¿›è¡Œä¿®è¡¥ã€‚ æ”¹å˜GPUéœ€è¦è°ƒç”¨cudaDeviceResetå’ŒCudaInitï¼Œè¿™å¯èƒ½éœ€è¦5-10ç§’ã€‚æˆ‘ä»¬é€šè¿‡åœ¨ \u0026ldquo;æš‚åœ \u0026ldquo;æ—¶åœ¨åå°æ‰§è¡Œè¿™äº›æ“ä½œæ¥éšè—è¿™ä¸ªå»¶æ—¶      Tensorflowè¿ç§»\n æˆ‘ä»¬åœ¨æ¯ä¸ªæœåŠ¡å™¨ä¸Šéƒ¨ç½²äº†ä¸€ä¸ªè¿ç§»åŠ©æ‰‹ï¼Œä»¥æ”¯æŒæŒ‰éœ€checkpointå’Œè¿ç§»ã€‚  å½“æ”¶åˆ°æ¥è‡ªè°ƒåº¦å™¨çš„è¿ç§»å‘½ä»¤æ—¶ï¼Œç›®çš„åœ°åŠ©æ‰‹é¦–å…ˆé¢„çƒ­TFä¼šè¯å¹¶ç­‰å¾…æ£€æŸ¥ç‚¹çš„åˆ°æ¥ã€‚ ç„¶åï¼Œæºå¸®åŠ©è€…è¦æ±‚TFä¿å­˜æ£€æŸ¥ç‚¹ï¼Œåœ¨è·¨æœåŠ¡å™¨è¿ç§»çš„æƒ…å†µä¸‹å°†æ£€æŸ¥ç‚¹ç§»åˆ°ç›®çš„åœ°ï¼Œæœ€åæ¢å¤è®­ç»ƒä¼šè¯ã€‚ ä¸ºäº†åŠ å¿«è¿ç§»è¿‡ç¨‹ï¼Œæˆ‘ä»¬é‡‡ç”¨Ramdiskå°†æ£€æŸ¥ç‚¹ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚åœ¨è·¨æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œä¿®æ”¹åçš„TFé€šè¿‡ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰åè®®å°†æ£€æŸ¥ç‚¹ç›´æ¥ä¿å­˜åˆ°è¿œç¨‹Ramdiskã€‚   å½“Migration Helperè¦æ±‚ä½œä¸šæ‰§è¡Œcheckpointæ—¶  ä¿®æ”¹åçš„TFä¼šåœ¨ä¸€ä¸ªå°æ‰¹å¤„ç†ç»“æŸæ—¶è°ƒç”¨tf.Saverã€‚ å¯¹äºæ•°æ®çš„å¹¶è¡Œæ€§ï¼Œæ£€æŸ¥ç‚¹åªåŒ…æ‹¬ä¸€ä¸ªGPUä¸­çš„æ¨¡å‹ï¼Œè€Œä¸è€ƒè™‘è®­ç»ƒä¸­ä½¿ç”¨çš„GPUæ•°é‡ã€‚ ä¸ºäº†è¿›ä¸€æ­¥åŠ å¿«TFçš„è¿ç§»ï¼Œæˆ‘ä»¬åœ¨æ£€æŸ¥ç‚¹ä¸­ä¸åŒ…æ‹¬å…ƒå›¾ç»“æ„ï¼Œå› ä¸ºå®ƒå¯ä»¥æ ¹æ®ç”¨æˆ·ä»£ç è¿›è¡Œé‡å»ºã€‚   åœ¨é¢„çƒ­é˜¶æ®µï¼Œä¿®æ”¹åçš„TFæ£€æŸ¥GPUé…ç½®å¹¶é‡å»ºå…ƒå›¾ã€‚  å®ƒè¿›ä¸€æ­¥åˆ›å»ºExecutoræ¥è¿è¡Œé¢„çƒ­æ“ä½œï¼Œä»¥ç¡®ä¿åˆå§‹åŒ–ä¸ä¼šè¢«æ‡’æƒ°åœ°æ¨è¿Ÿã€‚ å½“æ¢å¤è®­ç»ƒè¿‡ç¨‹æ—¶ï¼Œä¿®æ”¹åçš„TFåŠ è½½æ£€æŸ¥ç‚¹ï¼Œç”±å¤šä¸ªGPUå¹¶è¡ŒåŠ è½½ï¼Œå¹¶ç»§ç»­è¿›è¡Œè®­ç»ƒã€‚      ","date":"2022-11-08T09:59:52+08:00","image":"https://cdn.jsdelivr.net/gh/Tweakzx/ImageHost@main/img/202211081933118.png","permalink":"https://tweakzx.github.io/p/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0gandiva%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/","title":"ã€è®ºæ–‡ç¬”è®°ã€‘Gandivaè®ºæ–‡é˜…è¯»ç¬”è®°"},{"content":"docker çš„ä½¿ç”¨æ–¹æ³• dockerçš„å®‰è£… dockerçš„ç‰ˆæœ¬æ¯”è¾ƒå¤šï¼Œ å¤§å®¶å¯ä»¥è‡ªè¡Œæœç´¢å®‰è£…æ–¹å¼ï¼Œ ä»¥ä¸‹åªæ˜¯å‚è€ƒã€‚\nUbuntu å®‰è£…docker.ioæ¯”è¾ƒæ–¹ä¾¿\næŸ¥è¯¢å¯å®‰è£…ç‰ˆæœ¬ apt-cache madison docker å®‰è£…docker sudo apt install docker.io æŒ‡å®šå®‰è£…ç‰ˆæœ¬ sudo apt install docker.io=18.09.1-0ubuntu1 å¯åŠ¨docker sudo systemctl start docker é‡å¯docker sudo systemctl daemon-reload sudo systemctl restart docker è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ $ sudo systemctl enable docker æˆ– $ sudo systemctl enable docker.service --now éªŒè¯docker systemctl status docker docker --version centOS éœ€è¦å®‰è£…docker-ceï¼Œ dockerç¤¾åŒºç‰ˆ\nå¸è½½æ—§ç‰ˆæœ¬ yum remove docker docker-common docker-selinux docker-engine å®‰è£…ä¾èµ– yum install -y yum-utils device-mapper-persistent-data lvm2 è®¾ç½®æº é˜¿é‡Œæº\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo æ¸…åæº\nyum-config-manager --add-repo https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo å®‰è£… æŸ¥çœ‹å¯å®‰è£…ç‰ˆæœ¬\nyum list docker-ce --showduplicates | sort -r é€‰æ‹©ç‰ˆæœ¬å®‰è£…\nyum -y install docker-ce-18.03.1.ce å¯åŠ¨docker systemctl start docker systemctl enable docker docker çš„åŸºæœ¬å‘½ä»¤ æœ¬åœ°é•œåƒç®¡ç†  images rmi tag build history save load import  å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†  run start/stop/restart kill rm pause/unpause create exec  å®¹å™¨æ“ä½œ  ps inspect top attach events logs wait export port stats  å®¹å™¨rootfså‘½ä»¤  commit cp diff  é•œåƒä»“åº“   login\n  pull\n  push\n  search\n  https://www.runoob.com/docker/docker-import-command.html)\n  info|version  info version  docker éƒ¨ç½²å®ä¾‹ Hello World runoob@runoob:~$ docker run ubuntu:15.10 /bin/echo \u0026quot;Hello world\u0026quot;\rHello world\rRedis docker pull redis:latest\rdocker run -itd --name redis-test -p 6379:6379 redis\rdocker exec -it redis-test /bin/bash\rç›¸å…³é—®é¢˜ 1. docker.io å’Œdocker-ce çš„åŒºåˆ«  ç»´æŠ¤è€…ï¼š\n docker-ce æ˜¯ docker å®˜æ–¹ç»´æŠ¤çš„ docker.io æ˜¯ Debian å›¢é˜Ÿç»´æŠ¤çš„  ä¾èµ–ç®¡ç†ï¼š\n docker.io é‡‡ç”¨ apt çš„æ–¹å¼ç®¡ç†ä¾èµ– docker-ce ç”¨ go çš„æ–¹å¼ç®¡ç†ä¾èµ–ï¼Œä¼šè‡ªå·±ç®¡ç†æ‰€æœ‰çš„ä¾èµ–ã€‚   2. ","date":"2022-11-01T16:44:33+08:00","permalink":"https://tweakzx.github.io/p/dockerdocker%E7%94%A8%E6%B3%95/","title":"ã€Dockerã€‘Dockerç”¨æ³•"},{"content":"çªå‘æ¶ç–¾ å…³äºæ‰‹å¤´çš„å·¥ä½œ ç°åœ¨åœ¨å·¥ä½ä¸Šæ‘¸é±¼ï¼Œå‡†å¤‡åœ¨åˆ«äººçš„ä»£ç ï¼ˆgaiaGPUï¼‰ä¸Šå¢åŠ ä¸€äº›åŠŸèƒ½ã€‚\nä½†æ˜¯è‡ªå·±çœ‹ç›¸å…³çš„ä»£ç ï¼Œè®ºæ–‡ï¼ŒçŸ¥è¯†å·²ç»è¿‡å»å¥½ä¹…äº†ï¼Œå§‹ç»ˆæ²¡æœ‰ä¸‹æ‰‹å†™å‡ºä»£ç ã€‚\nä¼¼ä¹æŠ˜è…¾äº†å¾ˆä¹…ï¼Œç¡®å®ä¹Ÿæ²¡æœ‰å¼„æ‡‚ä»€ä¹ˆã€‚\nè¿™ä¸ªé¡¹ç›®æ˜¯è¯¾é¢˜ç»„å”¯ä¸€çš„é¡¹ç›®äº†ï¼ŒæŒ‰é“ç†æ¥è¯´æˆ‘åº”è¯¥æœ‰ç€å¤§é‡çš„ç²¾åŠ›æ¥åšè¿™ä»¶äº‹ï¼Œä½†ä¸çŸ¥ä¸ºä»€ä¹ˆæ€»æ˜¯ç²¾ç¥éƒéƒã€‚\nå…³äºä¸ºä»€ä¹ˆä¼šçªå‘æ¶ç–¾ æ‰€è°“çªå‘ï¼Œ æ— éæ˜¯çªç„¶é—´ä»€ä¹ˆéƒ½ä¸æƒ³åšäº†ï¼Œè¿›å…¥åˆ°ä¸€ç§æŠ‘éƒé¢“åºŸçš„çŠ¶æ€ã€‚\nå¬åˆ°åé¢è¯¾é¢˜ç»„çš„å­¦å§åœ¨åæ§½å¥¹å¸¦çš„ä¸€ä¸ªå­¦ç”Ÿèƒ½åŠ›å¾ˆå·®ï¼Œæ— æ³•æ¨è¿›å·¥ä½œã€‚\næˆ‘å¬åˆ°ä¹‹åè§‰å¾—å¥½åƒæ˜¯æœ‰å¾ˆå¤šèš‚èšåœ¨èº«ä¸Šçˆ¬ï¼Œæ¯•ç«Ÿæˆ‘ä¹Ÿèƒ½åŠ›å¾ˆå·®ï¼Œé¡¹ç›®åšäº†ä¸€æ®µæ—¶é—´ä½†æ˜¯æ²¡æœ‰æ¨è¿›ã€‚\nå¦ä¸€æ–¹é¢å°±æ˜¯å¯¼å¸ˆæŠŠæˆ‘æ‰‹å¤´çš„å·¥ä½œå¥½åƒå·å·äº¤ç»™ä¸€ä¸ªå­¦å¼Ÿæ¥åšäº†ï¼Œè¿™æ˜¯è®©æˆ‘æ›´åŠ æœ‰å‹åŠ›çš„ä¸€ä»¶äº‹ã€‚\næ¯•ç«Ÿå¯¼å¸ˆæ˜¯ä¸€ä¸ªæ“…é•¿é˜´é˜³æ€ªæ°”æ¶æ„è®½åˆºçš„äººã€‚\nä»–å·å·çš„è¿™æ ·åšè™½ç„¶ä¸ä¸€å®šæ˜¯å‡ºäºåå¿ƒï¼Œä½†æ˜¯å­¦å¼Ÿå¦‚æœåšå‡ºæ¥äº†ï¼Œè¿›åº¦æ¯”æˆ‘å¿«çš„è¯ï¼Œé‚£æˆ‘ä¸€å®šæ˜¯å…ä¸äº†æ”¶åˆ°ä¸€äº›ä¸å¤§å‹å–„çš„è¯„è®ºçš„ã€‚\nä»€ä¹ˆæ˜¯æˆ‘æƒ³è¦çš„å‘¢ è¿™ä¸ªé¡¹ç›®æ¶‰åŠåˆ°k8sï¼Œ gpuï¼Œ dockerï¼Œæœºå™¨å­¦ä¹ ï¼Œä¼¼ä¹é¡¹ç›®æ¶‰åŠçš„ä¸œè¥¿å¾ˆå¤šï¼Œæˆ‘ä¸€æ—¶é—´æ‘¸ä¸åˆ°è¯¥æ€ä¹ˆæ‰©å……è‡ªå·±çš„çŸ¥è¯†ã€‚\nå®é™…è¦åšçš„åŠŸèƒ½åˆä¼¼ä¹ä»€ä¹ˆéƒ½ä¸éœ€è¦æ‡‚ï¼Œåªè¦åœ¨åˆ«äººçš„ä»£ç ä¸ŠåŠ ä¸€ç‚¹é€»è¾‘å°±è¡Œï¼Œå¯æ˜¯æˆ‘çœ‹æºç åˆæ˜¯æ‘¸ä¸åˆ°è¯¥åœ¨ä»€ä¹ˆåœ°æ–¹åŠ ã€‚\nä¼¼ä¹æˆ‘æ€»æ˜¯åœ¨åˆ¶é€ éšœç¢ï¼Œé˜»ç¢è‡ªå·±åšåˆ°è¿™ä»¶äº‹ã€‚\næˆ‘æ€»æ˜¯å¸Œæœ›æœ‰ä¸ªæ‡‚åšé¡¹ç›®çš„äººæ¥æŒ‡å¯¼ä¸€ä¸‹æˆ‘ï¼Œç‚¹ç ´å½“å‰çš„è¿·æ´¥ã€‚\nå¯æ˜¯å¯¼å¸ˆè‚¯å®šæ˜¯æŒ‡æœ›ä¸ä¸Šäº†ï¼Œä»–å‡ ä¹ä»€ä¹ˆéƒ½ä¸æ‡‚ï¼Œç»„é‡Œçš„åŒå­¦åšçš„ä¸œè¥¿åˆéƒ½ä¸ä¸€æ ·ã€‚\nç°å®å¾€å¾€æ˜¯\u0026hellip; ä¸å…‰æ˜¯å¯¼å¸ˆæ°´å¹³å¥‡å·®ï¼Œæ²¡æœ‰æŒ‡å¯¼ã€‚\nè‡ªå·±åœ¨å­¦ä¹ è¿™ä»¶äº‹ä¸Šä¹Ÿæ˜¯ä¸å¤ªæ“…é•¿ï¼Œæ¯æ¬¡æ‰“ç®—è¦å­¦ä¹ ä»€ä¹ˆä¸œè¥¿ï¼Œæ€»æ˜¯æ„Ÿè§‰è‡ªå·±å­¦ä¸ä¼šã€‚\næˆ–è€…è¯´æ ¹æœ¬ä½“ä¼šä¸åˆ°åœ¨å­¦ä¹ çš„æ„Ÿè§‰ï¼Œæ›´åˆ«è°ˆå­¦ä¼šä»€ä¹ˆçš„æ„Ÿè§‰äº†ã€‚\nå¯èƒ½æ˜¯å¤šå¹´çš„é«˜è€ƒåº”è¯•æ€ç»´å§ï¼Œå‡ ä¹æ˜¯ä¸å­¦ä»€ä¹ˆçœŸæ­£çš„çŸ¥è¯†ï¼Œè€Œæ˜¯åˆ©ç”¨è®°å¿†åŠ›å»å®Œæˆä¸€äº›äº‹æƒ…ã€‚\nå¤§å­¦å‡ å¹´ä¸‹æ¥æ²¡æœ‰å°†ä»€ä¹ˆçŸ¥è¯†çœŸæ­£è½¬åŒ–æˆæˆ‘çš„æŠ€èƒ½ã€‚\nå·®ä¸å¤šéƒ½æ˜¯åœ¨è€ƒå‰ä¸€å¤©åˆ©ç”¨è®°å¿†åŠ›é€šè¿‡è€ƒè¯•ï¼Œåˆ†æ•°ä¸ä¼šå¾ˆé«˜ä½†ä¹Ÿä¸ä¼šå¾ˆä½ã€‚\nâ€‹\næˆ‘è§‰å¾—é•¿æœŸçš„æŠ‘éƒæƒ…ç»ªå·²ç»ä¸¥é‡å½±å“åˆ°æˆ‘çš„è®°å¿†èƒ½åŠ›äº†ã€‚\næˆ‘å¼€å§‹é¢‘ç¹çš„å‘ç°è‡ªå·±çš„è®°å¿†å¡å£³ã€‚\næœ¬æ¥å°±æ²¡æœ‰å®é™…æŠ€èƒ½çš„æˆ‘ï¼Œå¤±å»äº†åŸæœ¬çš„ä¸€äº›ä¼˜åŠ¿ä¹‹åå°±çœŸçš„ä»€ä¹ˆéƒ½æ²¡æœ‰äº†ã€‚\nç°åœ¨è¦è‡ªå·±ä¸Šæ‰‹åšä¸€äº›å¼€å‘ï¼Œå¯¹æˆ‘æ¥è¯´çœŸçš„å°±æ˜¯å¾ˆå›°éš¾ã€‚\nè¿™æ ·ä¸€é—¨åŠ¨æ‰‹çš„å­¦ç§‘æˆ‘å´æ°æ°ç¼ºä¹åŠ¨æ‰‹çš„èƒ½åŠ›ã€‚\nâ€‹\nå°†æ¥çš„å·¥ä½œä¼¼ä¹ä¹Ÿæ— æ³•è·å¾—è§£è„±ã€‚\nåœ¨å·¥ä½œä¸Šï¼Œå¦‚æœä¹Ÿæ˜¯è‡ªå·±å»æ¼«æ— è¾¹é™…çš„æ‘¸ç´¢ï¼Œé‚£å¯¹æˆ‘æ¥è¯´å°†æ˜¯ä¸€åœºè‹¦æ—…ã€‚\nåœ¨è¿™æ ·å®¹æ˜“è¿·å¤±çš„è’æ¼ ä¹‹ä¸­ï¼Œæˆ‘æ€¥åˆ‡éœ€è¦ä¸€ä¸ªæ„¿æ„æä¾›æŒ‡å¯¼çš„å¼•è·¯äººã€‚\nä»æ¥æ²¡æœ‰æˆé•¿ï¼Œåªæœ‰ä¼¤ç—•çš„å¢åŠ  äººä»¬å¸¸è¯´åƒä¸€å ‘é•¿ä¸€æ™ºï¼Œè¿™å¥è¯å¯¹æˆ‘æ¥è¯´ä¼¼ä¹ä¸å¤ªèµ·ä½œç”¨ã€‚\næˆ‘ä¼¼ä¹åœ¨æˆé•¿è¿™ä»¶äº‹ä¸Šä¹Ÿåšçš„å¾ˆæ˜¯åƒåŠ›ï¼Œç—›è‹¦éšç€å¹´é¾„çš„å¢åŠ ä¼¼ä¹å‡ºç°äº†æŒ‡æ•°çº§çš„å¢é•¿ã€‚\næˆ‘æ€»æ˜¯åœ¨æ¯•ä¸šä¹‹åæ‰èƒ½æ˜ç™½ï¼Œæœ‰äº›å­¤ç‹¬ä¸çŸ›ç›¾æ˜¯æ²¡æœ‰å¿…è¦å­˜åœ¨çš„ã€‚\nå…³äºæœ¬ç§‘é˜¶æ®µä¸ºä»€ä¹ˆåœæ» ä¼¼ä¹é«˜è€ƒç•™ä¸‹çš„åé—ç—‡ï¼Œå¤§ä¸€çš„æ—¶å€™ä¸€ç›´å·é«˜æ•°ï¼Œå·å®Œé«˜æ•°ï¼Œå·å¤§ç‰©ï¼Œè¿˜è¦å·å¤§å­¦çš„å…¶ä»–è¯¾ç¨‹\nä»æ¥æ²¡æœ‰èƒ†é‡è€ƒè™‘è¿‡è‡ªå·±è¦åšä¸€ä¸ªä¸èƒ½åŠ å­¦åˆ†çš„é¡¹ç›®ï¼Œç›®å…‰ä¸€ç›´ç›¯ç€æ¯”èµ›ï¼Œå¤§åˆ›ï¼Œä»¥åŠå¾ˆæ°´çš„æœ¬ç§‘è¯¾ç¨‹\nç»“æœå°±æ˜¯æˆç»©è¿˜ä¸é”™ï¼Œä¸“ä¸šå‰åä¿ç ”åˆ°äº†è®¡ç®—æ‰€\nè®©æˆ‘å›æœ›æœ¬ç§‘ï¼Œåæ‚”çš„äº‹æƒ…æœ‰å¾ˆå¤šï¼Œ\nä¸€æ˜¯æ²¡æœ‰ä¸€ä¸ªæ„Ÿå…´è¶£çš„æ–¹å‘ï¼Œç„¶ååŠªåŠ›å­¦ä¹ ä¸‹å»\näºŒæ˜¯æ²¡æœ‰å¾ˆå¥½çš„å’ŒåŒå­¦åšå¥½æœ‹å‹ï¼Œå¤§æ¦‚æ˜¯ç«äº‰å¯¼è‡´çš„ï¼Œå’ŒåŒå­¦æœ‰æ‰€ç–è¿œ\nä¸‰æ˜¯æ²¡æœ‰å¼€å§‹åˆ·é¢˜ï¼Œå¦‚æœå½“æ—¶å¤šåˆ·ä¸€ç‚¹é¢˜çš„è¯ï¼Œä¿ç ”å’Œæ‰¾å®ä¹ çš„ç¬”è¯•éƒ½ä¼šæ¯”è¾ƒé¡ºåˆ©\nå…³äºç¬¬ä¸€ä»¶ï¼Œæˆ‘å®åœ¨æ˜¯è§åˆ°çš„ï¼ŒçŸ¥é“çš„å¤ªå°‘äº†\nä¼¼ä¹ä»æ¥éƒ½ç¼ºå°‘ä¸€ä¸ªå¥‘æœºï¼Œæ¼«æ— ç›®çš„ï¼Œæ²¡æœ‰æ–¹å‘\nåœ¨ä¸çŸ¥é“ä»€ä¹ˆçš„ç«äº‰å¿ƒç†ä½œç”¨ä¸‹ï¼Œè¢«çœ‹ä¸è§çš„é”é“¾å›°åœ¨åŸåœ°ï¼Œä¸æ•¢çœŸæ­£çš„åšç‚¹æœ‰ç”¨çš„ä¸œè¥¿\nå­¦ä¹ å½“ç„¶ä¹Ÿå¯èƒ½æ²¡æœ‰é‚£ä¹ˆé‡è¦ï¼Œæ¯•ç«Ÿäººçš„å˜åŒ–ä¸ä¸€å®šèƒ½è·‘èµ¢ç¯å¢ƒçš„å˜åŒ–\nç¬¬äºŒä»¶çš„è¯ï¼Œå®è¯è¯´å’ŒåŒå­¦ç›¸å¤„çš„éƒ½è¿˜å¯ä»¥ï¼Œèµ·ç æ²¡æœ‰å…³ç³»å¾ˆå·®çš„åŒå­¦\nä½†ä¹Ÿå¾ˆå°‘æœ‰å…³ç³»å¾ˆå¥½çš„åŒå­¦\nå…³äºå®¤å‹ï¼Œèµ·åˆå¯èƒ½å°±æ˜¯ä¸€äº›ç»†å°çš„çŸ›ç›¾å’Œå±æœºæ„Ÿå¯¼è‡´çš„\nå…³ç³»è¿˜ä¸é”™ï¼Œä½†æ˜¯æ€»æ˜¯æœ‰ä¸€äº›ç”Ÿç–ï¼Œå°±æ˜¯å¾ˆæœ‰ç¤¼è²Œçš„ç”Ÿç–\nå¤§å®¶éƒ½å„è‡ªæœ‰äº†æœ‹å‹ï¼Œå¯èƒ½æ˜¯å¤ªå¤šç¼ºä¹å®‰å…¨æ„Ÿå¯¼è‡´çš„ï¼Œæˆ‘å¯¹æœ‹å‹å»äº¤åˆ«çš„æœ‹å‹è¿™ä»¶äº‹ååˆ†æ•æ„Ÿ\nç°åœ¨æƒ³æ¥çœŸçš„æ˜¯ï¼Œæ˜æ˜æŠŠå¾ˆå¤šäº‹æƒ…è¯´å¼€ï¼Œæ´»å¾—ä¼šè½»æ¾å¾ˆå¤šï¼Œæœ‹å‹ä¹‹é—´ç›¸å¤„ä¹Ÿä¼šè‡ªåœ¨å¾ˆå¤š\nç§¯éƒç€ï¼Œæ€»æ˜¯æ·¡æ·¡æ„ï¼Œå¦‚åŒé›¨å­£é‡Œå¬ä¸è§è¿œæ–¹çš„ç¬‘å£°\nä¸€ä¸ªäººåœ¨ç»†é›¨æ‰“æ¹¿çš„é•¿æ¤…ä¸Šï¼Œçœ‹ç€å¾®å¾®é€ç€å…‰äº®çš„é˜´å¤©\næœ€å–œæ¬¢åœ¨æ ¡å›­é‡Œè¡Œèµ°ï¼Œæµ“è«é®è”½çš„äº¤å¤§æ ¡å›­ï¼Œé€‚åˆæµ®èºçš„äººæ•£æ•£å¿ƒ\nå…³äºæˆ‘çš„æ•æ„Ÿï¼Œç„¦è™‘ï¼Œå±æœºæ„Ÿå¯¼è‡´å’Œæœ‹å‹ç–è¿œè¿™ä»¶äº‹\næˆ‘æƒ³æˆ‘æ€»æ˜¯è´Ÿç€ä¸€äº›æ„§ç–šçš„ï¼Œæˆ–è®¸æˆ‘è½»æ¾ä¸€ç‚¹ï¼Œæˆ‘å‘¨å›´çš„æœ‹å‹ä¹Ÿå¯ä»¥è½»æ¾ä¸€ç‚¹\nå…¶å®éšè—åœ¨è¿™èƒŒåçš„ï¼Œè½¯é™¢çš„å­¦ä¹ æ°›å›´å…¶å®æ¨åŠ¨äº†ä¸€äº›åŒå­¦åŒ…æ‹¬æˆ‘çš„å¿ƒç†çš„æ‰­æ›²\nå­¦é™¢ä¸ç®—å¾ˆå·ï¼Œä½†æ˜¯èµ„æºå¹¶ä¸å¤šï¼Œå®è¯è¯´è¯¾ç¨‹è´¨é‡å…¶å®ä¸å¤ªèƒ½æé«˜å­¦ç”Ÿçš„å®é™…æ°´å¹³\nå­¦é™¢æä¾›ä¸äº†å­¦ç”Ÿéœ€è¦çš„æˆé•¿ä¸å‘å±•ï¼Œå°¤å…¶åœ¨è®¡ç®—æœºè¿™ä¸ªçœ‹é‡èƒ½åŠ›çš„é¢†åŸŸ\nå¯¼è‡´å­¦ç”Ÿå‡ºç°ç„¦è™‘ä¹Ÿå¾ˆæ­£å¸¸\nå¤§å®¶éƒ½æƒ³å¿«é€Ÿè·å¾—ä¸€äº›å‘å±•ï¼Œè¶…è¶ŠåŒé¾„äººï¼Œå¯¼è‡´äº†ä¸€äº›é»‘æš—æ£®æ—æ³•åˆ™çš„äº‹æƒ…çš„å‘ç”Ÿ\nä¸è¦å‡ºå£°ï¼Œè‡ªå·±åœ¨å­¦ä»€ä¹ˆï¼Œè‡ªå·±åœ¨åšä»€ä¹ˆï¼Œä¸è¦å‡ºå£°\né—·å£°å‘å¤§è´¢çš„ç†å¿µæ˜¯å¤§å®¶çš„é»˜å¥‘\nç„¶è€Œé—·å£°çš„å¾ˆå¤šï¼Œå‘è´¢çš„å¾ˆå°‘\nå…³äºç¬¬ä¸‰ä»¶äº‹ï¼Œæ²¡æœ‰å¥½å¥½åˆ·é¢˜ï¼Œå…¶å®æ˜¯æ ¹æœ¬æ²¡æœ‰åˆ·é¢˜çš„æ–¹æ³•ä¸ç´§è¿«æ„Ÿ\nå½“æ—¶çš„ç´§è¿«æ„Ÿä¸»è¦æ¥è‡ªå‘¨å›´çš„åŒå­¦éƒ½åœ¨åšä»€ä¹ˆ\nåˆ·leetcodeé¢˜å¯¹ç»©ç‚¹èƒ½æœ‰ä»€ä¹ˆå¸®åŠ©å‘¢ï¼Ÿ\nå³ä½¿æˆ‘ä»¬éƒ½çŸ¥é“æ‰¾å·¥ä½œè¦åˆ·ç®—æ³•é¢˜ï¼Œä¿ç ”ä¹Ÿè¦è¿‡ç®—æ³•è€ƒè¯•\nä½†æ˜¯å¤§ä¸‰å‰å¤§å®¶æ²¡æœ‰è¿™æ ·åšçš„æ‰“ç®—ï¼Œå¤§ä¸‰åä¹Ÿå·²ç»æ¥ä¸åŠ\nå¦å¤–å°±æ˜¯æˆ‘å½“æ—¶ä¸çŸ¥é“åˆ·ç®—æ³•çš„è·¯çº¿ä¸æ•™ç¨‹\nè‡ªå·±æ‰“å¼€lcï¼Œéšä¾¿çœ‹å‡ é“éƒ½æ˜¯ä¸ä¼šåšçš„é¢˜\nç”šè‡³æƒ³åˆ°è§£æ³•ï¼Œä»£ç çš„å®ç°ç»†èŠ‚è¿˜æ˜¯æ— æ³•è½åœ°\nç°åœ¨è¿˜å¥½åˆ·äº†400å¤šé“é¢˜ï¼Œè™½è¯´ä¸æ˜¯åˆ·é¢˜é«˜æ‰‹ï¼Œä½†æ˜¯èµ·ç ä¸ä¼šå®³æ€•é¢˜ç›®äº†\nè¿™ä»¶äº‹ä¸ºä»€ä¹ˆä¼šå¯¼è‡´æˆ‘çš„åæ‚”å‘¢ï¼Ÿ\næ²¡æœ‰åˆ·é¢˜å¯¼è‡´æˆ‘é”™è¿‡äº†å¾ˆå¤šæœºä¼š\nå…³äºä¿ç ”çš„æ—¶å€™ä¸ºä»€ä¹ˆåšå‡ºé”™è¯¯çš„é€‰æ‹© ä¿ç ”çš„æ—¶å€™ï¼Œä¸€æ–¹é¢è‡ªå·±çš„ç®€å†æ²¡æœ‰å‡ºä¼—çš„åœ°æ–¹\nç”šè‡³å…³äºä¿ç ”çš„å‡†å¤‡å°±æ˜¯æ‹¿åˆ°äº†ä¿ç ”èµ„æ ¼ï¼Œä¿ç ”ä¹‹åçš„æ‰¾å¯¼å¸ˆå‡ ä¹æ˜¯æ²¡æœ‰å‡†å¤‡çš„\né¢è¯•ä¹Ÿéƒ½æ˜¯å‡ ä¹æ²¡æœ‰å‡†å¤‡çš„ï¼Œè‡ªå·±ç®€å†ç©ºæœ‰ç»©ç‚¹è€Œæ— å®è´¨\nç°åœ¨çš„å¯¼å¸ˆï¼Œæ˜¯è®©æˆ‘å¾ˆåæ‚”çš„ä¸€ä¸ªé€‰æ‹©\nå¯¼å¸ˆçš„å­¦æœ¯èƒ½åŠ›å¾ˆå·®ï¼Œè¯¾é¢˜ç»„æ²¡æœ‰å®é™…çš„ç§‘ç ”æ–¹å‘ï¼Œæé’±æ˜¯å”¯ä¸€çš„æ–¹å‘\né™¤äº†æä¾›ä¸€äº›ååˆ†ç‰µå¼ºç¦»è°±çš„ideaï¼Œæä¾›ä¸äº†ä»€ä¹ˆæŒ‡å¯¼\nåœ¨ä»–èº«ä¸Šæˆ‘çœ‹åˆ°äº†è‡ªå‘å’Œè‡ªè´Ÿæ˜¯ä¸€æšç¡¬å¸çš„æ­£åä¸¤é¢\nç„¶è€Œæˆ‘è‡ªå·±ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæƒ³æ³•ï¼Œæˆ–è®¸é€‰æ‹©åšç§‘ç ”å¹¶ä¸æ˜¯ä¸€æ¡é€‚åˆæˆ‘çš„è·¯\nç§‘ç ”å˜›ï¼Œè¦ä¹ˆå¯¼å¸ˆæœ‰å¥½çš„æƒ³æ³•ï¼Œè¦ä¹ˆè‡ªå·±æœ‰\nè¦æ˜¯éƒ½æ²¡æœ‰ï¼Œé‚£å°±ä¸å¥½æäº†ï¼Œå°¤å…¶æ˜¯å¯¼å¸ˆæ²‰æµ¸äºå®å¤§å™äº‹è€Œæ— å®äº‹æ±‚æ˜¯èƒ½åŠ›çš„æƒ…å†µä¸‹\né€‰æ‹©ä»–ï¼Œä¸»è¦è¿˜æ˜¯å› ä¸ºå½“æ—¶å¹¶ä¸çŸ¥é“ï¼Œä¸­ç§‘é™¢è®¡ç®—æ‰€çš„å¯¼å¸ˆæ°´å¹³å¯ä»¥è¿™ä¹ˆå·®\nåŸæœ¬ä»¥ä¸ºå¯¼å¸ˆè„¾æ°”å·®ä¸€ç‚¹æ— æ‰€è°“ï¼Œè„¾æ°”å·®å¯èƒ½æ˜¯è¦æ±‚é«˜ï¼Œå¯¹è‡ªå·±ä¸ä¸€å®šæ˜¯ä¸€ä»¶åäº‹\nä½†åæ¥æˆ‘å‘ç°ï¼Œè„¾æ°”å·®å¾€å¾€æ˜¯æ— èƒ½çš„è¡¨ç°ï¼Œè„¾æ°”è¶Šå·®çš„äººè¶Šæ˜¯æ— èƒ½ç‹‚æ€’\nå½“ç„¶å¯èƒ½æ˜¯ç½‘ç»œä¸Šè¢«ä¸å¤ªå¥½çš„è¯„ä»·åˆºæ¿€åˆ°äº†\nå¯¼å¸ˆç°åœ¨ååˆ†æ”¶æ•›ï¼Œå¯¹å­¦ç”Ÿå¤©å¤©æ˜¯ç‚¹èµï¼Œå¤¸å¥–ï¼Œå°¬å¹ï¼Œï¼ˆé˜´é˜³ï¼‰\nå¤§å®¶å¯¹ä»–çš„å¤¸å¥–æ„Ÿåˆ°ååˆ†çš„åŒçƒ¦ï¼Œå¯ä»¥è¯´å¯¼å¸ˆçš„å¤¸äººçš„æƒ…å•†éå¸¸ä½\nä¸€ä¸ªé”™è¯¯çš„é€‰æ‹©çœŸçš„è€½è¯¯äº†æˆ‘å¾ˆé•¿çš„å‘å±•æ—¶é—´\nç”šè‡³æœªæ¥ä¸¤å¹´ä¹Ÿä¸ä¼šå¤ªä¹è§‚\nå…³äºåˆšåˆšè¢«éª—é’±çš„äº‹ å¯¹äº†ï¼Œå€’éœ‰çš„äº‹å¯¹æˆ‘æ¥è¯´å¯ä¸æ­¢ä¸€ä»¶\n9æœˆåº•ï¼Œæˆ‘ç»å†ç”µä¿¡è¯ˆéª—ï¼Œè¢«éª—èµ°äº†å¾ˆå¤šé’±\nåˆšåˆšé—®äº†è­¦å¯ŸåŒå¿—ï¼Œåæ­£é’±å¤§æ¦‚ç‡æ˜¯è¿½ä¸å›æ¥äº†\nç®—äº†ï¼Œå°±å½“ä¸¢äº†å§\næŸå¤±è¿™ä¹ˆæƒ¨é‡ï¼Œå¯¼è‡´æˆ‘10æœˆå…¶å®æœ‰ä¸€ç‚¹æ¶ˆæ²‰\nä¸è¿‡è¿˜å¥½ï¼Œå·¥ä½œä¸é¡ºåˆ©æ‰æ˜¯æˆ‘å¤´ç–¼çš„ä¸»è¦åŸå› \nç´§æ¥ç€è¢«æ‹‰å»é…’åº—è‡ªè´¹éš”ç¦»ï¼Œæ˜¯çœŸçš„ï¼Œæœ¬ä¸å¯Œè£•çš„ç”Ÿæ´»é›ªä¸ŠåŠ éœœ\näº¤å®Œé…’åº—çš„é’±ï¼Œå±±ç©·æ°´å°½äº†ï¼Œå•Šä¸ï¼Œæˆ‘è¿˜æœ‰å¤–å€º\nå»ä»–å¦ˆçš„äººç”Ÿ\nå…³äºå¯¹åˆ«äººçš„ç¾¡æ…• ä¸€ä¸ªè´Ÿé¢æƒ…ç»ªå¾ˆå¤šçš„äººå¯¹æ­£å¸¸äººçš„è‡ªç„¶ç¾¡æ…• æˆ‘çœŸçš„è´Ÿé¢æƒ…ç»ªå¾ˆå¤šå—ï¼Ÿæˆ‘æƒ³è¯´ä¸\næˆ‘è¡¨ç°å‡ºæ¥çš„å¾ˆå¤šï¼Œä½†æ›´å¤šçš„æ˜¯æ— å¥ˆä¸ç–²æƒ«\nè¿™äº›éƒ½æ˜¯å¯ä»¥è§£å†³çš„ï¼Œå¦‚æœæˆ‘èƒ½åŠ›çªé£çŒ›è¿›\næˆ–è€…æœ‰ä¸€ä¸ªé€‚åˆæˆ‘æˆé•¿çš„ç¯å¢ƒï¼Œå¾ˆå¤šé—®é¢˜éƒ½ä¼šå¾—åˆ°ç¼“è§£\næˆ‘å¸¸å¸¸çœ‹åˆ°å‘¨å›´çš„åŒå­¦ç›®æ ‡æ˜ç¡®é£é€Ÿè¿›æ­¥è€Œæ„Ÿåˆ°ç„¦è™‘\nä½†æ¯ä¸ªäººéƒ½æœ‰ä¸åŒçš„å‘å±•ç©ºé—´å˜›ï¼Œå‘å±•çš„æ—¶é—´èŠ‚ç‚¹ä¹Ÿä¸å¤ªä¸€è‡´\nå¤§ä¸äº†ç»™è‡ªå·±ä¸€ç‚¹æ—¶é—´ï¼Œæ™šå‡ å¹´ä¹Ÿæ²¡ä»€ä¹ˆçš„\næˆ‘çš„ç„¦è™‘æ˜¯ç°å®åŸå› å¯¼è‡´çš„ï¼Œå‡ ä¹æ— æ³•ç¼“è§£\nå‘¨å›´çš„åŒå­¦å¯ä»¥è‡ªç”±çš„æˆé•¿å’Œç”Ÿæ´»ï¼Œå…ä¸äº†è®©æˆ‘å¿ƒç”Ÿå¾ˆå¤šç¾¡æ…•\nä¸€åˆ‡éƒ½æ¥å¾—åŠ ä½†æ˜¯æˆ‘è¿˜æ˜¯ä¼šè®¸æ„¿\nä¸€åˆ‡éƒ½æ¥å¾—åŠï¼Œæ¯ä¸ªäººéƒ½æœ‰ä¸åŒçš„äººç”Ÿè¯¾é¢˜\näººè¿™ä¸€è¾ˆå­è‡ªå·±æ˜¯å”¯ä¸€çš„é•¿æœŸè§‚ä¼—\n","date":"2022-10-21T15:52:45+08:00","permalink":"https://tweakzx.github.io/p/%E5%BF%83%E5%8F%8A%E4%B8%80%E4%BA%9B%E5%BE%80%E4%BA%8B/","title":"ã€å¿ƒåŠã€‘ä¸€äº›å¾€äº‹"},{"content":"ã€ŠAntMan: Dynamic Scaling on GPU Clusters for Deep Learningã€‹è®ºæ–‡é˜…è¯»ç¬”è®° Abstract å¦‚ä½•åœ¨å¤§è§„æ¨¡GPUé›†ç¾¤ä¸Šæœ‰æ•ˆè°ƒåº¦æ·±åº¦å­¦ä¹ å·¥ä½œï¼Œ å¯¹äºå·¥ä½œæ€§èƒ½ï¼Œç³»ç»Ÿååé‡å’Œç¡¬ä»¶åˆ©ç”¨ç‡è‡³å…³é‡è¦ã€‚\néšç€æ·±åº¦å­¦ä¹ çš„å·¥ä½œé‡å˜å¾—æ›´åŠ å¤æ‚ï¼Œå®ƒå˜å¾—è¶Šæ¥è¶Šå…·æœ‰æŒ‘æˆ˜æ€§ã€‚\næœ¬æ–‡å°†ä»‹ç»Antmanï¼Œ è¿™æ˜¯ä¸€ç§æ·±å…¥å­¦ä¹ çš„åŸºç¡€è®¾æ–½ï¼Œè¯¥åŸºç¡€æ¶æ„å…±åŒè®¾è®¡äº†é›†ç¾¤è°ƒåº¦ç¨‹åºï¼Œå¹¶å·²åœ¨é˜¿é‡Œå·´å·´éƒ¨ç½²åœ¨ç”Ÿäº§ä¸­ï¼Œä»¥ç®¡ç†æ•°ä»¥ä¸‡è®¡çš„æ¯æ—¥æ·±åº¦å­¦ä¹ å·¥ä½œã€‚\n Antmané€‚åº”æ·±åº¦å­¦ä¹ è®­ç»ƒçš„æ³¢åŠ¨èµ„æºéœ€æ±‚ã€‚å› æ­¤ï¼Œå®ƒåˆ©ç”¨å¤‡ç”¨GPUèµ„æºåœ¨å…±äº«GPUä¸Šå…±åŒæ‰§è¡Œå¤šä¸ªä½œä¸šã€‚ Antmanåˆ©ç”¨æ·±åº¦å­¦ä¹ è®­ç»ƒçš„ç‹¬ç‰¹ç‰¹å¾ï¼Œåœ¨æ·±åº¦å­¦ä¹ æ¡†æ¶å†…ä¸ºæ˜¾å­˜å’Œè®¡ç®—èµ„æºå¼•å…¥åŠ¨æ€ç¼©æ”¾æœºåˆ¶ã€‚è¿™å…è®¸jobä¹‹é—´çš„ç»†ç²’åº¦åè°ƒå¹¶é˜²æ­¢å·¥ä½œå¹²æ‰°ã€‚ è¯„ä¼°è¡¨æ˜ï¼ŒAntmanåœ¨æˆ‘ä»¬çš„å¤šç§Ÿæˆ·é›†ç¾¤ä¸­ä¸æŸå®³å…¬å¹³æ€§çš„æƒ…å†µä¸‹ï¼Œæ•´ä½“å°†æ˜¾å­˜åˆ©ç”¨ç‡æé«˜äº†42ï¼…ï¼Œè®¡ç®—èµ„æºåˆ©ç”¨ç‡æé«˜äº†34ï¼…ï¼Œä¸ºæœ‰æ•ˆåˆ©ç”¨å¤§è§„æ¨¡çš„GPUæå‡ºäº†æ–°æ–¹æ³•ã€‚  Introduction  åœ¨å…±äº«å¤šç§Ÿæˆ·çš„DLé›†ç¾¤ï¼Œ è®¸å¤šå·¥ä½œæ’é˜Ÿç­‰å¾…èµ„æºçš„æ—¶å€™ä¼šå¯¼è‡´GPUåˆ©ç”¨ç‡ä½ä¸‹ï¼Œæœ‰ä¸¤ä¸ªåŸå›   å¤§å¤šæ•°çš„è®­ç»ƒä»»åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸èƒ½å®Œå…¨åˆ©ç”¨GPUèµ„æº  è®­ç»ƒä¸€ä¸ªDLæ¨¡å‹é€šå¸¸éœ€è¦å¤šç§è®¡ç®—çš„æ··åˆ å½“ä½¿ç”¨åˆ†å¸ƒå¼çš„è®­ç»ƒçš„æ—¶å€™ï¼Œ90%çš„æ—¶é—´ä¼šè¢«æµªè´¹åˆ°ç½‘ç»œé€šä¿¡ä¸Š   åŸºäºèµ„æºé¢„ç•™çš„é›†ç¾¤è°ƒåº¦æ–¹æ¡ˆå¯¼è‡´æ˜¾è‘—çš„GPUç©ºé—²ï¼ŒDLå·¥ä½œä¸­æ€»æœ‰éƒ¨åˆ†èµ„æºæ²¡æœ‰æŠ•å…¥ä½¿ç”¨  ä¾‹å¦‚ï¼Œéšæœºæ¢¯åº¦ä¸‹é™æ˜¯åŒæ­¥çš„ï¼Œéœ€è¦è·å–æ‰€æœ‰çš„èµ„æºä»¥è¿›è¡Œgang-schedulingï¼Œ åœ¨å¾—åˆ°æ‰€æœ‰èµ„æºä¹‹å‰ï¼Œå·²å¾—åˆ°çš„éƒ¨åˆ†èµ„æºå°±ä¼šé™·å…¥ç©ºé—²     åœ¨å…±äº«GPUä¸Šè¿›è¡Œpacking job  å¯ä»¥æé«˜GPUçš„åˆ©ç”¨ç‡ï¼Œå¯ä»¥ä½¿å¾—åŒæ ·çš„é›†ç¾¤æ•´ä½“ä¸Šèƒœä»»æ›´å¤šçš„jobã€‚ ä½†æ˜¯è¿™ä¸ªç­–ç•¥åœ¨ç”Ÿäº§é›†ç¾¤ä¸Šå¾ˆå°‘ä½¿ç”¨ï¼Œ åŸå›   å°½ç®¡æå‡GPUçš„åˆ©ç”¨ç‡æ˜¯æœ‰åˆ©çš„ï¼Œä½†ä¹Ÿè¦ä¿è¯resource-guarantee jobsï¼ˆRGJï¼Œèµ„æºä¿è¯æ€§jobï¼‰çš„æ€§èƒ½ã€‚åŒä¸€ä¸ªGPUä¸ŠåŒæ—¶æ‰§è¡Œå¤šä¸ªjobä¼šå¯¼è‡´å¹²æ‰°\u0026ndash;\u0026gt;RGJæ€§èƒ½å‡ºç°æ˜¾è‘—ä¸‹é™ job packingç­–ç•¥å¯ä»¥ç»™å¹¶å‘jobå¼•å…¥å†…å­˜ç«äº‰ã€‚jobéœ€è¦çš„èµ„æºé™¡ç„¶å¢åŠ çš„è¯ï¼Œæœ‰å¯èƒ½å¯¼è‡´è®­ç»ƒä»»åŠ¡failureã€‚   å› æ­¤ï¼Œjobèµ„æºçš„ç‹¬å åˆ†é…åœ¨æ˜¾å­˜çš„GPUé›†ç¾¤ç”Ÿäº§ç¯å¢ƒä¸­æ¯”è¾ƒå…¸å‹   æˆ‘ä»¬æå‡ºAntMan  ç®€è¿°  ä¸€ä¸ªDLç³»ç»Ÿæé«˜GPUé›†ç¾¤çš„åˆ©ç”¨ç‡ åŒæ—¶ä¿è¯å…¬å¹³æ€§ä¸RGJçš„æ€§èƒ½ é€šè¿‡åˆä½œæ€§çš„èµ„æºæ‰©ç¼©æ¥å‡å°‘jobå¹²æ‰°   DLç³»ç»Ÿä¸­å¼•å…¥äº†æ–°çš„åˆ†é…æœºåˆ¶åœ¨jobè®­ç»ƒè¿‡ç¨‹ä¸­æ¥åŠ¨æ€åœ°ç²¾ç¡®åˆ†é…æ‰€éœ€èµ„æºï¼ˆæ˜¾å­˜å’Œè®¡ç®—å•å…ƒï¼‰ ä½¿ç”¨è¶…å–æœºåˆ¶ä½¿å¾—ä»»ä½•ç©ºé—²çš„GPUèµ„æºï¼ˆæ˜¾å­˜å’Œè®¡ç®—å•å…ƒï¼‰éƒ½èƒ½è¢«åˆ©ç”¨ é‡æ–°è®¾è®¡äº†é›†ç¾¤è°ƒåº¦å™¨å’ŒDLæ¡†æ¶æ¥é€‚åº”ç”Ÿäº§jobçš„æ³¢åŠ¨çš„èµ„æºç‰¹ç‚¹  é€šè¿‡  æ¡†æ¶ä¿¡æ¯æ„ŸçŸ¥è°ƒåº¦ é€æ˜æ˜¾å­˜æ‰©å±• å¿«é€Ÿå¯æŒç»­çš„ä»»åŠ¡é—´åè°ƒ   ä½¿ç”¨è¿™ä¸ªç»“æ„ï¼ŒAntmanä¸ºDLä»»åŠ¡çš„åŒæ—¶æ‰§è¡Œçš„policy design å¼€è¾Ÿäº†ç©ºé—´   AntMané‡‡ç”¨äº†ç®€å•ä¸”æœ‰æ•ˆçš„ç­–ç•¥æ¥æœ€å¤§åŒ–é›†ç¾¤åå  ä¸ºRGJæä¾›èµ„æºä¿è¯çš„åŒæ—¶ åˆ†é…ä¸€äº›å¶ç„¶æ€§çš„ä»»åŠ¡æ¥å°½åŠ›è€Œä¸ºçš„åˆ©ç”¨GPUèµ„æºï¼ˆä½ä¼˜å…ˆçº§ä¸”ä¸ä¿è¯èµ„æºï¼‰     æœ¬æ–‡ä¸»è¦è´¡çŒ®å¦‚ä¸‹  å¯¹ç”Ÿäº§ç¯å¢ƒçš„DLé›†ç¾¤è¿›è¡Œè°ƒç ”ï¼Œå‘ç°ä½åˆ©ç”¨ç‡æ¥è‡ªäºä¸‰ä¸ªæ–¹é¢ï¼šç¡¬ä»¶ï¼Œé›†ç¾¤è°ƒåº¦ï¼Œjobè¡Œä¸º åœ¨DLæ¡†æ¶ä¸­ä¸ºæ˜¾å­˜å’Œè®¡ç®—å•å…ƒç®¡ç†å¼•å…¥äº†ä¸¤ç§åŠ¨æ€æ”¾ç¼©æœºåˆ¶ï¼Œæ¥è§£å†³GPUå…±äº«é—®é¢˜ã€‚æ–°æœºåˆ¶åˆ©ç”¨DLçš„å·¥ä½œç‰¹å¾æ¥åŠ¨æ€è°ƒæ•´DL jobçš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œåœ¨ä½œä¸šæ‰§è¡ŒæœŸé—´ã€‚ é€šè¿‡å…±åŒè®¾è®¡é›†ç¾¤è°ƒåº¦å™¨å’ŒDLæ¡†æ¶ä»¥åˆ©ç”¨åŠ¨æ€ç¼©æ”¾æœºåˆ¶ï¼Œæˆ‘ä»¬ä¸ºGPUå…±äº«å¼•å…¥äº†ä¸€ç§æ–°çš„å·¥ä¸šæ–¹æ³•ã€‚è¿™åœ¨å¤šç§Ÿæˆ·é›†ç¾¤ä¸­ç»´æŠ¤å·¥ä½œæœåŠ¡çº§åè®®ï¼ˆSLAï¼‰ï¼ŒåŒæ—¶é€šè¿‡æœºä¼šè°ƒåº¦æ¥æ”¹å–„é›†ç¾¤åˆ©ç”¨ç‡ã€‚ åœ¨è¶…è¿‡5000ä¸ªGPUä¸Šè¿›è¡Œäº†å®éªŒ    Motivation deep learning Training  æ·±åº¦å­¦ä¹ è®­ç»ƒé€šå¸¸åŒ…æ‹¬æ•°ç™¾ä¸‡æ¬¡è¿­ä»£ï¼Œæ¯ä¸ªè¿­ä»£è¿‡ç¨‹éƒ½ç§°ä¸ºmini-batchã€‚  é€šå¸¸ï¼Œè®­ç»ƒmini-batchå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µã€‚  é¦–å…ˆï¼Œè®¡ç®—æ ·å“å’Œæ¨¡å‹æƒé‡ä»¥äº§ç”Ÿä¸€ç»„å¾—åˆ†ï¼Œç§°ä¸ºforward pass å…¶æ¬¡ï¼Œä½¿ç”¨ç›®æ ‡å‡½æ•°åœ¨äº§ç”Ÿçš„åˆ†æ•°å’Œæ‰€éœ€çš„åˆ†æ•°ä¹‹é—´è®¡ç®—loss errorã€‚ç„¶åï¼ŒæŸå¤±é€šè¿‡æ¨¡å‹å‘åæ‰©æ•£ï¼Œä»¥è®¡ç®—æ¢¯åº¦ï¼Œç§°ä¸ºbackward passã€‚ æœ€åï¼Œé€šè¿‡ç”±ä¼˜åŒ–å™¨å®šä¹‰çš„å­¦ä¹ ç‡æ¥ç¼©æ”¾æ¢¯åº¦ï¼Œä»¥æ›´æ–°æ¨¡å‹å‚æ•°ã€‚   æ­£å‘é€šè¡Œçš„è®¡ç®—è¾“å‡ºé€šå¸¸åŒ…æ‹¬è®¸å¤šæ•°æ®è¾“å‡ºï¼Œæ¯ä¸ªæ•°æ®è¾“å‡ºç§°ä¸ºå¼ é‡ã€‚è¿™äº›å¼ é‡åº”æš‚æ—¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¹¶è¢«å‘åé€šè¿‡ä»¥è®¡ç®—æ¢¯åº¦ã€‚é€šå¸¸ï¼Œä¸ºäº†ç›‘è§†åŸ¹è®­ä¸­çš„æ¨¡å‹è´¨é‡ï¼Œå®šæœŸè§¦å‘è¯„ä¼°.   ä¸ºäº†ä½¿ç”¨å¤§é‡æ•°æ®åŸ¹è®­æ¨¡å‹ï¼ŒDLé€šå¸¸åœ¨å¤šä¸ªGPUä¸­é‡‡ç”¨æ•°æ®å¹¶è¡Œæ€§ï¼Œå…¶ä¸­æ¯ä¸ªGPUè´Ÿè´£å¹¶è¡Œå¤„ç†æ•°æ®å­é›†ï¼ŒåŒæ—¶åœ¨æ¨¡å‹æ›´æ–°ä¹‹å‰æ‰§è¡Œæ¯ä¸ªè¿·ä½ æ‰¹æ¬¡æ¢¯åº¦åŒæ­¥ã€‚ åœ¨å¤§å‹å…¬å¸ä¸­ï¼Œå¤šç§Ÿæˆ·é›†ç¾¤é€šå¸¸ç”¨äºæ”¹å–„ç¡¬ä»¶åˆ©ç”¨ç‡ï¼Œç”¨æˆ·æœ‰æ—¶å¯ä»¥è¶…é¢è®¢é˜…GPUèµ„æºé…é¢ï¼Œå°¤å…¶æ˜¯å½“GPUè¦æ±‚çˆ†å‘æ—¶ã€‚  Characterizing Production DL Cluster æˆ‘ä»¬ä»ä¸‰ä¸ªè§’åº¦ç ”ç©¶ç”Ÿäº§é›†ç¾¤ä¸­çš„èµ„æºä½¿ç”¨ç‡ï¼šç¡¬ä»¶ï¼Œé›†ç¾¤è°ƒåº¦å’Œjobè¡Œä¸ºã€‚\n  åœ¨ä½¿ç”¨ä¸­çš„GPUçš„ä½åˆ©ç”¨ç‡\n \rimage-20220831200958715\r å†…å­˜å®¹é‡ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œåªæœ‰20ï¼…çš„GPUæ­£åœ¨è¿è¡Œæ¶ˆè€—ä¸€åŠä»¥ä¸ŠGPUå­˜å‚¨å™¨çš„åº”ç”¨ç¨‹åºã€‚ å…³äºè®¡ç®—å•å…ƒçš„ä½¿ç”¨ï¼Œåªæœ‰10ï¼…çš„GPUè·å¾—äº†é«˜äº80ï¼…çš„GPUåˆ©ç”¨ç‡ã€‚ è¯¥ç»Ÿè®¡æ•°æ®è¡¨æ˜ï¼ŒGPUå†…å­˜å’Œè®¡ç®—å•å…ƒå‡æœªå¾—åˆ°å……åˆ†åˆ©ç”¨ï¼Œå› æ­¤æµªè´¹äº†æ˜‚è´µçš„ç¡¬ä»¶èµ„æºã€‚    å¯¹gang-scheduleçš„ç©ºé—²ç­‰å¾…\n Gang schedulingæ˜¯åœ¨å¹¶å‘ç³»ç»Ÿä¸­å°†å¤šä¸ªç›¸å…³è”çš„è¿›ç¨‹è°ƒåº¦åˆ°ä¸åŒå¤„ç†å™¨ä¸ŠåŒæ—¶è¿è¡Œçš„ç­–ç•¥ï¼Œå…¶æœ€ä¸»è¦çš„åŸåˆ™æ˜¯ä¿è¯æ‰€æœ‰ç›¸å…³è”çš„è¿›ç¨‹èƒ½å¤ŸåŒæ—¶å¯åŠ¨ï¼Œé˜²æ­¢éƒ¨åˆ†è¿›ç¨‹çš„å¼‚å¸¸ï¼Œå¯¼è‡´æ•´ä¸ªå…³è”è¿›ç¨‹ç»„çš„é˜»å¡ã€‚ä¾‹å¦‚ï¼Œæ‚¨æäº¤ä¸€ä¸ªæ‰¹é‡Jobï¼Œè¿™ä¸ªæ‰¹é‡JobåŒ…å«å¤šä¸ªä»»åŠ¡ï¼Œè¦ä¹ˆè¿™å¤šä¸ªä»»åŠ¡å…¨éƒ¨è°ƒåº¦æˆåŠŸï¼Œè¦ä¹ˆä¸€ä¸ªéƒ½è°ƒåº¦ä¸æˆåŠŸã€‚è¿™ç§All-or-Nothingè°ƒåº¦åœºæ™¯ï¼Œå°±è¢«ç§°ä½œGang schedulingã€‚\n  \rimage-20220831201015900\r å¤šGPUè®­ç»ƒå·¥ä½œéœ€è¦Gang schedulingï¼Œè¿™æ„å‘³ç€é™¤éåŒæ—¶æä¾›æ‰€æœ‰å¿…éœ€çš„GPUï¼Œå¦åˆ™jobå°†ä¸ä¼šå¼€å§‹è®­ç»ƒ ç”±äºGPUèµ„æºå¾€å¾€ä¸èƒ½åŒæ—¶å…¨éƒ¨è·å¾—ï¼Œ æ‰€ä»¥ä¼šå‡ºç°idle waitingã€‚ ä¸€ä¸ªjobéœ€è¦çš„GPUè¶Šå¤šï¼Œ å®ƒçš„å¹³å‡é—²ç½®æ—¶é—´å°±è¶Šé•¿ **èµ„æºåˆ°è¾¾çš„ä¸å¯é¢„æµ‹å¯¼è‡´äº†é¢„ç•™èµ„æºçš„idle waitingã€‚**ä¸€ä¸ªå¹¼ç¨šçš„è§£å†³æ–¹æ¡ˆæ˜¯åœ¨GPU idle waitingçš„æ—¶å€™æ‰§è¡Œåˆ«çš„jobã€‚ä½†æ˜¯è¿™ä¼šå¯¼è‡´èµ„æºéœ€æ±‚å¤§jobçš„é¥¥é¥¿ï¼Œå½±å“åˆ†é…å…¬å¹³æ€§ã€‚å¦å¤–ä¸€æ—¦èµ„æºéœ€è¦è¢«æ»¡è¶³å¯¼è‡´çš„GPUéœ€æ±‚æ¿€å¢æˆ–è®¸å¯¼è‡´GPUä¹‹é—´çš„èµ„æºå†²çªï¼Œå¯¼è‡´å·¥ä½œfail    åŠ¨æ€èµ„æºéœ€æ±‚\n \rimage-20220831201047910\r åœ¨ä¸€ä¸ªDL jobç”Ÿå‘½å‘¨æœŸä¸­ï¼Œ GPUèµ„æºå¾€å¾€æœªè¢«å……åˆ†åˆ©ç”¨ã€‚ å›¾3ï¼šåœ¨Criteoæ•°æ®é›†ä¸Šè¿è¡ŒDEEPFM [20]æ—¶çš„å‰10åˆ†é’Ÿã€‚ä¸€å¼€å§‹ï¼Œæ•°æ®é›†ä¸Šçš„é¢„å¤„ç†ä»…éœ€è¦CPUã€‚ä½†æ˜¯ï¼ŒGPUçš„SMåˆ©ç”¨ç‡å’Œå†…å­˜ä½¿ç”¨é‡åœ¨275ç§’æ—¶å¯åŠ¨ã€‚ å›¾4ï¼šè®­ç»ƒå¯ä»¥åŒ…å«å‡ ä¸ªé˜¶æ®µï¼Œä¸åŒé˜¶æ®µçš„SMå’ŒMemoryçš„ä½¿ç”¨ç‡éƒ½æ˜¯ä¸ä¸€æ ·çš„ èµ„æºéœ€æ±‚çš„åŠ¨æ€å˜åŒ–ä¸å›ºå®šçš„èµ„æºåˆ†é…å’Œæ¼«é•¿çš„è®­ç»ƒæ—¶é—´ç›¸çŸ›ç›¾ã€‚èµ„æºéœ€è¦æ»¡è¶³jobçš„å³°å€¼éœ€è¦ï¼Œå¯¼è‡´è¿™ä¸ªæ˜‚è´µçš„ç¡¬ä»¶è¢«ä½æ•ˆåˆ©ç”¨ã€‚æ˜¾å­˜çš„DLæ¡†æ¶çš„memory cachingè®¾è®¡éšè—äº†æ˜¾å­˜ä½¿ç”¨éšæ—¶é—´çš„å˜åŒ–ï¼Œä¸€å®šç¨‹åº¦ä¸Šé˜»æ­¢äº†GPUçš„æ½œåœ¨å…±äº«ã€‚    Opportunities in DL Uniqueness   è¶…å–æœ‰æœºä¼šæé«˜é›†ç¾¤çš„åå\n ä¸å¯é¢„æµ‹çš„jobå†…å’Œjobé—´çš„éœ€æ±‚æ¿€å¢ä¸ºå®‰å…¨çš„èµ„æºå…±äº«å¼•å…¥äº†æŒ‘æˆ˜  å› ä¸ºèµ„æºç«äº‰ï¼Œ jobså¯èƒ½ä¼šæŠŠæ˜¾å­˜ç”¨å…‰ åœ¨å¤šç§Ÿæˆ·é›†ç¾¤ä¸­ï¼Œå½“jobsåœ¨å…±äº«ç¯å¢ƒæ‰§è¡Œæ—¶ï¼Œä¸ºæŒæœ‰å®šé¢èµ„æºçš„jobæä¾›æ€§èƒ½éš”ç¦»æ˜¯ååˆ†é‡è¦çš„   AntManåˆ©ç”¨DL trainingçš„ç‰¹æ€§æ¥åˆ©ç”¨è¿™ä¸ªæœºä¼š    æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒé›†ç¾¤çš„10kä¸ªtaskä¸­å–æ ·å‘ç°\n \rimage-20220905143619325\r åªæœ‰ä¸€å°éƒ¨åˆ†ç”¨æ¥å­˜å‚¨æ¨¡å‹ï¼Œ ä¸”90%çš„æ¨¡å‹å¤§å°ä¸è¶…è¿‡500M å¤§éƒ¨åˆ†æ˜¾å­˜åœ¨åŒä¸€ä¸ªmini-batchä¸­è¢«åˆ†é…å’Œé‡Šæ”¾ é™¤æ­¤ä¹‹å¤–ï¼Œä¸€ä¸ªmini-batchçš„æ¶ˆè€—æ—¶é—´å¾ˆçŸ­ï¼Œ 80%çš„ä»»åŠ¡åœ¨600msä¹‹å†…æ¶ˆè€—ä¸€ä¸ªmini-batch    æˆ‘ä»¬é€šè¿‡å¤šç§æ–¹å¼åˆ©ç”¨è¿™ç§ç‹¬ç‰¹çš„ç‰¹å¾æ¥å®‰æ’å…±äº«GPUä¸Šçš„ä½œä¸šã€‚\n é¦–å…ˆï¼Œæ ¹æ®é€šå¸¸çš„æ¨¡å‹å¤§å°ï¼Œå¤§éƒ¨åˆ†æ˜¾å­˜åœ¨å…±åŒæ‰§è¡Œçš„ä½œä¸šä¸­å¯ä»¥æ‹¿æ¥è°ƒåº¦ å…¶æ¬¡ï¼Œmini-batchçš„å‘¨æœŸé€šå¸¸å¾ˆçŸ­ï¼Œå¯ä»¥åœ¨æ¯ä¸ªmini-batchè¾¹ç•Œå¤„è¿›è¡Œç»†ç²’åº¦çš„GPUå†…å­˜å’Œè®¡ç®—èµ„æºçš„è°ƒåº¦ã€‚è¿™å¯ä»¥è¿›ä¸€æ­¥å…è®¸jobé—´çš„å¿«é€Ÿèµ„æºåè°ƒã€‚ ç¬¬ä¸‰ï¼Œmini-batché€šå¸¸è¿›è¡Œç›¸ä¼¼çš„è®¡ç®—ï¼Œè¿™å¯ä»¥è¢«åˆ©ç”¨å»æè¿°jobæ€§èƒ½ï¼Œå› æ­¤è¿›åº¦ç‡å¯ä»¥è¢«åˆ›å»ºä½œä¸ºæ€§èƒ½çŸ©é˜µæ¥é‡åŒ–å¹²æ‰°ã€‚    Design AntManæ·±å…¥å…±åŒè®¾è®¡é›†ç¾¤è°ƒåº¦ç¨‹åºå’ŒDLæ¡†æ¶ï¼Œ æœ¬éƒ¨åˆ†å°†ä»‹ç»ä¸‰éƒ¨åˆ†ï¼šDL æ¡†æ¶çš„ä¿®æ”¹ï¼Œè°ƒåº¦å™¨ä¸è°ƒåº¦åŸåˆ™\nDynamic Scaling in DL Frameworks  ä½ä½¿ç”¨æ•ˆç‡çš„GPUé›†ç¾¤æœ‰ç€æ‰§è¡Œæ›´å¤šä»»åŠ¡çš„æ½œåŠ›ï¼Œä½†éœ€è¦è§£å†³ä¸€ä¸‹æŒ‘æˆ˜  ä½¿ç”¨æœ€ä¸‹éœ€æ±‚æ‰§è¡Œjobçš„åŒæ—¶é˜²æ­¢GPUå†…å­˜ä½¿ç”¨çš„çˆ†å‘å¯¼è‡´çš„å¤±æ•ˆ é€‚åº”è®¡ç®—å•å…ƒçš„ä½¿ç”¨æ³¢åŠ¨çš„åŒæ—¶é™åˆ¶æ½œåœ¨çš„å¹²æ‰°   DLæ¡†æ¶æ˜¯ä¸“æ³¨äºGPUæ‰§è¡Œï¼Œ ç¼ºä¹jobåˆä½œçš„èƒ½åŠ›ã€‚è¿™æ¿€å‘äº†åŠ¨æ€ç¼©æ”¾æœºåˆ¶çš„è®¾è®¡ï¼Œæœºåˆ¶åŒ…å«å†…å­˜å’Œè®¡ç®—ä¸¤éƒ¨åˆ†  Memory Management AntManä»¥tensorä¸ºå•ä½ï¼Œåœ¨GPUå’ŒCPUçš„å†…å­˜é—´è¿›è¡ŒåŠ¨æ€å†…å­˜ç®¡ç†ã€‚ç±»ä¼¼äºæ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ï¼ŒAntManä»¥tensorä¸ºå•ä½è¿›è¡Œäº†æ˜¾å­˜è™šæ‹ŸåŒ–ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼ŒDLæ¡†æ¶å¯ä»¥æä¾›è¶…å‡ºä¸Šé™çš„æ˜¾å­˜ã€‚\n  æ˜¾å­˜åˆ†é…\n \rimage-20220905151151692\r åœ¨å¼ é‡è¢«é”€æ¯åï¼ŒGPUå†…å­˜è¢«ç¼“å­˜åœ¨DLæ¡†æ¶å†…çš„ä¸€ä¸ªå…¨å±€å†…å­˜åˆ†é…å™¨ä¸­ï¼Œæ™®éæƒ…å†µä¸‹ï¼Œä¸€äº›å¼ é‡åªåœ¨DLè®­ç»ƒçš„æŸäº›é˜¶æ®µä½¿ç”¨ï¼ˆå¦‚æ•°æ®é¢„å¤„ç†ã€è¯„ä¼°ï¼‰ï¼Œä¸å†éœ€è¦äº†ã€‚ç„¶è€Œï¼Œè¿™éƒ¨åˆ†ç¼“å­˜çš„GPUå†…å­˜ä¸ä¼šè¢«é‡Šæ”¾ï¼ˆå›¾6cï¼‰ã€‚DLæ¡†æ¶ä¸­çš„è¿™ç§ç¼“å­˜å†…å­˜è®¾è®¡ä¼˜åŒ–äº†å•ä¸ªä½œä¸šçš„æ€§èƒ½ï¼Œä½†ä»£ä»·æ˜¯å¤±å»äº†å…±äº«æ½œåŠ›ã€‚ AntManè½¬å‘äº†æ‰©å±•GPUå†…å­˜ä¸Šé™çš„æ–¹æ³•ã€‚å®ƒä¸»åŠ¨æ£€æµ‹ä½¿ç”¨ä¸­çš„å†…å­˜ï¼Œä»¥ç¼©å°ç¼“å­˜çš„å†…å­˜ï¼Œä»è€Œè‡ªçœåœ°å°†GPUå†…å­˜çš„ä½¿ç”¨è°ƒæ•´åˆé€‚ã€‚è¿™æ˜¯é€šè¿‡ç›‘æµ‹åº”ç”¨æ€§èƒ½å’Œå¤„ç†å°æ‰¹é‡æ—¶çš„å†…å­˜éœ€æ±‚æ¥å®ç°çš„ï¼ˆå›¾6dï¼‰ã€‚AntManä½¿ç”¨å…¶æœ€å¤§çš„åŠªåŠ›åœ¨GPUè®¾å¤‡ä¸Šåˆ†é…å¼ é‡ï¼Œç„¶è€Œï¼Œå¦‚æœGPUå†…å­˜ä»ç„¶ç¼ºä¹ï¼Œå¼ é‡å¯ä»¥åœ¨GPUä¹‹å¤–ç”¨ä¸»æœºå†…å­˜åˆ†é…ï¼ˆå›¾6eï¼‰ã€‚å½“GPUå†…å­˜çš„ä¸Šé™å¢åŠ æ—¶ï¼ŒTensorså¯ä»¥è‡ªåŠ¨åˆ†é…å›GPUï¼ˆå›¾6fï¼‰ã€‚    æ˜¾å­˜ä¸Šé™åŠ¨æ€è°ƒæ•´\n  \rimage-20220905151235705\r\n  å›¾7aè¯´æ˜äº†å†…å­˜æ‰©å±•å¦‚ä½•è§£å†³çªå‘éœ€æ±‚ã€‚åœ¨T0ï¼Œæ­£åœ¨è¿è¡Œçš„DLè®­ç»ƒä½œä¸šçš„å†…å­˜éœ€æ±‚å¢åŠ ï¼Œç”±äºGPUå†…å­˜çš„æœ‰é™ä¸Šé™ï¼Œä¸€äº›å¼ é‡ä¸èƒ½æ”¾åœ¨GPUå†…å­˜ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸»æœºå†…å­˜åˆ›å»ºã€‚AntManæ£€æµ‹åˆ°ä¸»æœºå†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œåœ¨T1ï¼Œå®ƒæ ¹æ®ä¸»æœºå†…å­˜çš„ä½¿ç”¨æƒ…å†µæé«˜è¯¥ä½œä¸šçš„GPUå†…å­˜çš„ä¸Šé™ï¼Œè™½ç„¶åœ¨è¿™ä¸€ä¸ªå°æ‰¹æ¬¡ä¸­ï¼Œè¿™ä¸ªè¿è¡Œä½œä¸šçš„æ€§èƒ½å¯èƒ½ä¼šå‡æ…¢ï¼Œå› ä¸ºå¼ é‡è¢«æ”¾ç½®åœ¨ä¸»æœºå†…å­˜ä¸­ï¼Œä½†æ˜¯åç»­çš„tensoréƒ½ä¼šç”³è¯·åˆ°æ˜¾å­˜ä¸Šã€‚è€ƒè™‘åˆ°ä¸€ä¸ªå…¸å‹çš„DLè®­ç»ƒå¾€å¾€éœ€è¦æ•°ç™¾ä¸‡ä¸ªå°æ‰¹æ¬¡ï¼Œè¿™ç§æ€§èƒ½å¼€é”€æ˜¯å¯ä»¥å¿½ç•¥ä¸è®¡çš„ã€‚\n    è¿è¡Œæ—¶æ˜¾å­˜ç»†ç²’åº¦è°ƒæ•´\n æ­¤å¤–ï¼ŒAntManåœ¨è¿è¡Œæ—¶æä¾›ç»†ç²’åº¦çš„GPUå†…å­˜è°ƒåº¦ã€‚å¦‚å›¾7bæ‰€ç¤ºï¼Œä¸€ä¸ªè®­ç»ƒä½œä¸šå¯èƒ½ä¼šæ”¶ç¼©ä»¥ç¡®ä¿å…¶ä»–ä½œä¸šçš„å†…å­˜èµ„æºï¼Œå¹¶åœ¨å…¶ä»–ä½œä¸šå®Œæˆåå†å¢é•¿ã€‚å®ƒè¯´æ˜äº†ä¸€ä¸ªDLä½œä¸šåœ¨T0æ—¶ç¼©å‡ï¼Œåœ¨T1æ—¶å¢åŠ ï¼Œä»£ä»·æ˜¯åœ¨ä¸»æœºå†…å­˜ä¸Šåˆ†é…äº†ä¸€äº›å¼ é‡ã€‚å› æ­¤ï¼Œåœ¨åŒä¸€å…±äº«GPUä¸­è¿è¡Œçš„ä½œä¸šåœ¨T0å’ŒT1ä¹‹é—´å¯¹å‰©ä½™GPUå†…å­˜çš„ä½¿ç”¨æ˜¯æœ‰ä¿éšœçš„ã€‚    Computation Management  åŠ¨æ€è®¡ç®—å•å…ƒç®¡ç†ï¼Œç”¨äºæ§åˆ¶DLè®­ç»ƒä½œä¸šçš„GPUåˆ©ç”¨ç‡ã€‚   ç±»ä¼¼cgroupï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°éš”ç¦»DLç‰¹å®šè¿›ç¨‹çš„GPUè®¡ç®—èµ„æºè®¿é—®ã€‚\n  å½“å¤šä¸ªDLä½œä¸šåœ¨åŒä¸€ä¸ªGPUä¸Šå¯åŠ¨æ—¶ï¼Œå¹²æ‰°ä¸»è¦æ˜¯ç”±æ½œåœ¨çš„GPUå†…æ ¸æ’é˜Ÿå»¶è¿Ÿå’ŒPCIeæ€»çº¿äº‰ç”¨å¼•èµ·çš„ï¼Œè¿™ä¼šå¯¼è‡´æ‰€æœ‰ä½œä¸šçš„æ€§èƒ½ä¸€è‡´ä¸‹é™ï¼Œå¦‚æœpacking jobæ˜¯åœ¨ç›¸åŒçš„æ¨¡å‹å’Œé…ç½®ä¸Šè¿è¡Œçš„è¯ã€‚\n  **å¦‚æœä¸åŒçš„ä½œä¸šè¢«æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œä½œä¸šä¼šä»¥ä¸åŒçš„æ–¹å¼å˜æ…¢ã€‚**è¿™æ˜¯å› ä¸ºä½œä¸šåœ¨è·å–GPUè®¡ç®—å•å…ƒæ–¹é¢æœ‰ä¸åŒçš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œä½œä¸šæ€§èƒ½åœ¨GPUå…±äº«ä¸­å‡ ä¹æ— æ³•ä¿è¯æˆ–é¢„æµ‹ï¼Œå¯¼è‡´å¤šç§Ÿæˆ·é›†ç¾¤çš„GPUå…±äº«éƒ¨ç½²å›°éš¾ã€‚\n  AntManä¸­ï¼ŒGPUè¿ç®—å™¨çš„æ‰§è¡Œæ˜¯ç”±ä¸€ä¸ªæ–°å¼•å…¥çš„æ¨¡å—è´Ÿè´£çš„ï¼Œç§°ä¸ºGpuOpManagerã€‚\n å½“GPUè¿ç®—å™¨å‡†å¤‡æ‰§è¡Œæ—¶ï¼Œå®ƒè¢«æ·»åŠ åˆ°GpuOpManagerï¼Œè€Œä¸æ˜¯ç›´æ¥å¯åŠ¨ã€‚ GpuOpManagerçš„ä¸»è¦æ€æƒ³æ˜¯é€šè¿‡å»¶è¿Ÿæ‰§è¡ŒGPUè¿ç®—ç¬¦æ¥æ§åˆ¶å¯åŠ¨é¢‘ç‡ã€‚GpuOpManageré€šè¿‡è¿™ç§æ–¹å¼æ¥é™åˆ¶DLè®­ç»ƒä½œä¸šçš„GPUåˆ©ç”¨ç‡ã€‚GpuOpManagerä¸æ–­å¯¹GPUè¿ç®—å™¨çš„æ‰§è¡Œæ—¶é—´è¿›è¡Œåˆ†æï¼Œå¹¶åœ¨å¯åŠ¨GPUè¿ç®—å™¨ä¹‹å‰ç®€å•åœ°åˆ†é…ç©ºé—²çš„æ—¶é—´æ®µã€‚ è¯·æ³¨æ„ï¼ŒGpuOpManageråªæ˜¯å»¶è¿Ÿäº†GPUå†…æ ¸çš„æ‰§è¡Œã€‚å› æ­¤ï¼Œè¿ç®—ç¬¦ï¼ˆåŒ…æ‹¬GPUè¿ç®—ç¬¦å’ŒCPUè¿ç®—ç¬¦ï¼‰ä¹‹é—´çš„æ½œåœ¨ä¾èµ–å…³ç³»è¢«ä¿ç•™ä¸‹æ¥ï¼Œè¿™æ„å‘³ç€å¦‚æœå¯èƒ½çš„è¯ï¼ŒCPUè¿ç®—ç¬¦å¯ä»¥ç»§ç»­ã€‚    \rimage-20220905151222951\r\n å›¾8è¯´æ˜äº†åœ¨åŒä¸€GPUä¸Šæ‰§è¡Œçš„ä¸¤ä¸ªä½œä¸šçš„GPUè®¡ç®—å•å…ƒå¹²æ‰°çš„ä¾‹å­ã€‚å›¾8aè¯´æ˜äº†Job-Aæ˜¯å¦‚ä½•ä»¥ç»†ç²’åº¦çš„æ–¹å¼åœ¨GPUä¸Šæ‰§è¡Œçš„ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒGPUå†…æ ¸å°†è¢«æŒ‰é¡ºåºæ”¾ç½®ï¼Œå¹¶ç”±GPUè®¡ç®—å•å…ƒé€ä¸€å¤„ç†ã€‚è¯·æ³¨æ„ï¼Œåœ¨å›¾8ä¸­ï¼ŒJob-Aå¯èƒ½æ— æ³•ä½¿GPUå®Œå…¨é¥±å’Œï¼Œå¯¼è‡´GPUå‘¨æœŸé—²ç½®ï¼ŒGPUåˆ©ç”¨ç‡ä½ï¼Œæœ‰å¯èƒ½è¢«å…¶ä»–ä½œä¸šä½¿ç”¨ã€‚\nå› æ­¤ï¼Œä½œä¸š-Bè¢«å®‰æ’åœ¨è¿™ä¸ªGPUä¸Šï¼ˆå›¾8bï¼‰ã€‚Job-Bçš„GPUæ“ä½œè€…å¯åŠ¨åœ¨GPUä¸­æ‰§è¡Œçš„å†…æ ¸ï¼ˆç»¿è‰²å—ï¼‰ï¼Œè¿™å¯ä»¥å¡«æ»¡å®ƒï¼Œä»è€Œå»¶è¿Ÿå…¶ä»–GPUå†…æ ¸ï¼ˆè“è‰²å—ï¼‰çš„æ‰§è¡Œï¼Œå¯¼è‡´Job-Açš„æ€§èƒ½ä¸ä½³ã€‚\nè¿™ç§å¹²æ‰°ä¸»è¦æ¥è‡ªäºç¼ºä¹æ§åˆ¶GPUå†…æ ¸æ‰§è¡Œé¢‘ç‡çš„èƒ½åŠ›ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨DLæ¡†æ¶ä¸­å¼•å…¥äº†ä¸€ä¸ªGPUè¿ç®—å™¨ç®¡ç†å™¨ï¼ˆå›¾8cï¼‰ã€‚\nç°æœ‰çš„DLæ¡†æ¶ä¸€æ—¦æ»¡è¶³äº†GPUè¿ç®—å™¨çš„æ§åˆ¶ä¾èµ–æ€§ï¼Œå°±ä¼šåœ¨GPUè¿ç®—å™¨ä¸­å‘å¸ƒGPUå†…æ ¸ã€‚åœ¨å¦‚å›¾8cæ‰€ç¤ºï¼Œç¬¬ä¸‰ä¸ªCPUæ“ä½œç¬¦æ²¡æœ‰è¢«é˜»æ­¢ï¼Œç„¶è€Œï¼Œç¬¬å››ä¸ªæ“ä½œç¬¦è¢«å»¶è¿Ÿäº†ï¼Œå› ä¸ºå®ƒä¾èµ–äºç¬¬äºŒä¸ªGPUæ“ä½œç¬¦ï¼Œå®ƒçš„æ‰§è¡Œè¢«GpuOpManagerå»¶è¿Ÿäº†ã€‚\n     Collaborative Scheduler   AntMançš„æ•´ä½“æ¶æ„\n \rimage-20220905152947633\r AntMané‡‡ç”¨äº†ä¸€ä¸ªåˆ†å±‚ç»“æ„  ä¸€ä¸ªå…¨å±€è°ƒåº¦å™¨è´Ÿè´£job è°ƒåº¦ æ¯ä¸ªå·¥ä½œæœåŠ¡å™¨éƒ½åŒ…å«ä¸€ä¸ªæœ¬åœ°åè°ƒå™¨ï¼Œè´Ÿè´£é€šè¿‡è€ƒè™‘DLæ¡†æ¶æŠ¥å‘Šçš„ç»Ÿè®¡æ•°æ®ï¼Œä½¿ç”¨åŠ¨æ€èµ„æºæ‰©å±•çš„åŸºå…ƒç®¡ç†ä½œä¸šçš„æ‰§è¡Œ   AntManæ˜¯ä¸ºå¤šç§Ÿæˆ·GPUé›†ç¾¤è®¾è®¡çš„ã€‚  åœ¨å¤šç§Ÿæˆ·é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªç§Ÿæˆ·é€šå¸¸æ‹¥æœ‰ä¸€å®šçš„èµ„æºï¼Œè¢«æ³¨é‡Šä¸ºèµ„æºé…é¢ï¼ˆå³GPUçš„æ•°é‡ï¼‰ï¼Œè¿™æ˜¯å¯ä»¥åˆ†é…ç»™è¯¥ç§Ÿæˆ·çš„ä½œä¸šçš„å¹¶å‘æ€§èƒ½ä¿è¯èµ„æºã€‚ æ¯ä¸ªç§Ÿæˆ·çš„GPUèµ„æºé…é¢ä¹‹å’Œå°äºç­‰äºä¸€ä¸ªGPUé›†ç¾¤çš„æ€»å®¹é‡ã€‚   åœ¨AntManä¸­ï¼Œå·¥ä½œè¢«åˆ†ä¸ºä¸¤ç§ï¼Œç”±å…¨å±€è°ƒåº¦å™¨åº”ç”¨ä¸åŒçš„è°ƒåº¦ç­–ç•¥  èµ„æºä¿è¯å‹å·¥ä½œï¼šèµ„æºä¿éšœå‹ä½œä¸šä¼šæ¶ˆè€—å…¶ç›¸åº”ç§Ÿæˆ·çš„ä¸€å®šæ•°é‡çš„GPUèµ„æºé…é¢ã€‚AntManç¡®ä¿èµ„æºä¿è¯ä½œä¸šçš„æ€§èƒ½åº”è¯¥ä¸ç‹¬å æ‰§è¡Œçš„æ€§èƒ½ä¸€è‡´ã€‚ æœºä¼šå‹å·¥ä½œï¼šæœºä¼šå‹ä½œä¸šåˆ™ä¸ä¼šã€‚      AntManå„æ¨¡å—çš„è¿ä½œæ–¹å¼\n è°ƒåº¦å†³ç­–å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªè‡ªä¸Šè€Œä¸‹çš„æ§åˆ¶æµ  åœ¨AntManä¸­ï¼Œä¸ä¼ ç»Ÿçš„é›†ç¾¤è°ƒåº¦å™¨ç±»ä¼¼ï¼Œè°ƒåº¦å†³ç­–ç”±å…¨å±€è°ƒåº¦å™¨æ´¾å‘ç»™æœ¬åœ°åè°ƒå™¨ æœ¬åœ°åè°ƒå™¨ä½¿ç”¨åŠ¨æ€ç¼©æ”¾æœºåˆ¶å¯¹GPUèµ„æºè¿›è¡Œå†…çœå¼è°ƒåº¦ï¼Œä»¥è¾¾åˆ°DLè®­ç»ƒä½œä¸šçš„ç›®çš„   æ•°æ®ç»Ÿè®¡æµä¿¡æ¯ç”±æœ¬åœ°åè°ƒå™¨çš„ç»Ÿè®¡æ¨¡å—æ”¶é›†ï¼Œå¹¶ä»¥è‡ªä¸‹è€Œä¸Šçš„æ–¹å¼æ±‡æ€»åˆ°é›†ç¾¤ç»Ÿè®¡æ¨¡å—ä¸Š  ä¿¡æ¯  ç¡¬ä»¶ä¿¡æ¯  GPUåˆ©ç”¨ç‡ GPUå†…å­˜ä½¿ç”¨ç‡   DLæ¡†æ¶æŠ¥å‘Šçš„è¯¦ç»†ä½œä¸šä¿¡æ¯  å°å‹æ‰¹æ¬¡æŒç»­æ—¶é—´ å³°å€¼å†…å­˜ä½¿ç”¨ç‡ æœ€å°å†…å­˜ä½¿ç”¨ç‡ ä¸»æœºå†…å­˜æ¶ˆè€—ç­‰     è¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©å…¨å±€è°ƒåº¦å™¨åšå‡ºä½œä¸šè°ƒåº¦å†³ç­–  å³°å€¼å†…å­˜å’Œæœ€å°å†…å­˜ä½¿ç”¨é‡æ˜¯ç”¨æ¥æŒ‡ç¤ºå¯ä»¥å¿«é€Ÿæä¾›çš„GPUå†…å­˜å¤§å° æ‰¹å¤„ç†æ—¶é—´æ˜¾ç¤ºGPUå†…å­˜å¤šä¹…å¯ä»¥ç”¨äºå¦ä¸€ä¸ªDLè®­ç»ƒä½œä¸š     å½“ä½œä¸šåœ¨GPUæœåŠ¡å™¨ä¸Šå¯åŠ¨ï¼Œæœ¬åœ°è°ƒåº¦å™¨ç®¡ç†å…¶ç«¯åˆ°ç«¯æ‰§è¡Œ  ç”±äºDLè®­ç»ƒä½œä¸šçš„è´Ÿè½½æ³¢åŠ¨ï¼Œæœ¬åœ°åè°ƒå™¨ä»¥è‡ªçœ(introspective)çš„æ–¹å¼è¡Œäº‹ï¼Œå¯¹DLæ¡†æ¶è¿›è¡ŒæŒç»­çš„ä½œä¸šæ§åˆ¶ å®ƒä»ç¡¬ä»¶å’ŒDLæ¡†æ¶ä¸­æ”¶é›†æ‰€æœ‰ä½œä¸šçš„ç»Ÿè®¡æ•°æ® -\u0026gt; ä½¿ç”¨æˆ‘ä»¬åœ¨ç¬¬3.1èŠ‚ä¸­ä»‹ç»çš„æ–°åŸè¯­ \u0026ndash;\u0026gt; é€šè¿‡èµ„æºä½¿ç”¨è°ƒæ•´ï¼ˆä¾‹å¦‚ï¼Œæ”¶ç¼©GPUå†…å­˜ï¼‰\u0026ndash;\u0026gt; æ¥æ§åˆ¶ä½œä¸šæ€§èƒ½      Scheduling Policy   ç›®æ ‡\n  ç”±äºé›†ç¾¤ä¸Šçš„è´Ÿè½½å’Œä½œä¸šçš„èµ„æºéœ€æ±‚ä¸æ–­æ³¢åŠ¨ï¼Œåœ¨æä¾›å…¬å¹³æ€§ï¼ˆå¦‚ç¡®ä¿DLä½œä¸šçš„SLAï¼Œä¿è¯èµ„æºï¼‰å’Œå®ç°é«˜èµ„æºåˆ©ç”¨ç‡ï¼ˆå¦‚GPUåˆ©ç”¨ç‡ï¼‰ä¹‹é—´å­˜åœ¨ç€å›ºæœ‰çš„çŸ›ç›¾ã€‚ æ™®éçš„ç”Ÿäº§å‹DLé›†ç¾¤è°ƒåº¦å™¨ç»å¸¸ä»¥æŸäº›æ–¹å¼ç”¨å…¬å¹³æ€§æ¢å–æ•ˆç‡ã€‚  ä¾‹å¦‚ï¼Œç©ºé—²èµ„æºè¢«åˆ†é…ç»™è¶…é¢é…ç½®çš„ç§Ÿæˆ·ã€‚ ç„¶è€Œï¼Œè¿™æ ·çš„GPUèµ„æºåœ¨æ²¡æœ‰æŠ¢å çš„æƒ…å†µä¸‹å¾ˆéš¾æ‹¿å›æ¥ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒæŠ¢å å¾ˆå°‘è¢«ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä½¿æ­£åœ¨è¿è¡Œçš„ä½œä¸šå¤±è´¥ï¼ŒåŒæ—¶æµªè´¹äº†æ˜‚è´µçš„GPUå‘¨æœŸã€‚ æ­¤å¤–ï¼Œè¿˜æŠ¥å‘Šäº†æ­§è§†å¤§å‹ä½œä¸šçš„å¤±åºè¡Œä¸ºï¼ˆå³åˆ†é…æ›´å¤šçš„GPUï¼‰ï¼Œå¯¼è‡´å€¾å‘äºå°å‹ä½œä¸šçš„ä¸å…¬å¹³ã€‚      é¦–è¦ç›®æ ‡ï¼šå¤šç§Ÿæˆ·å…¬å¹³æ€§  AntMané€šè¿‡åœ¨å…¨å±€è°ƒåº¦å™¨å’Œæœ¬åœ°åè°ƒå™¨ä¸­å®æ–½çš„æ”¿ç­–å®ç°äº†å…¬å¹³æ€§ è¿™äº›æ”¿ç­–ç”±åŠ¨æ€æ‰©å±•æœºåˆ¶æä¾›æ”¯æŒã€‚   ç¬¬äºŒä¼˜å…ˆï¼šæé«˜é›†ç¾¤æ•ˆç‡ï¼Œä»è€Œå®ç°æ›´é«˜çš„ååé‡  AntManä¸­è¿˜å¼•å…¥äº†GPUæœºä¼šä¸»ä¹‰å·¥ä½œï¼Œä»¥çªƒå–GPUä¸­çš„ç©ºé—²å‘¨æœŸï¼Œä»è€Œæœ€å¤§é™åº¦åœ°æé«˜é›†ç¾¤çš„åˆ©ç”¨ç‡ã€‚      å…¨å±€è°ƒåº¦å™¨ï¼šç»´æŠ¤ç€å·¥ä½œåˆ°è¾¾çš„å¤šä¸ªç§Ÿæˆ·é˜Ÿåˆ—ï¼Œå†³å®šä¸ºå·¥ä½œåˆ†é…çš„GPUçš„ä½ç½®\n  è°ƒåº¦ç­–ç•¥\n å¯¹äºèµ„æºä¿è¯å‹å·¥ä½œå’Œæœºä¼šå‹å·¥ä½œï¼ŒAntManåº”ç”¨ä¸åŒçš„è°ƒåº¦ç­–ç•¥ï¼Œå¦‚ç®—æ³•1æ‰€ç¤ºã€‚ \rimage-20220905153001724\r findNodesæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè¿”å›æ»¡è¶³å·¥ä½œè¯·æ±‚çš„èŠ‚ç‚¹å’ŒGPUå€™é€‰è€…ï¼Œå¹¶æœ‰ä¸€ä¸ªå¯é€‰çš„å‚æ•°æ¥æŒ‡å®šçº¦æŸã€‚ å…¨å±€è°ƒåº¦å™¨åœ¨æœ‰è¶³å¤Ÿçš„GPUèµ„æºçš„æƒ…å†µä¸‹å…¬å¹³åœ°åˆ†é…èµ„æºä¿è¯ä½œä¸šã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œèµ„æºä¿è¯ä½œä¸šè¿˜å¯ä»¥ä½¿ç”¨ç©ºé—²çš„GPUèµ„æºæ¥æœ€å¤§åŒ–ä½œä¸šæ€§èƒ½ ã€‚ å¦‚æœä¸€ä¸ªä½œä¸šçš„èµ„æºè¯·æ±‚åªèƒ½éƒ¨åˆ†æ»¡è¶³ï¼Œå…¨å±€è°ƒåº¦å™¨å°±ä¼šä¸ºè¿™ä¸ªä½œä¸šä¿ç•™èµ„æºã€‚ ä¿ç•™çš„èµ„æºå°†æ°¸è¿œä¸ä¼šè¢«å…¶ä»–èµ„æºä¿è¯çš„ä½œä¸šå ç”¨ï¼Œä½†æ˜¯å®ƒä»¬å¯ä»¥è¢«æœºä¼šä¸»ä¹‰ä½œä¸šæ‰€åˆ©ç”¨ã€‚    æœºä¼šä¸»ä¹‰ä½œä¸š\n é»˜è®¤æƒ…å†µä¸‹ï¼Œå…¨å±€è°ƒåº¦å™¨å°†ä¼°è®¡æ²¡æœ‰è®¾ç½®GPUé…é¢çš„ä½œä¸šçš„æ’é˜Ÿæ—¶é—´ã€‚æ’é˜Ÿæ—¶é—´é•¿çš„ä½œä¸šå°†è¢«è‡ªåŠ¨ä½œä¸ºæœºä¼šä¸»ä¹‰ä½œä¸šæ‰§è¡Œã€‚ ç›®çš„ï¼šä¸ºäº†æœ€å¤§é™åº¦åœ°åˆ©ç”¨è‡ªç”±èµ„æºã€‚ å®ƒé€šè¿‡è€ƒè™‘å®é™…çš„GPUåˆ©ç”¨ç‡åœ¨GPUä¸Šåˆ†é…æœºä¼šä¸»ä¹‰ä½œä¸šã€‚åªæœ‰åœ¨è¿‡å»10ç§’å†…åˆ©ç”¨ç‡**ä½äºMï¼ˆç›®å‰è®¾å®šä¸º80%ï¼‰**çš„GPUå¯ä»¥è¢«é€‰ä¸ºå€™é€‰ã€‚ åœ¨æœ€ç©ºé—²çš„å€™é€‰äººä¸Šåˆ†é…æœºä¼šä¸»ä¹‰ä½œä¸šï¼ˆå³minLoadNodesï¼Œç¬¬9-10è¡Œï¼‰ã€‚ åˆ†é…åœ¨åŒä¸€ä¸ªGPUä¸Šçš„ä½œä¸šç”±æœ¬åœ°åè°ƒè€…ç®¡ç†    AntMané»˜è®¤ä¼šè‡ªåŠ¨é€‰æ‹©æœºä¼šä¸»ä¹‰ä½œä¸šï¼Œä½†å®ƒä¹Ÿå…è®¸ç”¨æˆ·åœ¨æäº¤æ—¶æ‰‹åŠ¨ç¡®å®šä½œä¸šç±»å‹\n æ˜ç¡®æŒ‡å®šä¸ºèµ„æºä¿è¯ä½œä¸šï¼Œä»¥ç¡®ä¿SLA ä¸€ä¸ªä½œä¸šä¹Ÿå¯ä»¥è¢«æŒ‡å®šä¸ºæœºä¼šä¸»ä¹‰ä½œä¸šï¼Œæ°¸è¿œä¸ä¼šå ç”¨ç§Ÿæˆ·çš„èµ„æºé…é¢   åœ¨å®è·µä¸­ï¼Œç”¨æˆ·é€šå¸¸ä»¥æœºä¼šä¸»ä¹‰æ¨¡å¼æäº¤ä½œä¸šï¼Œä»¥é¿å…æ½œåœ¨çš„æ’é˜Ÿå»¶è¿Ÿï¼Œç›®çš„æ˜¯è¿›è¡Œè°ƒè¯•å’Œè¶…å‚æ•°è°ƒæ•´ï¼Œè¿™éƒ½æ˜¯ç”±æ—©æœŸåé¦ˆé©±åŠ¨çš„ã€‚\n     æœ¬åœ°è°ƒåº¦å™¨ï¼šåä½œæ‰§è¡Œå…±äº«GPUä¸Šçš„ä½œä¸š\n  å¦‚ä½•åœ¨å…±äº«æ‰§è¡Œä¸­ç¡®ä¿èµ„æºä¿è¯ä½œä¸šçš„æ€§èƒ½\n ä¸€ä¸ªGPUåªä¼šåˆ†é…ç»™ä¸€ä¸ªèµ„æºä¿è¯ä½œä¸šï¼Œå› ä¸ºå®ƒæ¶ˆè€—GPUé…é¢ æœ¬åœ°åè°ƒè€…é¦–å…ˆé™åˆ¶æœºä¼šä¸»ä¹‰å·¥ä½œä½¿ç”¨GPUï¼Œé˜²æ­¢èµ„æºä¿è¯å·¥ä½œå—åˆ°å¹²æ‰° åœ¨å¯åŠ¨DLè®­ç»ƒä½œä¸šæ—¶ï¼Œéœ€è¦ç”±DLæ¡†æ¶åˆå§‹åŒ–GPUè®¾å¤‡  å¦‚æœGPUå¤„äºé«˜è´Ÿè·çŠ¶æ€ï¼Œåˆ™éœ€è¦æ›´å¤šæ—¶é—´ã€‚ï¼ˆåˆå§‹åŒ–æ—¶å ç”¨æ›´å¤šèµ„æºï¼‰ ä¸€æ—¦èµ„æºä¿è¯ä½œä¸šç¨³å®šæ‰§è¡Œï¼Œæœ¬åœ°åè°ƒå™¨å°†æŠŠå‰©ä½™çš„GPUå†…å­˜åˆ†é…ç»™æœºä¼šä¸»ä¹‰ä½œä¸šã€‚   é€šè¿‡ç›‘æµ‹ä½œä¸šæ€§èƒ½ï¼ˆå³å°æ‰¹é‡æ—¶é—´ï¼‰ï¼Œåœ¨ä¸å¹²æ‰°èµ„æºä¿è¯ä½œä¸šçš„æƒ…å†µä¸‹ï¼Œé€æ­¥å¢åŠ æœºä¼šä¸»ä¹‰ä½œä¸šçš„GPUè®¡ç®—å•å…ƒä½¿ç”¨é‡ åŒæ ·ï¼Œå½“ä¸€ä¸ªæœºä¼šä¸»ä¹‰ä½œä¸šåˆ°è¾¾å…±äº«GPUæ—¶ï¼Œæœ¬åœ°åè°ƒå™¨åœ¨ä¸å½±å“èµ„æºä¿è¯ä½œä¸šçš„æƒ…å†µä¸‹ï¼Œä»¥é˜¶æ¢¯å¼çš„æ–¹å¼æé«˜å…¶GPUèµ„æºä½¿ç”¨ç‡ã€‚    å¦‚ä½•å¤„ç†èµ„æºä¿è¯ä½œä¸šçš„èµ„æºéœ€æ±‚æ¿€å¢\n ä¸ºäº†æ„è¯†åˆ°åŠ¨æ€çš„èµ„æºéœ€æ±‚ï¼Œæœ¬åœ°åè°ƒå™¨ç›‘æµ‹DLæ¡†æ¶æŠ¥å‘Šçš„æŒ‡æ ‡ å½“ä¸€ä¸ªèµ„æºä¿è¯ä½œä¸šå¢åŠ äº†GPUå†…å­˜éœ€æ±‚æ—¶ï¼Œç”±äºæœ‰äº†é€šç”¨å†…å­˜ï¼Œå¼ é‡è¢«æš‚æ—¶ä½¿ç”¨ä¸»æœºå†…å­˜å­˜å‚¨ã€‚ æœ¬åœ°åè°ƒè€…ç¼©å‡å…¶ä»–æœºä¼šä¸»ä¹‰ä½œä¸šçš„GPUå†…å­˜ä½¿ç”¨é‡ï¼Œå¹¶æé«˜èµ„æºä¿è¯ä½œä¸šçš„GPUå†…å­˜é™åˆ¶ï¼Œä»¥æ¢å¤å…¶æ€§èƒ½ã€‚ è¿™å¯¹GPUè®¡ç®—å•å…ƒçš„ä½¿ç”¨åè°ƒæ˜¯ç±»ä¼¼çš„ã€‚ ğŸš¨AntManä¾é åº”ç”¨å±‚é¢çš„æŒ‡æ ‡ï¼ˆå³è¿·ä½ æ‰¹å¤„ç†æ—¶é—´ï¼‰æ¥è¡¨æ˜èµ„æºä¿è¯ä½œä¸šçš„æ€§èƒ½ã€‚å¦‚æœå®ƒè§‚å¯Ÿåˆ°èµ„æºä¿è¯ä½œä¸šçš„æ€§èƒ½ä¸ç¨³å®šï¼Œå®ƒå°±ä¼šé‡‡å–æ‚²è§‚çš„ç­–ç•¥æ¥é™åˆ¶å…¶ä»–æœºä¼šä¸»ä¹‰ä½œä¸šå¯¹GPUèµ„æºçš„ä½¿ç”¨ã€‚    å½“ä¸€ä¸ªGPUåªè¢«æœºä¼šä¸»ä¹‰å·¥ä½œæ‰€å…±äº«æ—¶ï¼Œæœ€å¤§é™åº¦åœ°æé«˜èšåˆå·¥ä½œçš„æ€§èƒ½ã€‚\n  å¦‚æœåªæœ‰ä¸€ä¸ªæœºä¼šä¸»ä¹‰ä½œä¸šï¼Œé‚£ä¹ˆGPUèµ„æºå°±å¯ä»¥è¢«è¿™ä¸ªä½œä¸šå……åˆ†åˆ©ç”¨ï¼Œè€Œæ²¡æœ‰ä»»ä½•çº¦æŸã€‚\n  æœ‰æ—¶ï¼Œä¸€ä¸ªGPUæœ‰å¯èƒ½è¢«å¤šä¸ªæœºä¼šä¸»ä¹‰å·¥ä½œå ç”¨ã€‚\n  AntMané€šè¿‡æœ€å¤§é™åº¦åœ°æé«˜GPUå†…å­˜æ•ˆç‡æ¥ä¼˜åŒ–èšåˆä½œä¸šçš„æ€§èƒ½ã€‚\n  åœ¨å¯ç”¨åŠ¨æ€ç¼©æ”¾æœºåˆ¶åï¼Œæˆ‘ä»¬å‘ç°ä¸åŒçš„å·¥ä½œè´Ÿè½½åœ¨å†…å­˜é™åˆ¶å¸¦æ¥çš„æ€§èƒ½ä¸‹é™æ–¹é¢è¡¨ç°å‡ºä¸åŒçš„æ•æ„Ÿæ€§\n   \rimage-20220905153042457\r\n  å¦‚å›¾10æ‰€ç¤ºï¼Œ\n SRæ¨¡å‹å³ä½¿åœ¨å…¶è®¾å¤‡å†…å­˜å‡å°‘90%çš„æƒ…å†µä¸‹ï¼Œä¹Ÿåªé­å—äº†å¤§çº¦25%çš„æ€§èƒ½ä¸‹é™ Cifar10æ•°æ®é›†ä¸Šçš„VGG16[43]æ¨¡å‹ï¼ˆVGGï¼‰å³ä½¿åœ¨è®¾å¤‡å†…å­˜å‡å°‘ä¸€åŠåï¼Œä¹Ÿèƒ½ä¿æŒå…¶å¤§éƒ¨åˆ†çš„åŸå§‹æ€§èƒ½ã€‚ ImageNetæ•°æ®é›†ï¼ˆResNetï¼‰ä¸Šçš„ResNet50[22]å¯¹å†…å­˜ç¼©å‡å¾ˆæ•æ„Ÿï¼›10%çš„å†…å­˜ç¼©å‡ä¼šå¸¦æ¥60%ä»¥ä¸Šçš„é€Ÿåº¦ä¸‹é™ã€‚       å½“æœºä¼šä¸»ä¹‰ä½œä¸šçš„æ€»çš„GPUå†…å­˜éœ€æ±‚è¶…è¿‡äº†GPUçš„å†…å­˜å®¹é‡æ—¶\n å°†GPUå†…å­˜åˆ†é…ç»™æœ€èƒ½æé«˜ä½œä¸šæ€§èƒ½ï¼ˆNormalized Performanceï¼‰çš„ä½œä¸š          Job å‡çº§\n æœºä¼šä¸»ä¹‰å·¥ä½œè™½ç„¶ä»¥best effortæ‰§è¡Œï¼Œ ä½†è¿™æ˜¯åœ¨æ²¡æœ‰SLAä¿è¯çš„æƒ…å†µä¸‹ã€‚ å…¨å±€è°ƒåº¦å™¨ä¼šåœ¨æœ‰è¶³å¤Ÿèµ„æºçš„æƒ…å†µä¸‹å‡çº§è¿™äº›ä½œä¸šï¼Œä»¥å¿«é€Ÿå®Œæˆå®ƒä»¬ã€‚ å…¨å±€è°ƒåº¦å™¨é€šçŸ¥æœ¬åœ°åè°ƒå™¨ï¼Œå°†å…¶æ ‡è®°ä¸ºèµ„æºä¿è¯ä½œä¸šï¼Œå¹¶æ¶ˆè€—ç§Ÿæˆ·çš„GPUé…é¢æ¥å®Œæˆä½œä¸šå‡çº§ã€‚    å¯¹äºåˆ†å¸ƒå¼åŒæ­¥DLè®­ç»ƒæ¥è¯´ï¼Œéƒ¨åˆ†å‡çº§æ²¡æœ‰å¸®åŠ©ï¼Œå› ä¸ºä¸€ä¸ªå·¥ä½œè€…çš„æ€§èƒ½ä¸‹é™å¯èƒ½ä¼šå¹¿æ’­åˆ°æ•´ä¸ªä½œä¸šã€‚ å› æ­¤ï¼Œå…¨å±€è°ƒåº¦å™¨æ£€æŸ¥æ‰€æœ‰GPUæ˜¯å¦éƒ½è¢«æœºä¼šä¸»ä¹‰å·¥ä½œå¡«æ»¡ã€‚ ä¸€æ—¦æ‰€æœ‰çš„ä»»åŠ¡å®ä¾‹éƒ½å‡†å¤‡å¥½å‡çº§ï¼Œå¹¶ä¸”èµ„æºé…é¢è¶³å¤Ÿï¼ŒAntManæ›´æ„¿æ„å°†æœºä¼šä¸»ä¹‰å·¥ä½œå‡çº§ï¼Œè€Œä¸æ˜¯æ–°å¯ä¸€ä¸ªå·¥ä½œã€‚     Implementation Deep Learning Framework  åŠ¨æ€ç¼©æ”¾æœºåˆ¶åœ¨ä¸¤ä¸ªæµè¡Œçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­å®ç°  Pytorch Tensorflow   DLæ¡†æ¶çš„ä¿®æ”¹ä¸»è¦ä½“ç°åœ¨ä¸‰ä¸ªéƒ¨åˆ†ï¼š  å†…å­˜åˆ†é…å™¨  ä¸ºäº†å®ç°åŠ¨æ€çš„é€šç”¨å†…å­˜ï¼Œ(tensorflow ::BFCAllocator, PyTorch::CUDACachingAllocatorï¼‰è¢«ä¿®æ”¹ä»¥å¼•å…¥å¯è°ƒæ•´çš„å†…å­˜ä¸Šé™ã€‚å†…å­˜åˆ†é…å™¨ä¼šè·Ÿè¸ªå†…å­˜åˆ†é…çš„æ€»å­—èŠ‚æ•°ï¼Œå¹¶åœ¨æ€»å­—èŠ‚æ•°è¶…è¿‡ä¸Šé™æ—¶è§¦å‘å†…å­˜ä¸è¶³ã€‚ æ­¤å¤–ï¼Œè¿˜ä¸ºå†…å­˜åˆ†é…å™¨å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¥å£ï¼Œå…è®¸åœ¨ä»»ä½•æ—¶å€™æ¸…ç©ºç¼“å­˜å†…å­˜ã€‚ è¿˜å¢åŠ äº†ä¸€ä¸ªæ–°çš„é€šç”¨å†…å­˜åˆ†é…å™¨UniversalAllocatorï¼Œä»¥åŒ…è£¹GPUå†…å­˜åˆ†é…å™¨å’Œä¸»æœºå†…å­˜åˆ†é…å™¨ï¼ˆå³ä½¿ç”¨cudaHostMallocè¿›è¡Œå†…å­˜åˆ†é…ï¼‰ã€‚  å½“å¼ é‡çš„è¯·æ±‚è§¦å‘äº†å†…å­˜åˆ†é…æ—¶ï¼ŒUniversalAllocatorè¯•å›¾ä½¿ç”¨GPUå†…å­˜åˆ†é…å™¨æ¥åˆ†é…å†…å­˜ï¼Œ å¦‚æœGPUå†…å­˜å‰©ä½™ä¸è¶³ï¼Œåˆ™å°†CPUå†…å­˜åˆ†é…å™¨ä½œä¸ºå¤‡ä»½ã€‚ ğŸš¨UniversalAllocatorç»´æŠ¤äº†ä¸€ä¸ªé›†åˆæ•°æ®ç»“æ„ï¼Œè®°å½•äº†ç”±GPUåˆ†é…çš„å†…å­˜åŒºåŸŸçš„æŒ‡é’ˆï¼Œç”¨æ¥å¯¹å†…å­˜æŒ‡é’ˆè¿›è¡Œåˆ†ç±»ï¼Œä»¥ä¾¿äºå›æ”¶ã€‚     æ‰§è¡Œå™¨  ä¸ºäº†å®ç°åŠ¨æ€è®¡ç®—å•å…ƒçš„æ‰©å±•ï¼Œåœ¨DLæ¡†æ¶ä¸­å¼•å…¥äº†ä¸€ä¸ªå¸¦æœ‰è¿ç®—å™¨å¤„ç†é˜Ÿåˆ—çš„GpuOpManagerï¼Œå®ƒåœ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¸­è¿è¡Œã€‚ TensorFlowçš„è¿ç®—å™¨è¢«ç›¸åº”åœ°ä¿®æ”¹ï¼Œä»¥æ’å…¥GPU Opåˆ°GpuOpManageré˜Ÿåˆ—ä¸­ï¼Œä»è€Œå°†GPUè¿ç®—å™¨çš„æ‰§è¡Œä¸“é—¨äº¤ç»™å®ƒã€‚ GpuOpManagerå¯èƒ½ä¼šæ ¹æ®è®¡ç®—èƒ½åŠ›çš„æœ‰é™ç™¾åˆ†æ¯”æ¥å»¶è¿ŸGPUè¿ç®—ç¬¦çš„å®é™…æ‰§è¡Œã€‚   æ¥å£   å†…å­˜ä½¿ç”¨æ¨¡å¼çš„ç»Ÿè®¡æ•°æ®å’Œæ‰§è¡Œä¿¡æ¯è¢«æ±‡æ€»åˆ°æœ¬åœ°åè°ƒå™¨ä¸Š  DLæ¡†æ¶å’Œæœ¬åœ°åè°ƒå™¨é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œé€šä¿¡ ä»–ä»¬éƒ½æœ‰ä¸€ä¸ªç›‘æ§çº¿ç¨‹æ¥æ£€æŸ¥æ–‡ä»¶ï¼Œä»¥æ¥æ”¶å·¥ä½œç»Ÿè®¡æ•°æ®æˆ–æ§åˆ¶ä¿¡å· ä¸ºäº†æœ€å¤§é™åº¦åœ°å‡å°‘å†…å­˜ç®¡ç†çš„å¼€é”€ï¼Œå†…å­˜çš„åŠ¨æ€ç¼©æ”¾æ˜¯åœ¨mini-batchçš„è¾¹ç•Œï¼ˆsession.run()çš„ç»“æŸï¼‰è§¦å‘çš„    Cluster Scheduler  åœ¨Kubernetesä¸Šå®ç°äº†ä¸€ä¸ªè‡ªå®šä¹‰è°ƒåº¦å™¨ï¼Œä½œä¸ºè¯„ä¼°AntMançš„åŸå‹ã€‚  Kubernetesè´Ÿè´£é›†ç¾¤ç®¡ç†å’Œæ‰§è¡ŒDockerå®¹å™¨ä¸­çš„ä½œä¸šã€‚ æˆ‘ä»¬çš„å…¨å±€è°ƒåº¦å™¨ä½¿ç”¨Python APIsæ¥ç›‘æ§Kubernetesçš„APIæœåŠ¡å™¨ä¸­çš„äº‹ä»¶ï¼Œä»¥ä¾¿è¿›è¡Œè°ƒåº¦ã€‚ æœ¬åœ°åè°ƒå™¨ä½œä¸ºDaemonSetéƒ¨ç½²åœ¨Kubernetesä¸­ã€‚æ¯ä¸ªåè°ƒå™¨ç›‘æ§æ–‡ä»¶ç³»ç»Ÿçš„æŸäº›è·¯å¾„ï¼Œä»¥æ”¶é›†æ¯ä¸ªä½œä¸šçš„æŠ¥å‘Šä¿¡æ¯ã€‚ æ±‡æ€»çš„ä½œä¸šå’Œè®¾å¤‡ä¿¡æ¯å­˜å‚¨åœ¨ETCDä¸­ï¼Œè¿™æ˜¯Kubernetesä¸­å†…ç½®çš„åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ã€‚å› æ­¤ï¼Œå…¨å±€è°ƒåº¦å™¨åœ¨åšè°ƒåº¦å†³ç­–æ—¶ç›´æ¥è¯»å–ETCDä¸­çš„çŠ¶æ€ã€‚    Evaluation Benchmark Trace Experiment Cluster Experiment Ralated Work Conclusion å‚è€ƒèµ„æ–™\n è®ºæ–‡åœ°å€ï¼šAntMan: Dynamic Scaling on GPU Clusters for Deep Learning | USENIX ä»£ç åœ°å€ï¼šhttps://github.com/alibaba/GPU-scheduler-for-deep-learning å‚è€ƒï¼šOSDI'20 è®ºæ–‡èµï¼šANTMAN: DYNAMIC SCALING ON GPU CLUSTERS FOR DEEP LEARNING | é«˜ç­– (gaocegege.com)  ","date":"2022-08-29T15:41:42+08:00","image":"https://cdn.jsdelivr.net/gh/Tweakzx/ImageHost@main/img/20220829154241.png","permalink":"https://tweakzx.github.io/p/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0antman%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/","title":"ã€è®ºæ–‡ç¬”è®°ã€‘AntManè®ºæ–‡é˜…è¯»ç¬”è®°"},{"content":"ã€ŠGaiaGPUï¼šSharing GPUs in Container Cloudsã€‹è®ºæ–‡ç¬”è®° Abstract  å¯¹äºäº‘æœåŠ¡çš„æä¾›å•†ï¼Œ å¦‚ä½•åœ¨å®¹å™¨é—´å…±äº«GPUï¼Œ æ˜¯ä¸€ä¸ªæœ‰å¸å¼•åŠ›çš„é—®é¢˜  å®¹å™¨çš„è½»é‡ä¸ä¼¸ç¼©æ€§ GPUå¼ºå¤§çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ› åœ¨äº‘ç¯å¢ƒï¼Œå®¹å™¨éœ€è¦ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªGPUæ¥æ»¡è¶³èµ„æºéœ€è¦çš„åŒæ—¶ï¼Œ å®¹å™¨ç‹¬å å¼çš„GPUå¾€å¾€ä½¿ç”¨ç‡å¾ˆä½   æˆ‘ä»¬æå‡ºGaiaGPUï¼Œèƒ½å¤Ÿåœ¨å®¹å™¨é—´å…±äº«æ˜¾å­˜å’Œç®—åŠ›  å°†ç‰©ç†GPUåˆ’åˆ†ä¸ºå¤šä¸ªè™šæ‹ŸGPU é‡‡ç”¨å¼¹æ€§èµ„æºåˆ†é…å’ŒåŠ¨æ€èµ„æºåˆ†é…æ¥æé«˜èµ„æºåˆ©ç”¨ç‡ å®éªŒç»“æœæ˜¾ç¤ºï¼Œ æœ‰æ•ˆçš„å®ç°äº†å®¹å™¨é—´èµ„æºçš„åˆ†é…å’Œéš”ç¦»çš„åŒæ—¶ï¼Œå¹³å‡åªå¢åŠ äº†1.015%çš„å¼€é”€ã€‚    Introduction  å®¹å™¨åŒ–æ˜¯ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯  æ¶‰åŠåˆ°é‡èº«å®šåˆ¶ä¸€ä¸ªæ ‡å‡†æ“ä½œç³»ç»Ÿï¼Œæ–¹ä¾¿å®ƒåœ¨ä¸€ä¸ªç‰©ç†æœºä¸Šè¿è¡Œç”±å¤šä¸ªç”¨æˆ·å¤„ç†çš„ä¸åŒåº”ç”¨ç¨‹åº ä¸VMæ¨¡æ‹Ÿåº•å±‚ç¡¬ä»¶ä¸åŒ  å®¹å™¨æ¨¡æ‹Ÿçš„æ˜¯æ“ä½œç³»ç»Ÿ è½»é‡ï¼Œå¯ä¼¸ç¼©ï¼Œæ˜“éƒ¨ç½² å¾®æœåŠ¡æ‰“åŒ…ä¸å‘å¸ƒåº”ç”¨çš„äº‹å®æ ‡å‡†   äº‘æœåŠ¡æä¾›å•†æ•´åˆå®¹å™¨ç¼–æ’æ¡†æ¶ï¼ˆå¦‚k8sï¼‰åˆ°åŸºç¡€æ¶æ„ä¸­æ¥æä¾›å®¹å™¨äº‘   GPU å›¾åƒå¤„ç†å•å…ƒ  æœ‰å¾ˆå¼ºçš„å¹¶è¡Œå¤„ç†èƒ½åŠ›  å› ä¸ºä¸€ä¸ªèŠ¯ç‰‡ä¸Šé›†æˆäº†æ•°ä»¥åƒè®¡çš„è®¡ç®—æ ¸ GPUè¢«å¹¿æ³›ç”¨äºè®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œä»¥åŠ å¿«è®¡ç®— éšç€æŠ€æœ¯çš„å‘å±•è¶‹åŠ¿ï¼Œç°ä»£GPUå†…å°†é›†æˆå…¥è¶Šæ¥è¶Šå¤šçš„è®¡ç®—èµ„æº   CUDAæ˜¯å¤šåŠŸèƒ½GPUæœ€æµè¡Œçš„å¹³å°ï¼Œæä¾›äº†APIæ–¹ä¾¿GPUçš„ä½¿ç”¨ å“è¶Šçš„æ€§èƒ½å¸å¼•äº†å¾ˆå¤šäº‘æä¾›å•†å°†GPUå¼•å…¥äº‘ç¯å¢ƒ  åœ¨äº‘ç¯å¢ƒä¸­ï¼Œéƒ¨ç½²åœ¨å®¹å™¨ä¸­çš„ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦ä¸€ä¸ªæˆ–å¤šä¸ªGPUæ‰èƒ½æ‰§è¡Œï¼Œ è€Œå¦ä¸€æ–¹é¢ï¼Œåº”ç”¨ç¨‹åºçš„ä¸“ç”¨GPUèµ„æºå¯¼è‡´èµ„æºä¸è¶³ã€‚ å› æ­¤ï¼Œå¦‚ä½•åœ¨ä¸åŒçš„å®¹å™¨ä¸­å…±äº«GPUå¯¹å¤§å¤šæ•°äº‘æä¾›å•†éƒ½éå¸¸æ„Ÿå…´è¶£     GPUè™šæ‹ŸåŒ–æŠ€æœ¯æ˜¯åœ¨éš”ç¦»çš„è™šæ‹Ÿç¯å¢ƒï¼ˆä¾‹å¦‚VMï¼Œ å®¹å™¨ï¼‰ä¹‹é—´å…±äº«GPUçš„æŠ€æœ¯  å¤šæ•°çš„GPUè™šæ‹ŸåŒ–æŠ€æœ¯åº”ç”¨äºVMï¼Œ å®¹å™¨é—´çš„è™šæ‹ŸåŒ–æŠ€æœ¯è¿˜åœ¨èµ·å§‹é˜¶æ®µ ç°é˜¶æ®µçš„åŸºäºå®¹å™¨çš„GPUè™šæ‹ŸåŒ–æŠ€æœ¯æœ‰ä»¥ä¸‹å±€é™æ€§  éœ€è¦ç‰¹å®šçš„ç¡¬ä»¶è®¾å¤‡ï¼ˆNVIDIA GRIDï¼‰ å°†ä¸€æ•´ä¸ªGPUåˆ†é…ç»™å•ä¸ªå®¹å™¨ï¼Œ ä¸èƒ½å…±äº« ï¼ˆNVIDIA Dockerï¼‰ å®¹å™¨é—´åªèƒ½å…±äº«GPUæ˜¾å­˜ ï¼ˆConvGPUï¼‰ åªæ”¯æŒå•ä¸ªGPU ï¼ˆConvGPUï¼‰     æˆ‘ä»¬æå‡ºGaiaGPUï¼Œèƒ½å¤Ÿåœ¨å®¹å™¨é—´é€æ˜åœ°å…±äº«æ˜¾å­˜å’Œç®—åŠ›  ç”¨æˆ·ä¸ç”¨ä¿®æ”¹å®¹å™¨é•œåƒæ¥å…±äº«åº•å±‚GPU  æˆ‘ä»¬ä½¿ç”¨k8sçš„device plugin æ¡†æ¶å°†ç‰©ç†GPUåˆ’åˆ†ä¸ºå¤šä¸ªè™šæ‹ŸGPU   æ¯ä¸ªé•œåƒå¯ä»¥æŒ‰éœ€åˆ†é…ä¸€ä¸ªæˆ–è€…å¤šä¸ªvGPU æä¾›äº†ä¸¤è€…æ–¹å¼åœ¨è¿è¡Œæ—¶æ›´æ”¹é•œåƒèµ„æº  å¼¹æ€§èµ„æºåˆ†é…ï¼šæš‚æ—¶æ”¹å˜èµ„æº åŠ¨æ€èµ„æºåˆ†é…ï¼šæ°¸ä¹…æ”¹å˜èµ„æº     vGPUåŒ…æ‹¬GPUæ˜¾å­˜å’Œè®¡ç®—èµ„æº  å…±äº«æ˜¾å­˜  å®¹å™¨åŒ…å«GPUæ˜¾å­˜çš„ä¸€å°éƒ¨åˆ† vGPUåˆ†é…çš„æ˜¯GPUçš„ç‰©ç†å†…å­˜   å…±äº«è®¡ç®—èµ„æº  å…±äº«è®¡ç®—èµ„æºæ„å‘³ç€æ¯ä¸ªå®¹å™¨éƒ½æ‹¥æœ‰GPUçº¿ç¨‹çš„ä¸€éƒ¨åˆ†ä»¥å¹¶è¡Œæ‰§è¡Œè®¡ç®—ã€‚ VGPUçš„è®¡ç®—èµ„æºç”±GPUçš„åˆ©ç”¨ç‡è¡¡é‡ï¼ˆé‡‡æ ·æ—¶æ®µå†…ï¼Œ å®¹å™¨ä½¿ç”¨GPUçš„æ—¶é—´æ¯”ä¾‹ï¼‰     æ€»ç»“ï¼šæœ¬æ–‡åšäº†å¦‚ä¸‹è´¡çŒ®  æå‡ºäº†GaiaGPUï¼šä¸€ç§åœ¨å®¹å™¨é—´é€æ˜å…±äº«æ˜¾å­˜ä¸ç®—åŠ›çš„æ–¹æ³• é‡‡ç”¨å¼¹æ€§åˆ†é…å’ŒåŠ¨æ€åˆ†é…çš„æ–¹å¼æé«˜äº†èµ„æºçš„åˆ©ç”¨ç‡ è¿›è¡Œäº†å››ä¸ªå®éªŒæ¥éªŒè¯GaiaGPUçš„æ€§èƒ½ã€‚ç»“æœï¼šå®ç°äº†å®¹å™¨é—´èµ„æºçš„åˆ†é…å’Œéš”ç¦»çš„åŒæ—¶ï¼Œå¹³å‡åªå¢åŠ äº†1.015%çš„å¼€é”€ã€‚    Related Work GPUè™šæ‹ŸåŒ–   è¢«åº”ç”¨äºåœ¨å¤šä¸ªè™šæ‹Ÿç¯å¢ƒä¹‹é—´åˆ†äº«GPUï¼Œ æå¤§åœ°æé«˜äº†åº”ç”¨æ€§èƒ½\n  ç°å­˜çš„å¤šæ•°GPUè™šæ‹ŸåŒ–æŠ€æœ¯åŸºäºVMï¼Œä¸»è¦æœ‰ä¸‰ç§è™šæ‹ŸåŒ–GPU\n API remoting  vCUDA å’Œ rCUDA åˆ›å»ºGPUçš„å°è£…åº“-\u0026gt;åŠ«æŒGPUè°ƒç”¨-\u0026gt;å°†é‡å®šå‘åˆ°host   para and full virtualization  GPUvm GPUvmå°†GPUæ˜¾å­˜å’ŒMMIOï¼ˆå­˜å‚¨å™¨æ˜ å°„è¾“å…¥è¾“å‡ºï¼‰åˆ†æˆå‡ ç‰‡ï¼Œå°†ç‰‡åˆ†ç»™VM   ç¡¬ä»¶æ”¯æŒçš„è™šæ‹ŸåŒ–  NVIDIA GRID ç¡¬ä»¶è™šæ‹ŸåŒ–ï¼Œåˆ›å»ºè™šæ‹ŸGPUï¼ŒæŒ‚åœ¨å®¹å™¨      ä¸VMç›¸æ¯”ï¼Œ å®¹å™¨ä½¿ç”¨ä¸»æœºçš„æ“ä½œç³»ç»Ÿ-\u0026gt;å®¹å™¨å¯ä»¥ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„GPUé©±åŠ¨-\u0026gt;æ€§èƒ½æ¥è¿‘åŸç”Ÿç¯å¢ƒ\n NVIDIA GRID  éœ€è¦ç‰¹å®šçš„ç¡¬ä»¶å’Œä¸è™šæ‹ŸGPUè¦æœ‰ç›¸åŒçš„èµ„æºé…ç½® ä¸€ä¸ªå®¹å™¨åªèƒ½åˆ†é…ä¸€ä¸ªè™šæ‹ŸGPU   NVIDIA Docker  ä½¿å¾—Dockeré•œåƒå¯ä»¥ä½¿ç”¨GPU å…è®¸GPUé©±åŠ¨å¯¹CUDAé•œåƒä¸æ„ŸçŸ¥ æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œçš„å°è£…-\u0026gt;å½“å®¹å™¨å¯åŠ¨æ—¶å¯ä»¥æŒ‚è½½driverçš„ç”¨æˆ·æ€ç»„ä»¶å’ŒGPUè®¾å¤‡æ–‡ä»¶ ä¸èƒ½å…±äº«ï¼šåªèƒ½æŠŠä¸€æ•´ä¸ªGPUåˆ†é…ç»™ä¸€ä¸ªå®¹å™¨   ConvGPU  å®¹å™¨é—´å…±äº«GPUæ˜¾å­˜ å®ƒæ‹¦æˆªäº†CUDAåº“æ¥ç®¡ç†æ¯ä¸ªé•œåƒæ˜¾å­˜çš„åˆ†é…å’Œå›æ”¶ ä»…æ”¯æŒåˆ†äº«æ˜¾å­˜ è€Œä¸”åªèƒ½è™šæ‹ŸåŒ–å•ä¸ªç‰©ç†GPU   GaiaGPU  è½¯ä»¶å±‚è™šæ‹ŸåŒ–ï¼Œæ²¡æœ‰ç¡¬ä»¶é™åˆ¶ æ¯ä¸ªè™šæ‹ŸGPUçš„èµ„æºå¯ä»¥æ˜¯ä¸ä¸€æ ·çš„ ä¸€ä¸ªå®¹å™¨å¯ä»¥åˆ†é…å¤šä¸ªè™šæ‹ŸGPU å¯ä»¥åŒæ—¶å…±äº«æ˜¾å­˜å’Œè®¡ç®—èµ„æº å¯ä»¥è™šæ‹ŸåŒ–å¤šä¸ªç‰©ç†GPU      Device Plugin  è‡´åŠ›äºå¾è˜å„ç§è®¡ç®—èµ„æºï¼ˆGPUsï¼Œ NICsï¼Œ FPGAsï¼‰ä¾›é›†ç¾¤ä½¿ç”¨ æ— éœ€æ”¹å˜k8sçš„æ ¸å¿ƒä»£ç  å·¥ä½œæµ  èµ„æºå‘ç°  å®ç°Device Plugin é€šè¿‡gRPCå°†deviceæ³¨å†Œåˆ°Kubelet æˆåŠŸæ³¨å†Œåï¼Œdevice pluginå‘é€è®¾å¤‡åˆ—è¡¨ Kubeletè´Ÿè´£å°†è¿™ä¸ªæ‰©å±•èµ„æºæ¨å¹¿ç»™Master   èµ„æºåˆ†é…  ç”¨æˆ·åœ¨å®¹å™¨çš„specificationä¸­è¯·æ±‚è®¾å¤‡ masterçš„scheduleré€‰æ‹©ä¸€ä¸ªk8sèŠ‚ç‚¹çš„device pluginå‘é€deviceè¯·æ±‚ device pluginåˆ†é…å¯¹åº”çš„è®¾å¤‡ç»™å®¹å™¨   \rimg\r   Vaucheré€šè¿‡åˆ©ç”¨è®¾å¤‡æ’ä»¶æ¡†æ¶æ¥å®ç°SGXï¼ˆSoftware Guard Extensionsï¼‰è®¾å¤‡è™šæ‹ŸåŒ–ï¼Œ  è¯¥æ’ä»¶æ¡†æ¶ä¿®æ”¹äº†Kubeletå’ŒSGXä»£ç ä»¥é™åˆ¶è™šæ‹ŸSGXè®¾å¤‡çš„è®¾å¤‡å†…å­˜çš„ä½¿ç”¨ ä»…å¤„ç†å†…å­˜èµ„æº å¯¹å†…å­˜æ–½åŠ ä¸¥é‡é™åˆ¶   GaiaGPUä¹Ÿé‡‡ç”¨äº†device pluginæ¡†æ¶ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«èµ„æº  å¯¹èµ„æºé‡‡ç”¨å¼¹æ€§é™åˆ¶è€Œä¸æ˜¯ç¡¬é™åˆ¶-\u0026gt;æ¥æ”¹å–„åˆ©ç”¨ç‡    Design And Implementation è®¾è®¡ä¸å®ç°  ç›®æ ‡ï¼šåœ¨å®¹å™¨é—´å…±äº«æ˜¾å­˜ä¸è®¡ç®—èµ„æºï¼Œä½¿ç”¨æœ€å°çš„æˆæœ¬è·å¾—æœ€å¤§çš„æå‡ æŒ‘æˆ˜ï¼š  é€æ˜æ€§ï¼š  GaiaGPUä¸åº”è¯¥ä¿®æ”¹k8sçš„ä»£ç æˆ–è€…å®¹å™¨é•œåƒ ä½¿ç”¨å…±äº«GPUå°±å¦‚åŒä½¿ç”¨ç‰©ç†GPUä¸€æ ·   ä½å¼€é”€  ä½¿ç”¨å…±äº«GPUçš„æ€§èƒ½å°½å¯èƒ½æ¥è¿‘ä½¿ç”¨ç‰©ç†GPU   éš”ç¦»  GaiaGPUåº”è¯¥ç®¡ç†GPUèµ„æºåœ¨æ¯ä¸ªå®¹å™¨çš„åˆ†é…ä¸å›æ”¶ å…±äº«GPUæ—¶å®¹å™¨ä¹‹é—´å®Œå…¨éš”ç¦»     ç»“æ„ï¼š  \rimage-20220828143547571\r ä¸¤å±‚èµ„æºç®¡ç†  hostå±‚ï¼š  GPU Managerè´Ÿè´£åˆ›å»ºvGPUs GPU Scheduler è´Ÿè´£åˆ†é…ç‰©ç†GPUèµ„æºåˆ°vGPUs   å®¹å™¨å±‚  vGPU Libraryè´Ÿè´£ç®¡ç†å…·ä½“å®¹å™¨çš„GPUèµ„æº     ç»„ä»¶  GPU Manager  device pluginï¼šè¿è¡Œåœ¨hostä¸Šè´Ÿè´£åˆ›å»ºvGPUsï¼Œä½¿ç”¨gRPCä¸Kubeleté€šä¿¡ \rimage-20220828171002587\r Registerï¼šGPU Managerå°†è‡ªèº«æ³¨å†Œåˆ°Kubeletä»¥é€šçŸ¥å…¶å­˜åœ¨ ListAndWatchï¼šæˆåŠŸæ³¨å†Œåï¼ŒKubeletè°ƒç”¨ListAndWatchè·å–è®¾å¤‡ä¿¡æ¯List  æ˜¾å­˜ï¼š256M ä½œä¸ºä¸€ä¸ªå•å…ƒï¼Œ æ¯ä¸ªå•å…ƒéƒ½è¢«ç§°ä½œä¸€ä¸ªvmemoryè®¾å¤‡ è®¡ç®—èµ„æºï¼šä¸€ä¸ªGPUè¢«åˆ†ä½œ100ä»½vprocessorè®¾å¤‡ï¼Œ æ¯ä¸ªvprocessoréƒ½æœ‰ç™¾åˆ†ä¹‹ä¸€çš„åˆ©ç”¨ç‡   Allocateï¼š  æ˜ å°„è¿‡ç¨‹  Kubeletå‘é€éšæœºé€‰æ‹©çš„è®¾å¤‡IDsåˆ°GPU Manager GPU Manageræ ¹æ®å¾—åˆ°çš„è®¾å¤‡IDsè®¡ç®—æ‰€éœ€çš„ç‰©ç†GPUèµ„æº GPU Manage å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° GPU Scheduler GPU Scheduler è¿”å›è¦åˆ†é…ç»™å®¹å™¨çš„ç‰©ç†GPU   æ˜ å°„å®Œæˆåï¼ŒGPU managerè¿”å›ä¸€ä¸ªallocateResponseï¼Œ åŒ…å«è·å–åˆ†é…åˆ°çš„è®¾å¤‡çš„Configurations  å®¹å™¨çš„ç¯å¢ƒå˜é‡ æŒ‚è½½åˆ°å®¹å™¨çš„ç›®å½•å’Œæ–‡ä»¶ åˆ†é…çš„è®¾å¤‡   Kubeletå°†è¿™äº›é…ç½®å‘é€åˆ°å®¹å™¨è¿è¡Œæ—¶     GPU Scheduler  è´Ÿè´£å¤„ç†GPU Managerå‘æ¥çš„è°ƒåº¦è¯·æ±‚ åŸºäºæ‹“æ‰‘æ ‘åˆ†é…GPUï¼Œæ ‘çš„æ ¹èŠ‚ç‚¹æ˜¯hostï¼Œ æ ‘çš„å¶èŠ‚ç‚¹æ˜¯ç‰©ç†GPU å½“æ‰€éœ€è¦çš„èµ„æºå°‘äºä¸€ä¸ªç‰©ç†GPUï¼Œåˆ†é…ç­–ç•¥ä¼šæœ€å¤§ç¨‹åº¦å‡å°‘èµ„æºç¢ç‰‡ å½“æ‰€éœ€çš„èµ„æºç­‰äºä¸€ä¸ªç‰©ç†GPUæ—¶ï¼Œé‡‡ç”¨äº†æœ€å°åŒ–å•å¶èŠ‚ç‚¹ï¼ˆå³æ²¡æœ‰å…„å¼Ÿå§å¦¹èŠ‚ç‚¹çš„å¶å­èŠ‚ç‚¹ï¼‰çš„åˆ†é…ç­–ç•¥ã€‚ å½“æ‰€éœ€çš„èµ„æºä¸æ­¢ä¸€ä¸ªç‰©ç†GPUæ—¶ï¼Œåˆ†é…ç­–ç•¥çš„ç›®æ ‡æ˜¯æœ€å¤§ç¨‹åº¦åœ°é™ä½GPUçš„é€šä¿¡æˆæœ¬ã€‚é€šä¿¡æˆæœ¬å–å†³äºä¸¤ä¸ªGPUçš„è¿æ¥æ¨¡å¼ã€‚   vGPU Manager  è¿è¡Œåœ¨hostï¼Œä¼ é€’å®¹å™¨é…ç½®å¹¶ä¸”ç›‘ç®¡åˆ†é…äº†vGPUsçš„å®¹å™¨ å½“å®¹å™¨ç”³è¯·GPUèµ„æºæ—¶ï¼ŒGPU Managerå°†é…ç½®å‘é€ç»™vGPU Managerï¼Œä¾‹å¦‚  éœ€è¦çš„GPUèµ„æº è¯¥å®¹å™¨çš„name   æ¥æ”¶åˆ°é…ç½®åï¼Œåœ¨ä¸»æœºä¸Šä¸ºå®¹å™¨å‘½åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„è·¯å¾„  è·¯å¾„åä¸ºå®¹å™¨å è¿™ä¸ªè·¯å¾„åŒ…å«åœ¨allocateResponseé‡Œ å®¹å™¨çš„é…ç½®ä¹ŸåŒ…å«åœ¨è¿™ä¸ªè·¯å¾„é‡Œï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡Kubeletä¼ é€’åˆ°å®¹å™¨   vGPU Manager å’Œ vGPU Libraryæ˜¯ æœåŠ¡å™¨-å®¢æˆ·ç«¯æ¨¡å¼  vGPU Manager ç»´æŠ¤ä¸€ä¸ªæ´»ç€çš„ä¸”åˆ†é…äº†GPUèµ„æºçš„å®¹å™¨çš„list ä¼šå®šæœŸæ£€æŸ¥è¿™äº›å®¹å™¨æ˜¯å¦å­˜æ´» å¦‚æœå®¹å™¨æ­»äº†ï¼Œä»listä¸­ç§»é™¤è¿™ä¸ªå®¹å™¨çš„ä¿¡æ¯ï¼Œå¹¶ä¸”åˆ é™¤ç›®å½•     vGPU Library  è¿è¡Œåœ¨å®¹å™¨ä¸­ï¼Œç®¡ç†å®¹å™¨çš„GPUèµ„æº åœ¨å®¹å™¨ç¬¬ä¸€æ¬¡æ‰§è¡ŒGPUç¨‹åºæ—¶è¢«åŠ è½½ å¯åŠ¨åvGPU Libraray å‘ vGPU Manageræ³¨å†Œè‡ªèº« åˆ©ç”¨LD_LIBRARY_PATHæœºåˆ¶æ‹¦æˆªCUDAåº“ä¸­å†…å­˜ä¸è®¡ç®—ç›¸å…³çš„API  LD_LIBRARY_PATHæ˜¯ä¸€ä¸ªlinuxç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ å¯ä»¥å½±å“ç¨‹åºçš„runtime link å…è®¸æŸäº›è·¯å¾„å…ˆäºstandard set of directoriesï¼ˆï¼Ÿæ ‡å‡†åº“ç›®å½•ï¼Ÿï¼‰åŠ è½½ \rimage-20220828222012346\r   å½“å®¹å™¨éœ€è¦çš„GPUèµ„æºè¶…å‡ºå®ƒç”³è¯·çš„èµ„æºæ—¶ï¼Œä¸ºäº†é¿å…è€—å°½æ•´ä¸ªGPUï¼Œæœ‰ä¸¤ç§èµ„æºé™åˆ¶ç­–ç•¥  ç¡¬é™åˆ¶ï¼ˆhard limiitï¼‰ï¼šå¦‚æœå®¹å™¨èµ„æºæ¶ˆè€—é‡è¶…è¿‡é…é¢ï¼Œå°±ä¸å†ç»™è¯¥å®¹å™¨åˆ†é…èµ„æº å¼¹æ€§é™åˆ¶ï¼ˆelastic limitï¼‰ï¼šå¦‚æœå®¹å™¨èµ„æºæ¶ˆè€—é‡è¶…è¿‡é…é¢ï¼Œä½†æ˜¯ç³»ç»Ÿä¸­è¿˜æœ‰ç©ºé—²èµ„æºï¼Œé‚£ä¹ˆè¯¥å®¹å™¨ä»ç„¶èƒ½å¤Ÿå¾—åˆ°æ›´å¤šçš„èµ„æº   å†…å­˜èµ„æºçš„é™åˆ¶é‡‡ç”¨ç¡¬é™åˆ¶ç­–ç•¥ï¼Œ å› ä¸º  å†…å­˜èµ„æºå¤§å°èƒ½å†³å®šä¸€ä¸ªç¨‹åºèƒ½å¦è¿è¡Œï¼Œä½†å¯¹è¿è¡Œçš„æ•ˆç‡å½±å“è¾ƒå° GPUæ˜¯è®¡ç®—è®¾å¤‡ï¼Œå®ƒä»¬é‡‡ç”¨ä¸€æ¬¡æ€§èµ„æºåˆ†é…ç­–ç•¥ã€‚ä»…åœ¨è·å–æ‰€æœ‰å†…å­˜èµ„æºåæ‰å¯ä»¥æ‰§è¡Œåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”åœ¨å®Œæˆå†…å­˜ä¹‹å‰ä¸ä¼šé‡Šæ”¾ã€‚å¦‚æœä½¿ç”¨å¼¹æ€§å†…å­˜åˆ†é…ï¼Œåˆ™å…·æœ‰è¾ƒå¤§å†…å­˜éœ€æ±‚çš„åº”ç”¨ç¨‹åºå°†é¥¿æ­» æ’¤å›è¿‡åº¦åˆ†é…çš„å†…å­˜èµ„æºçš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡æŠ›å‡ºout-of-memory exceptionæ¥æ€æ­»è¯¥è¿‡ç¨‹   è®¡ç®—èµ„æºé‡‡ç”¨å¼¹æ€§é™åˆ¶ç­–ç•¥ï¼Œå› ä¸º  è®¡ç®—èµ„æºå¯¹ç¨‹åºè¿è¡Œçš„å½±å“å¾ˆå¤§ è®¡ç®—èµ„æºï¼ˆGPU çº¿ç¨‹ï¼‰åœ¨æ‰§è¡Œä¹‹åä¼šç«‹åˆ»é‡Šæ”¾æ‰         æ€»ç»“ï¼š  Step 1ï¼šGPU Managerå‘Kubeletæ³¨å†Œè‡ªèº«ï¼Œå¹¶æŠ¥å‘ŠvGPUçš„ä¿¡æ¯ï¼ˆListAndWatchï¼‰ Step 2ï¼šKubeletæ¥æ”¶åˆ°æ¥è‡ªMasterçš„åˆ›å»ºä¸€ä¸ªGPUå®¹å™¨çš„è¯·æ±‚ Step 3ï¼šKubeletå‘é€ä¸€ä¸ªallocateRequeståˆ°GPU Manager Step 4ï¼šGPU Managerå‘é€ä¸€ä¸ªvGPUè°ƒåº¦è¯·æ±‚åˆ°GPU Schedulerï¼ŒGPU Scheduleræ ¹æ®è°ƒåº¦ç­–ç•¥é€‰æ‹©å®é™…æä¾›èµ„æºçš„ç‰©ç†GPUã€‚å¦‚æœè°ƒåº¦æˆåŠŸè¿”å›ä¸€ä¸ªåŒ…å«è¯¥ç‰©ç†GPUçš„ä¿¡æ¯çš„reponse Step 5ï¼šGPU Managerå°†å®¹å™¨é…ç½®ä¿¡æ¯å‘é€åˆ°vGPU Manager Step 6ï¼šGPU Managerå°†å®¹å™¨ç¯å¢ƒå˜é‡ï¼ŒæŒ‚è½½ä¿¡æ¯å’Œè®¾å¤‡ä¿¡æ¯é€šè¿‡allocateResponseè¿”å›ç»™Kubelet Step 7ï¼šKubeletæ ¹æ®allocateResponseåˆ›å»ºå¹¶ä¸”åˆå§‹åŒ–ä¸€ä¸ªå®¹å™¨ Step 8ï¼švGPU Libraryå‘vGPU Manageræ³¨å†Œè‡ªèº«å¹¶ä¸”ç®¡ç†å…¶æ‰€åœ¨å®¹å™¨çš„GPUèµ„æº Step 9ï¼švGPU ManageræŒç»­ç›‘æ§GPUå®¹å™¨çŠ¶æ€ \rimage-20220828143547571\r    ä¼˜åŒ–   å®¹å™¨çš„èµ„æºä¸ä»…ä¼šå½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œè€Œä¸”è¿˜ä¼šç¡®å®šåº”ç”¨ç¨‹åºçš„çŠ¶æ€ ç”¨æˆ·åœ¨åˆ›å»ºå®¹å™¨æ—¶æ— æ³•å‡†ç¡®ä¼°ç®—æ‰€éœ€çš„èµ„æº å› æ­¤ï¼Œæˆ‘ä»¬æä¾›ä¸¤ç§æ–¹æ³•æ¥æ›´æ”¹è¿è¡Œæ—¶å®¹å™¨çš„èµ„æºã€‚å¼¹æ€§èµ„æºåˆ†é…ä¼šæš‚æ—¶ä¿®æ”¹å®¹å™¨çš„è®¡ç®—èµ„æºé™åˆ¶ï¼Œè€ŒåŠ¨æ€èµ„æºåˆ†é…æ°¸ä¹…æ”¹å˜äº†å®¹å™¨çš„èµ„æºã€‚     å¼¹æ€§åˆ†é…ç­–ç•¥\n ç›®çš„æ˜¯ä½¿ç”¨é—²ç½®çš„è®¡ç®—èµ„æºä»¥æé«˜èµ„æºåˆ©ç”¨ç‡ \rimage-20220828224059056\r nanosleep()æ˜¯Linuxå†…æ ¸å‡½æ•°ï¼Œä¼šæŒ‚èµ·å½“å‰çº¿ç¨‹ç­‰å¾…ä¸€æ®µæ—¶é—´æˆ–è€…ç›´åˆ°æ¥æ”¶åˆ°è°ƒç”¨å½“å‰çº¿ç¨‹çš„ä¿¡å·ï¼ˆLine 2ï¼‰ ä¸ºäº†é˜²æ­¢è¿‡è½½ï¼Œ $GU_{max}$ é»˜è®¤çš„æœ€å¤§å€¼æ˜¯90% ï¼ˆLine 3ï¼‰ å¦‚æœç‰©ç†GPUè®¡ç®—å¡ä»ç„¶æœ‰ç©ºé—²èµ„æºï¼Œä¹Ÿå°±æ˜¯è¯´GU free \u0026gt; 0ï¼Œå³ä½¿å®¹å™¨çš„èµ„æºè¯·æ±‚å·²ç»è¶…å‡ºå…¶é…é¢ï¼ŒvGPU Libraryä¹Ÿä¼šç»§ç»­ç»™å®¹å™¨åˆ†é…è®¡ç®—èµ„æºï¼ˆLine 4-5ï¼‰ã€‚å¦‚æœç³»ç»Ÿæ²¡æœ‰å‰©ä½™çš„ç©ºé—²èµ„æºï¼ˆ*GU free \u0026lt;= 0*ï¼‰å¹¶ä¸”å®¹å™¨çš„æ¶ˆè€—çš„èµ„æºå¤§äºå…¶é…é¢ï¼ŒvGPU Libraryä¼šé€æ¸æ”¶å›è¶…é¢ï¼ˆover-allocatedï¼‰èµ„æºï¼ˆLine 6-7ï¼‰ è¶…é¢èµ„æºçš„å›æ”¶é‡‡ç”¨éæŠ¢å å¼ç­–ç•¥ï¼ˆnon-preemptive strategyï¼‰ï¼Œå°±æ˜¯è¯´ä¼šç­‰åˆ°å®¹å™¨ä¸­å ç”¨çº¿ç¨‹çš„æ ¸å‡½æ•°æ‰§è¡Œå®Œåå†å›æ”¶çº¿ç¨‹èµ„æºã€‚CU cores*å¯ä»¥è¢«ç†è§£ä¸ºä¸€ç§tokenï¼Œå®¹å™¨æ‰§è¡Œæ ¸å‡½æ•°æ—¶éœ€è¦æ¶ˆè€—è¯¥tokenï¼Œå½“æ ¸å‡½æ•°æ‰§è¡Œå®Œæˆé‡Šæ”¾çº¿ç¨‹èµ„æºæ—¶å®¹å™¨åˆå›é‡æ–°æ‹¥æœ‰è¯¥tokenã€‚CU coresçš„åˆå§‹å€¼ç­‰äºå®¹å™¨çš„è®¡ç®—èµ„æºé…é¢ï¼ŒCU coresä¸ºé›¶æ—¶ï¼ˆç³»ç»Ÿæ²¡æœ‰ç©ºé—²çš„èµ„æºï¼Œå¹¶ä¸”è¯¥å®¹å™¨çš„è®¡ç®—èµ„æºé…é¢éƒ½æ­£åœ¨è¢«ç”¨äºæ‰§è¡Œæ ¸å‡½æ•°ï¼‰ï¼ŒvGPU Libraryä¸ä¼šå†ç»™å®¹å™¨åˆ†é…ä»»ä½•è®¡ç®—èµ„æºï¼Œç›´åˆ°å®¹å™¨çš„CU coreså¤§äºé›¶ï¼ˆå…¶ä»–å®¹å™¨é‡Šæ”¾äº†ç©ºé—²èµ„æºï¼Œæˆ–è€…è¯¥å®¹å™¨æœ‰æ ¸å‡½æ•°å®Œæˆé‡Šæ”¾äº†èµ„æºï¼Œå®¹å™¨é‡æ–°è·å¾—CU cores*ï¼‰ å¼¹æ€§åˆ†é…çš„æ ·ä¾‹  \rimage-20220828233026263\r é¦–å…ˆï¼Œå®¹å™¨Aç”³è¯·äº†0.3ä¸ªGPUï¼Œå¹¶ä¸”è¢«GPU Schedulerè°ƒåº¦åˆ°äº†ä¸€ä¸ªå®Œå…¨ç©ºé—²çš„GPUä¸Š ç”±äºGPUå®Œå…¨ç©ºé—²ï¼Œæ‰€ä»¥å®¹å™¨Aä¼šé€æ¸å ç”¨æ‰€æœ‰çš„ç©ºé—²èµ„æºï¼Œé»˜è®¤æœ€å¤§å¯å ç”¨90% æ­¤æ—¶å®¹å™¨Bç”³è¯·äº†0.7ä¸ªGPUï¼Œä¹Ÿè¢«è°ƒåº¦åˆ°äº†æ­¤GPUä¸Šï¼Œä½†æ˜¯ç”±äºå®¹å™¨Aå ç”¨äº†æ‰€æœ‰çš„ç©ºé—²èµ„æºï¼Œæ‰€ä»¥éœ€è¦ä»å®¹å™¨Aå›æ”¶è¶…é¢çº¿ç¨‹èµ„æºå¹¶åˆ†é…ç»™å®¹å™¨B é‡å¤ç»è¿‡å‡ æ¬¡èµ„æºçš„é‡æ–°åˆ†é…ï¼Œå®¹å™¨Aå’Œå®¹å™¨Bæ‰€å ç”¨çš„èµ„æºä¸å…¶èµ„æºé…é¢ç›¸åŒ      åŠ¨æ€åˆ†é…ç­–ç•¥\n åŠ¨æ€èµ„æºåˆ†é…ä¼šä¿®æ”¹å®¹å™¨èµ„æºï¼ŒåŒ…æ‹¬å†…å­˜å’Œè®¡ç®—èµ„æºï¼Œè€Œæ— éœ€åœæ­¢å®¹å™¨ã€‚ åŠ¨æ€èµ„æºåˆ†é…æ—¨åœ¨è§£å†³ä¸¤ä¸ªé—®é¢˜  åœ¨ç¡¬é™åˆ¶ä¸‹æ›´æ–°å®¹å™¨çš„å†…å­˜å’Œè®¡ç®—èµ„æº åœ¨å¼¹æ€§é™åˆ¶ä¸‹å°†å†…å­˜èµ„æºæ·»åŠ åˆ°å®¹å™¨ä¸­   vGPU Library é€šè¿‡å°†å®¹å™¨çš„èµ„æºé…ç½®ä¸å®¹å™¨çš„å®é™…ä½¿ç”¨è¿›è¡Œæ¯”è¾ƒæ¥é™åˆ¶å®¹å™¨èµ„æº è¦æ°¸ä¹…æ›´æ”¹å®¹å™¨çš„èµ„æºï¼šä¿®æ”¹å®¹å™¨çš„èµ„æºé…ç½®â€”\u0026gt;é€šçŸ¥GPU Scheduler-\u0026gt;æ›´æ–°ç›¸åº”çš„ç‰©ç†GPUåˆ†é…    Experiments \u0026hellip;\nConclusion \u0026hellip;\nå‚è€ƒèµ„æ–™   è®ºæ–‡åœ°å€ https://ieeexplore.ieee.org/abstract/document/8672318\n  Githubå¼€æºä»£ç  https://github.com/tkestack/gpu-manager\n  ","date":"2022-08-26T17:20:32+08:00","image":"https://cdn.jsdelivr.net/gh/Tweakzx/ImageHost@main/img/20220826142857.png","permalink":"https://tweakzx.github.io/p/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0gaiagpu%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/","title":"ã€è®ºæ–‡ç¬”è®°ã€‘GaiaGPUè®ºæ–‡é˜…è¯»ç¬”è®°"},{"content":"åœ¨ubuntuä¸Šk8sé›†ç¾¤éƒ¨ç½²å®è·µ  centos ä¸Šå®‰è£…å»ºè®®çœ‹ åç«¯ - CentOS æ­å»º K8Sï¼Œä¸€æ¬¡æ€§æˆåŠŸï¼Œæ”¶è—äº†ï¼_ä¸ªäººæ–‡ç«  - SegmentFault æ€å¦\n ä¸€ã€æœºå™¨é…ç½® é…ç½®ä¸»æœºå sudo hostnamectl set-hostname \u0026#34;k8s-master\u0026#34; // Run this command on masternode cat /etc/hostname sudo hostnamectl set-hostname \u0026#34;k8s-node1\u0026#34;Â // Run this command on node-0 sudo hostnamectl set-hostname \u0026#34;k8s-node2\u0026#34;Â // Run this command on node-1 é…ç½®/etc/hosts sudo vi /etc/hosts 10.1.13.106 k8s-master #10.1.13.107 k8s-node1 #10.1.13.108 k8s-node1 é…ç½®å…å¯†ç™»å½• æƒ³è®©æœºå™¨ A è®¿é—®æœºå™¨ Bï¼Œå°±æŠŠæœºå™¨ A çš„å…¬é’¥æ”¾åˆ°æœºå™¨ B çš„~/.ssh/authorized_keys æ–‡ä»¶é‡Œå°±è¡Œäº†ã€‚\né¦–å…ˆæˆ‘ä»¬åœ¨workerä¸Šç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼Œè¾“å…¥ä¸‹è¿°å‘½ä»¤åä¸€è·¯å›è½¦å³å¯ï¼š\nssh-keygen ç„¶åç™»å½•masterï¼Œå¹¶ä¾æ¬¡è¾“å…¥ä¸‹è¿°ä¸¤æ¡å‘½ä»¤å°†å…¶å¤åˆ¶å¹¶å†™å…¥åˆ°masterçš„authorized_keysä¸­ï¼Œæ³¨æ„æˆ‘ä¸‹é¢çš„scpå‘½ä»¤ä¸­ä½¿ç”¨äº†workeråˆ«åï¼Œè¦æå‰è¿›è¡Œé…ç½®ï¼š\n# å¤åˆ¶åˆ° master ä¸»æœº scp root@worker:~/.ssh/id_rsa.pub /home # å†™å…¥åˆ° authorized_keys ä¸­ cat /home/id_rsa.pub \u0026gt;\u0026gt; ~/.ssh/authorized_keys ç„¶åå†æ¬¡ä½¿ç”¨ssh workerç™»å½•å°±å¯ä»¥å‘ç°ç›´æ¥è¿æ¥ä¸Šè€Œä¸éœ€è¦å¯†ç äº†ã€‚\nå…³é—­é˜²ç«å¢™ sudo systemctl stop firewalld sudo systemctl disable firewalld ç¦ç”¨swap è¿™ä¸ªswapå…¶å®å¯ä»¥ç±»æ¯”æˆ windows ä¸Šçš„è™šæ‹Ÿå†…å­˜ï¼Œå®ƒå¯ä»¥è®©æœåŠ¡å™¨åœ¨å†…å­˜åƒæ»¡çš„æƒ…å†µä¸‹å¯ä»¥ä¿æŒä½æ•ˆè¿è¡Œï¼Œè€Œä¸æ˜¯ç›´æ¥å¡æ­»ã€‚ä½†æ˜¯ k8s çš„è¾ƒæ–°ç‰ˆæœ¬éƒ½è¦æ±‚å…³é—­swapã€‚æ‰€ä»¥å’±ä»¬ç›´æ¥åŠ¨æ‰‹ï¼Œä¿®æ”¹/etc/fstabæ–‡ä»¶ï¼š\nsudo vi /etc/fstab ä½ åº”è¯¥å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼ŒæŠŠç¬¬äºŒæ¡ç”¨#æ³¨é‡Šæ‰å°±å¥½äº†ï¼Œæ³¨æ„ç¬¬ä¸€æ¡åˆ«æ³¨é‡Šäº†ï¼Œä¸ç„¶é‡å¯ä¹‹åç³»ç»Ÿæœ‰å¯èƒ½ä¼šæŠ¥file system read-onlyé”™è¯¯ã€‚\nUUID=e2048966-750b-4795-a9a2-7b477d6681bf / ext4 errors=remount-ro 0 1 # /dev/fd0 /media/floppy0 auto rw,user,noauto,exec,utf8 0 0 ç„¶åè¾“å…¥rebooté‡å¯å³å¯ï¼Œé‡å¯åä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹ä»»åŠ¡ç®¡ç†å™¨ï¼Œå¦‚æœçœ‹åˆ°å¦‚ä¸‹KiB Swapåå‡ä¸º 0 å°±è¯´æ˜å…³é—­æˆåŠŸäº†ã€‚\nå…³é—­swapä¹‹åä½¿ç”¨topå‘½ä»¤çœ‹åˆ° KiB Swap å…¨éƒ¨ä¸º0\n\rimage-20220613000133107\r\nä¸Šé¢è¯´çš„æ˜¯æ°¸ä¹…å…³é—­swapå†…å­˜ï¼Œå…¶å®ä¹Ÿå¯ä»¥æš‚æ—¶å…³é—­ï¼Œä½¿ç”¨swapoff -aå‘½ä»¤å³å¯ï¼Œæ•ˆæœä¼šåœ¨é‡å¯åæ¶ˆå¤±ã€‚\nç¦ç”¨Selinux sudo apt install selinux-utils setenforce 0 ç¡®ä¿æ—¶åŒºå’Œæ—¶é—´æ­£ç¡® sudo timedatectl set-timezone Asia/Shanghai sudo systemctl restart rsyslog sudo apt-get install ntpdate â€“y sudo ntpdate time.windows.com é…ç½®net.bridge.bridge-nf-call-iptables cat \u0026lt;\u0026lt;EOF | sudo tee /etc/modules-load.d/k8s.conf br_netfilter EOF cat \u0026lt;\u0026lt;EOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sudo sysctl --system è®¾ç½®rp_filterçš„å€¼ sudo vi /etc/sysctl.d/10-network-security.conf # å°†ä¸‹é¢ä¸¤ä¸ªå‚æ•°çš„å€¼ä»2ä¿®æ”¹ä¸º1 # net.ipv4.conf.default.rp_filter=1 # net.ipv4.conf.all.rp_filter=1 sudo sysctl --system äºŒã€å®‰è£…docker docker æ˜¯ k8s çš„åŸºç¡€ï¼Œåœ¨å®‰è£…å®Œæˆä¹‹åä¹Ÿéœ€è¦ä¿®æ”¹ä¸€äº›é…ç½®æ¥é€‚é… k8s ï¼Œæ‰€ä»¥æœ¬ç« åˆ†ä¸º docker çš„å®‰è£… ä¸ docker çš„é…ç½® ä¸¤éƒ¨åˆ†ã€‚å¦‚æœä½ å·²ç»å®‰è£…å¹¶ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´çš„ docker äº†è¯ï¼Œå»ºè®®ä½¿ç”¨docker -væŸ¥çœ‹å·²å®‰è£…çš„ docker ç‰ˆæœ¬ï¼Œå¹¶åœ¨ k8s å®˜ç½‘ä¸ŠæŸ¥è¯¢é€‚åˆè¯¥ç‰ˆæœ¬çš„ k8s è¿›è¡Œå®‰è£…ã€‚è¿™ä¸€æ­¥ä¸¤å°ä¸»æœºéƒ½éœ€è¦è¿›è¡Œå®‰è£…ã€‚\nå®‰è£…docker sudo apt install docker.io sudo apt install docker.io=18.09.1-0ubuntu1 å¯åŠ¨docker sudo systemctl start docker é…ç½®docker sudo mkdir -p /etc/docker sudo tee /etc/docker/daemon.json \u0026lt;\u0026lt;-\u0026#39;EOF\u0026#39; { \u0026#34;registry-mirrors\u0026#34;: [\u0026#34;https://n73pm3wf.mirror.aliyuncs.com\u0026#34;], \u0026#34;exec-opts\u0026#34;: [ \u0026#34;native.cgroupdriver=systemd\u0026#34; ] } EOF sudo systemctl daemon-reload sudo systemctl restart docker è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ $ sudo systemctl enable docker æˆ– $ sudo systemctl enable docker.service --now éªŒè¯docker systemctl status docker docker --version docker info | grep Cgroup ä¿®æ”¹åçš„ docker cgroup çŠ¶æ€ï¼Œå‘ç°å˜ä¸ºsystemdå³ä¸ºä¿®æ”¹æˆåŠŸã€‚\né‡å¯dockerï¼ˆå½“æœ‰é…ç½®æ”¹åŠ¨åæ‰§è¡Œï¼‰ sudo pkill -SIGHUP dockerd sudo systemctl restart docker å¸è½½docker sudo apt-get remove docker.io ä¸‰ã€å®‰è£…k8s å®‰è£…k8s # ä½¿å¾— apt æ”¯æŒ ssl ä¼ è¾“ apt-get update \u0026amp;\u0026amp; apt-get install -y apt-transport-https # ä¸‹è½½ gpg å¯†é’¥ è¿™ä¸ªéœ€è¦rootç”¨æˆ·å¦åˆ™ä¼šæŠ¥é”™ curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - # æ·»åŠ  k8s é•œåƒæº è¿™ä¸ªéœ€è¦rootç”¨æˆ·å¦åˆ™ä¼šæŠ¥é”™ cat \u0026lt;\u0026lt;EOF \u0026gt;/etc/apt/sources.list.d/kubernetes.list deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main EOF # æ›´æ–°æºåˆ—è¡¨ apt-get update # ä¸‹è½½ kubectlï¼Œkubeadmä»¥åŠ kubelet # å®‰è£…æœ€æ–°ç‰ˆæœ¬ apt-get install -y kubelet kubeadm kubectl # å®‰è£…æŒ‡å®šç‰ˆæœ¬ apt-get install -y kubelet=1.15.1-00 kubeadm=1.15.1-00 kubectl=1.15.1-00 åˆ é™¤å·²å®‰è£…çš„k8s sudo apt-get remove -y --allow-change-held-packages kubeadm kubectl kubelet æŸ¥è¯¢å¯å®‰è£…ç‰ˆæœ¬ apt-cache madison kubeadm apt-cache madison kubelet apt-cache madison kubectl apt-cache madison kubernetes-cni è®¾ç½®ä¸éšç³»ç»Ÿæ›´æ–°è€Œæ›´æ–° sudo apt-mark hold kubelet kubeadm kubectl å››ã€åˆå§‹åŒ–master kubeadm init kubeadm init \\ --apiserver-advertise-address=10.10.0.2 \\ --kubernetes-version=1.15.1 \\ --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers \\ --service-cidr=10.96.0.0/16 \\ --pod-network-cidr=10.244.0.0/16 å‚æ•°è§£é‡Šï¼š\n \u0026ndash;kubernetes-versionï¼šæŒ‡å®škubernetesçš„ç‰ˆæœ¬ï¼Œä¸ä¸Šé¢kubeletï¼Œkubeadmï¼Œkubectlå·¥å…·ç‰ˆæœ¬ä¿æŒä¸€è‡´ã€‚ \u0026ndash;apiserver-advertise-addressï¼šapiserveræ‰€åœ¨çš„èŠ‚ç‚¹(master)çš„ipã€‚ \u0026ndash;image-repository=registry.aliyuncs.com/google_containersï¼šç”±äºå›½å¤–åœ°å€æ— æ³•è®¿é—®ï¼Œæ‰€ä»¥ä½¿ç”¨é˜¿é‡Œäº‘ä»“åº“åœ°å€ \u0026ndash;server-cidrï¼šserviceä¹‹é—´è®¿é—®ä½¿ç”¨çš„ç½‘ç»œipæ®µ \u0026ndash;pod-network-cidrï¼špodä¹‹é—´ç½‘ç»œè®¿é—®ä½¿ç”¨çš„ç½‘ç»œip,ä¸ä¸‹æ–‡éƒ¨ç½²çš„CNIç½‘ç»œç»„ä»¶ymlä¸­ä¿æŒä¸€è‡´  åˆå§‹åŒ–æˆåŠŸä¹‹åä½ å°†çœ‹åˆ°\nYour Kubernetes control-plane has initialized successfully! To start using your cluster, you need to run the following as a regular user: mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config Alternatively, if you are the root user, you can run: export KUBECONFIG=/etc/kubernetes/admin.conf You should now deploy a pod network to the cluster. Run \u0026#34;kubectl apply -f [podnetwork].yaml\u0026#34; with one of the options listed at: https://kubernetes.io/docs/concepts/cluster-administration/addons/ Then you can join any number of worker nodes by running the following on each as root: kubeadm join 10.10.0.2:6443 --token juojiv.q4gwfmkj4cwgscnt \\  --discovery-token-ca-cert-hash sha256:381b61262d3b174cfce0e5cfbd0b4b171e270c506d82c4d82334d0a4e2c2ac47 åˆå§‹åŒ–å¤±è´¥ é‡ç½®ä¹‹åé‡æ–°åˆå§‹åŒ–\nkubeadm reset è®°å¾—ä¿å­˜kubeadm join å‘½ä»¤ kubeadm join 10.10.0.2:6443 --token qc7drh.47mloh5ierij84xi \\  --discovery-token-ca-cert-hash sha256:90f147ef85ae06d9a46bed91d64109abbd697b6878ab9ca16a376e11816f9a0d å¦‚æœå¿˜è®°å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤é‡æ–°ç”Ÿæˆ\nkubeadm token create --print-join-command é…ç½®kubectl æŒ‰ç…§ä¸Šå›¾ä¸­çš„å‘½ä»¤é…ç½®ï¼Œå¯ä»¥ç›´æ¥ä»å‘½ä»¤è¡Œä¸­å¤åˆ¶\n érootç”¨æˆ·  mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config # æŸ¥çœ‹å·²åŠ å…¥çš„èŠ‚ç‚¹ kubectl get nodes # æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ kubectl get cs  rootç”¨æˆ·  export KUBECONFIG=/etc/kubernetes/admin.conf éƒ¨ç½²ç½‘ç»œ ç½‘ç»œæ’ä»¶å¯ä»¥é€‰æ‹©calicoæˆ–flannelã€‚è¿™é‡Œä½¿ç”¨Flannelä½œä¸ºKuberneteså®¹å™¨ç½‘ç»œæ–¹æ¡ˆï¼Œè§£å†³å®¹å™¨è·¨ä¸»æœºç½‘ç»œé€šä¿¡ã€‚\n éƒ¨ç½²flannelç½‘ç»œ  kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml kubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªæ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œæ³¨æ„ä¿®æ”¹ä¸‹å›¾ä¸­çš„Networkï¼Œä¸kubeadm intiä¸­çš„\u0026ndash;pod-network-cidr 10.244.0.0/16å‚æ•°ä¿æŒä¸€è‡´ï¼Œç„¶å\nkubectl apply -f kube-flannel.yml \rimage-20220613013117789\r\nå°†ä¼šçœ‹åˆ°\npodsecuritypolicy.policy/psp.flannel.unprivileged created clusterrole.rbac.authorization.k8s.io/flannel created clusterrolebinding.rbac.authorization.k8s.io/flannel created serviceaccount/flannel created configmap/kube-flannel-cfg created daemonset.apps/kube-flannel-ds created æŸ¥çœ‹podçŠ¶æ€ï¼Œåº”è¯¥å…¨éƒ¨ä¸ºrunningã€‚å¯èƒ½éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´\nkubectl get pod --all-namespaces -o wide \rimage-20220613012658569\r\n éƒ¨ç½²calicoç½‘ç»œ  ä¸‹è½½ymlæ–‡ä»¶\nwget https://docs.projectcalico.org/v3.11/manifests/calico.yaml vi calico.yaml #ä¿®æ”¹CALICO_IPV4POOL_CIDRï¼Œä¸º10.244.0.0/16ï¼ˆè¦ä¸kubeadm intiä¸­çš„\u0026ndash;pod-network-cidr 10.244.0.0/16å‚æ•°ä¿æŒä¸€è‡´ï¼Œé»˜è®¤ä¸º192.168.0.0/16\nkubectl apply -f calico.yaml äº”ã€æ·»åŠ workerèŠ‚ç‚¹ ä½¿ç”¨ä¹‹å‰ä¿å­˜çš„kubeadm joinå‘½ä»¤\nkubeadm join 10.10.0.2:6443 --token ryyy8k.pr8u7cjm4btqdx4v --discovery-token-ca-cert-hash sha256:6b596c66745b162190475b63686ca46c60cc4f39473 ç„¶ååœ¨masterèŠ‚ç‚¹ä¸Šï¼ŒæŸ¥çœ‹\nkubectl get nodes å¯ä»¥çœ‹åˆ°\n\rimage-20220613010009663\r\nå…­ã€éªŒè¯ åˆ›å»ºnginx kubectl create deployment nginx-web --image=nginx è·å–podä¿¡æ¯ kubectl get pod -o wide \rimage-20220613013920336\r\nå¯ä»¥çœ‹åˆ°è¯¥èŠ‚ç‚¹çš„ipä¸º10.244.1.2\næµ‹è¯•nginx root@k8s-master:/home# curl http://10.244.1.2 å¯ä»¥çœ‹åˆ°\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Welcome to nginx!\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; html { color-scheme: light dark; } body { width: 35em; margin: 0 auto; font-family: Tahoma, Verdana, Arial, sans-serif; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Welcome to nginx!\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;If you see this page, the nginx web server is successfully installed and working. Further configuration is required.\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;For online documentation and support please refer to \u0026lt;a href=\u0026#34;http://nginx.org/\u0026#34;\u0026gt;nginx.org\u0026lt;/a\u0026gt;.\u0026lt;br/\u0026gt; Commercial support is available at \u0026lt;a href=\u0026#34;http://nginx.com/\u0026#34;\u0026gt;nginx.com\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Thank you for using nginx.\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; åˆ é™¤pod kubectl delete pod nginx-web-xxxxxx -n nginx-web ä¸ƒã€åˆ é™¤èŠ‚ç‚¹ é¦–å…ˆï¼Œç¡®å®šæƒ³è¦æ¸…ç©ºçš„èŠ‚ç‚¹çš„åç§°ã€‚å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹:\nkubectl get nodes æ¥ä¸‹æ¥ï¼Œå‘Šè¯‰ Kubernetes æ¸…ç©ºèŠ‚ç‚¹ï¼š\nkubectl drain \u0026lt;node name\u0026gt; ä¸€æ—¦å®ƒè¿”å›ï¼ˆæ²¡æœ‰æŠ¥é”™ï¼‰ï¼Œ ä½ å°±å¯ä»¥ä¸‹çº¿æ­¤èŠ‚ç‚¹ï¼ˆæˆ–è€…ç­‰ä»·åœ°ï¼Œå¦‚æœåœ¨äº‘å¹³å°ä¸Šï¼Œåˆ é™¤æ”¯æŒè¯¥èŠ‚ç‚¹çš„è™šæ‹Ÿæœºï¼‰ã€‚ å¦‚æœè¦åœ¨ç»´æŠ¤æ“ä½œæœŸé—´å°†èŠ‚ç‚¹ç•™åœ¨é›†ç¾¤ä¸­ï¼Œåˆ™éœ€è¦è¿è¡Œï¼š\nkubectl uncordon \u0026lt;node name\u0026gt; ç„¶åå‘Šè¯‰ Kubernetesï¼Œå®ƒå¯ä»¥ç»§ç»­åœ¨æ­¤èŠ‚ç‚¹ä¸Šè°ƒåº¦æ–°çš„ Podsã€‚\n","date":"2022-06-13T14:57:42+08:00","image":"https://cdn.jsdelivr.net/gh/Tweakzx/ImageHost@main/img/20220823230439.png","permalink":"https://tweakzx.github.io/p/kubernetesubuntu%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4/","title":"ã€Kubernetesã€‘ubuntuå®‰è£…k8sé›†ç¾¤"},{"content":"é¢˜ç›®æè¿° è¯·ä½ æ¥å®ç°ä¸€ä¸ª myAtoi(string s) å‡½æ•°ï¼Œä½¿å…¶èƒ½å°†å­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ª 32 ä½æœ‰ç¬¦å·æ•´æ•°ï¼ˆç±»ä¼¼ C/C++ ä¸­çš„ atoi å‡½æ•°ï¼‰ã€‚\nå‡½æ•° myAtoi(string s) çš„ç®—æ³•å¦‚ä¸‹ï¼š\n è¯»å…¥å­—ç¬¦ä¸²å¹¶ä¸¢å¼ƒæ— ç”¨çš„å‰å¯¼ç©ºæ ¼ æ£€æŸ¥ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼ˆå‡è®¾è¿˜æœªåˆ°å­—ç¬¦æœ«å°¾ï¼‰ä¸ºæ­£è¿˜æ˜¯è´Ÿå·ï¼Œè¯»å–è¯¥å­—ç¬¦ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚ ç¡®å®šæœ€ç»ˆç»“æœæ˜¯è´Ÿæ•°è¿˜æ˜¯æ­£æ•°ã€‚ å¦‚æœä¸¤è€…éƒ½ä¸å­˜åœ¨ï¼Œåˆ™å‡å®šç»“æœä¸ºæ­£ã€‚ è¯»å…¥ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œç›´åˆ°åˆ°è¾¾ä¸‹ä¸€ä¸ªéæ•°å­—å­—ç¬¦æˆ–åˆ°è¾¾è¾“å…¥çš„ç»“å°¾ã€‚å­—ç¬¦ä¸²çš„å…¶ä½™éƒ¨åˆ†å°†è¢«å¿½ç•¥ã€‚ å°†å‰é¢æ­¥éª¤è¯»å…¥çš„è¿™äº›æ•°å­—è½¬æ¢ä¸ºæ•´æ•°ï¼ˆå³ï¼Œ\u0026ldquo;123\u0026rdquo; -\u0026gt; 123ï¼Œ \u0026ldquo;0032\u0026rdquo; -\u0026gt; 32ï¼‰ã€‚å¦‚æœæ²¡æœ‰è¯»å…¥æ•°å­—ï¼Œåˆ™æ•´æ•°ä¸º 0 ã€‚å¿…è¦æ—¶æ›´æ”¹ç¬¦å·ï¼ˆä»æ­¥éª¤ 2 å¼€å§‹ï¼‰ã€‚ å¦‚æœæ•´æ•°æ•°è¶…è¿‡ 32 ä½æœ‰ç¬¦å·æ•´æ•°èŒƒå›´ [âˆ’231, 231 âˆ’ 1] ï¼Œéœ€è¦æˆªæ–­è¿™ä¸ªæ•´æ•°ï¼Œä½¿å…¶ä¿æŒåœ¨è¿™ä¸ªèŒƒå›´å†…ã€‚å…·ä½“æ¥è¯´ï¼Œå°äº âˆ’231 çš„æ•´æ•°åº”è¯¥è¢«å›ºå®šä¸º âˆ’231 ï¼Œå¤§äº 231 âˆ’ 1 çš„æ•´æ•°åº”è¯¥è¢«å›ºå®šä¸º 231 âˆ’ 1 ã€‚ è¿”å›æ•´æ•°ä½œä¸ºæœ€ç»ˆç»“æœã€‚  æ³¨æ„ï¼š\n  æœ¬é¢˜ä¸­çš„ç©ºç™½å­—ç¬¦åªåŒ…æ‹¬ç©ºæ ¼å­—ç¬¦ ' ' ã€‚\n  é™¤å‰å¯¼ç©ºæ ¼æˆ–æ•°å­—åçš„å…¶ä½™å­—ç¬¦ä¸²å¤–ï¼Œè¯·å‹¿å¿½ç•¥ ä»»ä½•å…¶ä»–å­—ç¬¦ã€‚\n  ç¤ºä¾‹ 1ï¼š\n è¾“å…¥ï¼šs = \u0026ldquo;42\u0026rdquo; è¾“å‡ºï¼š42 è§£é‡Šï¼šåŠ ç²—çš„å­—ç¬¦ä¸²ä¸ºå·²ç»è¯»å…¥çš„å­—ç¬¦ï¼Œæ’å…¥ç¬¦å·æ˜¯å½“å‰è¯»å–çš„å­—ç¬¦ã€‚ ç¬¬ 1 æ­¥ï¼š\u0026ldquo;42\u0026rdquo;ï¼ˆå½“å‰æ²¡æœ‰è¯»å…¥å­—ç¬¦ï¼Œå› ä¸ºæ²¡æœ‰å‰å¯¼ç©ºæ ¼ï¼‰ ^ ç¬¬ 2 æ­¥ï¼š\u0026ldquo;42\u0026rdquo;ï¼ˆå½“å‰æ²¡æœ‰è¯»å…¥å­—ç¬¦ï¼Œå› ä¸ºè¿™é‡Œä¸å­˜åœ¨ \u0026lsquo;-\u0026rsquo; æˆ–è€… \u0026lsquo;+'ï¼‰ ^ ç¬¬ 3 æ­¥ï¼š\u0026ldquo;42\u0026rdquo;ï¼ˆè¯»å…¥ \u0026ldquo;42\u0026rdquo;ï¼‰ ^ è§£æå¾—åˆ°æ•´æ•° 42 ã€‚ ç”±äº \u0026ldquo;42\u0026rdquo; åœ¨èŒƒå›´ [-231, 231 - 1] å†…ï¼Œæœ€ç»ˆç»“æœä¸º 42 ã€‚\n ç¤ºä¾‹ 2ï¼š\n è¾“å…¥ï¼šs = \u0026quot; -42\u0026quot; è¾“å‡ºï¼š-42 è§£é‡Šï¼š ç¬¬ 1 æ­¥ï¼š\u0026quot; -42\u0026quot;ï¼ˆè¯»å…¥å‰å¯¼ç©ºæ ¼ï¼Œä½†å¿½è§†æ‰ï¼‰ ^ ç¬¬ 2 æ­¥ï¼š\u0026quot; -42\u0026quot;ï¼ˆè¯»å…¥ \u0026lsquo;-\u0026rsquo; å­—ç¬¦ï¼Œæ‰€ä»¥ç»“æœåº”è¯¥æ˜¯è´Ÿæ•°ï¼‰ ^ ç¬¬ 3 æ­¥ï¼š\u0026quot; -42\u0026quot;ï¼ˆè¯»å…¥ \u0026ldquo;42\u0026rdquo;ï¼‰ ^ è§£æå¾—åˆ°æ•´æ•° -42 ã€‚ ç”±äº \u0026ldquo;-42\u0026rdquo; åœ¨èŒƒå›´ [-231, 231 - 1] å†…ï¼Œæœ€ç»ˆç»“æœä¸º -42 ã€‚\n ç¤ºä¾‹ 3ï¼š\n è¾“å…¥ï¼šs = \u0026ldquo;4193 with words\u0026rdquo; è¾“å‡ºï¼š4193 è§£é‡Šï¼š ç¬¬ 1 æ­¥ï¼š\u0026ldquo;4193 with words\u0026rdquo;ï¼ˆå½“å‰æ²¡æœ‰è¯»å…¥å­—ç¬¦ï¼Œå› ä¸ºæ²¡æœ‰å‰å¯¼ç©ºæ ¼ï¼‰ ^ ç¬¬ 2 æ­¥ï¼š\u0026ldquo;4193 with words\u0026rdquo;ï¼ˆå½“å‰æ²¡æœ‰è¯»å…¥å­—ç¬¦ï¼Œå› ä¸ºè¿™é‡Œä¸å­˜åœ¨ \u0026lsquo;-\u0026rsquo; æˆ–è€… \u0026lsquo;+'ï¼‰ ^ ç¬¬ 3 æ­¥ï¼š\u0026ldquo;4193 with words\u0026rdquo;ï¼ˆè¯»å…¥ \u0026ldquo;4193\u0026rdquo;ï¼›ç”±äºä¸‹ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œæ‰€ä»¥è¯»å…¥åœæ­¢ï¼‰ ^ è§£æå¾—åˆ°æ•´æ•° 4193 ã€‚ ç”±äº \u0026ldquo;4193\u0026rdquo; åœ¨èŒƒå›´ [-231, 231 - 1] å†…ï¼Œæœ€ç»ˆç»“æœä¸º 4193 ã€‚\n æç¤ºï¼š\n 0 \u0026lt;= s.length \u0026lt;= 200 s ç”±è‹±æ–‡å­—æ¯ï¼ˆå¤§å†™å’Œå°å†™ï¼‰ã€æ•°å­—ï¼ˆ0-9ï¼‰ã€\u0026rsquo; \u0026lsquo;ã€'+'ã€'-\u0026rsquo; å’Œ \u0026lsquo;.\u0026rsquo; ç»„æˆ  æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/string-to-integer-atoi\né¢˜è§£ å¤§å®¶å¯ä»¥è‡ªè¡Œå»çœ‹leetcodeçš„å®˜æ–¹é¢˜è§£ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªè‡ªåŠ¨æœºæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ç¬¬ä¸€æ¬¡ç”¨Goæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥å†³å®šè®°å½•ä¸‹æ¥\ntype Automaton struct{ state string sign int ans int table map[string][]string } func(a *Automaton) init(){ //å› ä¸ºGoä¸èƒ½è®¾ç½®ç±»å‹å˜é‡çš„åˆå§‹å€¼ï¼ˆæˆ‘æ²¡æ‰¾åˆ°ç›¸å…³ä»£ç ï¼‰ï¼Œæ‰€ä»¥æˆ‘ç”¨äº†åˆå§‹åŒ–å‡½æ•°æ¥ä»£æ›¿  a.state = \u0026#34;start\u0026#34; a.sign = 1 a.ans = 0 a.table = map[string][]string{ \u0026#34;start\u0026#34; : []string{\u0026#34;start\u0026#34;,\u0026#34;signed\u0026#34;,\u0026#34;in_number\u0026#34;,\u0026#34;end\u0026#34;}, \u0026#34;signed\u0026#34; : []string{\u0026#34;end\u0026#34;,\u0026#34;end\u0026#34;,\u0026#34;in_number\u0026#34;,\u0026#34;end\u0026#34;}, \u0026#34;in_number\u0026#34; : []string{\u0026#34;end\u0026#34;,\u0026#34;end\u0026#34;,\u0026#34;in_number\u0026#34;,\u0026#34;end\u0026#34;}, \u0026#34;end\u0026#34; : []string{\u0026#34;end\u0026#34;,\u0026#34;end\u0026#34;,\u0026#34;end\u0026#34;,\u0026#34;end\u0026#34;}, } } func(a *Automaton) get(c byte){ //å®ç°çŠ¶æ€è½¬ç§»çš„æ–¹æ³•  a.state = a.table[a.state][a.get_col(c)] switch a.state{ case \u0026#34;in_number\u0026#34;: a.ans = a.ans*10 + int(c-\u0026#39;0\u0026#39;) if a.sign\u0026gt;0{ a.ans = min(a.ans, math.MaxInt32) }else{ a.ans = min(a.ans, -math.MinInt32) } case \u0026#34;signed\u0026#34;: if c == \u0026#39;-\u0026#39;{ a.sign = -1 } } } func(a *Automaton) get_col(c byte ) int{//è·å¾—è¾“å…¥å­—ç¬¦çš„ç±»å‹  switch { case c==\u0026#39; \u0026#39;: return 0 case c==\u0026#39;+\u0026#39;||c==\u0026#39;-\u0026#39;: return 1 case \u0026#39;0\u0026#39;\u0026lt;=c\u0026amp;\u0026amp;c\u0026lt;=\u0026#39;9\u0026#39;: return 2 default: return 3 } } func(a *Automaton) get_ans() int{ //è·å¾—ç»“æœ  return a.sign * a.ans } func myAtoi(s string) int { a := \u0026amp;Automaton{} a.init() for i:=0; i\u0026lt;len(s); i++{ a.get(s[i]) } return a.get_ans() } func min(a,b int) int{ if a\u0026lt;b{ return a } return b } ","date":"2022-03-12T16:59:39+08:00","permalink":"https://tweakzx.github.io/p/golang%E8%87%AA%E5%8A%A8%E6%9C%BA%E7%9A%84%E5%AE%9E%E7%8E%B0/","title":"ã€Golangã€‘è‡ªåŠ¨æœºçš„å®ç°"},{"content":"æ—…è¡Œèµ·ç‚¹ Go è¯­è¨€ä¹‹æ—… (go-zh.org)\nä¸Šæ–¹é“¾æ¥æ˜¯ä¸€ä¸ªGoè¯­è¨€å­¦ä¹ çš„Playgroundï¼Œå¿«ç‚¹å‡»å®ƒï¼Œå¼€å¯ä¸€åœºGoè¯­è¨€ä¹‹æ—…å§\næ—…è¡Œå¼€å§‹ ç»ƒä¹ ï¼šå¾ªç¯ä¸å‡½æ•° ä¸ºäº†ç»ƒä¹ å‡½æ•°ä¸å¾ªç¯ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªå¹³æ–¹æ ¹å‡½æ•°ï¼šç”¨ç‰›é¡¿æ³•å®ç°å¹³æ–¹æ ¹å‡½æ•°ã€‚\nè®¡ç®—æœºé€šå¸¸ä½¿ç”¨å¾ªç¯æ¥è®¡ç®— x çš„å¹³æ–¹æ ¹ã€‚ä»æŸä¸ªçŒœæµ‹çš„å€¼ z å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ® zÂ² ä¸ x çš„è¿‘ä¼¼åº¦æ¥è°ƒæ•´ zï¼Œäº§ç”Ÿä¸€ä¸ªæ›´å¥½çš„çŒœæµ‹ï¼š\nz -= (z*z - x) / (2*z) é‡å¤è°ƒæ•´çš„è¿‡ç¨‹ï¼ŒçŒœæµ‹çš„ç»“æœä¼šè¶Šæ¥è¶Šç²¾ç¡®ï¼Œå¾—åˆ°çš„ç­”æ¡ˆä¹Ÿä¼šå°½å¯èƒ½æ¥è¿‘å®é™…çš„å¹³æ–¹æ ¹ã€‚\nåœ¨æä¾›çš„ func Sqrt ä¸­å®ç°å®ƒã€‚æ— è®ºè¾“å…¥æ˜¯ä»€ä¹ˆï¼Œå¯¹ z çš„ä¸€ä¸ªæ°å½“çš„çŒœæµ‹ä¸º 1ã€‚ è¦å¼€å§‹ï¼Œè¯·é‡å¤è®¡ç®— 10 æ¬¡å¹¶éšä¹‹æ‰“å°æ¯æ¬¡çš„ z å€¼ã€‚è§‚å¯Ÿå¯¹äºä¸åŒçš„å€¼ xï¼ˆ1ã€2ã€3 \u0026hellip;ï¼‰ï¼Œ ä½ å¾—åˆ°çš„ç­”æ¡ˆæ˜¯å¦‚ä½•é€¼è¿‘ç»“æœçš„ï¼ŒçŒœæµ‹æå‡çš„é€Ÿåº¦æœ‰å¤šå¿«ã€‚\næç¤ºï¼šç”¨ç±»å‹è½¬æ¢æˆ–æµ®ç‚¹æ•°è¯­æ³•æ¥å£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ªæµ®ç‚¹æ•°å€¼ï¼š\nz := 1.0 z := float64(1) ç„¶åï¼Œä¿®æ”¹å¾ªç¯æ¡ä»¶ï¼Œä½¿å¾—å½“å€¼åœæ­¢æ”¹å˜ï¼ˆæˆ–æ”¹å˜éå¸¸å°ï¼‰çš„æ—¶å€™é€€å‡ºå¾ªç¯ã€‚è§‚å¯Ÿè¿­ä»£æ¬¡æ•°å¤§äºè¿˜æ˜¯å°äº 10ã€‚ å°è¯•æ”¹å˜ z çš„åˆå§‹çŒœæµ‹ï¼Œå¦‚ x æˆ– x/2ã€‚ä½ çš„å‡½æ•°ç»“æœä¸æ ‡å‡†åº“ä¸­çš„ math.Sqrt æ¥è¿‘å—ï¼Ÿ\nï¼ˆæ³¨ï¼š å¦‚æœä½ å¯¹è¯¥ç®—æ³•çš„ç»†èŠ‚æ„Ÿå…´è¶£ï¼Œä¸Šé¢çš„ zÂ² âˆ’ x æ˜¯ zÂ² åˆ°å®ƒæ‰€è¦åˆ°è¾¾çš„å€¼ï¼ˆå³ xï¼‰çš„è·ç¦»ï¼Œ é™¤ä»¥çš„ 2z ä¸º zÂ² çš„å¯¼æ•°ï¼Œæˆ‘ä»¬é€šè¿‡ zÂ² çš„å˜åŒ–é€Ÿåº¦æ¥æ”¹å˜ z çš„è°ƒæ•´é‡ã€‚ è¿™ç§é€šç”¨æ–¹æ³•å«åšç‰›é¡¿æ³•ã€‚ å®ƒå¯¹å¾ˆå¤šå‡½æ•°ï¼Œç‰¹åˆ«æ˜¯å¹³æ–¹æ ¹è€Œè¨€éå¸¸æœ‰æ•ˆã€‚ï¼‰\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;math\u0026#34; ) func Sqrt(x float64) (z float64) { z = float64(1) for math.Abs(z*z-x)\u0026gt;0.000001 { z -= (z*z-x)/(z*2) } return } func main() { fmt.Println(Sqrt(2)) } ç»ƒä¹ ï¼šåˆ‡ç‰‡ å®ç° Picã€‚å®ƒåº”å½“è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º dy çš„åˆ‡ç‰‡ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º dxï¼Œå…ƒç´ ç±»å‹ä¸º uint8 çš„åˆ‡ç‰‡ã€‚å½“ä½ è¿è¡Œæ­¤ç¨‹åºæ—¶ï¼Œå®ƒä¼šå°†æ¯ä¸ªæ•´æ•°è§£é‡Šä¸ºç°åº¦å€¼ï¼ˆå¥½å§ï¼Œå…¶å®æ˜¯è“åº¦å€¼ï¼‰å¹¶æ˜¾ç¤ºå®ƒæ‰€å¯¹åº”çš„å›¾åƒã€‚\nå›¾åƒçš„é€‰æ‹©ç”±ä½ æ¥å®šã€‚å‡ ä¸ªæœ‰è¶£çš„å‡½æ•°åŒ…æ‹¬ (x+y)/2, x*y, x^y, x*log(y) å’Œ x%(y+1)ã€‚\nï¼ˆæç¤ºï¼šéœ€è¦ä½¿ç”¨å¾ªç¯æ¥åˆ†é… [][]uint8 ä¸­çš„æ¯ä¸ª []uint8ï¼›è¯·ä½¿ç”¨ uint8(intValue) åœ¨ç±»å‹ä¹‹é—´è½¬æ¢ï¼›ä½ å¯èƒ½ä¼šç”¨åˆ° math åŒ…ä¸­çš„å‡½æ•°ã€‚ï¼‰\npackage main import \u0026#34;golang.org/x/tour/pic\u0026#34; func Pic(dx, dy int) [][]uint8 { picture := make([][]uint8,dy) for x:=range picture{ line := make([]uint8,dx) for y:=range line{ line[y] = uint8((x+y)/2) } picture[x] = line } return picture } func main() { pic.Show(Pic) } ç»ƒä¹ ï¼šæ˜ å°„ å®ç° WordCountã€‚å®ƒåº”å½“è¿”å›ä¸€ä¸ªæ˜ å°„ï¼Œå…¶ä¸­åŒ…å«å­—ç¬¦ä¸² s ä¸­æ¯ä¸ªâ€œå•è¯â€çš„ä¸ªæ•°ã€‚å‡½æ•° wc.Test ä¼šå¯¹æ­¤å‡½æ•°æ‰§è¡Œä¸€ç³»åˆ—æµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶è¾“å‡ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚\nä½ ä¼šå‘ç° strings.Fields å¾ˆæœ‰å¸®åŠ©ã€‚\npackage main import ( \u0026#34;golang.org/x/tour/wc\u0026#34; \u0026#34;strings\u0026#34; ) func WordCount(s string) map[string]int { words := strings.Fields(s) ans := make(map[string]int) for _,w :=range words{ //v,ok := ans[w] \tans[w] = ans[w] + 1 } return ans } func main() { wc.Test(WordCount) } ç»ƒä¹ ï¼šæ–æ³¢çº³å¥‘é—­åŒ… è®©æˆ‘ä»¬ç”¨å‡½æ•°åšäº›å¥½ç©çš„äº‹æƒ…ã€‚\nå®ç°ä¸€ä¸ª fibonacci å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªå‡½æ•°ï¼ˆé—­åŒ…ï¼‰ï¼Œè¯¥é—­åŒ…è¿”å›ä¸€ä¸ªæ–æ³¢çº³å¥‘æ•°åˆ— (0, 1, 1, 2, 3, 5, ...)ã€‚\npackage main import \u0026#34;fmt\u0026#34; // è¿”å›ä¸€ä¸ªâ€œè¿”å›intçš„å‡½æ•°â€ func fibonacci() func() int { first := 2 second := 1 //æ ¹æ®å…¬å¼å€’æ¨å‡ºçš„firstå’Œsecond \treturn func() int{ first = second - first second = second + first //æ–æ³¢é‚£å¥‘å…¬å¼ \treturn second } } func main() { f := fibonacci() for i := 0; i \u0026lt; 10; i++ { fmt.Println(f()) } } ç»ƒä¹ ï¼šStringer é€šè¿‡è®© IPAddr ç±»å‹å®ç° fmt.Stringer æ¥æ‰“å°ç‚¹å·åˆ†éš”çš„åœ°å€ã€‚\nä¾‹å¦‚ï¼ŒIPAddr{1, 2, 3, 4} åº”å½“æ‰“å°ä¸º \u0026quot;1.2.3.4\u0026quot;ã€‚\npackage main import \u0026#34;fmt\u0026#34; type IPAddr [4]byte // TODO: ç»™ IPAddr æ·»åŠ ä¸€ä¸ª \u0026#34;String() string\u0026#34; æ–¹æ³• func (ip IPAddr) String() string{ return fmt.Sprintf(\u0026#34;%v.%v.%v.%v\\n\u0026#34;,ip[0],ip[1],ip[2],ip[3]) } func main() { hosts := map[string]IPAddr{ \u0026#34;loopback\u0026#34;: {127, 0, 0, 1}, \u0026#34;googleDNS\u0026#34;: {8, 8, 8, 8}, } for name, ip := range hosts { fmt.Printf(\u0026#34;%v: %v\\n\u0026#34;, name, ip) } } ç»ƒä¹ ï¼šé”™è¯¯ ä»ä¹‹å‰çš„ç»ƒä¹ ä¸­å¤åˆ¶ Sqrt å‡½æ•°ï¼Œä¿®æ”¹å®ƒä½¿å…¶è¿”å› error å€¼ã€‚\nSqrt æ¥å—åˆ°ä¸€ä¸ªè´Ÿæ•°æ—¶ï¼Œåº”å½“è¿”å›ä¸€ä¸ªé nil çš„é”™è¯¯å€¼ã€‚å¤æ•°åŒæ ·ä¹Ÿä¸è¢«æ”¯æŒã€‚\nåˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å‹\ntype ErrNegativeSqrt float64 å¹¶ä¸ºå…¶å®ç°\nfunc (e ErrNegativeSqrt) Error() string æ–¹æ³•ä½¿å…¶æ‹¥æœ‰ error å€¼ï¼Œé€šè¿‡ ErrNegativeSqrt(-2).Error() è°ƒç”¨è¯¥æ–¹æ³•åº”è¿”å› \u0026quot;cannot Sqrt negative number: -2\u0026quot;ã€‚\næ³¨æ„: åœ¨ Error æ–¹æ³•å†…è°ƒç”¨ fmt.Sprint(e) ä¼šè®©ç¨‹åºé™·å…¥æ­»å¾ªç¯ã€‚å¯ä»¥é€šè¿‡å…ˆè½¬æ¢ e æ¥é¿å…è¿™ä¸ªé—®é¢˜ï¼šfmt.Sprint(float64(e))ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\nä¿®æ”¹ Sqrt å‡½æ•°ï¼Œä½¿å…¶æ¥å—ä¸€ä¸ªè´Ÿæ•°æ—¶ï¼Œè¿”å› ErrNegativeSqrt å€¼ã€‚\npackage main import ( \u0026#34;fmt\u0026#34; ) type ErrNegativeSqrt float64 func (e ErrNegativeSqrt) Error() string{ return fmt.Sprintf(\u0026#34;cannot Sqrt negative number: %v\u0026#34;,float64(e)) } func Sqrt(x float64) (float64, error) { if x\u0026gt;0{ return 0, nil }else{ var e ErrNegativeSqrt e = ErrNegativeSqrt(x) return x,e } } func main() { fmt.Println(Sqrt(2)) fmt.Println(Sqrt(-2)) } ç»ƒä¹ ï¼šReader å®ç°ä¸€ä¸ª Reader ç±»å‹ï¼Œå®ƒäº§ç”Ÿä¸€ä¸ª ASCII å­—ç¬¦ 'A' çš„æ— é™æµã€‚\npackage main import \u0026#34;golang.org/x/tour/reader\u0026#34; type MyReader struct{} // TODO: ç»™ MyReader æ·»åŠ ä¸€ä¸ª Read([]byte) (int, error) æ–¹æ³• func (mr MyReader) Read(buf []byte) (int, error) { for i :=range buf{ buf[i] = \u0026#39;A\u0026#39; } return 1, nil } func main() { reader.Validate(MyReader{}) } ç»ƒä¹ ï¼šrot13Reader æœ‰ç§å¸¸è§çš„æ¨¡å¼æ˜¯ä¸€ä¸ª io.Reader åŒ…è£…å¦ä¸€ä¸ª io.Readerï¼Œç„¶åé€šè¿‡æŸç§æ–¹å¼ä¿®æ”¹å…¶æ•°æ®æµã€‚\nä¾‹å¦‚ï¼Œgzip.NewReader å‡½æ•°æ¥å—ä¸€ä¸ª io.Readerï¼ˆå·²å‹ç¼©çš„æ•°æ®æµï¼‰å¹¶è¿”å›ä¸€ä¸ªåŒæ ·å®ç°äº† io.Reader çš„ *gzip.Readerï¼ˆè§£å‹åçš„æ•°æ®æµï¼‰ã€‚\nç¼–å†™ä¸€ä¸ªå®ç°äº† io.Reader å¹¶ä»å¦ä¸€ä¸ª io.Reader ä¸­è¯»å–æ•°æ®çš„ rot13Readerï¼Œé€šè¿‡åº”ç”¨ rot13 ä»£æ¢å¯†ç å¯¹æ•°æ®æµè¿›è¡Œä¿®æ”¹ã€‚\nrot13Reader ç±»å‹å·²ç»æä¾›ã€‚å®ç° Read æ–¹æ³•ä»¥æ»¡è¶³ io.Readerã€‚\npackage main import ( \u0026#34;io\u0026#34; \u0026#34;os\u0026#34; \u0026#34;strings\u0026#34; ) type rot13Reader struct { r io.Reader } func ( rot rot13Reader) Read(buf []byte) (int, error){ len,ok := rot.r.Read(buf) for i,v := range buf{ switch{ case (\u0026#39;a\u0026#39;\u0026lt;=v \u0026amp;\u0026amp; v\u0026lt;=\u0026#39;m\u0026#39;)||(\u0026#39;A\u0026#39;\u0026lt;=v \u0026amp;\u0026amp; v\u0026lt;=\u0026#39;M\u0026#39;): buf[i] = v+13 case (\u0026#39;n\u0026#39;\u0026lt;=v \u0026amp;\u0026amp; v\u0026lt;=\u0026#39;z\u0026#39;)||(\u0026#39;N\u0026#39;\u0026lt;=v \u0026amp;\u0026amp; v\u0026lt;=\u0026#39;Z\u0026#39;): buf[i] = v-13 default: } } return len,ok } func main() { s := strings.NewReader(\u0026#34;Lbh penpxrq gur pbqr!\u0026#34;) r := rot13Reader{s} io.Copy(os.Stdout, \u0026amp;r) } ç»ƒä¹ ï¼šå›¾åƒ è¿˜è®°å¾—ä¹‹å‰ç¼–å†™çš„å›¾ç‰‡ç”Ÿæˆå™¨ å—ï¼Ÿæˆ‘ä»¬å†æ¥ç¼–å†™å¦å¤–ä¸€ä¸ªï¼Œä¸è¿‡è¿™æ¬¡å®ƒå°†ä¼šè¿”å›ä¸€ä¸ª image.Image çš„å®ç°è€Œéä¸€ä¸ªæ•°æ®åˆ‡ç‰‡ã€‚\nå®šä¹‰ä½ è‡ªå·±çš„ Image ç±»å‹ï¼Œå®ç°å¿…è¦çš„æ–¹æ³•å¹¶è°ƒç”¨ pic.ShowImageã€‚\nBounds åº”å½“è¿”å›ä¸€ä¸ª image.Rectangle ï¼Œä¾‹å¦‚ image.Rect(0, 0, w, h)ã€‚\nColorModel åº”å½“è¿”å› color.RGBAModelã€‚\nAt åº”å½“è¿”å›ä¸€ä¸ªé¢œè‰²ã€‚ä¸Šä¸€ä¸ªå›¾ç‰‡ç”Ÿæˆå™¨çš„å€¼ v å¯¹åº”äºæ­¤æ¬¡çš„ color.RGBA{v, v, 255, 255}ã€‚\npackage main import ( \u0026#34;golang.org/x/tour/pic\u0026#34; \u0026#34;image\u0026#34; \u0026#34;image/color\u0026#34; ) type Image struct{ w,h int pixels [][]uint8 } func (self Image) Bounds()(image.Rectangle){ return image.Rect(0, 0, self.w, self.h) } func (self Image) ColorModel()(color.Model){ return color.RGBAModel } func (self Image) At(x int ,y int)(color.Color){ v := self.pixels[y][x] return color.RGBA{v,v, 255, 255} } func Pic(dx, dy int) [][]uint8 { img := make([][]uint8, dy) for y := 0; y \u0026lt; dy; y++ { img[y] = make([]uint8, dx) for x := 0; x \u0026lt; dx; x++ { img[y][x] = (uint8)(x^y) } } return img } func main() { m := Image{256,256,Pic(256,256)} pic.ShowImage(m) } ç»ƒä¹ ï¼šç­‰ä»·äºŒå‰æŸ¥æ‰¾æ ‘ 1. å®ç° Walk å‡½æ•°ã€‚\n2. æµ‹è¯• Walk å‡½æ•°ã€‚\nå‡½æ•° tree.New(k) ç”¨äºæ„é€ ä¸€ä¸ªéšæœºç»“æ„çš„å·²æ’åºäºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå®ƒä¿å­˜äº†å€¼ k, 2k, 3k, \u0026hellip;, 10kã€‚\nåˆ›å»ºä¸€ä¸ªæ–°çš„ä¿¡é“ ch å¹¶ä¸”å¯¹å…¶è¿›è¡Œæ­¥è¿›ï¼š\ngo Walk(tree.New(1), ch) ç„¶åä»ä¿¡é“ä¸­è¯»å–å¹¶æ‰“å° 10 ä¸ªå€¼ã€‚åº”å½“æ˜¯æ•°å­— 1, 2, 3, ..., 10ã€‚\n3. ç”¨ Walk å®ç° Same å‡½æ•°æ¥æ£€æµ‹ t1 å’Œ t2 æ˜¯å¦å­˜å‚¨äº†ç›¸åŒçš„å€¼ã€‚\n4. æµ‹è¯• Same å‡½æ•°ã€‚\nSame(tree.New(1), tree.New(1)) åº”å½“è¿”å› trueï¼Œè€Œ Same(tree.New(1), tree.New(2)) åº”å½“è¿”å› falseã€‚\nTree çš„æ–‡æ¡£å¯åœ¨è¿™é‡Œæ‰¾åˆ°ã€‚\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;golang.org/x/tour/tree\u0026#34; ) // Walk æ­¥è¿› tree t å°†æ‰€æœ‰çš„å€¼ä» tree å‘é€åˆ° channel chã€‚ func Walk(t *tree.Tree, ch chan int) { dfs(t, ch) close(ch) } func dfs(t *tree.Tree, ch chan int) { if t == nil { return } dfs(t.Left, ch) ch \u0026lt;- t.Value dfs(t.Right, ch) } // Same æ£€æµ‹æ ‘ t1 å’Œ t2 æ˜¯å¦å«æœ‰ç›¸åŒçš„å€¼ã€‚ func Same(t1, t2 *tree.Tree) bool { ch1, ch2 := make(chan int), make(chan int) go Walk(t1, ch1) go Walk(t2, ch2) for i := range ch1 { // ch1 å…³é—­å forå¾ªç¯è‡ªåŠ¨è·³å‡º \tif i != \u0026lt;-ch2 { return false } } return true } func main() { fmt.Println(Same(tree.New(1), tree.New(1))) } ç»ƒä¹ ï¼šWeb çˆ¬è™« åœ¨è¿™ä¸ªç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨ Go çš„å¹¶å‘ç‰¹æ€§æ¥å¹¶è¡ŒåŒ–ä¸€ä¸ª Web çˆ¬è™«ã€‚\nä¿®æ”¹ Crawl å‡½æ•°æ¥å¹¶è¡Œåœ°æŠ“å– URLï¼Œå¹¶ä¸”ä¿è¯ä¸é‡å¤ã€‚\næç¤ºï¼šä½ å¯ä»¥ç”¨ä¸€ä¸ª map æ¥ç¼“å­˜å·²ç»è·å–çš„ URLï¼Œä½†æ˜¯è¦æ³¨æ„ map æœ¬èº«å¹¶ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; ) type Fetcher interface { // Fetch è¿”å› URL çš„ body å†…å®¹ï¼Œå¹¶ä¸”å°†åœ¨è¿™ä¸ªé¡µé¢ä¸Šæ‰¾åˆ°çš„ URL æ”¾åˆ°ä¸€ä¸ª slice ä¸­ã€‚ \tFetch(url string) (body string, urls []string, err error) } // Crawl ä½¿ç”¨ fetcher ä»æŸä¸ª URL å¼€å§‹é€’å½’çš„çˆ¬å–é¡µé¢ï¼Œç›´åˆ°è¾¾åˆ°æœ€å¤§æ·±åº¦ã€‚  type CrawlRecord struct{ m map[string]int mux sync.Mutex wg sync.WaitGroup } var\tcr = CrawlRecord{m: make(map[string]int)} func Crawl(url string, depth int, fetcher Fetcher) { defer cr.wg.Done() // TODO: å¹¶è¡Œçš„æŠ“å– URLã€‚ \t// TODO: ä¸é‡å¤æŠ“å–é¡µé¢ã€‚  // ä¸‹é¢å¹¶æ²¡æœ‰å®ç°ä¸Šé¢ä¸¤ç§æƒ…å†µï¼š \tif depth \u0026lt;= 0 { return } cr.mux.Lock() cr.m[url]++ cr.mux.Unlock() body, urls, err := fetcher.Fetch(url) if err != nil { fmt.Println(err) return } fmt.Printf(\u0026#34;found: %s %q\\n\u0026#34;, url, body) for _, u := range urls { cr.mux.Lock() if _,ok := cr.m[u]; !ok{ cr.wg.Add(1) go Crawl(u, depth-1, fetcher) } cr.mux.Unlock() } return } func main() { cr.wg.Add(1) Crawl(\u0026#34;https://golang.org/\u0026#34;, 4, fetcher) cr.wg.Wait() } // fakeFetcher æ˜¯è¿”å›è‹¥å¹²ç»“æœçš„ Fetcherã€‚ type fakeFetcher map[string]*fakeResult type fakeResult struct { body string urls []string } func (f fakeFetcher) Fetch(url string) (string, []string, error) { if res, ok := f[url]; ok { return res.body, res.urls, nil } return \u0026#34;\u0026#34;, nil, fmt.Errorf(\u0026#34;not found: %s\u0026#34;, url) } // fetcher æ˜¯å¡«å……åçš„ fakeFetcherã€‚ var fetcher = fakeFetcher{ \u0026#34;https://golang.org/\u0026#34;: \u0026amp;fakeResult{ \u0026#34;The Go Programming Language\u0026#34;, []string{ \u0026#34;https://golang.org/pkg/\u0026#34;, \u0026#34;https://golang.org/cmd/\u0026#34;, }, }, \u0026#34;https://golang.org/pkg/\u0026#34;: \u0026amp;fakeResult{ \u0026#34;Packages\u0026#34;, []string{ \u0026#34;https://golang.org/\u0026#34;, \u0026#34;https://golang.org/cmd/\u0026#34;, \u0026#34;https://golang.org/pkg/fmt/\u0026#34;, \u0026#34;https://golang.org/pkg/os/\u0026#34;, }, }, \u0026#34;https://golang.org/pkg/fmt/\u0026#34;: \u0026amp;fakeResult{ \u0026#34;Package fmt\u0026#34;, []string{ \u0026#34;https://golang.org/\u0026#34;, \u0026#34;https://golang.org/pkg/\u0026#34;, }, }, \u0026#34;https://golang.org/pkg/os/\u0026#34;: \u0026amp;fakeResult{ \u0026#34;Package os\u0026#34;, []string{ \u0026#34;https://golang.org/\u0026#34;, \u0026#34;https://golang.org/pkg/\u0026#34;, }, }, } æ—…è¡Œç»ˆç‚¹ ä½ å¯ä»¥ä»å®‰è£… Go å¼€å§‹ã€‚\nwget -c https://dl.google.com/go/go1.14.2.linux-amd64.tar.gz -O - | sudo tar -xz -C /usr/local vim /etc/profile export PATH=$PATH:/usr/local/go/bin export GOPROXY=https://goproxy.cn,direct export GO111MODULE=on source ~/.profile go version ä¸€æ—¦å®‰è£…äº† Goï¼ŒGo æ–‡æ¡£æ˜¯ä¸€ä¸ªæå¥½çš„ åº”å½“ç»§ç»­é˜…è¯»çš„å†…å®¹ã€‚ å®ƒåŒ…å«äº†å‚è€ƒã€æŒ‡å—ã€è§†é¢‘ç­‰ç­‰æ›´å¤šèµ„æ–™ã€‚\näº†è§£å¦‚ä½•ç»„ç»‡ Go ä»£ç å¹¶åœ¨å…¶ä¸Šå·¥ä½œï¼Œå‚é˜…æ­¤è§†é¢‘ï¼Œæˆ–è€…é˜…è¯»å¦‚ä½•ç¼–å†™ Go ä»£ç ã€‚\nå¦‚æœä½ éœ€è¦æ ‡å‡†åº“æ–¹é¢çš„å¸®åŠ©ï¼Œè¯·å‚è€ƒåŒ…æ‰‹å†Œã€‚å¦‚æœæ˜¯è¯­è¨€æœ¬èº«çš„å¸®åŠ©ï¼Œé˜…è¯»è¯­è¨€è§„èŒƒæ˜¯ä»¶ä»¤äººæ„‰å¿«çš„äº‹æƒ…ã€‚\nè¿›ä¸€æ­¥æ¢ç´¢ Go çš„å¹¶å‘æ¨¡å‹ï¼Œå‚é˜… Go å¹¶å‘æ¨¡å‹(å¹»ç¯ç‰‡)ä»¥åŠæ·±å…¥ Go å¹¶å‘æ¨¡å‹(å¹»ç¯ç‰‡)å¹¶é˜…è¯»é€šè¿‡é€šä¿¡å…±äº«å†…å­˜çš„ä»£ç ä¹‹æ—…ã€‚\næƒ³è¦å¼€å§‹ç¼–å†™ Web åº”ç”¨ï¼Œè¯·å‚é˜…ä¸€ä¸ªç®€å•çš„ç¼–ç¨‹ç¯å¢ƒ(å¹»ç¯ç‰‡)å¹¶é˜…è¯»ç¼–å†™ Web åº”ç”¨çš„æŒ‡å—ã€‚\nå‡½æ•°ï¼šGo ä¸­çš„ä¸€ç­‰å…¬æ°‘å±•ç¤ºäº†æœ‰è¶£çš„å‡½æ•°ç±»å‹ã€‚\nGo åšå®¢æœ‰ç€ä¼—å¤šå…³äº Go çš„æ–‡ç« å’Œä¿¡æ¯ã€‚\nmikespook çš„åšå®¢ä¸­æœ‰å¤§é‡ä¸­æ–‡çš„å…³äº Go çš„æ–‡ç« å’Œç¿»è¯‘ã€‚\nå¼€æºç”µå­ä¹¦ Go Web ç¼–ç¨‹å’Œ Go å…¥é—¨æŒ‡å—èƒ½å¤Ÿå¸®åŠ©ä½ æ›´åŠ æ·±å…¥çš„äº†è§£å’Œå­¦ä¹  Go è¯­è¨€ã€‚\nè®¿é—® go-zh.org äº†è§£æ›´å¤šå†…å®¹ã€‚\n","date":"2022-02-22T17:20:32+08:00","image":"https://go.dev/images/gophers/biplane.svg","permalink":"https://tweakzx.github.io/p/golanggo%E8%AF%AD%E8%A8%80%E4%B9%8B%E6%97%85/","title":"ã€Golangã€‘Goè¯­è¨€ä¹‹æ—…"},{"content":"PolarDB Serverlessè®ºæ–‡é˜…è¯»æŠ¥å‘Š æ‘˜è¦ æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ä¸Šäº‘æ˜¯è¿‘æœŸå¾ˆç«çš„ç ”ç©¶è¶‹åŠ¿ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥è·å¾—æ›´é«˜çš„å¼¹æ€§ï¼Œå¯ç”¨æ€§ä»¥åŠæ›´ä½çš„æˆæœ¬ï¼Œä¼ ç»Ÿçš„ç‹¬å—çš„æ•°æ®åº“æ¶æ„å¾ˆéš¾æ»¡è¶³è¿™æ ·çš„è¦æ±‚ã€‚é«˜é€Ÿç½‘ç»œä¸æ–°çš„å†…å­˜æŠ€æœ¯ï¼ˆä¾‹å¦‚RDMAï¼‰çš„å‘å±•ï¼Œç»™åˆ†æ•£å¼æ•°æ®åº“å¸¦æ¥äº†å¯èƒ½ï¼šå®ƒå°†åŸå…ˆçš„ç‹¬å—çš„æœåŠ¡å™¨èµ„æºåˆ†ç¦»è§£è€¦åˆ°èµ„æºæ± ä¸­ï¼Œå†é€šè¿‡é«˜é€Ÿç½‘ç»œè¿æ¥èµ·æ¥ã€‚ä¸‹ä¸€ä»£çš„äº‘åŸç”Ÿæ•°æ®åº“å°±æ˜¯ä¸ºäº†åˆ†æ•£åŒ–çš„æ•°æ®ä¸­å¿ƒè€Œè®¾è®¡ã€‚\nPolarDB Serverless éµå¾ªåˆ†æ•£å¼çš„è®¾è®¡èŒƒå¼è€Œè®¾è®¡ï¼Œè§£è€¦äº†è®¡ç®—èŠ‚ç‚¹çš„CPUï¼Œå†…å­˜ï¼Œå­˜å‚¨èµ„æºã€‚\n æ¯ç§èµ„æºå¯ä»¥éšéœ€æ±‚è€Œç‹¬ç«‹çš„å¢é•¿æˆ–ç¼©å°ï¼Œä¿éšœå¯é æ€§çš„åŒæ—¶ï¼Œå¯ä»¥è¿›è¡Œå¤šç»´åº¦çš„æŒ‰éœ€ä¾›åº”ã€‚ åŒæ—¶é‡‡ç”¨äº†ä¼˜åŒ–ç­–ç•¥å¦‚ä¹è§‚é”å’Œé¢„å–ç­–ç•¥æ¥æ”¹å–„æ€§èƒ½ã€‚ è¿˜å¯ä»¥å®ç°æ›´å¿«çš„æ•…éšœæ¢å¤ã€‚  ä»‹ç» ä½¿ç”¨äº‘æ•°æ®åº“çš„ä¸‰ä¸ªå¥½å¤„ï¼š  æŒ‰éœ€ä»˜è´¹å¯ä»¥ä½¿å¾—ç”¨æˆ·å‡å°å¼€æ”¯ã€‚ æ›´é«˜çš„èµ„æºå¼¹æ€§å¯ä»¥åº”å¯¹çŸ­æš‚çš„èµ„æºä½¿ç”¨é«˜å³°æœŸã€‚ æ›´å¿«çš„å‡çº§ä¸æ›´å¿«çš„é”™è¯¯ä¿®å¤ã€‚å¿«é€Ÿçš„å‡çº§è¿­ä»£å¯ä»¥ä¿è¯äº§å“ç«äº‰åŠ›ï¼Œé”™è¯¯ä¿®å¤å¯ä»¥åœ¨ä¸å½±å“äº§å“å¯ç”¨æ€§çš„å‰æä¸‹è¿›è¡Œã€‚  ç»å…¸çš„äº‘æ•°æ®åº“çš„æ¶æ„  monolithic machine ç‹¬å—çš„æœºå™¨  ç‰¹ç‚¹ï¼šæ‰€æœ‰çš„èµ„æºéƒ½æ˜¯ç´§è€¦åˆçš„ é—®é¢˜ï¼š  åœ¨è¿›è¡Œæ•°æ®åº“å®ä¾‹åˆ°æœºå™¨çš„åˆ†å‘è¿‡ç¨‹ä¸­è¦è§£å†³ä¸€ä¸ªè£…ç®±é—®é¢˜ æ€»æ˜¯æœ‰ç¢ç‰‡åŒ–çš„èµ„æºï¼Œéš¾ä»¥è¾¾åˆ°é«˜çš„ä½¿ç”¨ç‡ è¿è¡Œæ—¶ä¸èƒ½æ ¹æ®è´Ÿè½½è°ƒæ•´èµ„æº èµ„æºé—´çš„å‘½è¿å…±äº«ï¼Œä¸€ä¸ªèµ„æºçš„æ•…éšœä¼šå¯¼è‡´å…¶ä»–èµ„æºçš„æ•…éšœï¼Œä¸èƒ½ç‹¬ç«‹é€æ˜åœ°ä¿®å¤æ•…éšœï¼Œå¯¼è‡´ä¿®å¤æ—¶é—´å¾ˆé•¿     å­˜ç®—åˆ†ç¦»çš„æ¶æ„ï¼š  ä¸¤ç§ï¼š  virtual machine with remote disk æ­è½½è¿œç¨‹ç¡¬ç›˜çš„è™šæ‹Ÿæœº shared storage å…±äº«å­˜å‚¨   ä¼˜ç‚¹  DBaaSå¯ä»¥æé«˜å­˜å‚¨æ± çš„ä½¿ç”¨ç‡ å…±äº«å­˜å‚¨å¯ä»¥è¿›ä¸€æ­¥å‡å°‘æˆæœ¬ï¼šåŸæ•°æ®ä¸åªè¯»å¤‡ä»½å¯ä»¥å…±äº«å­˜å‚¨   é—®é¢˜  CPUå’Œå†…å­˜çš„è£…ç®±é—®é¢˜ä¾æ—§å­˜åœ¨ ç¼ºä¹çµæ´»å¯æ”¾ç¼©çš„å†…å­˜èµ„æº æ¯ä¸ªåªè¯»å¤‡ä»½åœ¨å†…å­˜ä¸­éƒ½è¦æœ‰å†—ä½™çš„å†…å­˜å¼€é”€      æœ¬æ–‡æå‡ºäº†ä¸€ç§æ–°æ¶æ„ï¼Œåˆ†æ•£æ¶æ„ï¼ˆdisaggragation architecture)  è¿è¡Œåœ¨åˆ†æ•£çš„æ•°æ®ä¸­å¿ƒï¼ˆDDCï¼‰ï¼ŒCPUã€å†…å­˜å’Œå­˜å‚¨è§£è€¦ï¼Œèµ„æºé—´é€šè¿‡é«˜é€Ÿç½‘ç»œè¿æ¥ æ•ˆæœ  æ¯ä¸€ç§èµ„æºéƒ½å¯ä»¥æé«˜å…¶åˆ©ç”¨ç‡ï¼Œå¯ä»¥ç‹¬ç«‹åœ°æ”¾ç¼©å…¶èµ„æºé‡ è§£å†³äº†èµ„æºé—´çš„å‘½è¿å…±äº«é—®é¢˜ï¼Œèµ„æºæ•…éšœå¯ä»¥è¢«ç‹¬ç«‹ä¿®å¤ æ•°æ®é¡µå¯ä»¥åœ¨è¿œç¨‹å†…å­˜æ± ä¸­è¢«å…±äº«ï¼Œæ‰€ä»¥è§£å†³äº†å¤‡ä»½çš„å†…å­˜å†—ä½™é—®é¢˜    äº‘åŸç”Ÿæ•°æ®åº“ å¤šæ•°çš„äº‘æ•°æ®åº“æ˜¯åŸºäºå…±äº«å­˜å‚¨çš„æ¶æ„ï¼Œå†…å­˜å’ŒCPUç»‘æˆæœ€å°çš„èµ„æºå•å…ƒï¼Œåªèƒ½æŒ‰ç…§æœ€å°èµ„æºå•å…ƒçš„ç²’åº¦æ¥å¢é•¿å’Œé‡Šæ”¾èµ„æºï¼Œè¿™ä¼šå¸¦æ¥å¾ˆå¤šçš„èµ„æºæµªè´¹ã€‚\nPolarDB Serverlessåˆ™æ˜¯éµå¾ªåˆ†æ•£æ¶æ„çš„ä¸€ä¸ªäº‘åŸç”Ÿæ•°æ®åº“\n  å¼•å…¥äº†å¤šç§Ÿæˆ·å¯æ”¾ç¼©çš„å†…å­˜æ± ï¼Œå¯ä»¥è¿›è¡Œå†…å­˜é¡µçš„åˆ†é…ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†\n  èŠ‚ç‚¹ç»„æˆï¼š\n ä¸€ä¸ª RW node(å­˜åŸæ•°æ®é¡µèŠ‚ç‚¹) å¤šä¸ª RO nodeï¼ˆå­˜åªè¯»å¤‡ä»½èŠ‚ç‚¹ï¼‰    é¢ä¸´çš„æŒ‘æˆ˜\n æ·»åŠ è¿œç¨‹å†…å­˜ä¹‹åï¼Œç³»ç»Ÿå¯ä»¥æ­£ç¡®åœ°å¤„ç†äº‹åŠ¡  å½“å†™åè¯»æ—¶ï¼Œç³»ç»Ÿä¸åº”è¯¥é”™è¿‡ä»»ä½•ä¸€ä¸ªupdateã€‚ä½¿ç”¨ç¼“å­˜å¤±æ•ˆæœºåˆ¶æ¥ä¿è¯å†™åæ‰€æœ‰åœ°èŠ‚ç‚¹ä¼šæ›´æ–° åœ¨æ›´æ–°B+æ ‘åœ°ç´¢å¼•çš„æ—¶å€™ï¼Œä½¿ç”¨global latchå…¨å±€é¡µé”æ¥ä¿è¯ROèŠ‚ç‚¹ä¸èƒ½çœ‹åˆ°ä¸ä¸€è‡´çš„ç´¢å¼•ç»“æ„ ä½¿ç”¨è¯»è§†å›¾æ¥ç¡®ä¿ROèŠ‚ç‚¹ä¸ä¼šè¯»åˆ°æœªæäº¤çš„äº‹åŠ¡   é«˜æ•ˆåœ°æ‰§è¡Œäº‹åŠ¡  å¹¿æ³›ä½¿ç”¨äº†RDMAæ“ä½œï¼Œå°¤å…¶æ˜¯one-sided RDMA verbs ä¸ºäº†æé«˜å¹¶å‘ï¼Œä½¿ç”¨äº†ä¹è§‚é” å­˜å‚¨æ–¹é¢ä½¿ç”¨äº†page materialization offloadingæŠ€æœ¯ï¼Œä½¿ç”¨redoæ—¥å¿—ç”Ÿæˆpage åˆ©ç”¨äº†é¢„å–æ¥æé«˜æœ¬åœ°å‘½ä¸­ç‡   æ„å»ºå¯ä¿¡ç³»ç»Ÿ  å¯¹ä¸åŒçš„èŠ‚ç‚¹éƒ½è®¾è®¡äº†ç­–ç•¥æ¥å¤„ç†å•ç‚¹æ•…éšœ å› ä¸ºå†…å­˜å’Œå­˜å‚¨çš„çŠ¶æ€æ˜¯è§£è€¦çš„ï¼Œæ‰€ä»¥ä¿®å¤å´©æºƒçš„é€Ÿåº¦æ¯”ç‹¬å—æ¶æ„è¦å¿«5.3å€      èƒŒæ™¯ PolarDB PolarDBæ˜¯ä¸€ä¸ªåŸºäºå…±äº«å†…å­˜æ¶æ„äº‘åŸç”Ÿæ•°æ®åº“\n PolarFSæ˜¯ä¸€ä¸ªæŒä¹…åŒ–çš„åŸå­æ“ä½œçš„å¯ä¼¸ç¼©çš„åˆ†å¸ƒå¼å…±äº«å­˜å‚¨ã€‚æ˜¯ç»Ÿä¸€çš„å­˜å‚¨èµ„æºæ± ï¼Œå…¶æä¾›è™šæ‹Ÿçš„volumeï¼Œæ¯ä¸ªvolumeåˆ’åˆ†ä¸º10GBå¤§å°çš„chunkåˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹ã€‚æ¯ä¸ªvolumeæœ€å¤š10000ä¸ªchunkï¼Œå³100Tçš„å®¹é‡ã€‚æ¯ä¸ªchunkä¸‰å‰¯æœ¬ï¼Œç”¨parallel raftæä¾›çº¿æ€§ä¸€è‡´æ€§ã€‚ RWå’ŒROèŠ‚ç‚¹ä¹‹é—´é€šè¿‡redoæ—¥å¿—æ¥åŒæ­¥å†…å­˜çŠ¶æ€ï¼Œé€šè¿‡LSNï¼ˆlog sequence numberï¼‰æ¥åè°ƒä¸€è‡´æ€§ã€‚RWå’ŒROèŠ‚ç‚¹ä¸Šæœ‰è´Ÿè´£å¤„ç†SQLè¯­å¥çš„å¤„ç†å™¨å’Œäº‹åŠ¡å¼•æ“ï¼ˆInnoDBï¼ŒX-Engineï¼‰ï¼Œä»¥åŠä¸€ä¸ªç¼“å­˜æ± æ¥æœåŠ¡æŸ¥è¯¢ä¸äº‹åŠ¡ã€‚ æœ‰å¤šä¸ªæ— çŠ¶æ€çš„ä»£ç†èŠ‚ç‚¹è´Ÿè´£é€æ˜çš„è´Ÿè½½å‡è¡¡  \rimage-20211222201006368\r\nåˆ†æ•£åŒ–çš„æ•°æ®ä¸­å¿ƒDDC   è¿æ¥æŠ€æœ¯\n  åœ¨åˆ†æ•£åŒ–çš„æ•°æ®ä¸­å¿ƒï¼Œè®¡ç®—èŠ‚ç‚¹ã€å†…å­˜ç»“ç‚¹ä»¥åŠå­˜å‚¨èŠ‚ç‚¹éƒ½æ˜¯ç”±é«˜é€Ÿç½‘ç»œè¿æ¥ã€‚\n  RDMAï¼ˆRemote Direct Memory Accessï¼‰æŠ€æœ¯ç»™å¤§å‹çš„DDCå¸¦æ¥äº†å¯èƒ½\n    å±‚çº§ç»“æ„\n åˆ†ä¸ºä¸‰å±‚ï¼šspine layerã€leaf layerã€ToR layer æ¯ä¸€ä¸ªToRèŠ‚ç‚¹é“¾æ¥48å°ä¸»æœºï¼ŒToRçš„äº¤æ¢æœºåˆ†åˆ«è¿æ¥LeafèŠ‚ç‚¹çš„äº¤æ¢æœºï¼Œç„¶åLeafçš„äº¤æ¢æœºåˆå»é“¾æ¥Spineå±‚çš„äº¤æ¢æœºã€‚ æ¯å°ä¸»æœºéƒ½ä¼šé…æœ‰åŒç«¯å£çš„RDMAç½‘å¡ï¼Œç”¨äºé“¾æ¥ä¸¤ä¸ªToRèŠ‚ç‚¹æ¥é¿å…å•ç‚¹æ•…éšœã€‚ ä¸€ä¸ªleaf äº¤æ¢æœºç»„åŒ…å«äº’ä¸ºå¤‡ä»½çš„åŒæ—¶å·¥ä½œçš„å¤šä¸ªleafäº¤æ¢æœº ç”±ä¸€ä¸ªleafäº¤æ¢æœºç»„ç®¡ç†æ§åˆ¶çš„æ‰€æœ‰çš„äº¤æ¢æœºä¸æœåŠ¡å™¨ç§°ä¸ºä¸€ä¸ªPoDï¼ˆPoint of Deliveryï¼‰ã€‚ä¸€ä¸ªPoDæœ€å¤šæœ‰32ä¸ªleafäº¤æ¢æœºã€‚    èµ„æºéƒ¨ç½²æ–¹å¼\n å•ä¸ªæ•°æ®åº“å®ä¾‹æ‰€éœ€çš„å†…å­˜å’Œå­˜å‚¨ä¼šéƒ¨ç½²åœ¨ä¸€ä¸ªPoDä¸‹ ä¸åŒå®ä¾‹éƒ¨ç½²åœ¨ä¸åŒçš„PoDä¸‹ è®¡ç®—å’Œå†…å­˜èµ„æºæ€»æ˜¯å€¾å‘äºéƒ¨ç½²åœ¨åŒä¸€ä¸ªToRä¸‹ï¼Œä»¥è·å¾—æ›´ä½çš„å»¶è¿Ÿä¸æ›´å°‘çš„é¡µæŠ–åŠ¨    \rimage-20211222201043429\r\næ— æœåŠ¡æ•°æ®åº“ æ— æœåŠ¡æ•°æ®åº“æ˜¯äº‘åŸç”Ÿæ•°æ®åº“çš„é«˜å¼¹æ€§å˜ç§ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å®ç°èµ„æºçš„æŒ‰éœ€åˆ†é…\n è‡ªåŠ¨æ‰©ç¼© auto-scaling  ç°å­˜çš„æ— æœåŠ¡æ•°æ®åº“çš„æ‰©ç¼©å®¹å› ä¸ºæ˜¯åŸºäºå…±äº«å­˜å‚¨çš„æ¶æ„ï¼Œæ‰€ä»¥æ‰©ç¼©å®¹å—åˆ°é™åˆ¶ã€‚ç”±äºå†…å­˜å’ŒCPUèµ„æºæ€»æ˜¯æ·±åº¦ç»‘å®šåœ¨ä¸€ä¸ªèµ„æºå•ä½ä¸Šï¼Œæ‰©ç¼©å®¹ä¹Ÿåªèƒ½æŒ‰ç…§èµ„æºå•ä½ä½œä¸ºè°ƒåŠ¨ç²’åº¦ã€‚æ‰€ä»¥CPUå’Œå†…å­˜èµ„æºæ€»æ˜¯ä¸èƒ½å¾—åˆ°å……åˆ†åˆ©ç”¨ã€‚ åˆ†ææ€§æ•°æ®åº“å¯¹å†…å­˜çš„è¦æ±‚æ¯”è¾ƒé«˜ï¼Œåªéœ€è¦å°‘é‡çš„CPUèµ„æºæ¥å®šæœŸåŒæ­¥æ›´æ–°æ•°æ® äº‹åŠ¡æ€§æ•°æ®åº“å°‘é‡çš„å†…å­˜å°±å¯ä»¥ä¿è¯ç¼“å­˜å‘½ä¸­ç‡ï¼Œä½†éœ€è¦æ›´å¤šçš„CPUèµ„æºæ¥åº”å¯¹è®¿é—®çš„é«˜å³°æ—¶åˆ»   è‡ªåŠ¨æš‚åœ auto-pause  ç°å­˜çš„æ— æœåŠ¡æ•°æ®åº“çš„è‡ªåŠ¨æš‚åœä¹Ÿæ˜¯å—é™çš„ï¼ŒCPUå’Œå†…å­˜èµ„æºå¿…é¡»è¢«åŒæ—¶é‡Šæ”¾ åœ¨åˆ†æ•£å¼æ¶æ„ä¸‹ï¼ŒCPUå’Œå†…å­˜ä¸å†å…±äº«å‘½è¿ã€‚ä¸šåŠ¡ä½å³°æœŸï¼Œå†…å­˜å¯ä»¥ä¸å¿…é‡Šæ”¾ï¼Œé¿å…äº†é‡æ–°åŠ è½½ã€‚   æ‰©å®¹é€æ˜æ€§ scaling transparency  é€æ˜æ€§å³åœ¨æ‰©ç¼©å®¹çš„æ—¶å€™éœ€è¦ä¿è¯å®¢æˆ·çš„åœºæ™¯ä¸èƒ½ä¸­æ–­æˆ–è€…æ€§èƒ½å‡ºç°ä¸¥é‡å½±å“ åˆ†æ•£å¼æ¶æ„ä¸‹ï¼Œä¸­é—´ä¸´æ—¶çŠ¶æ€å¦‚è„é¡µã€äº‹åŠ¡çŠ¶æ€å¦‚ç‰ˆæœ¬ä¿¡æ¯timestampã€é€»è¾‘é”ã€queryä¸­é—´ç»“æœéƒ½å¯ä»¥ä¿å­˜åœ¨å…±äº«å†…å­˜å±‚ï¼Œç»™å®ç°æ‰©ç¼©å®¹çš„é€æ˜æ€§æä¾›äº†æ›´å¥½çš„æ¡ä»¶ã€‚ PolarDB Serverless ç›®å‰å°†è„é¡µå­˜åœ¨å…±äº«å†…å­˜é‡Œï¼Œå…¶ä»–çš„ä¸´æ—¶çŠ¶æ€æœŸå¾…åç»­çš„å·¥ä½œã€‚    è®¾è®¡ PolarDB Serverless åŸºäºPolarDBå¼€å‘çš„åˆ†æ•£å¼æ¶æ„çš„äº‘åŸç”Ÿæ•°æ®åº“ã€‚\n ç»„æˆï¼šå¤šä¸ªä»£ç†èŠ‚ç‚¹ï¼Œä¸€ä¸ªRWèŠ‚ç‚¹ï¼Œå¤šä¸ªROèŠ‚ç‚¹ ä½¿ç”¨PolarFSæ¥åšå…±äº«å­˜å‚¨ å’ŒPolarDBçš„æœ€å¤§ä¸åŒåœ¨äºä½¿ç”¨äº†è¿œç¨‹å†…å­˜æ± ï¼ˆå…±äº«å†…å­˜ï¼‰  ä½¿ç”¨å…±äº«å†…å­˜\n å¥½å¤„  RWå’ŒROå…±ç”¨æ•°æ®é¡µï¼Œçœå»äº†æ¯ä¸ªèŠ‚ç‚¹è‡ªå·±ä¿å­˜å‰¯æœ¬ï¼Œæé«˜äº†å†…å­˜çš„ä½¿ç”¨æ•ˆç‡   åå¤„ï¼ˆperformance penaltyï¼‰  è¿œç¨‹å†…å­˜çš„è®¿é—®é€Ÿåº¦è¿œè¿œä½äºæœ¬åœ°å†…å­˜ï¼›è§£å†³æ–¹æ¡ˆï¼šåˆ†å±‚å†…å­˜ç³»ç»Ÿå’Œé¢„å–æŠ€æœ¯ ç§æœ‰æ•°æ®æ”¾åœ¨å…¬å…±èµ„æºä¸Šï¼Œéœ€è¦æœ‰è·¨èŠ‚ç‚¹çš„äº’æ–¥ä¿æŠ¤ï¼›è§£å†³æ–¹æ¡ˆï¼šå¹¿æ³›ä½¿ç”¨å•è¾¹çš„RDMAè°“è¯å’Œä¹è§‚åè®®æ¥é¿å…ä½¿ç”¨å…¨å±€é”ï¼ˆglobal latchï¼‰ é¡µçš„ä¼ è¾“å’Œç½‘ç»œå¸¦æ¥äº†è´Ÿæ‹…ã€‚è§£å†³æ–¹æ¡ˆï¼šå…ˆå°†redo logå†™åˆ°å­˜å‚¨å±‚ï¼Œå†å¼‚æ­¥åœ°é€šè¿‡æ—¥å¿—å°†é¡µç‰©è´¨åŒ–    åˆ†æ•£åŒ–å†…å­˜ è¿œç¨‹å†…å­˜è®¿é—®æ¥å£  page_register: é¡µçš„å¼•ç”¨è®¡æ•°å¢ä¸€ page_unregister: é¡µçš„å¼•ç”¨è®¡æ•°å‡ä¸€ page_read: ä½¿ç”¨å•è¾¹RDMAè°“è¯å°†é¡µä»è¿œç¨‹å†…å­˜è¯»å–åˆ°æœ¬åœ° page_write: ä½¿ç”¨å•è¾¹RDMAè°“è¯å°†é¡µä»æœ¬åœ°å†™åˆ°è¿œç¨‹å†…å­˜ page_invalidation: ä½¿æ‰€æœ‰ROèŠ‚ç‚¹çš„æœ¬åœ°çš„å†…å­˜å‰¯æœ¬å¤±æ•ˆ  è¿œç¨‹å†…å­˜ç®¡ç† å†…å­˜çš„åˆ†é…å•å…ƒæ˜¯ä¸€ä¸ªslabï¼Œä¸€ä¸ªslabçš„å¤§å°æ˜¯1GB\nå‡ ç§æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š\n Page Arrayï¼ˆPAï¼‰  æ¯ä¸€ä¸ªslabç”±é¡µæ•°ç»„ç»„æˆï¼Œé¡µæ•°ç»„æ˜¯ç‰©ç†åœ°å€è¿ç»­çš„ç”±16KBçš„é¡µç»„æˆçš„æ•°ç»„ã€‚ PAçš„åœ°å€ä¼šæ³¨å†Œåˆ°RDMAçš„ç½‘å¡ä¸Šï¼Œæ‰€ä»¥å¯ä»¥è¢«RDMAè¿œç¨‹è®¿é—® è´Ÿè´£æä¾›slabè®¿é—®çš„èŠ‚ç‚¹ä¹Ÿå«slab nodeï¼Œç¬¬ä¸€ä¸ªslab node ä¹Ÿå«home node   Page Address Tableï¼ˆPATï¼‰  ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå­˜å‚¨æ¯ä¸€é¡µçš„ä½ç½®ï¼ˆslab id ä¸ç‰©ç†åœ°å€ï¼‰   Page Invalidation Bitmap (PIB)  ä¸€ä¸ªä½å›¾ï¼Œå¯¹åº”PATçš„æ¯ä¸€é¡¹è®°å½•invalidation bitï¼Œ0è¡¨ç¤ºå†…å­˜ä¸­çš„æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œ1è¡¨ç¤ºä¸æ˜¯æœ€æ–°ç‰ˆæœ¬   Page Reference Directory(PRD)  ä¸€ä¸ªmapï¼Œå¯¹åº”äºæ¯ä¸ªPATé¡¹ï¼Œè®°å½•å¼•ç”¨äº†è¿™ä¸ªé¡µçš„èŠ‚ç‚¹   Page Latch Table(PLT)  å¯¹äºPATä¸­çš„æ¯ä¸€é¡¹ï¼Œç®¡ç†å…¶é¡µé”ï¼ˆpage latchï¼‰ã€‚ æ˜¯ä¸€ä¸ªå…¨å±€çš„ç‰©ç†é”ï¼Œç”¨äºå¤šä¸ªæ•°æ®åº“èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œä¿æŠ¤ä¸åŒæ­¥è¯»å†™ å°¤å…¶ç”¨äºä¿æŠ¤B+æ ‘çš„ç»“æ„ä¸€è‡´æ€§    pageåˆ†é…è¿‡ç¨‹ï¼š\n æ•°æ®åº“å‘home node å‘é€page registerè¯·æ±‚ å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™éå†slabæ‰¾åˆ°æœ‰ç©ºé—²çš„slabï¼Œå¦‚æœéƒ½æ²¡æœ‰ç©ºé—²åˆ™ä½¿ç”¨LRUç®—æ³•æ·˜æ±°æ‰ä¸€äº›page å†™å…¥åï¼Œå°†pageçš„ä¸ºä½ç½®ä¿¡æ¯å†™å…¥åˆ°PATï¼Œè¿”å›pageçš„è¿œç¨‹åœ°å€å’Œpage latch  æ‰©ç¼©å®¹ï¼š\n æ‰©å®¹ï¼šhome node è¯·æ±‚DBaaSåˆ†é…æ–°çš„slabï¼Œæ‰©å±•buffer poolï¼ŒPATï¼ŒPIBå’ŒPRD ç¼©å®¹ï¼špageé€šè¿‡LRUè¿›è¡Œæ·˜æ±°ï¼Œæ— ç”¨çš„slabå°†è¢«å›æ”¶  æœ¬åœ°ç¼“å­˜  ä»¥pageä¸ºå•ä½å°†è¿œç¨‹å†…å­˜ç¼“å­˜åˆ°æœ¬åœ° å¦‚æœpageä¸åœ¨è¿œç¨‹å†…å­˜ä¸Šï¼Œè¿›ç¨‹ä¼šä»Polar FSè¯»å–å†…å®¹åˆ°æœ¬åœ°ç¼“å­˜ï¼Œç„¶åå†å†™å›åˆ°è¿œç¨‹å†…å­˜ã€‚ï¼ˆå­˜å‚¨å’Œå†…å­˜ä¸å‘ç”Ÿç›´æ¥æ¥è§¦ï¼‰ ä¸æ˜¯æ‰€æœ‰çš„pageéƒ½è¦å†™å…¥è¿œç¨‹å†…å­˜ï¼Œä¾‹å¦‚å…¨è¡¨æ‰«æï¼Œè¿™äº›pageä¸å¤ªä¼šå†æ¬¡è®¿é—® æœ¬åœ°å‘ç”Ÿmissï¼Œè¿›ç¨‹è¦ç­‰å¾…è¯»å–è¿œç¨‹å†…å­˜ï¼ˆå¯ä»¥åˆ©ç”¨é¢„å–æŠ€æœ¯ï¼‰ æœ¬åœ°çš„ç¼“å­˜å†™æ»¡åä½¿ç”¨LRUç®—æ³•è¿›è¡Œæ·˜æ±°ã€‚å¦‚æœpageæ²¡æœ‰ä¿®æ”¹è¿‡å¯ä»¥ç›´æ¥é‡Šæ”¾ã€‚å¦‚æœpageä¿®æ”¹è¿‡ï¼Œé‚£å°±å†™å›åå†é‡Šæ”¾ã€‚å¼•ç”¨è®¡æ•°å‡ä¸€ã€‚  ç¼“å­˜ä¸€è‡´æ€§  ROèŠ‚ç‚¹ä¸èƒ½ç›´æ¥è®¿é—®RWèŠ‚ç‚¹çš„æœ¬åœ°ç¼“å­˜ï¼Œåªèƒ½é€šè¿‡è·å–æœ€æ–°çš„redo logæ¥åœ¨æœ¬åœ°ç‰©è´¨åŒ–pageæ¥è·å–æœ€æ–°çš„æ•°æ®ã€‚ å¦‚æœRWèŠ‚ç‚¹å°†ä¿®æ”¹è¿‡çš„æ•°æ®å†™å›è¿œç¨‹å†…å­˜åï¼ŒROèŠ‚ç‚¹è‡ªç„¶æ˜¯ä¸éœ€è¦è¯»å–redo logï¼Œå¯æ˜¯ç³»ç»Ÿå¦‚æœæ¯æ¬¡ä¿®æ”¹éƒ½è¦ç«‹åˆ»å†™å›ï¼Œç½‘ç»œå¼€é”€ä¼šå¾ˆå¤§ã€‚æ‰€ä»¥RWèŠ‚ç‚¹ä¸ä¼šç«‹åˆ»å†™å›ï¼Œè€Œæ˜¯ä½¿ç”¨äº†é¡µå¤±æ•ˆçš„æ–¹æ³•ã€‚  \rimage-20211225120332727\r\n å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š  RWä¿®æ”¹pageåï¼Œè°ƒç”¨page_invalidation å‘é€è¯·æ±‚åˆ°home node PIBä¸­å¯¹åº”é¡µé¡¹è®¾ç½®ä¸º1 æŸ¥è¯¢PRDï¼ŒæŸ¥çœ‹pageåœ¨å“ªäº›ROèŠ‚ç‚¹ä¸Šå­˜åœ¨ å‘æ‰€æœ‰çš„å­˜åœ¨è¿™ä¸ªpageçš„ROå‘é€è¯·æ±‚ï¼Œå°†PIBè®¾ç½®ä¸º1 è®¾ç½®PIBè¿‡æœŸæ˜¯ä¸€ä¸ªåŒæ­¥é˜»å¡æ“ä½œ åªæœ‰å…¨éƒ¨çš„ROèŠ‚ç‚¹è®¾ç½®æˆåŠŸæ‰è¿”å›æˆåŠŸ å¦‚æœæœ‰ä¸ªROèŠ‚ç‚¹è¶…æ—¶ï¼Œé‚£ä¹ˆå°±æŠŠä»–è¸¢å‡ºé›†ç¾¤æ¥ä¿è¯è¯¥æ“ä½œæˆåŠŸ   åœ¨å†™å›åˆ°Polar FSï¼ˆè¿œç¨‹å­˜å‚¨ï¼‰çš„æ—¶å€™ï¼ŒåŒæ ·ä¼šä½¿ç”¨page_invalidæ¥ä¿è¯è¿œç¨‹å†…å­˜ä¸­ä¸ä¼šå­˜åœ¨æ¯”è¿œç¨‹å­˜å‚¨ä¸­æ›´è€ç‰ˆæœ¬çš„æ•°æ®ã€‚  B+æ ‘ç»“æ„ä¸€è‡´æ€§   ç‰©ç†ä¸€è‡´æ€§\né—®é¢˜æ˜¯ï¼šå¤šçº¿ç¨‹è®¿é—®B+æ ‘çš„Indexçš„æ—¶å€™å¦‚ä½•åšåˆ°å¹¶å‘æ§åˆ¶\nè§£å†³æ–¹æ¡ˆï¼š\n  åªæœ‰RWèŠ‚ç‚¹å¯ä»¥ä¿®æ”¹pageï¼Œæ‰€ä»¥ä¸éœ€è¦ç®¡ç†å¤šèŠ‚ç‚¹çš„å†™å†²çªã€‚ä½†æ˜¯SMOï¼ˆç»“æ„ä¿®æ”¹æ“ä½œï¼‰ä¼šåŒæ—¶ä¿®æ”¹å¤šä¸ªpageï¼Œå…¶ä»–èŠ‚ç‚¹åœ¨éå†B+æ ‘çš„æ—¶å€™ï¼Œä¸åŒçš„ROèŠ‚ç‚¹å¯èƒ½çœ‹åˆ°ä¸ä¸€è‡´çš„ç‰©ç†B+æ ‘ç»“æ„ã€‚\n æˆ‘ä»¬ä½¿ç”¨å…¨å±€é¡µé”æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨å…±äº«é”ï¼ˆSï¼‰å’Œæ’ä»–é”ï¼ˆXï¼‰ã€‚ åŒºåˆ«äºæœ¬åœ°é¡µé”ï¼Œå…¨å±€é¡µé”ç”¨äºä¿è¯å¤šèŠ‚ç‚¹ä¸‹çš„B+æ ‘ç´¢å¼•ç»“æ„ä¸€è‡´æ€§ã€‚ä½¿ç”¨crabbhing/lock couplingç®—æ³•å®ç° æ‰€æœ‰å‚ä¸SMOçš„èŠ‚ç‚¹ä¼šåŠ ä¸ŠXé”ï¼Œç›´åˆ°SMOç»“æŸã€‚ROèŠ‚ç‚¹è¯»å–çš„æ—¶å€™è¦æ£€æŸ¥PLTï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰Xé”ï¼Œå¹¶ä¸”å‘è¢«è¯»çš„é¡µä¸ŠåŠ Sé”ã€‚    å¯¹äºRWèŠ‚ç‚¹è¦è¿›è¡Œçš„insertå’Œdeleteæ“ä½œï¼Œæˆ‘ä»¬é‡‡å–ä¸¤é˜¶æ®µåšæ³•\n é‡‡ç”¨ä¹è§‚å¹¶å‘æ§åˆ¶ï¼Œå‡è®¾æ²¡æœ‰SMOæ“ä½œï¼Œé‚£å°±åªéœ€è¦æœ¬åœ°çš„é”æ¥ä½œå•èŠ‚ç‚¹å¹¶å‘æ§åˆ¶ã€‚å¦‚æœç¡®å®ä¸éœ€è¦è¿›è¡ŒSMOï¼Œé‚£å°±é¡ºåˆ©æ’å…¥æˆ–è€…åˆ é™¤ã€‚ å¦‚æœå‘ç°B+æ ‘çš„å¶å­èŠ‚ç‚¹ç›¸å¯¹ç©ºæˆ–è€…ç›¸å¯¹æ»¡ï¼Œå³å¾ˆæœ‰å¯èƒ½è¦å‘ç”ŸSMOæ“ä½œï¼Œå°±å¯ç”¨æ‚²è§‚ç­–ç•¥ï¼Œè¿™æ—¶å€™ä¼šå¯¹æ‰€æœ‰å¯èƒ½å‚ä¸SMOçš„pageåŠ ä¸ŠXé”ï¼Œç›´åˆ°SMOç»“æŸé‡Šæ”¾é”ã€‚è¿™æ ·é”çš„æ’åºå¯ä»¥ä¿è¯ROèŠ‚ç‚¹åªèƒ½çœ‹åˆ°SMOä¹‹å‰æˆ–è€…ä¹‹åçš„æ ‘ç»“æ„ï¼Œè€Œä¸ä¼šæ˜¯SMOçš„ä¸­é—´çŠ¶æ€ã€‚      é€»è¾‘ä¸€è‡´æ€§\n ç›¸åŒçš„æ•°æ®å¯èƒ½ä¼šæœ‰å¤šä¸ªäº‹åŠ¡è¿›è¡Œå¹¶å‘å¤„ç†ï¼Œå¦‚ä½•ä¿è¯æ»¡è¶³ä¸åŒçš„å¿«ç…§éš”ç¦»çº§åˆ«ã€‚    å¿«ç…§éš”ç¦» PolarDB Serverless æä¾›åŸºäºMVCCçš„å¿«ç…§éš”ç¦»ã€‚äº‹åŠ¡çš„å®ç°æœºåˆ¶ï¼Œæ˜¯ç”±å¿«ç…§çš„æ—¶é—´æˆ³æ¥æ§åˆ¶äº‹åŠ¡èƒ½çœ‹åˆ°æ•°æ®çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚RWèŠ‚ç‚¹ä¼šç»´æŠ¤ä¸€ä¸ªä¸­å¿ƒåŒ–çš„çš„æ—¶é—´æˆ³å«CTSï¼Œæ¥ä¸ºæ‰€æœ‰æ•°æ®åº“èŠ‚ç‚¹åˆ†é…å…¨å±€å•è°ƒé€’å¢çš„æ—¶é—´æˆ³ã€‚\nä¸€æ¬¡è¯»å†™äº‹åŠ¡éœ€è¦è·å–ä¸¤æ¬¡æ—¶é—´æˆ³ï¼ˆcts_readå’Œcts_commitï¼‰ï¼›æäº¤äº‹åŠ¡çš„æ—¶å€™æ‰€æœ‰è®°å½•å’Œundo logä¸­çš„è®°å½•éƒ½éœ€è¦é¢å¤–ç»´æŠ¤ä¸€ä¸ªåˆ—æ¥ä¿å­˜cts_commit;ä¸€ä¸ªè¯»å†™äº‹åŠ¡å†…çš„readæ€»ä¼šè¿”å›ä¸€ä¸ªcts_commitæ¯”cts_readè¦å°çš„è®°å½•;æ¯ä¸ªè®°å½•éƒ½ä¼šæœ‰ä¸€ä¸ªäº‹åŠ¡idå­—æ®µæ¥è®°å½•ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡ã€‚\nä¸€ä¸ªåªè¯»äº‹åŠ¡åˆ™åªéœ€è¦åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™è·å–cts_readæ—¶é—´æˆ³å³å¯ã€‚\nä½†æ˜¯å¯¹äºä¸€äº›æ¯”è¾ƒheavyçš„äº‹åŠ¡ï¼Œæ— æ³•è¿…é€Ÿå¯¹æ‰€æœ‰è®°å½•æ›´æ–°cts_commitï¼Œå› ä¸ºè¿™ä¼šåœ¨æäº¤äº‹åŠ¡çš„æ—¶å€™å¸¦æ¥å¤§é‡çš„éšæœºå†™ã€‚å› æ­¤è¿™ä¸ªcts_commitçš„æ›´æ–°æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚è¿™å°±å¯¼è‡´äº†åœ¨å¹¶å‘äº‹åŠ¡å¤„ç†çš„æ—¶å€™ï¼Œæ— æ³•å¾—çŸ¥è¯¥è®°å½•çš„cts_commitæ˜¯å¦å·²ç»è¢«å†™æˆ–è€…æ˜¯å¦è¦è¢«å†™ï¼Œå³æ— æ³•å¾—çŸ¥å…ˆå‰çš„äº‹åŠ¡æ˜¯å¦å·²ç»å®Œæˆæˆ–è€…è¯¥è®°å½•æ˜¯å¦ä¸å…ˆå‰äº‹åŠ¡æœ‰å…³ã€‚\nè§£å†³æ–¹æ¡ˆï¼šé€šè¿‡æŸ¥è¯¢RWä¸Šçš„CTS Logæ•°æ®ç»“æ„ï¼Œå…¶æ˜¯ä¸€ä¸ªç¯å½¢æ•°ç»„ï¼šè®°å½•ç€æœ€è¿‘è‹¥å¹²ä¸ªçš„è¯»å†™äº‹åŠ¡çš„æäº¤æ—¶é—´æˆ³(cts_commit)ã€‚å¦‚æœå…ˆå‰äº‹åŠ¡æ²¡æœ‰å®Œæˆï¼Œè¿™ä¸ªæ•°ç»„ä¸Šçš„commit timestampå°±ä¼šä¸ºnullï¼Œæ¯å½“ä¸€ä¸ªèŠ‚ç‚¹è¯»å–åˆ°ä¸€ä¸ªcts_commitä¸ºç©ºçš„è®°å½•ï¼Œå°±å¯ä»¥å»æŸ¥è¯¢è¿™ä¸ªå…¨å±€çš„ç¯å½¢æ•°ç»„æ¥å¾—çŸ¥è¿™ä¸ªè®°å½•å¯¹åº”çš„äº‹åŠ¡æ˜¯å¦å·²ç»æäº¤äº†ã€‚\nåŒæ ·è¦å»å…¨å±€æŸ¥è¿™ä¸ªæ—¶é—´æˆ³è¦å¯¹åº”ä¸€æ¬¡network requestï¼Œæœ¬ç³»ç»Ÿè¿˜æ˜¯é‡‡ç”¨RDMA æ¥åŠ é€Ÿç¯å½¢æ•°ç»„çš„è®¿é—®è·å–æ—¶é—´æˆ³çš„è¿‡ç¨‹ï¼ŒRDMA CASæŠ€æœ¯èƒ½å¤ŸåŸå­é€’å¢è·å–æ—¶é—´æˆ³ï¼Œå¹¶ä¸”è¿™ä¸ªæ•°ç»„çš„åœ°å€ä¹Ÿä¼šè¢«æ³¨å†Œåˆ°RDMA çš„ç½‘å¡ä¸Šã€‚å’Œç”¨RPCç›¸æ¯”ï¼Œç›´æ¥èµ°ç½‘å¡ä¸éœ€è¦å ç”¨RWèŠ‚ç‚¹çš„CPUèµ„æºã€‚\nPage Materialization Offloading ä¼ ç»Ÿçš„DBä¼šå‘¨æœŸæ€§çš„å°†è„é¡µå†™å…¥åˆ°æŒä¹…æ€§çš„å­˜å‚¨ä¸­ã€‚Auroraæå‡ºäº†æ—¥å¿—å³æ•°æ®åº“çš„æ¦‚å¿µï¼Œé€šè¿‡ä½¿ç”¨redo logæ¥ç‰©è´¨åŒ–é¡µæ•°æ®æ¥è·å–æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®ã€‚Socratesåœ¨æ­¤åŸºç¡€ä¸Šï¼Œåˆ™åšåˆ°äº†å°†logä¸æ•°æ®åˆ†ç¦»å­˜å‚¨ã€‚\nPolarrDB Serverlesså’ŒSocratesç±»ä¼¼ï¼Œå°†logså’Œpagesåˆ†å¼€å­˜å‚¨åœ¨ä¸åŒçš„chunksä¸­ã€‚\n redo logså…ˆå­˜å‚¨åœ¨logs chunksä¸­ å¼‚æ­¥å‘é€åˆ°page chunks ä¸ºäº†PolarFSç»„ä»¶çš„é‡ç”¨å’Œæœ€å°åŒ–æ›´æ”¹ï¼Œlogsä»…ä»…é€åˆ°leader nodeã€‚ ç„¶åleader node é‡åšå¹¶ä½¿ç”¨ParallelRaftä¿è¯å‰¯æœ¬çš„ä¸€è‡´æ€§  è‡ªåŠ¨æ‰©ç¼© åœ¨ç‰ˆæœ¬çš„å‡çº§å’Œé‡å¯è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·å¯¹ServerlessæœåŠ¡æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œæ–­å¼€è¿æ¥ï¼Œäº‹åŠ¡ä¸­æ–­ï¼Œè¯·æ±‚è¶…æ—¶æ˜¯ä¸å…è®¸çš„ã€‚\næ‰€ä»¥åœ¨æœ¬ç³»ç»Ÿä¸­ï¼Œå½“å‘ç”Ÿç‰ˆæœ¬å‡çº§å’Œè·¨èŠ‚ç‚¹è¿ç§»çš„æ—¶å€™ï¼Œä»£ç†èŠ‚ç‚¹è´Ÿè´£ä¿æŒå®¢æˆ·ç«¯è¿æ¥ï¼Œå‘é€è¯·æ±‚åä¼šç­‰å¾…æ—§çš„RWèŠ‚ç‚¹å¤„ç†æ‰æ­£åœ¨è¿›è¡Œçš„äº‹åŠ¡ã€‚ä¹‹åæŠŠå°±èŠ‚ç‚¹çš„è„é¡µflushåˆ°å…±äº«çš„å†…å­˜æ± ä¸­ï¼Œå†å…³é—­å°±RWèŠ‚ç‚¹ã€‚æ–°çš„RWèŠ‚ç‚¹è¿æ¥å†…å­˜æ± ï¼Œé¢„çƒ­ç¼“å­˜ï¼Œé‡åšundo logæ¥æ„å»ºäº‹åŠ¡çš„åˆ—è¡¨ã€‚ä¹‹åä»£ç†èŠ‚ç‚¹å°†è¿æ¥è¿˜ç»™æ–°çš„RWèŠ‚ç‚¹ã€‚\næ€§èƒ½ä¼˜åŒ– ä½¿ç”¨åˆ†æ•£å¼æ¶æ„ä¼šå¸¦æ¥æ€§èƒ½çš„æŸå¤±ï¼Œæ‰€ä»¥è¦ä½¿ç”¨ä¸€äº›æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µæ¥è¿›è¡Œä¼˜åŒ–ã€‚\nä¹è§‚é” ä½¿ç”¨ä¹è§‚é”å¯ä»¥å°½å¯èƒ½é¿å…å¹¶å‘æ“ä½œå¯¹å…¨å±€é”çš„è·å–ï¼Œè¿›è€Œæé«˜å¹¶è¡Œæ•ˆç‡ã€‚\nRWèŠ‚ç‚¹ä¼šç»´æŠ¤ä¸€ä¸ªSMO counterï¼Œæ¯æ¬¡å‘ç”ŸSMOçš„æ—¶å€™counter++ï¼›å¹¶ä¸”æ‰€æœ‰è¢«ä¿®æ”¹çš„Pageä¹Ÿä¼šç»´æŠ¤è¿™ä¸ªæ›´æ–°åçš„counterï¼ˆSMO RWï¼‰\næ¯æ¬¡queryæ‰§è¡Œçš„æ—¶å€™å»æ‹¿è¿™ä¸ªSMO counterï¼ˆSMO queryï¼‰ï¼Œä¸€æ—¦ROä¸Šçš„queryå‘ç°æŸä¸ªPageçš„SMO counteræ¯”SMO queryè¿˜è¦å¤§ï¼Œè¯´æ˜åœ¨queryæ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†SMOã€‚è¿™ä¸ªæ—¶å€™å°±è¦å›æ»šåˆ°æ‚²è§‚å¹¶å‘æ§åˆ¶ï¼Œå³è·å–å…¨å±€PLæ¥é”ä½æ•´ä¸ªB+ Treeçš„SMOæ›´æ–°ã€‚\né¢„å– åœ¨PolarDB Serverlessä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†æ‰¹å¤„ç†å¯†é’¥é¢„å¤„ç†(BKP)ã€‚BKPä»åˆ†è§£çš„å†…å­˜å’Œå­˜å‚¨ä¸­é¢„å–åŒ…å«æœ‰è¶£çš„å…ƒç»„çš„é¡µé¢ï¼Œä»¥éšè—è¿œç¨‹I/Oå»¶è¿Ÿã€‚BKPçš„æ¥å£æ¥å—ä¸€ç»„è¦é¢„å–çš„å¯†é’¥ã€‚å½“è°ƒç”¨è¯¥æ¥å£æ—¶ï¼Œå¼•æ“å°†å¯åŠ¨ä¸€ä¸ªåå°é¢„å–ä»»åŠ¡ï¼Œä»ç›®æ ‡ç´¢å¼•ä¸­æ£€ç´¢æ‰€éœ€çš„å¯†é’¥ï¼Œå¹¶åœ¨å¿…è¦æ—¶ä»è¿œç¨‹å†…å­˜/å­˜å‚¨ä¸­è·å–ç›¸åº”çš„æ•°æ®é¡µã€‚BKPè¿˜å¯ä»¥ä¼˜åŒ–åˆ†æå·¥ä½œè´Ÿè½½ã€‚\nå®¹é”™ä¸æ¢å¤ç­–ç•¥ æ•°æ®åº“èŠ‚ç‚¹æ¢å¤ æœ¬ç³»ç»Ÿé‡‡ç”¨çš„æ˜¯ARIESçš„æ¢å¤ç®—æ³•ï¼ˆAlgorithm for Recovery and Isolation Exploiting Semantics. ï¼‰\n ROèŠ‚ç‚¹çš„æ¢å¤ï¼šç”±äºé¡µæ•°æ®å†è¿œç¨‹å†…å­˜ä¸Šï¼Œæ‰€ä»¥å¯ä»¥è½»æ¾åœ°ä½¿ç”¨æ–°çš„ROèŠ‚ç‚¹ä»£æ›¿æ—§çš„ROèŠ‚ç‚¹ RWèŠ‚ç‚¹çš„æ¢å¤  æ— é¢„æœŸçš„èŠ‚ç‚¹æ•…éšœ  RWèŠ‚ç‚¹æŒ‚æ‰ä¹‹åï¼Œé›†ç¾¤çš„managerï¼ˆCMï¼‰ä¼šé€šè¿‡å¿ƒè·³ä¿¡å·æ¢æµ‹åˆ°ï¼Œç„¶åROèŠ‚ç‚¹å°±å¯ä»¥æ™‹å‡ä¸ºRWèŠ‚ç‚¹ã€‚   æœ‰é¢„æœŸçš„èŠ‚ç‚¹æ•…éšœ  ä¾‹å¦‚ç‰ˆæœ¬å‡çº§ï¼Œå‰æ–‡å·²ç»è®²è¿‡ï¼Œä¸å†èµ˜è¿°ã€‚      å†…å­˜ç»“ç‚¹æ¢å¤ å†…å­˜èŠ‚ç‚¹çš„æ•°æ®ç¼“å­˜Pageï¼Œåœ¨æŠŠdirty pageå†™åˆ°å†…å­˜èŠ‚ç‚¹å‰ï¼Œå¯¹åº”çš„redo logå·²ç»flushåˆ°å­˜å‚¨å±‚äº†ï¼Œå› æ­¤å†…å­˜èŠ‚ç‚¹é‡å¯å¯ä»¥ç”¨PolarFSä¸Šçš„redologæ¥è¿›è¡Œæ¢å¤æ•°æ®ã€‚\nhome nodeä¸Šå› ä¸ºåŒ…å«é‡è¦çš„metadataå¦‚PATï¼ŒPIBï¼ŒPRDå’ŒPLTï¼›è¿™äº›æ•°æ®ä¼šåŒæ­¥å¤‡ä»½åœ¨ä»å‰¯æœ¬ï¼›home nodeè´Ÿè´£æ£€æµ‹slab nodeä¸Šçš„æ•…éšœï¼Œç„¶åhome nodeæ ¹æ®PATä¸Šçš„ä¿¡æ¯æ¥é‡å»ºé‡å¯çš„slab nodeå³å¯ã€‚\né›†ç¾¤æ¢å¤ åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œå½“ä¸»èŠ‚ç‚¹çš„æ‰€æœ‰å‰¯æœ¬éƒ½ä¸å¯ç”¨æ—¶ï¼Œéœ€è¦é€šè¿‡é›†ç¾¤æ¢å¤æ¥æ¢å¤æœåŠ¡ã€‚æ‰€æœ‰æ•°æ®åº“èŠ‚ç‚¹å’Œå†…å­˜èŠ‚ç‚¹å°†ä»æ¸…é™¤çŠ¶æ€é‡æ–°å¯åŠ¨ï¼Œæ‰€æœ‰å†…å­˜çŠ¶æ€å°†ä»å­˜å‚¨é‡æ–°å¯åŠ¨ã€‚åˆå§‹åŒ–åï¼ˆè¿æ¥åˆ°è¿œç¨‹å†…å­˜å’Œå­˜å‚¨å™¨ç­‰ï¼‰ï¼ŒRWèŠ‚ç‚¹æ‰§è¡Œä¹‹å‰æ‰€è¿°çš„å¹¶è¡ŒREDOæ¢å¤ï¼Œç„¶åæ‰«ææ’¤é”€å¤´ä»¥æŸ¥æ‰¾æ‰€æœ‰æœªå®Œæˆçš„äº‹åŠ¡ã€‚ä¹‹åï¼ŒRWèŠ‚ç‚¹å°†å¯åŠ¨æœåŠ¡ï¼Œå¹¶åœ¨åå°å›æ»šæœªæäº¤çš„äº‹åŠ¡ã€‚åœ¨é›†ç¾¤æ¢å¤è¿‡ç¨‹ä¸­ï¼Œç¼“å­˜åœ¨è¿œç¨‹å†…å­˜ä¸­çš„é¡µé¢å°†è¢«æ¸…é™¤ï¼Œå› æ­¤å®ƒå°†å¿å—å†·ç¼“å­˜é—®é¢˜ã€‚\n","date":"2021-12-22T14:17:12+08:00","image":"https://2021.sigmod.org/images/2021sigmod-logo1.jpg","permalink":"https://tweakzx.github.io/p/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0polardb-serverless%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E6%8A%A5%E5%91%8A/","title":"ã€è®ºæ–‡ç¬”è®°ã€‘PolarDB-Serverlessè®ºæ–‡é˜…è¯»æŠ¥å‘Š"},{"content":"1 HPLï¼ˆHigh Performance Linpack) å‡è®¾è¦ä½¿ç”¨HPLç¨‹åºåœ¨4ä¸ªè¿›ç¨‹ä¸Šè§£ä¸€ä¸ª4096 * 4096çš„æ–¹ç¨‹ç»„ï¼ˆ4096 * 4096çš„çŸ©é˜µåŠ ä¸€åˆ—æ–¹ç¨‹ç»„çš„å³ç«¯é¡¹bï¼‰ï¼ŒæŒ‰ç…§è®²ä¹‰ç¬¬14é¡µæ‰€ç¤ºçš„block-cyclicæ–¹å¼å¯¹æ•°æ®è¿›è¡Œåˆ†é…ï¼ŒNB=512ã€‚4ä¸ªè¿›ç¨‹æŒ‰1 * 4å’Œ4 * 1ä¸¤ç§æ–¹å¼æ’å¸ƒã€‚é‚£ä¹ˆï¼Œåœ¨HPLçš„å›ä»£éƒ¨åˆ†ï¼ˆè®²ä¹‰48åˆ°55é¡µï¼‰ï¼ŒXçš„å„ä¸ªå…ƒç´ åˆ†åˆ«æ˜¯ç”±å“ªäº›è¿›ç¨‹ç®—å‡ºçš„ï¼Ÿä¾‹å¦‚ï¼ŒX[0..512]ç”±è¿›ç¨‹(3, 0)æ±‚å‡ºã€‚å†™å‡ºä¸¤ç§æ’å¸ƒæ–¹å¼ä¸‹Xçš„å„éƒ¨åˆ†åˆ†åˆ«ç”±å“ªäº›è¿›ç¨‹è®¡ç®—å¾—åˆ°ã€‚ï¼ˆ5åˆ†ï¼‰\n 1 * 4 æ’å¸ƒ  \rimage-20211214170301242\r\n   X è¿›ç¨‹     X[0..511] (0,0)   X[512..1023] (0,1)   X[1024..1535] (0,2)   X[1536..2047] (0,3)   X[2048..2559] (0,0)   X[2560..3071] (0,1)   X[3072..3583] (0,2)   X[3584..4095] (0,3)     4 * 1 æ’å¸ƒ  \rimage-20211214170325158\r\n   X è¿›ç¨‹     X[0..511] (0,0)   X[512..1023] (0,1)   X[1024..1535] (0,2)   X[1536..2047] (0,3)   X[2048..2559] (0,0)   X[2560..3071] (0,1)   X[3072..3583] (0,2)   X[3584..4095] (0,3)    ","date":"2021-12-14T13:55:35+08:00","image":"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpmob0455c.pic27.websiteonline.cn%2Fupload%2Felinpack3000-1200_dps0.jpg\u0026refer=http%3A%2F%2Fpmob0455c.pic27.websiteonline.cn\u0026app=2002\u0026size=f9999,10000\u0026q=a80\u0026n=0\u0026g=0n\u0026fmt=jpeg?sec=1642054231\u0026t=55c0893a251868314596e23dae76a843","permalink":"https://tweakzx.github.io/p/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8E%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97%E5%B9%B6%E8%A1%8C%E4%BD%9C%E4%B8%9A-3/","title":"ã€åˆ†å¸ƒå¼ä¸å¹¶è¡Œè®¡ç®—ã€‘å¹¶è¡Œä½œä¸š-3"},{"content":"1 åŠ é€Ÿå‘é‡åŠ æ³• #include \u0026lt;stdio.h\u0026gt;#include \u0026lt;assert.h\u0026gt; inline cudaError_t checkCuda(cudaError_t result) { if (result != cudaSuccess) { fprintf(stderr, \u0026#34;CUDA Runtime Error: %s\\n\u0026#34;, cudaGetErrorString(result)); assert(result == cudaSuccess); } return result; } void initWith(float num, float *a, int N) { for(int i = 0; i \u0026lt; N; ++i) { a[i] = num; } } __global__ void addVectorsInto(float *result, float *a, float *b, int N) { int initIndex = threadIdx.x + blockIdx.x * blockDim.x; int gridStride = gridDim.x * blockDim.x; for(int i = initIndex;i\u0026lt;N;i+=gridStride){ result[i] = a[i] + b[i]; } } void checkElementsAre(float target, float *array, int N) { for(int i = 0; i \u0026lt; N; i++) { if(array[i] != target) { printf(\u0026#34;FAIL: array[%d] - %0.0f does not equal %0.0f\\n\u0026#34;, i, array[i], target); exit(1); } } printf(\u0026#34;SUCCESS! All values added correctly.\\n\u0026#34;); } int main() { const int N = 2\u0026lt;\u0026lt;20; size_t size = N * sizeof(float); float *a; float *b; float *c; cudaMallocManaged(\u0026amp;a, size); cudaMallocManaged(\u0026amp;b, size); cudaMallocManaged(\u0026amp;c, size); initWith(3, a, N); initWith(4, b, N); initWith(0, c, N); size_t threads_per_block = 1024; size_t number_of_blocks = (N+threads_per_block-1)/threads_per_block; addVectorsInto\u0026lt;\u0026lt;\u0026lt;32,1024\u0026gt;\u0026gt;\u0026gt;(c, a, b, N); //addVectorsInto\u0026lt;\u0026lt;\u0026lt;number_of_blocks,threads_per_block\u0026gt;\u0026gt;\u0026gt;(c, a, b, N);  checkCuda(cudaGetLastError()); checkCuda(cudaDeviceSynchronize()); checkElementsAre(7, c, N); cudaFree(a); cudaFree(b); cudaFree(c); } 2 åŠ é€ŸSAXPY #include \u0026lt;stdio.h\u0026gt;#include \u0026lt;assert.h\u0026gt;#define N 2048 * 2048 // Number of elements in each vector  /* * Optimize this already-accelerated codebase. Work iteratively, * and use nsys to support your work. * * Aim to profile `saxpy` (without modifying `N`) running under * 20us. * * Some bugs have been placed in this codebase for your edification. */ inline cudaError_t checkCuda(cudaError_t result) { if (result != cudaSuccess) { fprintf(stderr, \u0026#34;CUDA Runtime Error: %s\\n\u0026#34;, cudaGetErrorString(result)); assert(result == cudaSuccess); } return result; } __global__ void saxpy(float * a, float * b, float * c) { int tid = blockIdx.x * blockDim.x + threadIdx.x; int stride = gridDim.x * blockDim.x; for(int i = tid; i\u0026lt;N; i+=stride){ c[tid] = 2 * a[tid] + b[tid]; } } int main() { int deviceId; int numberOfSMs; cudaGetDevice(\u0026amp;deviceId); cudaDeviceGetAttribute(\u0026amp;numberOfSMs, cudaDevAttrMultiProcessorCount, deviceId); float *a, *b, *c; int size = N * sizeof (float); // The total number of bytes per vector  cudaMallocManaged(\u0026amp;a, size); cudaMallocManaged(\u0026amp;b, size); cudaMallocManaged(\u0026amp;c, size); // Initialize memory  for( int i = 0; i \u0026lt; N; ++i ) { a[i] = 2.0; b[i] = 1.0; c[i] = 0.0; } cudaMemPrefetchAsync(a, size, deviceId); cudaMemPrefetchAsync(b, size, deviceId); cudaMemPrefetchAsync(c, size, deviceId); int threads_per_block = 256; int number_of_blocks = numberOfSMs * 32 ; saxpy \u0026lt;\u0026lt;\u0026lt; number_of_blocks, threads_per_block \u0026gt;\u0026gt;\u0026gt; ( a, b, c ); checkCuda(cudaGetLastError()); checkCuda(cudaDeviceSynchronize()); // Print out the first and last 5 values of c for a quality check  for( int i = 0; i \u0026lt; 5; ++i ) printf(\u0026#34;c[%d] = %f, \u0026#34;, i, c[i]); printf (\u0026#34;\\n\u0026#34;); for( int i = N-5; i \u0026lt; N; ++i ) printf(\u0026#34;c[%d] = %f, \u0026#34;, i, c[i]); printf (\u0026#34;\\n\u0026#34;); cudaFree( a ); cudaFree( b ); cudaFree( c ); } 3 N-body #include \u0026lt;math.h\u0026gt;#include \u0026lt;stdio.h\u0026gt;#include \u0026lt;stdlib.h\u0026gt;#include \u0026#34;timer.h\u0026#34;#include \u0026#34;files.h\u0026#34; #define SOFTENING 1e-9f  #include \u0026lt;assert.h\u0026gt;inline cudaError_t checkCuda(cudaError_t result) { if (result != cudaSuccess) { fprintf(stderr, \u0026#34;CUDA Runtime Error: %s\\n\u0026#34;, cudaGetErrorString(result)); assert(result == cudaSuccess); } return result; } /* * Each body contains x, y, and z coordinate positions, * as well as velocities in the x, y, and z directions. */ typedef struct { float x, y, z, vx, vy, vz; } Body; /* * Calculate the gravitational impact of all bodies in the system * on all others. */ __global__ void bodyForce(Body *p, float dt, int n) { int index = blockIdx.x * blockDim.x + threadIdx.x; int stride = gridDim.x * blockDim.x; for (int i = index; i \u0026lt; n; i+=stride) { float Fx = 0.0f; float Fy = 0.0f; float Fz = 0.0f; for (int j = 0; j \u0026lt; n; j++) { float dx = p[j].x - p[i].x; float dy = p[j].y - p[i].y; float dz = p[j].z - p[i].z; float distSqr = dx*dx + dy*dy + dz*dz + SOFTENING; float invDist = rsqrtf(distSqr); float invDist3 = invDist * invDist * invDist; Fx += dx * invDist3; Fy += dy * invDist3; Fz += dz * invDist3; } p[i].vx += dt*Fx; p[i].vy += dt*Fy; p[i].vz += dt*Fz; } } int main(const int argc, const char** argv) { // The assessment will test against both 2\u0026lt;11 and 2\u0026lt;15.  // Feel free to pass the command line argument 15 when you gernate ./nbody report files  int nBodies = 2\u0026lt;\u0026lt;11; if (argc \u0026gt; 1) nBodies = 2\u0026lt;\u0026lt;atoi(argv[1]); // The assessment will pass hidden initialized values to check for correctness.  // You should not make changes to these files, or else the assessment will not work.  const char * initialized_values; const char * solution_values; if (nBodies == 2\u0026lt;\u0026lt;11) { initialized_values = \u0026#34;files/initialized_4096\u0026#34;; solution_values = \u0026#34;files/solution_4096\u0026#34;; } else { // nBodies == 2\u0026lt;\u0026lt;15  initialized_values = \u0026#34;files/initialized_65536\u0026#34;; solution_values = \u0026#34;files/solution_65536\u0026#34;; } if (argc \u0026gt; 2) initialized_values = argv[2]; if (argc \u0026gt; 3) solution_values = argv[3]; const float dt = 0.01f; // Time step  const int nIters = 10; // Simulation iterations  int bytes = nBodies * sizeof(Body); float *buf; cudaMallocManaged(\u0026amp;buf, bytes); Body *p = (Body*)buf; read_values_from_file(initialized_values, buf, bytes); double totalTime = 0.0; /* * This simulation will run for 10 cycles of time, calculating gravitational * interaction amongst bodies, and adjusting their positions to reflect. */ int deviceId; int numberOfSMs; cudaGetDevice(\u0026amp;deviceId); cudaDeviceGetAttribute(\u0026amp;numberOfSMs, cudaDevAttrMultiProcessorCount, deviceId); int threads_per_block = 128; int number_of_blocks = numberOfSMs * 25 ; for (int iter = 0; iter \u0026lt; nIters; iter++) { StartTimer(); /* * You will likely wish to refactor the work being done in `bodyForce`, * and potentially the work to integrate the positions. */ bodyForce\u0026lt;\u0026lt;\u0026lt;threads_per_block,number_of_blocks\u0026gt;\u0026gt;\u0026gt;(p, dt, nBodies); // compute interbody forces  checkCuda(cudaGetLastError()); checkCuda(cudaDeviceSynchronize()); /* * This position integration cannot occur until this round of `bodyForce` has completed. * Also, the next round of `bodyForce` cannot begin until the integration is complete. */ for (int i = 0 ; i \u0026lt; nBodies; i++) { // integrate position  p[i].x += p[i].vx*dt; p[i].y += p[i].vy*dt; p[i].z += p[i].vz*dt; } const double tElapsed = GetTimer() / 1000.0; totalTime += tElapsed; } double avgTime = totalTime / (double)(nIters); float billionsOfOpsPerSecond = 1e-9 * nBodies * nBodies / avgTime; write_values_to_file(solution_values, buf, bytes); // You will likely enjoy watching this value grow as you accelerate the application,  // but beware that a failure to correctly synchronize the device might result in  // unrealistically high values.  printf(\u0026#34;%0.3f Billion Interactions / second\u0026#34;, billionsOfOpsPerSecond); cudaFree(buf); } 4 è¯ä¹¦ \rimage\r\n","date":"2021-12-13T19:03:20+08:00","image":"https://cdn.jsdelivr.net/gh/Tweakzx/ImageHost@main/img/image-20211215144717123.png","permalink":"https://tweakzx.github.io/p/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8E%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97cuda%E5%8A%A0%E9%80%9F%E8%AF%BE%E7%A8%8B%E9%A2%98%E7%9B%AE/","title":"ã€åˆ†å¸ƒå¼ä¸å¹¶è¡Œè®¡ç®—ã€‘CUDAåŠ é€Ÿè¯¾ç¨‹é¢˜ç›®"},{"content":"1 çŸ©é˜µå‘é‡ä¹˜æ³•ï¼ˆ6åˆ†ï¼‰ çŸ©é˜µå‘é‡ä¹˜æ³•(gemv)å¦‚ä½•ç”¨OpenMPæˆ–pthreadå¯¹å…¶å¹¶è¡ŒåŒ–(OpenMPå’Œpthreadä»»é€‰ä¸€ç§å³å¯)ï¼Ÿå‡è®¾çŸ©é˜µæŒ‰è¡Œå­˜å‚¨ï¼ˆæ¯ä¸€è¡Œæ•°æ®æ˜¯è¿ç»­çš„ï¼‰ï¼Œå¤„ç†å™¨æœ‰32ä¸ªæ ¸ã€‚å¦‚æœçŸ©é˜µæ˜¯æŒ‰åˆ—å­˜å‚¨å‘¢ï¼Ÿå…·ä½“å®ç°å¦‚ä½•ä¿®æ”¹ï¼Ÿ\nå¯ç”¨è¯­è¨€è¯¦ç»†æè¿°æˆ–å†™å‡ºä¼ªä»£ç \n  æŒ‰è¡Œå­˜å‚¨\nvoid *worker1(int row, int N, int** A, int* vec, int* result){ for(int i = row; i\u0026lt;N; i += 32){ result[i] = innerProduct(A[i],Vec); } } int main(){ ... for(int i=0;i\u0026lt;32;i++){ data_array[i].row = i; pthread_create(\u0026amp;threads[i], NULL, worker1, (void *)\u0026amp;data_array[i]) } ... }   æŒ‰åˆ—å­˜å‚¨\nvoid *worker2(int column, int N, int M, int** A, int* vec, int* result){ for(int j = column; j\u0026lt;M; j += 32){ for(int i = 0; i\u0026lt;N; i++){ result[i] += A[j][i]*Vec[j]; } } } int main(){ ... for(int i=0;i\u0026lt;32;i++){ data_array[i].column = i; pthread_create(\u0026amp;threads[i], NULL, worker1, (void *)\u0026amp;data_array[i]) } ... }   2 ç¨‹åºåˆ†æï¼ˆ4åˆ†ï¼‰ ä»¥ä¸‹ç¨‹åºè¿è¡Œæ—¶ä¼šå‡ºç°ä»€ä¹ˆç°è±¡ï¼Ÿå¯ä»¥å¦‚ä½•æ”¹å†™æ¥é¿å…æ­¤ç°è±¡å‘ç”Ÿï¼Ÿ\nint selected_thread; sem_t start1, start2, stop1, stop2; void* worker1() { sem_wait(\u0026amp;start1); sem_post(\u0026amp;stop1); } void *worker2(){ sem_wait(\u0026amp;start2); sem_post(\u0026amp;stop2); } int main(int argc, char *argv[]) { selected_thread = 2; sem_init(\u0026amp;start1); sem_init(\u0026amp;start2); sem_init(\u0026amp;stop1); sem_init(\u0026amp;stop2); pthread_create(worker1); pthread_create(worker2); sem_post(\u0026amp;start1); sem_wait(\u0026amp;stop1); sem_wait(\u0026amp;stop2); return 0; } ç­”ï¼š worker2ä¼šä¸€ç›´ç­‰å¾…ï¼Œç¨‹åºæ— æ³•ç»“æŸã€‚æ‰€ä»¥åœ¨ä¸»å‡½æ•°é‡ŒåŠ ä¸Šsem_post(\u0026amp;start2)ã€‚\n","date":"2021-12-11T18:01:26+08:00","image":"https://pic1.zhimg.com/v2-f9d2f5486443cc045996753d59f80a7e_1440w.jpg?source=172ae18b","permalink":"https://tweakzx.github.io/p/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8E%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97%E5%B9%B6%E8%A1%8C%E4%BD%9C%E4%B8%9A-2/","title":"ã€åˆ†å¸ƒå¼ä¸å¹¶è¡Œè®¡ç®—ã€‘å¹¶è¡Œä½œä¸š-2"},{"content":"1çŸ©é˜µå‘é‡ä¹˜æ³•ï¼ˆ4åˆ†ï¼‰ è®²ä¹‰55é¡µæ‰€ç¤ºç»“æœYï¼Œå¦‚æœè¦ä½œä¸ºä¸‹ä¸€æ¬¡çŸ©é˜µå‘é‡ä¹˜æ³•çš„è¾“å…¥Xï¼Œåˆ‡åˆ†åˆ°ä¸åŒçš„åˆ—è¿›ç¨‹ï¼Œå¹¶ä¸”å¤åˆ¶åˆ°æ¯ä¸€è¡Œè¿›ç¨‹ï¼Œåº”å¦‚ä½•æ“ä½œï¼Ÿå¯å†™å‡ºä¼ªä»£ç ï¼Œæˆ–ç”¨è¯­è¨€æè¿°ã€‚\nå³å›¾(a)ä¸­çš„Yï¼Œå˜æˆä¸‹å›¾(b)ä¸­çš„Xã€‚å‡è®¾æ¯è¡Œæœ‰Pä¸ªè¿›ç¨‹ï¼Œæ¯åˆ—ä¹Ÿæ˜¯Pä¸ªè¿›ç¨‹ï¼Œä¸€å…±P*Pä¸ªè¿›ç¨‹ã€‚\n\rimage-20211210120943046\r\nç­”ï¼šè¿›ç¨‹$P_{ij}$å’Œæ‰€æ§åˆ¶çš„çŸ©é˜µè¿›è¡ŒçŸ©é˜µå‘é‡ä¹˜ä¹‹åï¼Œå°†ç»“æœå­˜å…¥è¿›ç¨‹$P_{ji}$ã€‚\n2 ä»£ç å¡«ç©ºï¼ˆ3åˆ†ï¼‰ åœ¨æµ‹é‡ç¨‹åºæ€§èƒ½æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸è¦è®°å½•æ•´ä¸ªç¨‹åºæˆ–ç¨‹åºä¸­æŸä¸€éƒ¨åˆ†çš„è¿è¡Œæ—¶é—´ã€‚åœ¨MPIç¨‹åºä¸­ï¼Œç”±äºæ¯ä¸ªè¿›ç¨‹çš„è¿è¡Œæ—¶é—´ä¸åŒï¼Œä¸€èˆ¬éœ€è¦å–å„ä¸ªè¿›ç¨‹è¿è¡Œæ—¶é—´çš„æœ€å¤§å€¼ï¼Œç„¶åç”±0å·è¿›ç¨‹ä¿å­˜å’Œæ‰“å°ï¼ˆå…¶ä»–è¿›ç¨‹ä¸éœ€è¦ä¿å­˜ï¼‰ã€‚ä»¥ä¸‹ç¨‹åºå®Œæˆäº†è¿™ä¸ªåŠŸèƒ½ï¼Œè¯·åœ¨æ¨ªçº¿å¤„å¡«ä¸Šå‡½æ•°è°ƒç”¨è¯­å¥ã€‚\nint main(int argc, char * argv) { double total_time; double time0, time1; int procs, rank; MPI_init(argc, argv); MPI_Comm_size(MPI_COMM_WORLD, \u0026amp;procs); MPI_Comm_rank(MPI_COMM_WORLD, \u0026amp;rank); time0 = MPI_Wtime(); //do some computation \ttime1 = MPI_Wtime() â€“ time0; _______________________________________________________________ if(rank == 0) { Printf(â€œTotal execution time is %f seconds\\nâ€, total_time); } } ç­”ï¼š\nMPI_Reduce(\u0026amp;time1,\u0026amp;total_time,1,MPI_DOUBLE,MPI_MAX,0,MPI_COMM_WORLD) 3 ä»¥ä¸‹ç¨‹åºç›¸å½“äºå“ªä¸ªMPIèšåˆæ“ä½œï¼Ÿï¼ˆ3åˆ†ï¼‰ #define N 16384 double *send_buff, *recv_buff; MPI_Status status; int i, nprocs, myid, count=N/num_procs; send_buff = (double*)malloc(N*sizeof(double)); recv_buff = (double*)malloc(N*sizeof(double)); MPI_Comm_size(MPI_COMM_WORLD, \u0026amp;nprocs); MPI_Comm_rank(MPI_COMM_WORLD, \u0026amp;myid); //æ­¤å¤„çœç•¥send_buffä¸­æ•°æ®çš„åˆå§‹åŒ– memcpy((void*)(recv_buff + myid * count), (void*)(send_buff + myid * count), count*sizeof(double)); for(int i = 0; i \u0026lt; nprocs;i++) { if(i!=myid) { MPI_Sendrecv(send_buff+i*count, count, MPI_DOUBLE, i, 400, recv_buff+i*count, count, MPI_DOUBLE, i, 400, MPI_COMM_WORLD, \u0026amp;status); } } ç­”ï¼šMPI_Alltoall()\n","date":"2021-12-10T11:28:33+08:00","image":"https://img2.baidu.com/it/u=2900542081,1673808678\u0026fm=26\u0026fmt=auto","permalink":"https://tweakzx.github.io/p/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8E%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97%E5%B9%B6%E8%A1%8C%E4%BD%9C%E4%B8%9A-1/","title":"ã€åˆ†å¸ƒå¼ä¸å¹¶è¡Œè®¡ç®—ã€‘å¹¶è¡Œä½œä¸š-1"},{"content":"1 é€»è¾‘æ—¶é’Ÿä¸ä¸€è‡´å‰²é›† ä¸‹å›¾ä¸­ï¼Œç›´çº¿ä¸Šå°é»‘ç‚¹ç»™å‡ºäº†æ—¶é’Ÿè®¡æ•°ï¼Œè¯·åˆ†åˆ«ç”¨Lamport é€»è¾‘æ—¶é’Ÿå’Œå‘é‡æ—¶é’Ÿç»™å›¾ä¸Šçš„äº‹ä»¶è®¾ç½®æ—¶é—´æˆ³ï¼Œå¹¶ç»™å‡ºä¸€è‡´å‰²é›†å’Œéä¸€è‡´å‰²é›†çš„ä¾‹å­ã€‚\n\räº‹ä»¶æ—¶é’Ÿè®¡æ•°\r\nç­”ï¼š\n  è®¾ç½®æ—¶é—´æˆ³\n  Lamporté€»è¾‘æ—¶é’Ÿ\n\rLamporté€»è¾‘æ—¶é’Ÿ\r\n  å‘é‡æ—¶é’Ÿ\n\rå‘é‡æ—¶é’Ÿ\r\n    å‰²é›†çš„ä¾‹å­\n  ä¸€è‡´å‰²é›†\n\rä¸€è‡´å‰²é›†\r\n  éä¸€è‡´å‰²é›†\n\réä¸€è‡´å‰²é›†\r\nåŒ…å«$e_1^2$è¿™ä¸ªæ¥æ”¶äº‹ä»¶ä½†æ˜¯ä¸åŒ…å«$e_3^1$è¿™ä¸ªå‘é€äº‹ä»¶ã€‚\n    2 å¼‚æ­¥åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•…éšœç±»å‹ è€ƒè™‘åœ¨å¼‚æ­¥åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä½¿ç”¨çš„ä¸¤ä¸ªé€šä¿¡æœåŠ¡ã€‚åœ¨æœåŠ¡Aä¸­ï¼Œæ¶ˆæ¯å¯èƒ½ä¸¢å¤±ã€è¢«å¤åˆ¶æˆ–å»¶è¿Ÿï¼Œæ ¡éªŒå’Œä»…åº”ç”¨åˆ°æ¶ˆæ¯å¤´ã€‚åœ¨æœåŠ¡Bä¸­ï¼Œæ¶ˆæ¯å¯èƒ½ä¸¢å¤±ã€å»¶è¿Ÿæˆ–å‘é€åœ°å¤ªå¿«ä»¥è‡´æ¥æ”¶æ–¹æ— æ³•å¤„ç†å®ƒï¼Œä½†åˆ°è¾¾ç›®çš„åœ°çš„æ¶ˆæ¯å…¶å†…å®¹ä¸€å®šæ­£ç¡®ã€‚æè¿°æ¯ä¸ªæœåŠ¡ä¼šæœ‰çš„æ•…éšœç±»å‹ã€‚æ ¹æ®å¯¹æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§çš„å½±å“å°†æ•…éšœåˆ†ç±»ã€‚æœåŠ¡Bèƒ½è¢«æè¿°æˆä¸€ä¸ªå¯é çš„é€šä¿¡æœåŠ¡å—ï¼Ÿ\nç­”ï¼š\n  æœåŠ¡Aä¼šæœ‰çš„æ•…éšœç±»å‹\n é—æ¼æ•…éšœ  æ¶ˆæ¯ä¸¢å¤±   æ‹œå åº­æ•…éšœ  checksumä»…ä»…åº”ç”¨åˆ°æ¶ˆæ¯çš„headï¼Œæ¶ˆæ¯çš„bodyå¯èƒ½å‘ç”ŸæŸå æ¶ˆæ¯é‡å¤   å› ä¸ºè¿™æ˜¯å¼‚æ­¥åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ‰€ä»¥ä¸ä¼šæœ‰æ—¶åºæ•…éšœã€‚  é—æ¼æ•…éšœçš„æ¶ˆæ¯ä¸¢å¤±ç ´åäº†æœ‰æ•ˆæ€§ã€‚æ‹œå åº­æ•…éšœçš„å¯èƒ½æŸåçš„æ¶ˆæ¯ä»¥åŠé‡å¤çš„æ¶ˆæ¯ç ´åäº†å®Œæ•´æ€§ã€‚\n  æœåŠ¡Bä¼šæœ‰çš„æ•…éšœç±»å‹\n é—æ¼æ•…éšœ  æ¶ˆæ¯ä¸¢å¤± å‘é€åœ°å¤ªå¿«ä»¥è‡´æ¥æ”¶æ–¹æ— æ³•å¤„ç†å®ƒï¼Œæ¥æ”¶é—æ¼   å› ä¸ºè¿™æ˜¯å¼‚æ­¥åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ‰€ä»¥ä¸ä¼šæœ‰æ—¶åºæ•…éšœã€‚  æœåŠ¡Bæ»¡è¶³å®Œæ•´æ€§ï¼Œä½†æ˜¯æœåŠ¡Bæ¶ˆæ¯å‘ç”Ÿçš„é—æ¼æ•…éšœï¼Œä¸æ»¡è¶³æœ‰æ•ˆæ€§ï¼Œæ‰€ä»¥ä¸æ˜¯å¯é çš„é€šä¿¡æœåŠ¡ã€‚\n  3 Ricart and Agrawala ç®—æ³• è¯·è¯æ˜Ricart-Agrawalaçš„äº’æ–¥ç®—æ³•æ»¡è¶³ME2å’ŒME3ã€‚\n ME2:è¿›å…¥æˆ–é€€å‡ºä¸´ç•ŒåŒºçš„è¯·æ±‚æœ€ç»ˆéƒ½ä¼šæˆåŠŸ\nME3:å¦‚æœä¸€ä¸ªè¿›å…¥ä¸´ç•ŒåŒºçš„è¯·æ±‚å‘ç”Ÿåœ¨å…ˆï¼Œé‚£ä¹ˆè¿›å…¥ä¸´ç•ŒåŒºä¹ŸæŒ‰æ­¤é¡ºåº\nRicart-Agrawalaç®—æ³•ï¼š\n ä¸€ä¸ªè¿›ç¨‹ç”³è¯·èµ„æºæ—¶å‘æ‰€æœ‰å…¶ä»–è¿›ç¨‹å‘å‡ºå¸¦æœ‰æ—¶é—´æˆ³çš„ç”³è¯·æŠ¥æ–‡ï¼› ä¸€ä¸ªè¿›ç¨‹æ”¶åˆ°ç”³è¯·æŠ¥æ–‡åï¼Œç­”å¤è¿™ä¸ªç”³è¯·ï¼Œå½“ä¸”ä»…å½“ï¼š1ï¼‰è‹¥ä¸åœ¨ä¸´ç•ŒåŒºå¹¶ä¸”è‡ªå·±æœªç”³è¯·è¿›å…¥ä¸´ç•ŒåŒº,æˆ–è€…2)è‡ªå·±è™½ç„¶å‘å‡ºäº†ç”³è¯·æŠ¥æ–‡ï¼Œä½†è‡ªå·±çš„æŠ¥æ–‡çš„æ—¶é—´æˆ³å¤§äºæ”¶åˆ°çš„ç”³è¯·æŠ¥æ–‡ã€‚å¦‚æœå·²ç»åœ¨ä¸´ç•ŒåŒºï¼Œæˆ–è€…è‡ªå·±çš„ç”³è¯·å‘é€åœ¨å‰ï¼Œåˆ™åœ¨å‡ºä¸´ç•ŒåŒºä¹‹å‰å°†æ‰€æœ‰çš„ç”³è¯·æŒ‚èµ·ã€‚ ç”³è¯·èµ„æºçš„è¿›ç¨‹ä»…åœ¨æ”¶åˆ°å…¶å®ƒæ‰€æœ‰è¿›ç¨‹çš„å›ç­”æŠ¥æ–‡åæ‰è¿›å…¥ä¸´ç•ŒåŒºä½¿ç”¨èµ„æºï¼› ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨å®Œèµ„æºåï¼Œå®ƒå‘æ‰€æœ‰æŒ‚èµ·çš„ç”³è¯·å‘é€å›ç­”æŠ¥æ–‡ã€‚   è¯æ˜ï¼š\n è¯æ˜æ»¡è¶³ME2  ä¸€ä¸ªè¿›ç¨‹$p_i$è¦è¿›å…¥ä¸´ç•ŒåŒºå‘å…¶ä»–è¿›ç¨‹å‘é€è¯·æ±‚ï¼Œä¸æƒ³è¿›å…¥ä¸´ç•ŒåŒºçš„è¿›ç¨‹ï¼Œæˆ–è€…å·²ç»å‘é€äº†è¯·æ±‚ä½†æ˜¯å‘é€æ—¶é—´æˆ³å¤§äºæ¥æ”¶è¯·æ±‚æ—¶é—´æˆ³$T_i$çš„è¿›ç¨‹éƒ½ä¼šå›å¤ã€‚æ‰€ä»¥è¿›ç¨‹$p_i$è¦ç­‰å¾…é€»è¾‘æ—¶é—´æˆ³$T_i$ä¹‹å‰å‘é€äº†è¯·æ±‚çš„è¿›ç¨‹ä»¥åŠæ­£åœ¨ä¸´ç•ŒåŒºçš„è¿›ç¨‹çš„ç­”å¤ã€‚ åœ¨é€»è¾‘æ—¶é—´æˆ³$T_i$ä¹‹å‰å‘å‡ºè¯·æ±‚çš„è¿›ç¨‹æ‰€ç­‰å¾…è¿›ç¨‹çš„æ•°é‡ä¾æ¬¡é€’å‡åˆ°1ã€‚ç­‰æ­£åœ¨ä¸´ç•ŒåŒºçš„è¿›ç¨‹ä½¿ç”¨å®Œèµ„æºå¹¶é€€å‡ºåï¼Œæ‰€æœ‰åœ¨ç­‰å¾…çš„è¿›ç¨‹æ‰€éœ€ç­‰å¾…è¿›ç¨‹æ•°é‡å…¨éƒ½å‡1ã€‚æ­¤æ—¶æœ‰ä¸€ä¸ªè¿›ç¨‹å¾—åˆ°äº†å…¨éƒ¨çš„ç­”å¤ï¼Œè¿›å…¥ä¸´ç•ŒåŒºã€‚ æŒ‰ç…§è¿™ä¸ªè¿‡ç¨‹ï¼Œåªè¦å‰è¾¹çš„è¿›ç¨‹ä¾æ¬¡è¿›å…¥ä¸´ç•ŒåŒºå¹¶é€€å‡ºä¹‹åï¼Œè¿›ç¨‹$p_i$å°±å¯ä»¥æˆåŠŸè¿›å…¥ä¸´ç•ŒåŒºï¼Œæ¯•ç«Ÿæ²¡æœ‰è¿›ç¨‹å¯ä»¥æ’é˜Ÿï¼Œæ‰€éœ€ç­‰å¾…è¿›ç¨‹æ•°é‡åªèƒ½é€’å‡ã€‚ ç”±äºä½¿ç”¨å®Œèµ„æºåé€€å‡ºä¸´ç•ŒåŒºä¸éœ€è¦ç­‰å¾…ç­”å¤ï¼Œæ‰€ä»¥å¯ä»¥æˆåŠŸé€€å‡ºã€‚æ‰€ä»¥ï¼Œæ»¡è¶³ME2ã€‚   è¯æ˜æ»¡è¶³ME3  å½“è¿›$p_i$ç»™å…¶ä»–è¿›ç¨‹å‘é€è¿›å…¥ä¸´ç•ŒåŒºçš„ç”³è¯·æ—¶ å¦‚æœè¿›ç¨‹$p_j$ä¹Ÿæƒ³è¿›å…¥ä¸´ç•ŒåŒºï¼Œå‘é€çš„ç”³è¯·çš„æ—¶é—´æˆ³å°äºæ”¶åˆ°çš„$T_i$ï¼Œé‚£ä¹ˆ$p_j$ä¸ä¼šå‘é€ç­”å¤ç»™$p_i$,è¿™æ ·$p_i$å°±å¿…é¡»ç­‰å¾…$p_j$è¿›å…¥å¹¶é€€å‡ºä¸´ç•ŒåŒºä¹‹åæ‰èƒ½å¾—åˆ°ç­”å¤ï¼Œæ‰æœ‰å¯èƒ½è¿›å…¥ä¸´ç•ŒåŒºã€‚ å¦‚æœè¿›ç¨‹$p_j$ä¹Ÿæƒ³è¿›å…¥ä¸´ç•ŒåŒºï¼Œå‘é€çš„ç”³è¯·çš„æ—¶é—´æˆ³å¤§äºæ”¶åˆ°çš„$T_i$ï¼Œé‚£ä¹ˆä»–ä¼šå›å¤$p_i$çš„ç”³è¯·ï¼Œ$p_i$æ— éœ€ç­‰å¾…$p_j$ï¼Œä¸”å½“$p_i$æ”¶åˆ°$p_j$çš„è¯·æ±‚ä¹‹åä¸ä¼šå›å¤ï¼Œ$p_j$ç­‰å¾…$p_i$ã€‚ æ‰€ä»¥ï¼Œæ»¡è¶³ME3    4 æ”¹è¿›Ricart and Agrawala ç®—æ³• åœ¨Ricart-Agrawalaçš„äº’æ–¥ç®—æ³•ä¸­ï¼ŒåŸå§‹å‡å®šç³»ç»Ÿçš„è¿›ç¨‹æ˜¯ä¸å‡ºæ•…éšœçš„ã€‚è¯·ä¿®æ”¹ç®—æ³•å¢åŠ å¤„ç†ä¸€ä¸ªè¿›ç¨‹å´©æºƒçš„æƒ…å†µã€‚\nç­”ï¼šå¦‚æœæœ‰è¿›ç¨‹å´©æºƒï¼Œé‚£ä¹ˆå®ƒæ°¸è¿œä¸ä¼šå›å¤ï¼Œåˆ™å‘é€è¯·æ±‚çš„è¿›ç¨‹éœ€è¦ä¸€ç›´ç›²ç­‰ã€‚\n æ‰€ä»¥æ¯å½“æ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åè¦åšå‡ºç­”å¤ï¼Œå›å¤åŒæ„ï¼Œå½“ä¸”ä»…å½“ï¼š1ï¼‰è‹¥ä¸åœ¨ä¸´ç•ŒåŒºå¹¶ä¸”è‡ªå·±æœªç”³è¯·è¿›å…¥ä¸´ç•ŒåŒº,æˆ–è€…2)è‡ªå·±è™½ç„¶å‘å‡ºäº†ç”³è¯·æŠ¥æ–‡ï¼Œä½†è‡ªå·±çš„æŠ¥æ–‡çš„æ—¶é—´æˆ³å¤§äºæ”¶åˆ°çš„ç”³è¯·æŠ¥æ–‡ã€‚æˆ–è€…å›å¤æ‹’ç»ï¼Œå½“1ï¼‰è‡ªå·±å¤„åœ¨ä¸´ç•ŒåŒºï¼Œæˆ–è€…2ï¼‰è‡ªå·±çš„ä¸´ç•ŒåŒºç”³è¯·çš„é€»è¾‘æ—¶é—´æˆ³å°äºæ”¶åˆ°çš„ç”³è¯·ï¼ŒæŠŠå›å¤æ‹’ç»çš„è¿›ç¨‹ç¼“å­˜èµ·æ¥ï¼Œç­‰å¾…å›å¤ã€‚ å¦‚æœè¶…å‡ºtimeoutæ²¡æœ‰æ”¶åˆ°ç­”å¤åˆ™è®¤ä¸ºæœºå™¨æ•…éšœï¼Œåªéœ€ç­‰å¾…å…¶ä½™çš„æœºå™¨å…¨éƒ¨å›å¤åŒæ„ å½“ä¸€ä¸ªè¿›ç¨‹é€€å‡ºä¸´ç•ŒåŒºä¹‹åï¼Œè¦å‘æ‰€æœ‰å›å¤æ‹’ç»çš„è¿›ç¨‹å›å¤åŒæ„ã€‚  5æ”¹è¿›åŸºäºç¯çš„äº’æ–¥ç®—æ³• æ”¹è¿›åŸºäºç¯çš„äº’æ–¥ç®—æ³•ä½¿å¾—å®ƒèƒ½æ£€æµ‹æƒæ ‡çš„ä¸¢å¤±å¹¶é‡æ–°ç”Ÿæˆæƒæ ‡ã€‚\nç­”ï¼š\n ä¸€ä¸ªè¿›ç¨‹å‘å‡ºç”³è¯·ä¹‹åï¼Œå¦‚æœé•¿æ—¶é—´æ²¡æœ‰æ‹¿åˆ°æƒæ ‡ï¼Œåˆ™å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å‘é€ä¸€ä¸ªè¯·æ±‚reqestç¡®è®¤æƒæ ‡æ˜¯å¦è¿˜åœ¨ã€‚ ä¸€ä¸ªè¿›ç¨‹æ”¶åˆ°äº†ç¡®è®¤æƒæ ‡å­˜åœ¨çš„è¯·æ±‚requestï¼Œå¦‚æœæƒæ ‡åœ¨è‡ªå·±æ‰‹é‡Œåˆ™å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å‘é€ä¸€ä¸ªexistï¼Œå¦‚æœæƒæ ‡ä¸åœ¨è‡ªå·±æ‰‹é‡Œï¼Œåˆ™å°†requstä¼ é€’ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ ä¸€ä¸ªè¿›ç¨‹æ”¶åˆ°äº†ä¸€ä¸ªexistæ¶ˆæ¯åˆ™å°†å®ƒä¼ é€’åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ å¦‚æœå‘å‡ºç”³è¯·çš„è¿›ç¨‹æ”¶åˆ°requestè¯·æ±‚ï¼Œåˆ™è®¤ä¸ºæƒæ ‡ä¸¢å¤±ï¼Œé‡æ–°ç”Ÿæˆæƒæ ‡ã€‚å¦‚æœæ”¶åˆ°existï¼Œåˆ™è¯´æ˜ä¸€åˆ‡æ­£å¸¸ã€‚  6 åŒå‘ç¯ç»“æ„çš„é€‰ä¸¾ç®—æ³• åŸºäºç¯çš„é€‰ä¸¾ç®—æ³•æ˜¯å»ºç«‹åœ¨å•å‘ç¯çš„å‡è®¾ä¹‹ä¸Šçš„ï¼Œä¸ºäº†è·å¾—æ›´å¿«çš„é€‰ä¸¾é€Ÿåº¦ï¼Œç°é‡‡ç”¨åŒå‘ç¯ç»“æ„ï¼Œå³æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥åŒæ—¶å‘é¡ºæ—¶é’ˆå’Œé€†æ—¶é’ˆä¸¤ä¸ªæ–¹å‘å‘é€é€‰ä¸¾æ¶ˆæ¯ï¼Œè¯·åˆ—å‡ºæ–°ç®—æ³•çš„é«˜å±‚æè¿°ï¼Œå¹¶ç”¨ä¸€ä¸ªå››èŠ‚ç‚¹çš„åŒå‘ç¯æ¥è¯´æ˜ä½ çš„æ–¹æ³•ã€‚\nç­”ï¼š\n æœ€åˆï¼Œæ‰€æœ‰è¿›ç¨‹æ ‡è®°ä¸ºéå‚ä¸è€…ï¼Œä»»æ„ä¸€ä¸ªè¿›ç¨‹å‘èµ·é€‰ä¸¾ï¼Œå‘èµ·é€‰ä¸¾åï¼Œç½®è‡ªå·±ä¸ºå‚ä¸è€…ï¼ˆ$elected_i = âŠ¥$)ï¼Œå‘ä¸Šä¸‹æ¸¸å‘é€ä¸€ä¸ªé€‰ä¸¾æ¶ˆæ¯ï¼ŒåŒ…å«è‡ªå·±çš„æ ‡è¯†ç¬¦ã€‚ ä¸€ä¸ªè¿›ç¨‹æ”¶åˆ°é€‰ä¸¾æ¶ˆæ¯åï¼Œé‚£ä¹ˆæ¯”è¾ƒè‡ªå·±çš„æ ‡è¯†ç¬¦ä¸æ”¶åˆ°æ¶ˆæ¯ä¸­çš„æ ‡è¯†ç¬¦ï¼Œ  å¦‚æœè‡ªå·±çš„æ ‡è¯†ç¬¦å°äºæ¶ˆæ¯ä¸­çš„æ ‡è¯†ç¬¦ï¼Œé‚£ä¹ˆé¡ºæ¶ˆæ¯æ¥çš„æ–¹å‘ä¼ é€’é€‰ä¸¾æ¶ˆæ¯ï¼› å¦‚æœè‡ªå·±çš„æ ‡è¯†ç¬¦å¤§äºæ¶ˆæ¯ä¸­çš„æ ‡è¯†ç¬¦  å¦‚æœè‡ªå·±æ˜¯éå‚ä¸è€…ï¼Œå°†æ¶ˆæ¯ä¸­çš„æ ‡è¯†ç¬¦æ”¹ä¸ºè‡ªå·±æ ‡è¯†ç¬¦ï¼Œé¡ºæ¶ˆæ¯æ¥çš„æ–¹å‘ä¼ é€’é€‰ä¸¾æ¶ˆæ¯ã€‚ å¦‚æœè‡ªå·±æ˜¯å‚ä¸è€…ï¼Œåˆ™ä¸è½¬å‘æ¶ˆæ¯ã€‚   å¦‚æœè‡ªå·±çš„æ ‡è¯†ç¬¦ç­‰äºæ¶ˆæ¯ä¸­çš„æ ‡è¯†ç¬¦ï¼Œé‚£ä¹ˆè¯´æ˜è‡ªå·±çš„æ ‡è¯†ç¬¦æœ€å¤§ï¼Œå¦‚æœè¿˜æœªå½“é€‰ï¼Œåˆ™å½“é€‰ä¸ºåè°ƒè€…ï¼Œå‘ä¸Šæ¸¸å’Œä¸‹æ¸¸å‘é€ä¸€ä¸ªå½“é€‰æ¶ˆæ¯ï¼ŒåŒ…å«è‡ªå·±çš„æ ‡è¯†ç¬¦P   ä¸€ä¸ªè¿›ç¨‹æ”¶åˆ°ä¸€ä¸ªå½“é€‰æ¶ˆæ¯ï¼Œå¦‚æœè‡ªå·±æ˜¯å‚ä¸è€…ï¼Œè®¾ç½®$elected_i = P$ï¼Œç½®è‡ªå·±ä¸ºéå‚ä¸è€…ï¼Œå¹¶ä¸”æŒ‰ç…§æ¶ˆæ¯å‘é€çš„æ–¹å‘ä¼ é€’ç»™è‡ªå·±çš„é‚»å±…ï¼›å¦‚æœè‡ªå·±å·²ç»çŸ¥æ™“å½“é€‰æ¶ˆæ¯ï¼Œåˆ™ä¸è½¬å‘ã€‚  Init elected != âŠ¥ for process i (i = 1,2,...N) in the process which start an election: function startElection(): electingMSG \u0026lt;- MSG(type = \u0026quot;electing\u0026quot;, value = Local.id) Local.elected = 'âŠ¥' send(msg = electingMSG ,direction = clockwise) send(msg = electingMSG , direction = counterclockwise) in process i: function handleMSG(MSG msg, Direction direction): if msg.type = \u0026quot;electing\u0026quot;: if Local.id \u0026lt; msg.id: send(msg,direction) Local.elected = 'âŠ¥' else if Local.id \u0026gt; msg.id: if Local.elected != 'âŠ¥': msg.value = Local.id send(msg, direction) Local.elected = 'âŠ¥' end else if(process i is not Coordinator) setCoordinator(process i) Local.elected = 'âŠ¥' electdeMSG \u0026lt;- MSG(type = \u0026quot;elected\u0026quot;, value = Local.id) send(msg = electedMSG, direction = clockwise) send(msg = electedMSG, direction = counterclockwise) end end end if msg.type = \u0026quot;elected\u0026quot; if Local.elected == 'âŠ¥': Local.elected = msg.value send(msg, direction) end end \rimage-20211209165145519\r\nå›¾ä¸­:\tç™½è‰²è¡¨ç¤ºåˆå§‹éå‚ä¸è€…ï¼Œé»„è‰²è¡¨ç¤ºå‚ä¸è€…ï¼Œçº¢è‰²è¡¨ç¤ºçŸ¥é“å½“é€‰ç»“æœã€‚è“è‰²æ˜¯é€‰ä¸¾æ¶ˆæ¯ï¼Œç»¿è‰²æ˜¯å½“é€‰æ¶ˆæ¯ã€‚ä»13å·å¼€å§‹å‘èµ·é€‰ä¸¾ï¼Œæœ€ç»ˆé€‰å‡º23ä¸ºåè°ƒè€…ã€‚\n ç½‘ç»œå¸¦å®½ï¼šæ‰¾åˆ°æœ€å¤§æ ‡è¯†ç¬¦æœ€å¤šéœ€è¦Nä¸ªæ¶ˆæ¯ï¼Œç¡®è®¤æœ€å¤§æ ‡è¯†ç¬¦æœ€å¤šéœ€è¦2Nä¸ªæ¶ˆæ¯ï¼Œé€šçŸ¥å½“é€‰æœ€å¤šéœ€è¦N+1ä¸ªæ¶ˆæ¯ï¼Œåˆ™æœ€å¤šéœ€è¦æ¶ˆæ¯ä¸º 4N+1 å›è½¬æ—¶é—´ï¼šç¬¬ä¸€è½®å¯»æ‰¾èŠ±è´¹æœ€å¤š(N/2)ä¸ªæ¶ˆæ¯ï¼Œç¬¬äºŒè½®ç¡®è®¤éœ€è¦æœ€å¤šèŠ±è´¹Nä¸ªæ¶ˆæ¯ï¼Œç¬¬ä¸‰è½®é€šçŸ¥æœ€å¤šéœ€è¦èŠ±è´¹(N/2)+1ä¸ªæ¶ˆæ¯ï¼Œæ‰€ä»¥æœ€å¤šéœ€è¦èŠ±è´¹2N+1ä¸ªæ¶ˆæ¯çš„å›è½¬æ—¶é—´ã€‚  7 åŸºäºç”Ÿæˆæ ‘çš„é€‰ä¸¾ç®—æ³• èŠ‚ç‚¹ä¹‹é—´æŒ‰ç…§ç”Ÿæˆæ ‘æ–¹å¼è¿æ¥ï¼Œä»…æœ‰è¾¹ç›¸è¿çš„èŠ‚ç‚¹èƒ½é€šä¿¡ï¼Œè¯·åŸºäºæ­¤ç½‘ç»œæ‹“æ‰‘ï¼Œè®¾è®¡ä¸€ä¸ªé€‰ä¸¾ç®—æ³•ï¼Œç»™å‡ºå…¶ä¼ªç ã€‚å½“ä»…æœ‰ä¸€ä¸ªè¿›ç¨‹å‘èµ·é€‰ä¸¾ï¼Œä½ çš„é€‰ä¸¾ç®—æ³•æ‰€éœ€çš„æ¶ˆæ¯é‡æ˜¯å¤šå°‘ï¼Ÿ\nç­”ï¼šå‡å®šæ˜¯æœ‰å‘ç”Ÿæˆæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å‘å­èŠ‚ç‚¹æˆ–è€…çˆ¶èŠ‚ç‚¹å‘é€æ¶ˆæ¯ã€‚ä»»ä½•ä¸€ä¸ªè¿›ç¨‹éƒ½å¯ä»¥å‘èµ·é€‰ä¸¾ã€‚ç®—æ³•å¦‚ä¸‹ï¼š\n  æ”¶åˆ°é€‰ä¸¾æ¶ˆæ¯ï¼Œå°†å‘é€æ¶ˆæ¯çš„æ ‡è¯†ç¬¦å’Œè‡ªå·±çš„æ ‡è¯†ç¬¦ä½œæ¯”è¾ƒï¼Œæ›´æ”¹æ¶ˆæ¯ä¸­çš„ä¿¡æ¯ä¸ºè¾ƒå¤§å€¼ï¼›å¦‚æœæœ‰å­èŠ‚ç‚¹ï¼Œåˆ™å‘å­èŠ‚ç‚¹å‘é€è¿™ä¸ªé€‰ä¸¾æ¶ˆæ¯ï¼›å¦‚æœæ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™çˆ¶äº²èŠ‚ç‚¹è¿”å›ä¸€ä¸ªå›å¤æ¶ˆæ¯ï¼ŒåŒ…å«å½“å‰çš„è¾ƒå¤§æ ‡è¯†ç¬¦ã€‚\n  ç­‰åˆ°æ”¶åˆ°æ‰€æœ‰å­èŠ‚ç‚¹çš„å›å¤æ¶ˆæ¯ï¼Œé€‰å‡ºæœ€å¤§çš„æ ‡è¯†ç¬¦ï¼Œè¿”å›ç»™çˆ¶äº²èŠ‚ç‚¹\n  å½“æ ¹èŠ‚ç‚¹æ”¶åˆ°æœ€å¤§çš„ æ ‡è¯†ç¬¦ï¼Œåˆ™å‘æ‰€æœ‰çš„å­èŠ‚ç‚¹å‘é€å½“é€‰ä¿¡æ¯ï¼Œç›´åˆ°å¶èŠ‚ç‚¹ã€‚å¦‚æœæœ‰å­èŠ‚ç‚¹å‘ç°è‡ªå·±çš„æ ‡è¯†ç¬¦ç­‰äºæ¶ˆæ¯ä¸­çš„çš„æ ‡è¯†ç¬¦ï¼Œåˆ™æˆä¸ºåè°ƒè€…ã€‚\n  æˆ‘çš„é€‰ä¸¾ç®—æ³•æ‰€éœ€çš„æ¶ˆæ¯é‡é€‰ä¸¾æœ‰N-1ä¸ªï¼Œå›å¤æœ‰N-1ä¸ªï¼Œå½“é€‰æœ‰N-1ä¸ªï¼Œæ‰€ä»¥æ€»å…±æœ‰3N-3ä¸ªã€‚\nInit Local.elected != âŠ¥ for process i (i = 1,2,...N) Local.count =0 for process i (i = 1,2,...N) in the process p0 which start an election: function startElection(): electingMSG \u0026lt;- MSG(type = \u0026quot;electing\u0026quot;, value = Local.id) Local.elected = 'âŠ¥' for i in son(p0): send(electingMSG, dest = i) end in process p: function handleMSG(MSG msg): if msg.type = \u0026quot;electing\u0026quot;: Local.elected = 'âŠ¥' if !isEmpty(son(p): msg.value = max(Local.id,msg.value) for i in son(p): send(msg, dest = i) end else replyMSG = MSG(type = \u0026quot;reply\u0026quot;, value = max(Local.id,msg.value) send(relpyMSG, dest = father(p)) end if msg.type = \u0026quot;reply\u0026quot;: Local.count++; msg.value = max(Local.id, msg.value) if(Local.count == son(p).size()): if !isEmpty(father(p)): send(msg, dest = father(p)) else electedMSG = MSG(type = \u0026quot;elected\u0026quot;,value = msg.value) for i in son(p): send(electedMSG, dest = i) end Local.elected = msg.value if Local.ip == msg.value: setCoordinator(process = p) end end end end if msg.type = \u0026quot;elected\u0026quot;: if Local.ip == msg.value: setCoordinator(process = p) end if !isEmpty(son(p)): for i in son(p): send(msg, dest = i) end end 8 æ³•å®šæ•°å…±è¯†å¤åˆ¶ åœ¨æœåŠ¡å™¨Xã€Yå’ŒZä¸Šä½¿ç”¨æ³•å®šæ•°å…±è¯†è¿›è¡Œå¤åˆ¶ï¼Œè¿™äº›æœåŠ¡å™¨éƒ½æœ‰æ•°æ®é¡¹Aå’ŒBçš„å‰¯æœ¬ã€‚Aå’ŒBå‰¯æœ¬çš„åˆå§‹å€¼æ˜¯100ï¼Œå¹¶ä¸”åœ¨Xã€Yå’ŒZä¸ŠAå’ŒBçš„é€‰ç¥¨æ˜¯1ã€‚åŒæ ·å¯¹äºAå’ŒBï¼ŒRï¼Wï¼2ã€‚ä¸€ä¸ªå®¢æˆ·è¯»Açš„å€¼ç„¶åå°†å®ƒå†™åˆ°Bä¸Šã€‚\n1ï¼‰å½“å®¢æˆ·æ‰§è¡Œè¿™äº›æ“ä½œæ—¶ï¼Œå‡ºç°äº†ä¸€ä¸ªåˆ†åŒºï¼Œå°†æœåŠ¡å™¨Xå’ŒYä¸æœåŠ¡å™¨Zåˆ†éš”å¼€äº†ã€‚æè¿°å½“å®¢æˆ·èƒ½è®¿é—®æœåŠ¡å™¨Xå’ŒYæ—¶ï¼Œè·å¾—çš„æ³•å®šæ•°å’Œå‘ç”Ÿçš„æ“ä½œã€‚\n2ï¼‰æè¿°å½“å®¢æˆ·ä»…èƒ½è®¿é—®æœåŠ¡å™¨Zæ—¶ï¼Œè·å¾—çš„æ³•å®šæ•°å’Œå‘ç”Ÿçš„æ“ä½œã€‚\n3ï¼‰åˆ†åŒºä¿®å¤äº†ï¼Œç„¶åå¦ä¸€ä¸ªåˆ†åŒºå‘ç”Ÿäº†ï¼Œç»“æœXå’ŒZä¸Yåˆ†éš”å¼€äº†ã€‚æè¿°å½“å®¢æˆ·èƒ½è®¿é—®æœåŠ¡å™¨Xå’ŒZæ—¶ï¼Œè·å¾—çš„æ³•å®šæ•°å’Œå‘ç”Ÿçš„æ“ä½œã€‚\nç­”ï¼š\n1ï¼‰åœ¨æ•°æ®çš„v0ç‰ˆæœ¬æ—¶ï¼ŒAå’ŒBå‰¯æœ¬çš„åˆå§‹å€¼æ˜¯100ï¼Œå‡ºç°äº†ä¸€ä¸ªåˆ†åŒºï¼Œå°†æœåŠ¡å™¨Xå’ŒYä¸æœåŠ¡å™¨Zåˆ†éš”å¼€ã€‚\n   X Y Z     A = 100ï¼ˆv0) A = 100ï¼ˆv0) A = 100ï¼ˆv0)   B = 100ï¼ˆv0) B = 100ï¼ˆv0) B = 100ï¼ˆv0)    â€‹\tå®¢æˆ·å¯èƒ½ä»Xæˆ–è€…Yä¸Šè¯»å–Aï¼ŒR = 1+1 =2ï¼Œè¯»å–æˆåŠŸã€‚\nâ€‹\tå®¢æˆ·éœ€è¦åœ¨Xå’ŒYä¸Šå†™Bï¼ŒW = 1+1 = 2ï¼Œ å†™æˆåŠŸã€‚\n2)å®¢æˆ·åªèƒ½è®¿é—®æœåŠ¡å™¨Zï¼ŒR = 1ï¼Œå®¢æˆ·æ— æ³•è¯»å–ï¼›W = 1ï¼Œå®¢æˆ·æ— æ³•å†™ã€‚\n3)å½“åˆ†åŒºè¢«ä¿®å¤åï¼Œå› ä¸ºä¹‹å‰çš„åˆ†åŒºå¯¼è‡´Xå’ŒYçš„æ•°æ®è¦æ¯”Zä¸Šçš„æ•°æ®æ›´æ–°ï¼Œä¾‹å¦‚\n   X Y Z     A = 200ï¼ˆv1) A = 200ï¼ˆv1) A = 100ï¼ˆv0)   B = 300ï¼ˆv1) B = 300ï¼ˆv1) B = 100ï¼ˆv0)    æ­¤æ—¶ï¼Œå¦ä¸€ä¸ªåˆ†åŒºå‡ºç°ï¼ŒXå’ŒZä¸Yåˆ†éš”å¼€ï¼Œå½“å®¢æˆ·è¯•å›¾è·å–æ³•å®šæ•°çš„æ—¶å€™ï¼Œå‘ç°Zçš„æ•°æ®ç‰ˆæœ¬è¿‡æ—¶ï¼Œäºæ˜¯Zæ ¹æ®Xä¸Šçš„æœ€æ–°æ•°æ®æ›´æ–°è‡ªå·±ã€‚ä¹‹åå®¢æˆ·è·å–è¯»æ³•å®šæ•°ï¼ŒR = 1+1 =2ï¼Œç„¶åè¯»æˆåŠŸã€‚å®¢æˆ·è·å–å†™æ³•å®šæ•°ï¼ŒW = 1+1 =2ï¼Œå†™æˆåŠŸã€‚\n9 ä¸²è¡Œç­‰ä»·çš„äº¤é”™æ‰§è¡Œ ä¸€ä¸ªæœåŠ¡å™¨ç®¡ç†å¯¹è±¡a1, a2, \u0026hellip; an ï¼Œå®ƒä¸ºå®¢æˆ·æä¾›ä¸‹é¢ä¸¤ç§æ“ä½œï¼šread (i)è¿”å›å¯¹è±¡aiçš„å€¼ã€‚write(i, Value)å°†å¯¹è±¡aiè®¾ç½®ä¸ºå€¼Valueã€‚\näº‹åŠ¡Tå’ŒUå®šä¹‰å¦‚ä¸‹ï¼š\nT: x = read(j); y = read (i); write(j, 44); write(i, 33)\nU: x = read(k); write(i, 55); y = read (j); write(k, 66)\nè¯·ç»™å‡ºäº‹åŠ¡Tå’ŒUçš„3ä¸ªä¸²è¡ŒåŒ–ç­‰ä»·çš„äº¤é”™æ‰§è¡Œã€‚\nç­”ï¼šæˆ‘ä»¬ç»™æ¯ä¸€æ­¥åˆ†åˆ«è¡¨ä¸Šåºå·ï¼š\nT: â‘ x = read(j); â‘¡y = read (i); â‘¢write(j, 44); â‘£write(i, 33)\nU: â‘¤x = read(k); â‘¥write(i, 55); â‘¦y = read (j); â‘§write(k, 66)\nå¦‚æœæŒ‰ç…§å…ˆTåUçš„é¡ºåºä¾æ¬¡æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡çš„è¯ï¼Œæˆ‘ä»¬å‘ç°â‘ å’Œâ‘¤ï¼Œâ‘¡å’Œâ‘¦ï¼Œâ‘£å’Œâ‘¥æœ‰å†™åå†™ä¾èµ–ï¼›â‘¢å’Œâ‘¦æœ‰å†™åè¯»ä¾èµ–ï¼Œâ‘ å’Œâ‘¢ï¼Œâ‘¡å’Œâ‘£ï¼Œâ‘¡å’Œâ‘¥ï¼Œâ‘¤å’Œâ‘§æœ‰è¯»åå†™ä¾èµ–ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ä¿è¯è¿™äº›ä¾èµ–çš„é€»è¾‘é¡ºåºï¼Œä¸²è¡ŒåŒ–ç­‰ä»·çš„äº¤é”™æ‰§è¡Œå¦‚ä¸‹ï¼š\nâ‘ â‘¤â‘¡â‘¢â‘£â‘¥â‘¦â‘§\nâ‘ â‘¢â‘¤â‘¡â‘£â‘¦â‘§â‘¥\nâ‘ â‘¤â‘¢â‘¡â‘§â‘¦â‘£â‘¥\n10 ä¹è§‚å¹¶å‘æ§åˆ¶ è€ƒè™‘å°†ä¹è§‚å¹¶å‘æ§åˆ¶åº”ç”¨äºä¸‹åˆ—äº‹åŠ¡Tå’ŒUçš„æƒ…å†µï¼š\nâ€‹ T: x = read(i); write(j, 44);\nâ€‹ U: write(i, 55); write(j, 66);\nå¦‚æœäº‹åŠ¡Tå’ŒUåŒæ—¶å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œè¯•æè¿°ä»¥ä¸‹å‡ ç§æƒ…å†µçš„ç»“æœå¦‚ä½•ï¼š\n æœåŠ¡å™¨é¦–å…ˆå¤„ç†Tçš„æäº¤è¯·æ±‚ï¼Œä½¿ç”¨å‘åéªŒè¯æ–¹å¼ã€‚ æœåŠ¡å™¨é¦–å…ˆå¤„ç†Uçš„æäº¤è¯·æ±‚ï¼Œä½¿ç”¨å‘åéªŒè¯æ–¹å¼ã€‚ æœåŠ¡å™¨é¦–å…ˆå¤„ç†Tçš„æäº¤è¯·æ±‚ï¼Œä½¿ç”¨å‘å‰éªŒè¯æ–¹å¼ã€‚ æœåŠ¡å™¨é¦–å…ˆå¤„ç†Uçš„æäº¤è¯·æ±‚ï¼Œä½¿ç”¨å‘å‰éªŒè¯æ–¹å¼ã€‚  å¯¹äºä¸Šé¢çš„æ¯ç§æƒ…å†µï¼Œæè¿°äº‹åŠ¡Tå’ŒUçš„æ“ä½œé¡ºåºï¼Œæ³¨æ„å†™æ“ä½œåœ¨éªŒè¯é€šè¿‡ä¹‹åæ‰çœŸæ­£èµ·ä½œç”¨ã€‚\nç­”ï¼š\n  æœåŠ¡å™¨é¦–å…ˆå¤„ç†Tçš„æäº¤è¯·æ±‚ï¼Œä½¿ç”¨å‘åéªŒè¯æ–¹å¼ã€‚\nTå…ˆå¼€å§‹æ‰€ä»¥Tçš„éªŒè¯é˜¶æ®µæ— äº‹å‘ç”Ÿï¼ŒUè¿›å…¥éªŒè¯é˜¶æ®µä¹‹åï¼ŒUæ²¡æœ‰è¯»é›†ï¼Œæ‰€ä»¥æ²¡æœ‰å†²çªï¼Œå¯ä»¥é¡ºåˆ©æäº¤ã€‚\n  æœåŠ¡å™¨é¦–å…ˆå¤„ç†Uçš„æäº¤è¯·æ±‚ï¼Œä½¿ç”¨å‘åéªŒè¯æ–¹å¼ã€‚\nTè¿›å…¥éªŒè¯é˜¶æ®µï¼Œå‘ç°Tçš„è¯»é›†{i}ä¸Uçš„å†™é›†{i, j}æœ‰å†²çªï¼ŒTäº‹åŠ¡è¢«æ”¾å¼ƒã€‚\n  æœåŠ¡å™¨é¦–å…ˆå¤„ç†Tçš„æäº¤è¯·æ±‚ï¼Œä½¿ç”¨å‘å‰éªŒè¯æ–¹å¼ã€‚\nUè¿›å…¥éªŒè¯é˜¶æ®µï¼Œå‘ç°Uçš„å†™é›†{i,j}ä¸Tçš„è¯»é›†{i}æœ‰å†²çªï¼Œæ‰€ä»¥æ¨è¿ŸéªŒè¯ï¼Œç­‰Tçš„è¯»é›†æ‰§è¡Œå®Œæ¯•ä¹‹åå†æäº¤Uã€‚\n  æœåŠ¡å™¨é¦–å…ˆå¤„ç†Uçš„æäº¤è¯·æ±‚ï¼Œä½¿ç”¨å‘å‰éªŒè¯æ–¹å¼ã€‚\nTè¿›å…¥éªŒè¯é˜¶æ®µï¼Œå‘ç°Uæ— è¯»é›†ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡éªŒè¯ã€‚\n  ","date":"2021-12-07T14:21:24+08:00","image":"https://img2.baidu.com/it/u=1163044150,1040852846\u0026fm=26\u0026fmt=auto","permalink":"https://tweakzx.github.io/p/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8E%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97%E5%88%86%E5%B8%83%E5%BC%8F%E4%BD%9C%E4%B8%9A/","title":"ã€åˆ†å¸ƒå¼ä¸å¹¶è¡Œè®¡ç®—ã€‘åˆ†å¸ƒå¼ä½œä¸š"},{"content":" æ—¶é—´ï¼š2021-12-2 ä¸‹åˆ5ç‚¹åŠ\næ–¹å¼ï¼šé˜¿é‡Œä¼šè®®è§†é¢‘é¢è¯•\nå²—ä½ï¼šç ”ç©¶å‹å®ä¹ ç”Ÿ-æ™ºèƒ½å­˜å‚¨\n é¢è¯•è¿‡ç¨‹ è¿™æ¬¡é¢è¯•ä¸»è¦æ˜¯åœ¨èŠé¡¹ç›®ï¼ŒèŠå…´è¶£å•¥çš„ã€‚æ²¡æœ‰ä»€ä¹ˆç®—æ³•æˆ–è€…çŸ¥è¯†ç‚¹çš„æé—®ã€‚\n å…ˆåšä¸€ä¸‹è‡ªæˆ‘ä»‹ç»ã€‚ é—®æˆ‘è§‰å¾—è‡ªå·±åœ¨å­¦ä¹ ä¸Šçš„æœ€å¤§ä¼˜åŠ¿æ˜¯ä»€ä¹ˆã€‚ é—®æˆ‘å¤§ä¸‰å®ä¹ çš„ä¸»è¦å·¥ä½œï¼Œè¿™ä¸€éƒ¨åˆ†æˆ‘è¿˜æ˜¯å¿½ç•¥çš„å¸¦è¿‡äº†ã€‚ è®²äº†è‡ªå·±çš„å¤§äºŒæ—¶çš„æ¯”èµ›ã€‚ é—®äº†å¯ä»¥å®ä¹ çš„æ—¶é—´ã€‚ ç›®å‰åœ¨å­¦æ ¡é‡Œéƒ½å­¦äº†ä»€ä¹ˆè¯¾ç¨‹ã€‚ é¢è¯•å®˜é—®æˆ‘å¤§å››åœ¨åšä»€ä¹ˆï¼Œæˆ‘å›ç­”è‡ªå·±ä¿ç ”ååœ¨è¯¾é¢˜ç»„é‡Œåšç»“é¡¹çš„äº‹æƒ…ã€‚é¢è¯•å®˜æ¯”è¾ƒå¥½å¥‡æˆ‘è‡ªå·±éƒ½åšäº†ä»€ä¹ˆï¼Œæˆ‘å›ç­”ä¸œè¥¿éƒ½æ˜¯åˆ«äººåšçš„ï¼Œæˆ‘å°±æ˜¯æä¾›ä¸€äº›è¾…åŠ©æ€§çš„å·¥ä½œã€‚ ç„¶åè¯¢é—®æˆ‘è¯¾é¢˜ç»„çš„ä¸»è¦ç ”ç©¶æ˜¯ä»€ä¹ˆï¼Œæˆ‘å›ç­”äº‘è®¡ç®—ï¼Œdockerï¼Œk8sä¹‹ç±»çš„ã€‚é¢è¯•å®˜é—®é‚£ä¸ºå•¥ä½ åšçš„ä¸œè¥¿å’Œäº‘è®¡ç®—ä¸€ç‚¹å…³ç³»éƒ½æ²¡æœ‰ï¼Œåˆå»åšäº†ç®—æ³•NLPï¼Œæˆ‘å›ç­”è¿™æ˜¯è€å¸ˆå®‰æ’çš„ã€‚ é—®æˆ‘å¯¹dockerï¼Œk8säº†è§£å¤šå°‘ã€‚æˆ‘å›ç­”ä»…ä»…ä¼šç®€å•çš„ä½¿ç”¨ã€‚ åæ¥é¢è¯•å®˜è§£é‡ŠNLPä¹‹ç±»çš„å·¥ä½œä¸€èˆ¬æ˜¯è¾¾æ‘©é™¢å†…è¾¹æ¥åšï¼Œæ„æ€å¯èƒ½æ˜¯è¿™è¾¹è¿˜æ˜¯åé‡äºå¼€å‘ã€‚ é—®æˆ‘å¯¹è¿™ä¸ªéƒ¨é—¨çš„å·¥ä½œäº†è§£å—ï¼Œä¸€é¢æœ‰ä»‹ç»å—ï¼Ÿæˆ‘å›ç­”å’Œå­˜å‚¨ï¼Œé¢„è®­ç»ƒæ¨¡å‹å¥½åƒæœ‰å…³ã€‚ é¢è¯•å®˜è¯´ä½ è¦è‡ªå·±æƒ³å¥½è‡ªå·±è¦åšä»€ä¹ˆæ–¹å‘ï¼Œå…´è¶£æ˜¯æœ€å¥½çš„è€å¸ˆå•¥çš„ã€‚ï¼ˆæˆ‘ä¹Ÿæƒ³å•Šï¼‰ é¢è¯•å®˜é—®æˆ‘å¯¹NLPäº†è§£å¤šå°‘ï¼Œæˆ‘è¯´ä»…ä»…æ¯•ä¸šè®¾è®¡å’Œè¿™ä¸ªæœ‰å…³ï¼ŒçŸ¥é“é¢„è®­ç»ƒå’Œè’¸é¦ã€‚ ä»–è¯´æ„Ÿè§‰ä½ å¯¹è¿™äº›æ–¹é¢éƒ½æœ‰ä¸€ç‚¹äº†è§£ï¼Œä½†åˆéƒ½ä¸æ·±ï¼Œä¸çŸ¥é“ä½ å°†æ¥è¦åšä»€ä¹ˆã€‚æˆ‘å›ç­”è‡ªå·±ç›®å‰è¿˜åœ¨æ¢ç´¢ï¼Œæ‰“ç®—å…ˆå¼€å§‹åšåœ¨å»æ„Ÿå—è‡ªå·±æƒ³è¦ä»€ä¹ˆã€‚ æ„Ÿè§‰èŠåˆ°è¿™é‡Œï¼Œå…¶å®å·²ç»æ— è¯å¯èŠäº†ã€‚  ä¸‹é¢æ˜¯åé—®ç¯èŠ‚\n æˆ‘è¯´è‡ªå·±å¯èƒ½é—®çš„é—®é¢˜æ¯”è¾ƒå¤§ä¸å¥½å›ç­”ï¼šå¦‚æœæˆ‘æœ‰æœºä¼šå¾—åˆ°è¿™ä¸ªofferï¼Œé‚£æˆ‘éœ€è¦å¼¥è¡¥çš„å·®è·åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ é¢è¯•å®˜ä»ä¸¤ä¸ªæ–¹é¢å»ºè®®ï¼Œä¸€ä¸ªå°±æ˜¯å¦‚æœè®¡ç®—æƒ³æç®—æ³•çš„è¯ï¼Œblablaæˆ‘å¿˜äº†ã€‚å¦‚æœæƒ³åšå¼€å‘çš„è¯ï¼Œå¯ä»¥å­¦ä¹ ä¸€ä¸‹äº‘åŸç”Ÿï¼Œäº‘è®¡ç®—ä¹‹ç±»çš„çŸ¥è¯†ã€‚ é¢è¯•å®˜åˆ†æäº†ä¸€ä¸‹ä¹‹åï¼Œæˆ‘å›ç­”è‡ªå·±çš„ç†è§£ä¸çœ‹æ³• ï¼Œä¸»è¦è¯´äº†äººå·¥æ™ºèƒ½æ˜¯ä¸€ç§æ‹¿æ¥åº”ç”¨çš„æŠ€æœ¯ï¼Œåšå·¥ç¨‹çš„è¿‡ç¨‹ä¸­æ‹¿æ¥ä½¿ç”¨ï¼Œæ˜¯å·¥ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚ä¸æ˜¯æ‰€æœ‰äººéƒ½è¦å»ç ”ç©¶æ¨¡å‹ï¼Œæˆ‘ä»¬èƒ½æ‹¿æ¥å³ç”¨å³å¯ï¼Œè¿˜æ˜¯è¦å»æå‡å·¥ç¨‹ä¸Šçš„å¼€å‘èƒ½åŠ›ã€‚  é¢è¯•æ€»ç»“ æˆ‘å…¶å®çœ‹ä¸å‡ºæ¥è¿™æ¬¡çš„ç»“æœå¥½åï¼Œé¢è¯•å®˜ä¹Ÿç¡®å®æåˆ°äº†æ¬¢è¿æ¥å»åšä¸€äº›å°è¯•ï¼Œå¯ä»¥å…ˆè¿›æ¥ï¼Œå®ä¹ çš„è¿‡ç¨‹ä¸­æ‘¸ç´¢è‡ªå·±çš„å…´è¶£ï¼Œæ„Ÿå—ä¸€ä¸‹å„ä¸ªæ–¹å‘æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œä½†æ›´åƒæ˜¯ä¸€äº› è¯´æ³•æ­£ç¡®çš„å®¢å¥—è¯ã€‚\nç›®å‰è¿˜åœ¨ç­‰ç»“æœã€‚ï¼ˆå¸Œæœ›ç»“æœæ˜¯å¥½çš„å§ï¼‰\n","date":"2021-12-04T18:31:16+08:00","image":"https://img2.baidu.com/it/u=3334504742,937198599\u0026fm=26\u0026fmt=auto","permalink":"https://tweakzx.github.io/p/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95%E9%98%BF%E9%87%8C%E5%AE%9E%E4%B9%A0%E4%BA%8C%E9%9D%A2/","title":"ã€å®ä¹ é¢è¯•ã€‘é˜¿é‡Œå®ä¹ äºŒé¢"},{"content":" æ—¶é—´ï¼š2021-11-30 ä¸‹åˆ2ç‚¹\næ–¹å¼ï¼šé˜¿é‡Œä¼šè®®è§†é¢‘é¢è¯•\nå²—ä½ï¼šç ”ç©¶å‹å®ä¹ ç”Ÿ-æ™ºèƒ½å­˜å‚¨\n ä¸ºä»€ä¹ˆä¼šå‚åŠ è¿™æ¬¡é¢è¯•ï¼Ÿ å› ä¸ºæƒ³è¦äº²èº«å‚ä¸çœŸå®çš„ç§‘ç ”æ´»åŠ¨æˆ–è€…ä¸€ä¸ªçœŸå®ä¼ä¸šå†…çš„åšå·¥ç¨‹çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥æŠ•é€’äº†è¿™ä»½ç®€å†ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æƒ³åˆ°ä¼šç»™æˆ‘å®‰æ’é¢è¯•ã€‚å…¶å®é¢è¯•çš„æ—¶å€™æˆ‘å·²ç»å¿˜è®°è‡ªå·±æŠ•é€’çš„æ˜¯å“ªä¸ªè¯¾é¢˜äº†ï¼Œç°åœ¨æ¨æµ‹ä¸€ä¸‹å¯èƒ½æ˜¯å¤§è§„æ¨¡é¢„è®­ç»ƒæ¨¡å‹çš„è¿ç§»å•¥çš„ã€‚\nå› ä¸ºé¢è¯•çš„å‰ä¸€å¤©å‚åŠ äº†å­—èŠ‚çš„é¢è¯•ï¼Œååˆ†æŒ«è´¥ï¼Œæ‰€ä»¥å¯¹é¢è¯•å¯ä»¥è¯´ååˆ†æ²¡æœ‰ä¿¡å¿ƒï¼ŒåŠ ä¸Šæ”¶åˆ°çš„é‚®ä»¶é‡Œæ²¡æœ‰ä¼šè®®é“¾æ¥ã€‚æ— è®ºé¢ä¸ä¸é¢ï¼Œè¿Ÿæ—©è¦æ‰“ç”µè¯å‘ŠçŸ¥ï¼Œæ‰€ä»¥ç´¢æ€§å†³å®šæ‰“ç”µè¯æ¨è¾æ‰è¿™ä¸ªé¢è¯•ã€‚æ‰“äº†ç”µè¯ï¼Œä¼°è®¡ä¸­åˆé¢è¯•è”ç³»äººå¯èƒ½åœ¨ä¼‘æ¯ï¼Œæ‰€ä»¥è¿‡äº†ä¸€ä¼šæ‰æ¥åˆ°ï¼Œé¢è¯•è”ç³»äººåŠè¯´æˆ‘é¢è¯•æ²¡æœ‰åçš„å½±å“ï¼Œå°±å½“é”»ç‚¼è‡ªå·±ï¼Œåªæœ‰å¥½å¤„æ²¡æœ‰åå¤„ï¼Œä¸å¦‚ä¸€è¯•ã€‚æ‰€ä»¥æ²¡æœ‰æ¨è„±ï¼Œåæ­£å°±ä¸€ä¸ªå°æ—¶ï¼Œä¸€ä¸ªå°æ—¶ä¹‹åæˆ‘çš„ç”Ÿæ´»è¿˜ä¼šæ¢å¤åŸæ ·ã€‚\né¢è¯•è¿‡ç¨‹ é¢è¯•çš„æ—¶å€™å‘ç°åˆšåˆšæ¥ç”µè¯çš„äººåº”è¯¥å°±æ˜¯é¢è¯•å®˜ï¼Œé¢è¯•å®˜ç»™æˆ‘è¯¦ç»†ä»‹ç»äº†ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç ”ç©¶å‹å®ä¹ ç”Ÿä»¥åŠå®ƒå’Œå…¶ä»–çš„å®ä¹ ç”Ÿçš„åŒºåˆ«ï¼Œä»¥åŠå¯¹æ‹›è˜çš„å½±å“ã€‚ç„¶åå°±å¼€å§‹é¢è¯•ï¼Œå…ˆæ˜¯è‡ªæˆ‘ä»‹ç»ï¼Œè¿˜æ˜¯ä»‹ç»äº†æœ¬ç§‘ï¼Œç ”ç©¶ç”Ÿçš„å­¦æ ¡å’Œä¸“ä¸šï¼Œå®ä¹ ä¸æ¯”èµ›ã€‚é—®äº†æˆ‘å¤§æ¦‚æƒ³åšç§‘ç ”è¿˜æ˜¯åå·¥ç¨‹çš„æ–¹å‘ï¼Œæˆ‘å›ç­”å·¥ç¨‹ï¼Œä½†åæ¥æƒ³æƒ³åº”è¯¥å›ç­”æˆ‘éƒ½è¡Œçš„å…¶å®ã€‚\n  é¢è¯•äº†ä¸€é“ç®—æ³•é¢˜ï¼š\n å°†ä¸€ä¸ªå­—ç¬¦ä¸²æŒ‰å•è¯åè½¬ï¼Œä½†æ˜¯å¯¹ç©ºé—´çš„å¼€é”€æœ‰é™åˆ¶ï¼Œæœ€å¥½æ˜¯åœ¨åŸåœ°å€ä¸Šç›´æ¥ä¿®æ”¹ï¼Œå¦‚æœç”¨æ ˆï¼Œæˆ–è€…åˆ‡å‰²å•è¯æˆæ•°ç»„ä¹‹ç±»çš„æ–¹å¼éƒ½æ˜¯ä¸ç¬¦åˆç©ºé—´å¼€é”€è¦æ±‚çš„ã€‚\n åˆšå¼€å§‹æˆ‘æƒ³çš„æ˜¯å°†å•è¯å…ˆåˆ‡å‡ºæ¥ï¼Œé¢è¯•å®˜å‘ç°æˆ‘å¯èƒ½æ²¡æœ‰ç†è§£é¢˜ç›®å°±åˆè¯´äº†ä¸€ä¸‹ã€‚\næˆ‘ä¹‹åæƒ³è¯´åˆ¤æ–­ç©ºæ ¼ ç„¶ååšé¦–å°¾äº¤æ¢ï¼Œé¢è¯•å®˜æé†’æˆ‘å•è¯çš„é•¿åº¦å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ï¼Œè®©æˆ‘å†æƒ³æƒ³ã€‚\né¢è¯•å®˜è¯´å¯ä»¥å…ˆè¯´ä¸€ä¸‹æ€è·¯ï¼Œå†å†™ä»£ç ã€‚ï¼ˆè¯´å®è¯è¿™ç‚¹è¿˜æŒºèµçš„ã€‚ï¼‰\næœ€åæˆ‘æƒ³äº†æƒ³ï¼Œè¯´å®è¯å› ä¸ºæ²¡æœ‰ä»€ä¹ˆä¿¡å¿ƒï¼Œæˆ‘éƒ½æƒ³æ”¾å¼ƒç®—äº†ã€‚\nä½†ååè¿˜æ˜¯æƒ³åˆ°äº†å…ˆæŠŠæ¯ä¸ªå•è¯éƒ½å…ˆåœ¨å±€éƒ¨åè½¬ï¼Œç„¶åå…¨å±€ä¸€èµ·åè½¬å°±ä¸ä¼šäº§ç”Ÿå¤§çš„ç©ºé—´å¼€é”€ã€‚\né¢è¯•å®˜è¯´è¿™ä¸ªæƒ³æ³•æ˜¯å¯¹çš„ï¼Œç„¶åè®©æˆ‘è‡ªå·±å®ç°ä¸€ä¸‹ï¼Œå°±å¤§æ¦‚å†™äº†å†™ä»£ç ã€‚\nåˆé—®äº†æˆ‘è¿™ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Œæˆ‘è¯´æ˜¯O(n)ã€‚\n  é—®å¹³æ—¶æ€ä¹ˆåšæµ‹è¯•ï¼Œæˆ‘å›ç­”ç”¨è‡ªå·±è®¾è®¡æµ‹è¯•æ ·ä¾‹ï¼Œç„¶åprintçš„æ–¹æ³•å’Œç¼–è¾‘å™¨è°ƒè¯•ã€‚\nä»–é—®æˆ‘æœ‰ä¹ˆæœ‰ç”¨ä»€ä¹ˆæµ‹è¯•å·¥å…·ä¹‹ç±»çš„ï¼Œæˆ‘è¯´åœ¨è¯¾ä¸Šå­¦è¿‡UnitTest4ï¼Œä½†å®é™…ä¸Šæ²¡ç”¨è¿‡ã€‚\n  çŸ¥ä¸çŸ¥é“å¤šçº¿ç¨‹ï¼Œpthreadä¹‹ç±»çš„ã€‚\n  ä¹‹åèŠäº†å®ä¹ ï¼Œå®ä¹ æ—¶å†™çš„Jsonå·¥å…·ï¼Œæ—¥å¿—æ¥å£å¼€å‘ã€‚æˆ‘éƒ½å›ç­”å…¶å®æ²¡æœ‰ä»€ä¹ˆå«é‡‘é‡ã€‚\n  ç„¶åæ˜¯æœºå™¨äººå¤§èµ›ï¼Œè·¯å¾„è§„åˆ’ç®—æ³•ç”¨çš„æ˜¯A* ,é—®æˆ‘ä¸ºä»€ä¹ˆç”¨A* è€Œä¸æ˜¯ç”¨æœºå™¨äººèµ°è¿·å®«çš„æ–¹å¼æ¥æ“æ§æœºå™¨äººã€‚å’Œè§†è§‰ç®—æ³•çš„è®¾è®¡ï¼Œä»¥åŠOpenCVå•¥çš„ã€‚\n  æœ€åèŠäº†æœ¬ç§‘æ¯•è®¾ï¼Œä»‹ç»äº†è‡ªå·±çš„æ¯•è®¾å†…å®¹ï¼Œé—®æˆ‘è§‰å¾—æœ€æœ‰æŒ‘æˆ˜çš„éƒ¨åˆ†æ˜¯å•¥ã€‚æˆ‘å›ç­”æ˜¯losså‡½æ•°çš„è®¾è®¡ï¼Œä¸‰æ®µè’¸é¦ï¼Œæ¯æ®µçš„ä¸åŒçš„æŸå¤±è®¡ç®—æ–¹æ³•ã€‚\n  ç„¶åå°±æ˜¯åé—®ç¯èŠ‚ï¼Œæˆ‘æ²¡é—®ï¼Œç¡®å®ä¸çŸ¥é“é—®å•¥ã€‚\né¢è¯•æ€»ç»“ å¤§æ¦‚å°±åªè®°å¾—è¿™äº›äº†ï¼Œå¥½åƒå¿˜è®°äº†å¾ˆå¤šå…¶ä»–çš„ç»†èŠ‚ï¼Œä½†æ˜¯é¢è¯•å®Œå¿ƒæƒ…ä¹Ÿæ¯”ä¹‹å‰å¥½äº†ä¸€äº›ã€‚\né˜¿é‡Œå·´å·´çš„è¿™æ¬¡é¢è¯•ç»™æˆ‘æœ€å¤§çš„æ„Ÿå—å°±æ˜¯ï¼Œé¢è¯•å®˜ä¼šç¡®è®¤è‡ªå·±çš„æ„æ€æœ‰æ²¡æœ‰å‡†ç¡®ä¼ è¾¾ç»™æˆ‘ï¼Œè¿™ä¸ªç»†èŠ‚è¿˜æŒºä»¤æˆ‘æ„ŸåŠ¨çš„ã€‚é¢è¯•å®˜ä¼šæŠŠè‡ªå·±çš„é—®é¢˜æˆ–è€…å¾ˆå¤šè¦è€ƒè™‘çš„æƒ…å†µè®²çš„å¾ˆç»†è‡´ï¼Œç¡®è®¤æˆ‘ç†è§£ä¹‹åå†è®©æˆ‘æ€è€ƒå¹¶å›ç­”ï¼Œè¿™æ ·å…¶å®å¯¹æˆ‘è¿™æ ·ä¸å¤ªç†Ÿæ‚‰é¢è¯•çš„äººååˆ†å‹å¥½çš„ã€‚\né¢è¯•çš„ç»“æœè¿˜ä¸çŸ¥é“ï¼Œä½†æ˜¯æ— è®ºå¥½ä¸åï¼Œè¿™æ¬¡é¢è¯•éƒ½ç»™äº†æˆ‘ä¸€äº›é¼“èˆï¼Œå³ä¾¿æ˜¯ç»“æœä¸å¤ªå¥½ï¼Œæˆ‘ä¹Ÿä¸ä¼šæ°”é¦ï¼Œä¸ç®¡æ€ä¹ˆæ ·éƒ½è¦ç»§ç»­åŠªåŠ›ã€‚ï¼ˆå¸Œæœ›ç»“æœæ˜¯å¥½çš„å§ï¼‰\nåæ¥æ¥åˆ°äº†äºŒé¢çš„ç”µè¯ï¼Œæ‰€ä»¥ä¸€é¢åº”è¯¥æ˜¯è¿‡äº†ã€‚\n","date":"2021-12-01T21:49:57+08:00","image":"https://img2.baidu.com/it/u=3334504742,937198599\u0026fm=26\u0026fmt=auto","permalink":"https://tweakzx.github.io/p/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95%E9%98%BF%E9%87%8C%E5%AE%9E%E4%B9%A0%E7%94%9F%E9%9D%A2%E8%AF%95/","title":"ã€å®ä¹ é¢è¯•ã€‘é˜¿é‡Œå®ä¹ ç”Ÿé¢è¯•"},{"content":" æ—¶é—´ï¼š2021-11-26 ä¸‹åˆå…­ç‚¹\næ–¹å¼ï¼šé£ä¹¦è§†é¢‘é¢è¯•\nå²—ä½ï¼šåç«¯å¼€å‘\n ä¸ºä»€ä¹ˆä¼šé¢è¯•è“æ¹– å¿ƒè¡€æ¥æ½®æƒ³è¦å‡ºå»å®ä¹ ï¼Œåœ¨æ ¡å‹ç¾¤å†…å‘äº†æ±‚åŠ©ã€‚24å·ä¸­åˆï¼Œæœ¬ç§‘çš„åŒç­åŒå­¦æ¶›ç¥é—®æˆ‘æƒ³ä¸æƒ³è¯•ä¸€è¯•è“æ¹–ï¼Œæˆ‘æƒ³è¦ä¸€ä»½å®ä¹ æ¥æå‡è‡ªå·±çš„ä»£ç æ°´å¹³ï¼Œæ‰€ä»¥å½“ç„¶è¦æŠ“ä½è¿™æ¬¡æœºä¼šã€‚\næ‰€ä»¥ä¸­åˆæŠ“ç´§æ—¶é—´å†™äº†ä¸€ä»½ç®€å†äº¤ç»™äº†æ¶›ç¥å¸®å¿™å†…æ¨ã€‚æ¶›ç¥é—®æˆ‘è¦ä¸è¦å…ˆå‡†å¤‡ä¸€ä¸‹ï¼Œæˆ‘è¯´ä¸äº†ï¼Œæ—©è§£å†³æ—©è½»æ¾ï¼Œå¯èƒ½æ˜¯çŠ¯è ¢äº†ï¼Œä¹Ÿå¯èƒ½æ˜¯å¤ªäº†è§£è‡ªå·±ï¼Œæˆ‘ä¸æ˜¯ä¼šå¥½å¥½è§„åˆ’å¤ä¹ çš„äººï¼Œæ‰€ä»¥ä¸å¦‚è¶ç€çƒ­æƒ…ç›´æ¥ä¸Šã€‚\né¢è¯•çš„è¿‡ç¨‹ é¢è¯•å®˜è¿˜æ˜¯å¾ˆæ¸©æŸ”çš„ï¼Œä¸Šæ¥å…ˆè®©æˆ‘åšäº†ä¸€ä¸‹è‡ªæˆ‘ä»‹ç»ï¼Œæˆ‘ä»‹ç»äº†ä¸€ä¸‹æœ¬ç§‘å’Œç¡•å£«ï¼Œä»¥åŠä¸€æ®µå®ä¹ ç»å†ï¼Œä¸€æ®µæ¯”èµ›ç»å†ã€‚è®©è¯´ä¸€ä¸‹è§‰å¾—æœ€æœ‰æœ‰æŒ‘æˆ˜æ€§çš„å·¥ä½œï¼Ÿå®ä¹ å’Œæ¯”èµ›éƒ½å¾ˆæ°´ï¼Œæ‰€ä»¥å®è¯å®è¯´æ²¡å•¥äº®ç‚¹ã€‚\nç®—æ³•é¢˜ä¸€é“ï¼Œå†™ä¸€ä¸‹å¿«æ’ã€‚å½“æ—¶ä»£ç æ²¡æœ‰è·‘èµ·æ¥ï¼Œå› ä¸ºvscodeå¥½åƒæ›´æ–°äº†code runnerçš„é…ç½®ï¼Œæ‰€ä»¥æ²¡æœ‰è·‘èµ·æ¥ï¼Œä¸è¿‡å†™çš„ä»£ç å¤§æ¦‚ç‡å…¨æ˜¯bugï¼Œä»£ç èƒ½åŠ›ä¹Ÿæ˜¯ç¡¬ä¼¤ã€‚\nclass Solution { public: int qsort(vector\u0026lt;int\u0026gt;\u0026amp; nums,int left,int right){ int l = left; int r = right; if(l\u0026gt;=r){ return l; } int randNum = rand()%(r-l+1)+l; int temp = nums[randNum]; nums[randNum] = nums[l]; nums[l] = temp; int pivot = nums[l]; while(l\u0026lt;r){ while(l\u0026lt;r\u0026amp;\u0026amp;nums[r]\u0026gt;pivot){ r--; } nums[l] = nums[r]; while(l\u0026lt;r\u0026amp;\u0026amp;nums[l]\u0026lt;=pivot){ l++; } nums[r] = nums[l]; } nums[l] = pivot; qsort(nums,left,l-1); qsort(nums,l+1,right); return l; } vector\u0026lt;int\u0026gt; sortArray(vector\u0026lt;int\u0026gt;\u0026amp; nums) { srand((unsigned)time(NULL)); qsort(nums,0,(int)nums.size()-1); return nums; } }; ç„¶åé—®äº†ä¸€äº›åŸºç¡€é—®é¢˜ï¼š\n  Javaå’ŒC++çš„åŒºåˆ«æœ‰å“ªäº›\n  ç±»çš„é‡å†™å’Œé‡è½½\n  TCPé€šä¿¡çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ï¼Œä¸ºä»€ä¹ˆä¸èƒ½å¤šä¸€æ¬¡æˆ–è€…å°‘ä¸€æ¬¡ï¼Ÿ\n  TCPé•¿è¿æ¥å’ŒçŸ­é“¾æ¥\n  TCPå’ŒUDPçš„åŒºåˆ«\n  äº†è§£Cacheå—ï¼Ÿæˆ‘ç­”éæ‰€é—®ï¼Œå›ç­”äº†æ“ä½œç³»ç»Ÿçš„cacheã€‚\n  å…¶å®æœ‰å¯èƒ½æ˜¯é—®httpç¼“å­˜\n  è¾“å…¥urlåœ°å€æµè§ˆå™¨çš„å˜åŒ–\n  é—®æœ‰ä¹ˆæœ‰ç”¨è¿‡æ•°æ®åº“ï¼Œå¯¹æ•°æ®åº“äº†è§£å¤šå°‘ï¼Œå›ç­”ç”¨è¿‡MySQL\n  ä¸ºä»€ä¹ˆè¦ç”¨æ•°æ®åº“ï¼Ÿ\n  ç®€å•ä»‹ç»ä¸€ä¸‹äº‘è®¡ç®—æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦ç”¨äº‘è®¡ç®—\n  é¢è¯•æ€»ç»“ é¢å®Œå°±çŸ¥é“è‡ªå·±åº”è¯¥æ˜¯å‡‰äº†ï¼Œæœç„¶12æœˆ1å·æ”¶åˆ°äº†æ„Ÿè°¢ä¿¡ã€‚å…¶å®è¿˜æ˜¯è€é—®é¢˜ï¼Œè‡ªå·±çš„åŸºç¡€çŸ¥è¯†è¿˜æ˜¯è¦åœ¨å·©å›ºä¸€ä¸‹å¯èƒ½è¦å¤šçœ‹çœ‹é¢ç»ï¼Œå¦å¤–ç®—æ³•ä»€ä¹ˆçš„è¿˜æ˜¯è¦å¤šåŠ ç»ƒä¹ ã€‚\nåæ¥æ¶›ç¥å‘Šè¯‰æˆ‘æ˜¯HRè§‰å¾—åªæœ‰ä¸€ä¸ªæœˆå¤šçš„å®ä¹ æ—¶é—´å¤ªçŸ­äº†ï¼Œä¸å¥½å®‰æ’ã€‚\n","date":"2021-12-01T20:56:54+08:00","image":"https://cdn.jsdelivr.net/gh/Tweakzx/ImageHost@main/img/image-20211201214555354.png","permalink":"https://tweakzx.github.io/p/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95%E8%93%9D%E6%B9%96%E9%9D%A2%E8%AF%95%E5%87%89%E7%BB%8F/","title":"ã€å®ä¹ é¢è¯•ã€‘è“æ¹–é¢è¯•å‡‰ç»"},{"content":" æ—¶é—´ï¼š2021-11-29ä¸‹åˆä¸‰ç‚¹\næ–¹å¼ï¼šé£ä¹¦è§†é¢‘é¢è¯•\nå²—ä½ï¼šåç«¯å¼€å‘å®ä¹ ç”Ÿ-ä¸šåŠ¡ä¸­å°èŒä½\n ä¸ºä»€ä¹ˆä¼šæŠ•é€’å­—èŠ‚å®ä¹  â€‹\tå› ä¸ºä¸­ç§‘é™¢çš„ç ”ç©¶æ‰€å¤§å¤šä¸è®©å®ä¹ ï¼Œç ”äºŒæƒ³å»å®ä¹ æ˜¯ä¸€å®šä¸è¡Œçš„ã€‚ä½†æ˜¯ç ”ä¸€åœ¨é›æ –æ¹–ï¼Œè¯¾é¢˜ç»„åœ¨æµ·æ·€ï¼Œæˆ‘ç ”ä¸€åŸºæœ¬ä¸å‚ä¸ç§‘ç ”ï¼Œæ‰€ä»¥æƒ³è¦è¶æ²¡äººç®¡çš„æ—¶å€™å‡ºå»å®ä¹ ã€‚å› ä¸ºå°†æ¥å¤§æ¦‚ç‡æ˜¯åšè½¯å¼€ï¼Œæ‰€ä»¥æƒ³æ‰¾ä¸€ä»½åç«¯å¼€å‘çš„å·¥ä½œã€‚åœ¨æ ¡å‹ç¾¤é‡Œé—®äº†ä¸€ä¸‹ï¼Œæœ‰å­¦é•¿ç»™äº†ä¸€ä¸ªå†…æ¨çš„æœºä¼šï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™æ¬¡ä¸€é¢ã€‚\né¢è¯•è¿‡ç¨‹ â€‹\té¢è¯•å®˜ä¸Šæ¥è®©æˆ‘åšäº†è‡ªæˆ‘ä»‹ç»ä¹‹åå°±è®©æˆ‘å†™ä»£ç åšé¢˜ã€‚\n é¢˜ç›®ä¸€ï¼šé“¾è¡¨1-\u0026gt;2-\u0026gt;3-\u0026gt;4-\u0026gt;5-\u0026gt;6 è½¬å˜æˆ é“¾è¡¨1-\u0026gt;6-\u0026gt;2-\u0026gt;5-\u0026gt;3-\u0026gt;4\nå¤§æ¦‚æ„æ€å°±æ˜¯å°†é“¾è¡¨å¹³åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå‰ä¸€éƒ¨åˆ†é¡ºåºä¸å˜ï¼Œåä¸€éƒ¨åˆ†åè½¬åæ’ç©ºæ’å…¥å‰ä¸€éƒ¨åˆ†é“¾è¡¨ã€‚\n â€‹\tè¯´å®è¯ï¼Œè‡ªå·±çš„ä»£ç èƒ½åŠ›ç¡®å®æœ‰ç‚¹å·®ï¼ŒåŸæœ¬æ‰“ç®—ä½¿ç”¨c++æ¥å†™åæ¥æ”¹æˆäº†Javaï¼Œå› ä¸ºæˆ‘æƒ³èµ·Javaé‡Œæœ‰LinkedListè¿™ä¸ªæ•°æ®ç»“æ„ã€‚ç†ç”±æœ‰ç‚¹è’è¯å“ˆï¼Œå…¶å®æ˜¯æˆ‘æ²¡æœ‰æ„è¯†åˆ°è¦è‡ªå·±å®šä¹‰èŠ‚ç‚¹æ¥å®ç°é“¾è¡¨ï¼Œæ‰€ä»¥åœ¨æƒ³è¦å†™æŒ‡é’ˆçš„æ—¶å€™å°±å¡ä½äº†ï¼Œå®Œå…¨ä¸çŸ¥é“æ€ä¹ˆç»™LinkedListçš„é“¾è¡¨å†™æŒ‡é’ˆã€‚ç„¶åå°±å°¬ä½äº†ï¼Œé¢è¯•å®˜æ— å¥ˆè¯´é‚£å°±æ¢ä¸€é“å§ã€‚\n é¢˜ç›®äºŒï¼šåˆ¤æ–­ä¸€ä¸ªäºŒå‰æ ‘æ˜¯å¦æ˜¯å¹³è¡¡æ ‘\n â€‹\té¢˜ç›®ä¸æ˜¯å¾ˆéš¾ï¼Œä½†æ˜¯è‡ªå·±å¤ªä¹…ä¸å†™ä»£ç æœ‰äº›ç”Ÿç–äº†ï¼Œå†™å‡ºæ¥çš„ç¨‹åºä¸çŸ¥é“ä¸ºä»€ä¹ˆæ²¡æœ‰ç¼–è¯‘é€šè¿‡ã€‚è¯´å®è¯ï¼Œé¢è¯•å®˜è®©æˆ‘è‡ªå·±å®ç°ä¸€ä¸ªå•ä¾‹æ¥æµ‹è¯•ç¨‹åºï¼Œå…¶ä¸­çˆ†å‡ºçš„å„ç§é”™è¯¯ï¼Œæ— ä¸€ä¸æ­ç¤ºäº†æˆ‘å®Œå…¨æ²¡æœ‰ä»€ä¹ˆå¼€å‘ç»éªŒçš„äº‹å®ï¼Œä¾‹å¦‚å†…éƒ¨ç±»æ”¾é”™äº†ä½ç½®ï¼Œstaticçš„ç¼–è¯‘é—®é¢˜ï¼Œè¿˜æœ‰ä¸€ä¸ªç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚æ— ç–‘æ˜¯å†æ¬¡å°¬æ­»äº†ã€‚\nâ€‹\tä¹‹åé¢è¯•å®˜è®©æˆ‘è®²ä¸€è®²è‡ªå·±çš„é¡¹ç›®ç»å†ï¼Œä¸»è¦é—®äº†ä¸€ä¸‹å¤§ä¸‰åœ¨åä¸ºçš„å®ä¹ ã€‚å¯æƒœè‡ªå·±è™½ç„¶å®ä¹ äº†ï¼Œä½†å®é™…çš„å·¥ä½œå¾ˆå°‘ï¼Œå«é‡‘é‡ä¹Ÿä¸é«˜ï¼Œé¢è¯•å®˜å…´è¶£ä¸å¤§ã€‚\nâ€‹\tä¹‹åå°±æ˜¯é—®æˆ‘æœ‰æ²¡æœ‰ä»€ä¹ˆæƒ³é—®ä»–çš„ï¼Œæˆ‘å·²ç»ä¸æƒ³è¯´è¯äº†ï¼Œå°±æ²¡é—®ã€‚\nâ€‹\tè‰è‰ç»“æŸã€‚\næ€»ç»“ é¦–å…ˆè¿˜æ˜¯æŠŠè¿™ä¸¤é“é¢˜çš„ä»£ç å†™å†™å§ é¢˜ç›®ä¸€ /** * @author lizhixuan * @version 1.0 * @date 2021/12/1 15:50 */ public class ReverseList2 { public static class ListNode { int val; ListNode next; ListNode() {} ListNode(int val) { this.val = val; } ListNode(int val, ListNode next) { this.val = val; this.next = next; } } public static ListNode createInstance(int n){ ListNode head = new ListNode(1); ListNode current = head; for (int i = 2; i \u0026lt;= n; i++) { current.next = new ListNode(i); current = current.next; } return head; } public static void printList(ListNode head){ ListNode current = head; while(current.next!=null){ System.out.print(current.val); System.out.print(\u0026#34;-\u0026gt;\u0026#34;); current = current.next; } System.out.println(current.val); } public static ListNode reverse(ListNode head){ ListNode pre = null; ListNode current = head; ListNode next; while(current!=null){ next = current.next; current.next = pre; pre = current; current = next; } return pre; } public static ListNode mergeList(ListNode l1,ListNode l2){ ListNode head = l1; ListNode l1Next; ListNode l2Next; while(l1!=null\u0026amp;\u0026amp;l2!=null){ l1Next = l1.next; l2Next = l2.next; l1.next = l2; l2.next = l1Next; l1 = l1Next; l2 = l2Next; } return head; } public static ListNode reverseHalf(ListNode head){ ListNode fast = head; ListNode slow = head; while(fast != null){ if(fast.next == null){ break; } if(fast.next.next == null){ break; } fast = fast.next.next; slow = slow.next; } ListNode half = reverse(slow.next); slow.next = null; return mergeList(head,half); } public static void main(String[] args) { ListNode head = createInstance(7); printList(head); head = reverseHalf(head); printList(head); } } é¢˜ç›®äºŒ import java.util.LinkedList; import java.util.Queue; /** * @author lizhixuan * @version 1.0 * @date 2021/12/1 17:24 */ public class BalanceCheck { public static class TreeNode{ int val; TreeNode left; TreeNode right; TreeNode(int val){this.val = val;} } public static TreeNode listToTree(String src){ src = src.substring(1,src.length()-1); String[] strList = src.split(\u0026#34;,\u0026#34;); TreeNode root ; TreeNode result = null; Queue\u0026lt;TreeNode\u0026gt; queue = new LinkedList\u0026lt;\u0026gt;(); for (int i =0 ; i\u0026lt; strList.length ; i++){ if (i == 0){ root = new TreeNode(Integer.parseInt(strList[i])); result = root; queue.add(root); } if (!queue.isEmpty()){ root = queue.poll(); }else { break; } if ( i+1 \u0026lt; strList.length \u0026amp;\u0026amp; !strList[i+1].equals( \u0026#34;null\u0026#34;)){ root.left = new TreeNode(Integer.parseInt(strList[i +1])); queue.add(root.left); } if ( i + 2 \u0026lt; strList.length \u0026amp;\u0026amp; !strList[i+2].equals( \u0026#34;null\u0026#34;)){ root.right = new TreeNode(Integer.parseInt(strList[i +2])); queue.add(root.right); } i = i +1; } return result; } public static int getHeight(TreeNode root){ if(root==null){ return 0; } return Math.max(getHeight(root.left),getHeight(root.right))+1; } public static boolean isBalanced(TreeNode root){ if(root==null){ return true; } int leftHeight = getHeight(root.left); int rightHeight = getHeight(root.right); return Math.abs(leftHeight-rightHeight)\u0026lt;=1 \u0026amp;\u0026amp; isBalanced(root.left) \u0026amp;\u0026amp; isBalanced(root.right); } public static void main(String[] args) { String tree = \u0026#34;[3,9,20,null,null,15,7]\u0026#34;; TreeNode root = listToTree(tree); System.out.println(isBalanced(root)); } } ä¸€äº›çŸ¥è¯†ç‚¹   javaå†…éƒ¨ç±»ï¼š\n æˆå‘˜å†…éƒ¨ç±»ä¸­ä¸èƒ½å­˜åœ¨ä»»ä½•staticçš„å˜é‡å’Œæ–¹æ³• æˆå‘˜å†…éƒ¨ç±»æ˜¯ä¾é™„äºå¤–å›´ç±»çš„ï¼Œæ‰€ä»¥åªæœ‰å…ˆåˆ›å»ºäº†å¤–å›´ç±»æ‰èƒ½å¤Ÿåˆ›å»ºå†…éƒ¨ç±»    javaçš„staticå…³é”®å­—\n staticå˜é‡ä¹Ÿç§°ä½œé™æ€å˜é‡ï¼Œé™æ€å˜é‡è¢«æ‰€æœ‰çš„å¯¹è±¡æ‰€å…±äº«ï¼Œåœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œå®ƒå½“ä¸”ä»…å½“åœ¨ç±»åˆæ¬¡åŠ è½½æ—¶ä¼šè¢«åˆå§‹åŒ–ã€‚ ä¸ºä»€ä¹ˆè¯´staticå—å¯ä»¥ç”¨æ¥ä¼˜åŒ–ç¨‹åºæ€§èƒ½ï¼Œæ˜¯å› ä¸ºå®ƒçš„ç‰¹æ€§:åªä¼šåœ¨ç±»åŠ è½½çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ã€‚ åœ¨C/C++ä¸­staticæ˜¯å¯ä»¥ä½œç”¨åŸŸå±€éƒ¨å˜é‡çš„ï¼Œä½†æ˜¯åœ¨Javaä¸­åˆ‡è®°ï¼šstaticæ˜¯ä¸å…è®¸ç”¨æ¥ä¿®é¥°å±€éƒ¨å˜é‡ã€‚    åæ€  è‡ªå·±è¿˜æ˜¯ç¼ºä¹ä»£ç ç»éªŒï¼Œä»£ç å†™ä¸å‡ºæ¥ï¼Œé¢è¯•å®˜æ˜æ˜¾ååˆ†å¤±æœ›ï¼Œå¤±å»è€å¿ƒä¹‹åå¤šæ¬¡å¹æ°”æ‚è„¸ï¼Œè¯´å®è¯å‹åŠ›è¿˜æ˜¯æŒºå¤§çš„ï¼Œæ¯•ç«Ÿç¡®å®æŒºä¸¢è„¸çš„ã€‚ä»¥åä¹Ÿè¦å¤šå†™ä¸€ç‚¹ä»£ç ã€‚ æ‰“ç®—æŠŠè‡ªå·±çš„å­¦ä¹ æ€»ç»“ä¸‹æ¥ï¼Œäºæ˜¯ä¹Ÿæœ‰äº†è¿™ç¯‡åšå®¢ï¼Œå¸Œæœ›è‡ªå·±å¯ä»¥åšæŒå†™åšå®¢ï¼Œè¯´å®è¯ï¼Œé¢è¯•å®Œå‹åŠ›æŒºå¤§ï¼Œæ„Ÿè§‰è‡ªå·±å°±æ˜¯ä¸€ä¸ªæ— æ•Œé“åºŸç‰©ï¼Œå†™åšå®¢å†™å‡ºæ¥æ„Ÿè§‰å¥½ä¸€äº›äº†ã€‚  ","date":"2021-11-29T16:52:26+08:00","image":"https://cdn.jsdelivr.net/gh/Tweakzx/ImageHost@main/img/bytedance.jpg","permalink":"https://tweakzx.github.io/p/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95%E5%AD%97%E8%8A%82%E9%9D%A2%E8%AF%95%E5%87%89%E7%BB%8F/","title":"ã€å®ä¹ é¢è¯•ã€‘å­—èŠ‚é¢è¯•å‡‰ç»"}]